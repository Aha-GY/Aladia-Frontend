(self["webpackChunk_100ms_preview2"]=self["webpackChunk_100ms_preview2"]||[]).push([[504],{1760:function(e,t,i){"use strict";i.d(t,{JC:function(){return dc},yu:function(){return zs},Kd:function(){return No},iV:function(){return Bo},ox:function(){return ws},TI:function(){return Zs},NT:function(){return $s},DX:function(){return to},a3:function(){return Ps},VP:function(){return xs},L1:function(){return Fs},wB:function(){return Ns},Kr:function(){return Wo},Ns:function(){return Ho},rZ:function(){return Bs},pA:function(){return Ts},s3:function(){return Is},j7:function(){return jo},SO:function(){return Xo},dr:function(){return js},ws:function(){return _s},k6:function(){return Gs},b:function(){return Ys},B4:function(){return eo},VH:function(){return Ws},sj:function(){return $o},q8:function(){return Lo},ZD:function(){return Es},kU:function(){return Oo},wQ:function(){return no}});var n={};i.r(n),i.d(n,{fixNegotiationNeeded:function(){return Z},shimAddTrackRemoveTrack:function(){return Q},shimAddTrackRemoveTrackWithNative:function(){return J},shimGetDisplayMedia:function(){return V},shimGetSendersWithDtmf:function(){return q},shimGetStats:function(){return z},shimGetUserMedia:function(){return $},shimMediaStream:function(){return W},shimOnTrack:function(){return H},shimPeerConnection:function(){return Y},shimSenderReceiverGetStats:function(){return K}});var r={};i.r(r),i.d(r,{shimAddTransceiver:function(){return ae},shimCreateAnswer:function(){return ue},shimCreateOffer:function(){return ce},shimGetDisplayMedia:function(){return ee},shimGetParameters:function(){return le},shimGetUserMedia:function(){return X},shimOnTrack:function(){return te},shimPeerConnection:function(){return ie},shimRTCDataChannel:function(){return oe},shimReceiverGetStats:function(){return re},shimRemoveStream:function(){return se},shimSenderGetStats:function(){return ne}});var s={};i.r(s),i.d(s,{shimAudioContext:function(){return be},shimCallbacksAPI:function(){return pe},shimConstraints:function(){return ve},shimCreateOfferLegacy:function(){return ye},shimGetUserMedia:function(){return fe},shimLocalStreamsAPI:function(){return de},shimRTCIceServerUrls:function(){return ge},shimRemoteStreamsAPI:function(){return he},shimTrackEventTransceiver:function(){return me}});var o={};i.r(o),i.d(o,{removeExtmapAllowMixed:function(){return _e},shimAddIceCandidateNullOrEmpty:function(){return Ae},shimConnectionState:function(){return Ce},shimMaxMessageSize:function(){return Ee},shimParameterlessSetLocalDescription:function(){return Ie},shimRTCIceCandidate:function(){return Se},shimRTCIceCandidateRelayProtocol:function(){return we},shimSendThrowTypeError:function(){return Pe}});i(4114),i(6573),i(8100),i(7936),i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698),i(7467),i(4732),i(9577),i(8992),i(3215),i(4520),i(2577),i(3949),i(1454),i(8872),i(7550),i(4979),i(4603),i(7566),i(8721);function a(e,t){return e===t}function l(e,t,i){if(null===t||null===i||t.length!==i.length)return!1;for(var n=t.length,r=0;r<n;r++)if(!e(t[r],i[r]))return!1;return!0}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,i=null,n=null;return function(){return l(t,i,arguments)||(n=e.apply(null,arguments)),i=arguments,n}}function u(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"===typeof e}))){var i=t.map((function(e){return typeof e})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+i+"]")}return t}function d(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var s=0,o=n.pop(),a=u(n),l=e.apply(void 0,[function(){return s++,o.apply(null,arguments)}].concat(i)),c=e((function(){for(var e=[],t=a.length,i=0;i<t;i++)e.push(a[i].apply(null,arguments));return l.apply(null,e)}));return c.resultFunc=o,c.dependencies=a,c.recomputations=function(){return s},c.resetRecomputations=function(){return s=0},c}}var h=d(c);var p,f=i(5135),v=new Uint8Array(16);function g(){if(!p&&(p="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!p))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return p(v)}var m=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function y(e){return"string"===typeof e&&m.test(e)}for(var b=y,k=[],T=0;T<256;++T)k.push((T+256).toString(16).substr(1));function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]).toLowerCase();if(!b(i))throw TypeError("Stringified UUID is invalid");return i}var w=S;function E(e,t,i){e=e||{};var n=e.random||(e.rng||g)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return w(n)}var P=E,C=i(1029),_=i.n(C);let A=!0,I=!0;function R(e,t,i){const n=e.match(t);return n&&n.length>=i&&parseInt(n[i],10)}function L(e,t,i){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return r.apply(this,arguments);const s=e=>{const t=i(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,s),r.apply(this,[e,s])};const s=n.removeEventListener;n.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(i))return s.apply(this,arguments);const n=this._eventMap[t].get(i);return this._eventMap[t].delete(i),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function D(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(A=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function O(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(I=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function M(){if("object"===typeof window){if(A)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}}function x(e,t){I&&console.warn(e+" is deprecated, please use "+t+" instead.")}function N(e){const t={browser:null,version:null};if("undefined"===typeof e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:i}=e;if(i.mozGetUserMedia)t.browser="firefox",t.version=R(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=R(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!i.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=R(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function U(e){return"[object Object]"===Object.prototype.toString.call(e)}function F(e){return U(e)?Object.keys(e).reduce((function(t,i){const n=U(e[i]),r=n?F(e[i]):e[i],s=n&&!Object.keys(r).length;return void 0===r||s?t:Object.assign(t,{[i]:r})}),{}):e}function j(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach((n=>{n.endsWith("Id")?j(e,e.get(t[n]),i):n.endsWith("Ids")&&t[n].forEach((t=>{j(e,e.get(t),i)}))})))}function B(e,t,i){const n=i?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const s=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((t=>{e.forEach((i=>{i.type===n&&i.trackId===t.id&&j(e,i,r)}))})),r}const G=M;function $(e,t){const i=e&&e.navigator;if(!i.mediaDevices)return;const n=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((i=>{if("require"===i||"advanced"===i||"mediaSource"===i)return;const n="object"===typeof e[i]?e[i]:{ideal:e[i]};void 0!==n.exact&&"number"===typeof n.exact&&(n.min=n.max=n.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"===typeof n.ideal?(e[r("min",i)]=n.ideal,t.optional.push(e),e={},e[r("max",i)]=n.ideal,t.optional.push(e)):(e[r("",i)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!==typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",i)]=n.exact):["min","max"].forEach((e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,i)]=n[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if(e=JSON.parse(JSON.stringify(e)),e&&"object"===typeof e.audio){const t=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),t(e.audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===typeof e.video){let s=e.video.facingMode;s=s&&("object"===typeof s?s:{ideal:s});const o=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(t=["front"]),t)return i.mediaDevices.enumerateDevices().then((i=>{i=i.filter((e=>"videoinput"===e.kind));let o=i.find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!o&&i.length&&t.includes("back")&&(o=i[i.length-1]),o&&(e.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=n(e.video),G("chrome: "+JSON.stringify(e)),r(e)}))}e.video=n(e.video)}return G("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(e,t,n){r(e,(e=>{i.webkitGetUserMedia(e,t,(e=>{n&&n(s(e))}))}))};if(i.getUserMedia=o.bind(i),i.mediaDevices.getUserMedia){const e=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(s(e))))))}}}function V(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"===typeof t?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then((t=>{const n=i.video&&i.video.width,r=i.video&&i.video.height,s=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},n&&(i.video.mandatory.maxWidth=n),r&&(i.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(i)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function W(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function H(e){if("object"===typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===i.track.id)):{track:i.track};const r=new Event("track");r.track=i.track,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===i.id)):{track:i};const r=new Event("track");r.track=i,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else L(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function q(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let r=i.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function z(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,n]=arguments;if(arguments.length>0&&"function"===typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!==typeof e))return t.apply(this,[]);const r=function(e){const t={},i=e.result();return i.forEach((e=>{const i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{i[t]=e.stat(t)})),t[i.id]=i})),t},s=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const n=function(e){i(s(r(e)))};return t.apply(this,[n,e])}return new Promise(((e,i)=>{t.apply(this,[function(t){e(s(r(t)))},i])})).then(i,n)}}function K(e){if(!("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>B(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),L(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>B(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,i,n;return this.getSenders().forEach((i=>{i.track===e&&(t?n=!0:t=i)})),this.getReceivers().forEach((t=>(t.track===e&&(i?n=!0:i=t),t.track===e))),n||t&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function J(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(n)&&this._shimmedLocalStreams[i.id].push(n):this._shimmedLocalStreams[i.id]=[i,n],n};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{const t=this.getSenders().find((t=>t.track===e));if(t)throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();i.apply(this,arguments);const n=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const i=this._shimmedLocalStreams[t].indexOf(e);-1!==i&&this._shimmedLocalStreams[t].splice(i,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function Q(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return J(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=i.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{const t=this.getSenders().find((t=>t.track===e));if(t)throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],r=e._streams[n.id];i=i.replace(new RegExp(r.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:i})}function o(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],r=e._streams[n.id];i=i.replace(new RegExp(n.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:i})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const r=this.getSenders().find((e=>e.track===t));if(r)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const s=this._streams[i.id];if(s)s.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const n=new e.MediaStream([t]);this._streams[i.id]=n,this._reverseStreams[n.id]=i,this.addStream(n)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments,t=arguments.length&&"function"===typeof arguments[0];return t?i.apply(this,[t=>{const i=s(this,t);e[0].apply(null,[i])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):i.apply(this,arguments).then((e=>s(this,e)))}};e.RTCPeerConnection.prototype[t]=n[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=o(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=l.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");const t=e._pc===this;if(!t)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let i;this._streams=this._streams||{},Object.keys(this._streams).forEach((t=>{const n=this._streams[t].getTracks().find((t=>e.track===t));n&&(i=this._streams[t])})),i&&(1===i.getTracks().length?this.removeStream(this._reverseStreams[i.id]):i.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Y(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}))}function Z(e,t){L(e,"negotiationneeded",(e=>{const i=e.target;if(!(t.version<72||i.getConfiguration&&"plan-b"===i.getConfiguration().sdpSemantics)||"stable"===i.signalingState)return e}))}function X(e,t){const i=e&&e.navigator,n=e&&e.MediaStreamTrack;if(i.getUserMedia=function(e,t,n){x("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const e=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},t=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(i){return"object"===typeof i&&"object"===typeof i.audio&&(i=JSON.parse(JSON.stringify(i)),e(i.audio,"autoGainControl","mozAutoGainControl"),e(i.audio,"noiseSuppression","mozNoiseSuppression")),t(i)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const i=t.apply(this,arguments);return e(i,"mozAutoGainControl","autoGainControl"),e(i,"mozNoiseSuppression","noiseSuppression"),i}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(i){return"audio"===this.kind&&"object"===typeof i&&(i=JSON.parse(JSON.stringify(i)),e(i,"autoGainControl","mozAutoGainControl"),e(i,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[i])}}}}function ee(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===i.video?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function te(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ie(e,t){if("object"!==typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}));const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,s]=arguments;return n.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=i[e.type]||e.type}))}catch(n){if("TypeError"!==n.name)throw n;e.forEach(((t,n)=>{e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(r,s)}}function ne(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function re(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),L(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function se(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){x("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function oe(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ae(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const i=e.length>0;i&&e.forEach((e=>{if("rid"in e){const t=/^[a-z0-9]{0,16}$/i;if(!t.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const n=t.apply(this,arguments);if(i){const{sender:t}=n,i=t.getParameters();(!("encodings"in i)||1===i.encodings.length&&0===Object.keys(i.encodings[0]).length)&&(i.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(i).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return n})}function le(e){if("object"!==typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ce(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function ue(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function de(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((i=>t.call(this,i,e))),e.getVideoTracks().forEach((i=>t.call(this,i,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const i=e.getTracks();this.getSenders().forEach((e=>{i.includes(e.track)&&this.removeTrack(e)}))})}}function he(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const i=new Event("addstream");i.stream=t,e.dispatchEvent(i)}))}),t.apply(e,arguments)}}}function pe(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,n=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r};let a=function(e,t,i){const n=r.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n};t.setLocalDescription=a,a=function(e,t,i){const n=s.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.setRemoteDescription=a,a=function(e,t,i){const n=o.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.addIceCandidate=a}function fe(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>i(ve(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,i,n){t.mediaDevices.getUserMedia(e).then(i,n)}.bind(t))}function ve(e){return e&&void 0!==e.video?Object.assign({},e,{video:F(e.video)}):e}function ge(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){const t=[];for(let i=0;i<e.iceServers.length;i++){let n=e.iceServers[i];void 0===n.urls&&n.url?(x("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[i])}e.iceServers=t}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function me(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ye(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const i=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function be(e){"object"!==typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var ke=i(3298),Te=i.n(ke);function Se(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const i=new t(e),n=Te().parseCandidate(e.candidate);for(const e in n)e in i||Object.defineProperty(i,e,{value:n[e]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,L(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function we(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||L(e,"icecandidate",(e=>{if(e.candidate){const t=Te().parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Ee(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});const i=function(e){if(!e||!e.sdp)return!1;const t=Te().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Te().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},n=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const i=parseInt(t[1],10);return i!==i?-1:i},r=function(e){let i=65536;return"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i},s=function(e,i){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const r=Te().matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?n=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==i&&(n=2147483637),n},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const e=n(arguments[0]),t=r(e),i=s(arguments[0],e);let o;o=0===t&&0===i?Number.POSITIVE_INFINITY:0===t||0===i?Math.max(t,i):Math.min(t,i);const a={};Object.defineProperty(a,"maxMessageSize",{get(){return o}}),this._sctp=a}return o.apply(this,arguments)}}function Pe(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const i=e.send;e.send=function(){const n=arguments[0],r=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=i.apply(this,arguments);return t(e,this),e},L(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Ce(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const i=new Event("connectionstatechange",e);t.dispatchEvent(i)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}}))}function _e(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const i=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:i}):t.sdp=i}return i.apply(this,arguments)}}function Ae(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&0!==i.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Ie(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&0!==i.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!==typeof e||e.type&&e.sdp)return i.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer";break}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return i.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then((e=>i.apply(this,[e])))})}function Re({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=M,a=N(e),l={browserDetails:a,commonShim:o,extractVersion:R,disableLog:D,disableWarnings:O,sdp:ke};switch(a.browser){case"chrome":if(!n||!Y||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),l;if(null===a.version)return i("Chrome shim can not determine version, not shimming."),l;i("adapter.js shimming chrome."),l.browserShim=n,Ae(e,a),Ie(e,a),$(e,a),W(e,a),Y(e,a),H(e,a),Q(e,a),q(e,a),z(e,a),K(e,a),Z(e,a),Se(e,a),we(e,a),Ce(e,a),Ee(e,a),Pe(e,a),_e(e,a);break;case"firefox":if(!r||!ie||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),l;i("adapter.js shimming firefox."),l.browserShim=r,Ae(e,a),Ie(e,a),X(e,a),ie(e,a),te(e,a),se(e,a),ne(e,a),re(e,a),oe(e,a),ae(e,a),le(e,a),ce(e,a),ue(e,a),Se(e,a),Ce(e,a),Ee(e,a),Pe(e,a);break;case"safari":if(!s||!t.shimSafari)return i("Safari shim is not included in this adapter release."),l;i("adapter.js shimming safari."),l.browserShim=s,Ae(e,a),Ie(e,a),ge(e,a),ye(e,a),pe(e,a),de(e,a),he(e,a),me(e,a),fe(e,a),be(e,a),Se(e,a),we(e,a),Ee(e,a),Pe(e,a),_e(e,a);break;default:i("Unsupported browser!");break}return l}const Le=Re({window:"undefined"===typeof window?void 0:window});var De=Le,Oe=i(8974),Me=i.n(Oe);function xe(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(i.length?" "+i.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Ne(e){return!!e&&!!e[wt]}function Ue(e){var t;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var i=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return i===Object||"function"==typeof i&&Function.toString.call(i)===Et}(e)||Array.isArray(e)||!!e[St]||!!(null===(t=e.constructor)||void 0===t?void 0:t[St])||We(e)||He(e))}function Fe(e,t,i){void 0===i&&(i=!1),0===je(e)?(i?Object.keys:Pt)(e).forEach((function(n){i&&"symbol"==typeof n||t(n,e[n],e)})):e.forEach((function(i,n){return t(n,i,e)}))}function je(e){var t=e[wt];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:We(e)?2:He(e)?3:0}function Be(e,t){return 2===je(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Ge(e,t){return 2===je(e)?e.get(t):e[t]}function $e(e,t,i){var n=je(e);2===n?e.set(t,i):3===n?e.add(i):e[t]=i}function Ve(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function We(e){return yt&&e instanceof Map}function He(e){return bt&&e instanceof Set}function qe(e){return e.o||e.t}function ze(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=Ct(e);delete t[wt];for(var i=Pt(t),n=0;n<i.length;n++){var r=i[n],s=t[r];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[r]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[r]})}return Object.create(Object.getPrototypeOf(e),t)}function Ke(e,t){return void 0===t&&(t=!1),Qe(e)||Ne(e)||!Ue(e)||(je(e)>1&&(e.set=e.add=e.clear=e.delete=Je),Object.freeze(e),t&&Fe(e,(function(e,t){return Ke(t,!0)}),!0)),e}function Je(){xe(2)}function Qe(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function Ye(e){var t=_t[e];return t||xe(18,e),t}function Ze(){return gt}function Xe(e,t){t&&(Ye("Patches"),e.u=[],e.s=[],e.v=t)}function et(e){tt(e),e.p.forEach(nt),e.p=null}function tt(e){e===gt&&(gt=e.l)}function it(e){return gt={p:[],l:gt,h:e,m:!0,_:0}}function nt(e){var t=e[wt];0===t.i||1===t.i?t.j():t.g=!0}function rt(e,t){t._=t.p.length;var i=t.p[0],n=void 0!==e&&e!==i;return t.h.O||Ye("ES5").S(t,e,n),n?(i[wt].P&&(et(t),xe(4)),Ue(e)&&(e=st(t,e),t.l||at(t,e)),t.u&&Ye("Patches").M(i[wt].t,e,t.u,t.s)):e=st(t,i,[]),et(t),t.u&&t.v(t.u,t.s),e!==Tt?e:void 0}function st(e,t,i){if(Qe(t))return t;var n=t[wt];if(!n)return Fe(t,(function(r,s){return ot(e,n,t,r,s,i)}),!0),t;if(n.A!==e)return t;if(!n.P)return at(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var r=4===n.i||5===n.i?n.o=ze(n.k):n.o,s=r,o=!1;3===n.i&&(s=new Set(r),r.clear(),o=!0),Fe(s,(function(t,s){return ot(e,n,r,t,s,i,o)})),at(e,r,!1),i&&e.u&&Ye("Patches").N(n,i,e.u,e.s)}return n.o}function ot(e,t,i,n,r,s,o){if(Ne(r)){var a=st(e,r,s&&t&&3!==t.i&&!Be(t.R,n)?s.concat(n):void 0);if($e(i,n,a),!Ne(a))return;e.m=!1}else o&&i.add(r);if(Ue(r)&&!Qe(r)){if(!e.h.D&&e._<1)return;st(e,r),t&&t.A.l||at(e,r)}}function at(e,t,i){void 0===i&&(i=!1),!e.l&&e.h.D&&e.m&&Ke(t,i)}function lt(e,t){var i=e[wt];return(i?qe(i):e)[t]}function ct(e,t){if(t in e)for(var i=Object.getPrototypeOf(e);i;){var n=Object.getOwnPropertyDescriptor(i,t);if(n)return n;i=Object.getPrototypeOf(i)}}function ut(e){e.P||(e.P=!0,e.l&&ut(e.l))}function dt(e){e.o||(e.o=ze(e.t))}function ht(e,t,i){var n=We(t)?Ye("MapSet").F(t,i):He(t)?Ye("MapSet").T(t,i):e.O?function(e,t){var i=Array.isArray(e),n={i:i?1:0,A:t?t.A:Ze(),P:!1,I:!1,R:{},l:t,t:e,k:null,o:null,j:null,C:!1},r=n,s=At;i&&(r=[n],s=It);var o=Proxy.revocable(r,s),a=o.revoke,l=o.proxy;return n.k=l,n.j=a,l}(t,i):Ye("ES5").J(t,i);return(i?i.A:Ze()).p.push(n),n}function pt(e){return Ne(e)||xe(22,e),function e(t){if(!Ue(t))return t;var i,n=t[wt],r=je(t);if(n){if(!n.P&&(n.i<4||!Ye("ES5").K(n)))return n.t;n.I=!0,i=ft(t,r),n.I=!1}else i=ft(t,r);return Fe(i,(function(t,r){n&&Ge(n.t,t)===r||$e(i,t,e(r))})),3===r?new Set(i):i}(e)}function ft(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return ze(e)}var vt,gt,mt="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),yt="undefined"!=typeof Map,bt="undefined"!=typeof Set,kt="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,Tt=mt?Symbol.for("immer-nothing"):((vt={})["immer-nothing"]=!0,vt),St=mt?Symbol.for("immer-draftable"):"__$immer_draftable",wt=mt?Symbol.for("immer-state"):"__$immer_state",Et=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),Pt="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Ct=Object.getOwnPropertyDescriptors||function(e){var t={};return Pt(e).forEach((function(i){t[i]=Object.getOwnPropertyDescriptor(e,i)})),t},_t={},At={get:function(e,t){if(t===wt)return e;var i=qe(e);if(!Be(i,t))return function(e,t,i){var n,r=ct(t,i);return r?"value"in r?r.value:null===(n=r.get)||void 0===n?void 0:n.call(e.k):void 0}(e,i,t);var n=i[t];return e.I||!Ue(n)?n:n===lt(e.t,t)?(dt(e),e.o[t]=ht(e.A.h,n,e)):n},has:function(e,t){return t in qe(e)},ownKeys:function(e){return Reflect.ownKeys(qe(e))},set:function(e,t,i){var n=ct(qe(e),t);if(null==n?void 0:n.set)return n.set.call(e.k,i),!0;if(!e.P){var r=lt(qe(e),t),s=null==r?void 0:r[wt];if(s&&s.t===i)return e.o[t]=i,e.R[t]=!1,!0;if(Ve(i,r)&&(void 0!==i||Be(e.t,t)))return!0;dt(e),ut(e)}return e.o[t]===i&&(void 0!==i||t in e.o)||Number.isNaN(i)&&Number.isNaN(e.o[t])||(e.o[t]=i,e.R[t]=!0),!0},deleteProperty:function(e,t){return void 0!==lt(e.t,t)||t in e.t?(e.R[t]=!1,dt(e),ut(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var i=qe(e),n=Reflect.getOwnPropertyDescriptor(i,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:i[t]}:n},defineProperty:function(){xe(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){xe(12)}},It={};Fe(At,(function(e,t){It[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),It.deleteProperty=function(e,t){return It.set.call(this,e,t,void 0)},It.set=function(e,t,i){return At.set.call(this,e[0],t,i,e[0])};var Rt=function(){function e(e){var t=this;this.O=kt,this.D=!0,this.produce=function(e,i,n){if("function"==typeof e&&"function"!=typeof i){var r=i;i=e;var s=t;return function(e){var t=this;void 0===e&&(e=r);for(var n=arguments.length,o=Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return s.produce(e,(function(e){var n;return(n=i).call.apply(n,[t,e].concat(o))}))}}var o;if("function"!=typeof i&&xe(6),void 0!==n&&"function"!=typeof n&&xe(7),Ue(e)){var a=it(t),l=ht(t,e,void 0),c=!0;try{o=i(l),c=!1}finally{c?et(a):tt(a)}return"undefined"!=typeof Promise&&o instanceof Promise?o.then((function(e){return Xe(a,n),rt(e,a)}),(function(e){throw et(a),e})):(Xe(a,n),rt(o,a))}if(!e||"object"!=typeof e){if(void 0===(o=i(e))&&(o=e),o===Tt&&(o=void 0),t.D&&Ke(o,!0),n){var u=[],d=[];Ye("Patches").M(e,o,u,d),n(u,d)}return o}xe(21,e)},this.produceWithPatches=function(e,i){if("function"==typeof e)return function(i){for(var n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return t.produceWithPatches(i,(function(t){return e.apply(void 0,[t].concat(r))}))};var n,r,s=t.produce(e,i,(function(e,t){n=e,r=t}));return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(e){return[e,n,r]})):[s,n,r]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){Ue(e)||xe(8),Ne(e)&&(e=pt(e));var t=it(this),i=ht(this,e,void 0);return i[wt].C=!0,tt(t),i},t.finishDraft=function(e,t){var i=e&&e[wt],n=i.A;return Xe(n,t),rt(void 0,n)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!kt&&xe(20),this.O=e},t.applyPatches=function(e,t){var i;for(i=t.length-1;i>=0;i--){var n=t[i];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}i>-1&&(t=t.slice(i+1));var r=Ye("Patches").$;return Ne(e)?r(e,t):this.produce(e,(function(e){return r(e,t)}))},e}(),Lt=new Rt,Dt=Lt.produce;Lt.produceWithPatches.bind(Lt),Lt.setAutoFreeze.bind(Lt),Lt.setUseProxies.bind(Lt),Lt.applyPatches.bind(Lt),Lt.createDraft.bind(Lt),Lt.finishDraft.bind(Lt);function Ot(e,t){if(Object.is(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(let n=0;n<i.length;n++)if(!Object.prototype.hasOwnProperty.call(t,i[n])||!Object.is(e[i[n]],t[i[n]]))return!1;return!0}var Mt=Ot;function xt(e){let t;const i=new Set,n=(e,n)=>{const r="function"===typeof e?e(t):e;if(r!==t){const e=t;t=n?r:Object.assign({},t,r),i.forEach((i=>i(t,e)))}},r=()=>t,s=(e,n=r,s=Object.is)=>{let o=n(t);function a(){const i=n(t);if(!s(o,i)){const t=o;e(o=i,t)}}return i.add(a),()=>i.delete(a)},o=(e,t,n)=>t||n?s(e,t,n):(i.add(e),()=>i.delete(e)),a=()=>i.clear(),l={setState:n,getState:r,subscribe:o,destroy:a};return t=e(n,r,l),l}var Nt=xt,Ut=i(1186),Ft=Object.defineProperty,jt=Object.defineProperties,Bt=Object.getOwnPropertyDescriptors,Gt=Object.getOwnPropertySymbols,$t=Object.getPrototypeOf,Vt=Object.prototype.hasOwnProperty,Wt=Object.prototype.propertyIsEnumerable,Ht=Reflect.get,qt=(e,t,i)=>t in e?Ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,zt=(e,t)=>{for(var i in t||(t={}))Vt.call(t,i)&&qt(e,i,t[i]);if(Gt)for(var i of Gt(t))Wt.call(t,i)&&qt(e,i,t[i]);return e},Kt=(e,t)=>jt(e,Bt(t)),Jt=(e,t)=>{var i={};for(var n in e)Vt.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&Gt)for(var n of Gt(e))t.indexOf(n)<0&&Wt.call(e,n)&&(i[n]=e[n]);return i},Qt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Yt=(e,t,i)=>Ht($t(e),i,t),Zt=(e,t,i)=>new Promise(((n,r)=>{var s=e=>{try{a(i.next(e))}catch(Be){r(Be)}},o=e=>{try{a(i.throw(e))}catch(Be){r(Be)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,o);a((i=i.apply(e,t)).next())})),Xt=Qt(((e,t)=>{t.exports={version:"0.12.28",license:"MIT",repository:{type:"git",url:"https://github.com/100mslive/web-sdks.git",directory:"packages/hms-video-store"},main:"dist/index.cjs.js",module:"dist/index.js",typings:"dist/index.d.ts",files:["dist","src"],engines:{node:">=12"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},sideEffects:!1,scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",format:"prettier --write src/**/*.ts",test:"jest --maxWorkers=1","test:watch":"jest --watch","test:coverage":"jest --coverage",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",docs:"rm -rf ./docs && typedoc && rm -f ./docs/README.md && mkdir ./docs/home &&mv ./docs/modules.md ./docs/home/content.md && node ../../scripts/docs-store && npx prettier --write './docs/**/*'"},name:"@100mslive/hms-video-store",author:"100ms",dependencies:{eventemitter2:"^6.4.9",immer:"^9.0.6","lodash.isequal":"^4.5.0",reselect:"4.0.0","sdp-transform":"^2.14.1","ua-parser-js":"^1.0.1",uuid:"^8.3.2","webrtc-adapter":"^8.0.0",zustand:"3.5.7"},devDependencies:{"@types/dom-screen-wake-lock":"^1.0.1","@types/lodash.isequal":"^4.5.8","@types/sdp-transform":"^2.4.4","@types/ua-parser-js":"^0.7.36","@types/uuid":"^8.3.0","jest-canvas-mock":"^2.3.1","jsdom-worker":"^0.3.0",tslib:"^2.2.0"},description:"@100mslive Core SDK which abstracts the complexities of webRTC while providing a reactive store for data management with a unidirectional data flow",keywords:["video","webrtc","conferencing","100ms"],gitHead:"c4d7367340117e66de386fc7aaa9b5e95abd19ed"}})),ei=(e=>(e.Disconnected="Disconnected",e.Preview="Preview",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed",e))(ei||{}),ti=()=>({room:{id:"",isConnected:!1,name:"",peers:[],localPeer:"",roomState:"Disconnected",recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[],sessionStore:{},templateAppData:{},polls:{},whiteboards:{},hideLocalPeer:!1}),ii=()=>({peerStats:{},remoteTrackStats:{},localTrackStats:{},localPeer:{id:""}}),ni=(e=>(e.CHAT="chat",e))(ni||{}),ri=(e=>(e.INFO="info",e.ERROR="error",e))(ri||{}),si=(e=>(e.PEER_JOINED="PEER_JOINED",e.PEER_LEFT="PEER_LEFT",e.PEER_LIST="PEER_LIST",e.NEW_MESSAGE="NEW_MESSAGE",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED",e.TRACK_ADDED="TRACK_ADDED",e.TRACK_REMOVED="TRACK_REMOVED",e.TRACK_MUTED="TRACK_MUTED",e.TRACK_UNMUTED="TRACK_UNMUTED",e.TRACK_DEGRADED="TRACK_DEGRADED",e.TRACK_RESTORED="TRACK_RESTORED",e.TRACK_DESCRIPTION_CHANGED="TRACK_DESCRIPTION_CHANGED",e.ROLE_UPDATED="ROLE_UPDATED",e.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",e.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",e.ROOM_ENDED="ROOM_ENDED",e.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",e.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",e.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",e.NAME_UPDATED="NAME_UPDATED",e.METADATA_UPDATED="METADATA_UPDATED",e.POLL_CREATED="POLL_CREATED",e.POLL_STARTED="POLL_STARTED",e.POLL_STOPPED="POLL_STOPPED",e.POLL_VOTES_UPDATED="POLL_VOTES_UPDATED",e.POLLS_LIST="POLLS_LIST",e.HAND_RAISE_CHANGED="HAND_RAISE_CHANGED",e.TRANSCRIPTION_STATE_UPDATED="TRANSCRIPTION_STATE_UPDATED",e))(si||{}),oi=(e=>(e.audio="audio",e.video="video",e))(oi||{});function ai(e,t){let i,n;if(t)for(let r of t.auxiliaryTracks){let t=e[r];ui(t)&&(n=li(t)?t:n,i=ci(t)?t:i)}return{video:i,audio:n}}function li(e){return e&&"audio"===e.type}function ci(e){return e&&"video"===e.type}function ui(e){return e&&"screen"===e.source}function di(e){return e&&"audioplaylist"===e.source}function hi(e){return e&&"videoplaylist"===e.source}function pi(e){return!!e&&!(null==e||!e.degraded)}function fi(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].enabled}function vi(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].displayEnabled}function gi(e){var t;let i=!1,n=!1,r=!1;return null!=(t=null==e?void 0:e.publishParams)&&t.allowed&&(i=e.publishParams.allowed.includes("video"),n=e.publishParams.allowed.includes("audio"),r=e.publishParams.allowed.includes("screen")),{video:i,audio:n,screen:r}}var mi=(e=>(e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.TIME=4]="TIME",e[e.TIMEEND=5]="TIMEEND",e[e.ERROR=6]="ERROR",e[e.NONE=7]="NONE",e))(mi||{}),yi="undefined"!=typeof window&&"undefined"!=typeof window.expect,bi=class{static v(e,...t){this.log(0,e,...t)}static d(e,...t){this.log(1,e,...t)}static i(e,...t){this.log(2,e,...t)}static w(e,...t){this.log(3,e,...t)}static e(e,...t){this.log(6,e,...t)}static time(e){this.log(4,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(5,"[HMSPerformanceTiming]",e,e)}static cleanup(){performance.clearMarks(),performance.clearMeasures()}static log(e,t,...i){if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:console.log(t,...i);break;case 1:console.debug(t,...i);break;case 2:console.info(t,...i);break;case 3:console.warn(t,...i);break;case 6:console.error(t,...i);break;case 4:performance.mark(i[0]);break;case 5:{let e=i[0];try{let i=performance.measure(e,e);this.log(1,t,e,null==i?void 0:i.duration),performance.clearMarks(e),performance.clearMeasures(e)}catch(We){this.log(1,t,e,We)}break}}}};bi.level=yi?7:0;var ki,Ti,Si,wi,Ei,Pi=class{constructor(e){this.tracks=new Array,this.nativeStream=e,this.id=e.id}updateId(e){this.id=e}},Ci=new f.UAParser,_i="undefined"!=typeof window,Ai="undefined"==typeof window&&!(null!=(ki=Ci.getBrowser().name)&&ki.toLowerCase().includes("electron")),Ii=()=>!Ai,Ri=(Ii(),()=>"mobile"===Ci.getDevice().type),Li=()=>"undefined"!=typeof document&&document.hidden,Di=()=>{var e;return"ios"===(null==(e=Ci.getOS().name)?void 0:e.toLowerCase())},Oi=null==(Si=null==(Ti=Ci.getBrowser())?void 0:Ti.name)?void 0:Si.toLowerCase().includes("safari"),Mi="firefox"===(null==(Ei=null==(wi=Ci.getBrowser())?void 0:wi.name)?void 0:Ei.toLowerCase()),xi=(e=>(e.CUSTOM="CUSTOM",e.LOCAL="LOCAL",e.HMS="HMS",e))(xi||{});function Ni(){if(_i&&window){let e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"LOCAL":e.includes("app.100ms.live")?"HMS":"CUSTOM"}return"CUSTOM"}var Ui=Ni(),Fi={WebSocketConnectionErrors:{FAILED_TO_CONNECT:1e3,WEBSOCKET_CONNECTION_LOST:1003,ABNORMAL_CLOSE:1006},APIErrors:{SERVER_ERRORS:2e3,INIT_CONFIG_NOT_AVAILABLE:2002,ENDPOINT_UNREACHABLE:2003,INVALID_TOKEN_FORMAT:2004},TracksErrors:{GENERIC_TRACK:3e3,CANT_ACCESS_CAPTURE_DEVICE:3001,DEVICE_NOT_AVAILABLE:3002,DEVICE_IN_USE:3003,DEVICE_LOST_MIDWAY:3004,NOTHING_TO_RETURN:3005,INVALID_VIDEO_SETTINGS:3006,CODEC_CHANGE_NOT_PERMITTED:3007,AUTOPLAY_ERROR:3008,OVER_CONSTRAINED:3009,NO_AUDIO_DETECTED:3010,SYSTEM_DENIED_PERMISSION:3011,CURRENT_TAB_NOT_SHARED:3012,AUDIO_PLAYBACK_ERROR:3013,SELECTED_DEVICE_MISSING:3014,NO_DATA:3015},WebrtcErrors:{CREATE_OFFER_FAILED:4001,CREATE_ANSWER_FAILED:4002,SET_LOCAL_DESCRIPTION_FAILED:4003,SET_REMOTE_DESCRIPTION_FAILED:4004,ICE_FAILURE:4005,ICE_DISCONNECTED:4006,STATS_FAILED:4007},WebsocketMethodErrors:{SERVER_ERRORS:5e3,ALREADY_JOINED:5001,CANNOT_JOIN_PREVIEW_IN_PROGRESS:5002},GenericErrors:{NOT_CONNECTED:6e3,SIGNALLING:6001,UNKNOWN:6002,NOT_READY:6003,JSON_PARSING_FAILED:6004,TRACK_METADATA_MISSING:6005,RTC_TRACK_MISSING:6006,PEER_METADATA_MISSING:6007,INVALID_ROLE:6008,PREVIEW_IN_PROGRESS:6009,MISSING_MEDIADEVICES:6010,MISSING_RTCPEERCONNECTION:6011,LOCAL_STORAGE_ACCESS_DENIED:6012,VALIDATION_FAILED:6013},PlaylistErrors:{NO_ENTRY_TO_PLAY:8001,NO_ENTRY_IS_PLAYING:8002}},ji=class e extends Error{constructor(t,i,n,r,s,o=!1){super(r),this.code=t,this.name=i,this.message=r,this.description=s,this.isTerminal=o,Object.setPrototypeOf(this,e.prototype),this.action=n.toString()}toAnalyticsProperties(){return{error_name:this.name,error_code:this.code,error_message:this.message,error_description:this.description,action:this.action,is_terminal:this.isTerminal}}addNativeError(e){this.nativeError=e}toString(){var e;return`{\n        code: ${this.code};\n        name: ${this.name};\n        action: ${this.action};\n        message: ${this.message};\n        description: ${this.description};\n        isTerminal: ${this.isTerminal};\n        nativeError: ${null==(e=this.nativeError)?void 0:e.message};\n      }`}},Bi=class extends ji{constructor(e,t,i,n,r,s){super(e,t,i,n,r,!1),this.code=e,this.name=t,this.message=n,this.description=r,this.trackType=s}toAnalyticsProperties(){return Kt(zt({},super.toAnalyticsProperties()),{track_type:this.trackType})}toString(){var e;return`{\n        code: ${this.code};\n        name: ${this.name};\n        action: ${this.action};\n        message: ${this.message};\n        description: ${this.description};\n        isTerminal: ${this.isTerminal};\n        nativeError: ${null==(e=this.nativeError)?void 0:e.message};\n        trackType: ${this.trackType};\n      }`}},Gi=(e=>(e.AUDIO="audio",e.VIDEO="video",e.AUDIO_VIDEO="audio, video",e.SCREEN="screen",e))(Gi||{});function $i(e){switch(e){case"join":return"JOIN";case"offer":return"PUBLISH";case"answer":return"SUBSCRIBE";case"track-update":return"TRACK";default:return"NONE"}}var Vi=["join","offer","answer","trickle","on-error","JOIN"],Wi={WebSocketConnectionErrors:{FailedToConnect(e,t=""){return new ji(Fi.WebSocketConnectionErrors.FAILED_TO_CONNECT,"WebsocketFailedToConnect",e,`[WS]: ${t}`,`[WS]: ${t}`)},WebSocketConnectionLost(e,t=""){return new ji(Fi.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,"WebSocketConnectionLost",e,"Network connection lost",t)},AbnormalClose(e,t=""){return new ji(Fi.WebSocketConnectionErrors.ABNORMAL_CLOSE,"WebSocketAbnormalClose",e,"Websocket closed abnormally",t)}},APIErrors:{ServerErrors(e,t,i="",n=!0){return new ji(e,"ServerErrors",t,`[${t}]: Server error ${i}`,i,n)},EndpointUnreachable(e,t=""){return new ji(Fi.APIErrors.ENDPOINT_UNREACHABLE,"EndpointUnreachable",e,`Endpoint is not reachable - ${t}`,t)},InvalidTokenFormat(e,t=""){return new ji(Fi.APIErrors.INVALID_TOKEN_FORMAT,"InvalidTokenFormat",e,`Token is not in proper JWT format - ${t}`,t,!0)},InitConfigNotAvailable(e,t=""){return new ji(Fi.APIErrors.INIT_CONFIG_NOT_AVAILABLE,"InitError",e,`[INIT]: ${t}`,`[INIT]: ${t}`)}},TracksErrors:{GenericTrack(e,t=""){return new Bi(Fi.TracksErrors.GENERIC_TRACK,"GenericTrack",e,`[TRACK]: ${t}`,`[TRACK]: ${t}`,"audio, video")},CantAccessCaptureDevice(e,t,i=""){return new Bi(Fi.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,"CantAccessCaptureDevice",e,`User denied permission to access capture device - ${t}`,i,t)},DeviceNotAvailable(e,t,i=""){return new Bi(Fi.TracksErrors.DEVICE_NOT_AVAILABLE,"DeviceNotAvailable",e,`[TRACK]: Capture device is no longer available - ${t}`,i,t)},DeviceInUse(e,t,i=""){return new Bi(Fi.TracksErrors.DEVICE_IN_USE,"DeviceInUse",e,`[TRACK]: Capture device is in use by another application - ${t}`,i,t)},DeviceLostMidway(e,t,i=""){return new Bi(Fi.TracksErrors.DEVICE_LOST_MIDWAY,"DeviceLostMidway",e,`Lost access to capture device midway - ${t}`,i,t)},NothingToReturn(e,t="",i="There is no media to return. Please select either video or audio or both."){return new Bi(Fi.TracksErrors.NOTHING_TO_RETURN,"NothingToReturn",e,i,t,"audio, video")},InvalidVideoSettings(e,t=""){return new Bi(Fi.TracksErrors.INVALID_VIDEO_SETTINGS,"InvalidVideoSettings",e,"Cannot enable simulcast when no video settings are provided",t,"video")},AutoplayBlocked(e,t=""){return new Bi(Fi.TracksErrors.AUTOPLAY_ERROR,"AutoplayBlocked",e,"Autoplay blocked because the user didn't interact with the document first",t,"audio")},CodecChangeNotPermitted(e,t=""){return new Bi(Fi.TracksErrors.CODEC_CHANGE_NOT_PERMITTED,"CodecChangeNotPermitted",e,"Codec can't be changed mid call.",t,"audio, video")},OverConstrained(e,t,i=""){return new Bi(Fi.TracksErrors.OVER_CONSTRAINED,"OverConstrained",e,`[TRACK]: Requested constraints cannot be satisfied with the device hardware - ${t}`,i,t)},NoAudioDetected(e,t="Please check the mic or use another audio input"){return new Bi(Fi.TracksErrors.NO_AUDIO_DETECTED,"NoAudioDetected",e,"No audio input detected from microphone",t,"audio")},SystemDeniedPermission(e,t,i=""){return new Bi(Fi.TracksErrors.SYSTEM_DENIED_PERMISSION,"SystemDeniedPermission",e,`Operating System denied permission to access capture device - ${t}`,i,t)},CurrentTabNotShared(){return new Bi(Fi.TracksErrors.CURRENT_TAB_NOT_SHARED,"CurrentTabNotShared","TRACK","The app requires you to share the current tab","You must screen share the current tab in order to proceed","screen")},AudioPlaybackError(e){return new Bi(Fi.TracksErrors.AUDIO_PLAYBACK_ERROR,"Audio playback error","TRACK",e,e,"audio")},SelectedDeviceMissing(e){return new Bi(Fi.TracksErrors.SELECTED_DEVICE_MISSING,"SelectedDeviceMissing","TRACK",`Could not detect selected ${e} device`,`Please check connection to the ${e} device`,e)},NoDataInTrack(e){return new Bi(Fi.TracksErrors.NO_DATA,"Track does not have any data","TRACK",e,"This could possibily due to another application taking priority over the access to camera or microphone or due to an incoming call","audio, video")}},WebrtcErrors:{CreateOfferFailed(e,t=""){return new ji(Fi.WebrtcErrors.CREATE_OFFER_FAILED,"CreateOfferFailed",e,`[${e.toString()}]: Failed to create offer. `,t)},CreateAnswerFailed(e,t=""){return new ji(Fi.WebrtcErrors.CREATE_ANSWER_FAILED,"CreateAnswerFailed",e,`[${e.toString()}]: Failed to create answer. `,t)},SetLocalDescriptionFailed(e,t=""){return new ji(Fi.WebrtcErrors.SET_LOCAL_DESCRIPTION_FAILED,"SetLocalDescriptionFailed",e,`[${e.toString()}]: Failed to set offer. `,t)},SetRemoteDescriptionFailed(e,t=""){return new ji(Fi.WebrtcErrors.SET_REMOTE_DESCRIPTION_FAILED,"SetRemoteDescriptionFailed",e,`[${e.toString()}]: Failed to set answer. `,t,!0)},ICEFailure(e,t="",i=!1){return new ji(Fi.WebrtcErrors.ICE_FAILURE,"ICEFailure",e,`[${e.toString()}]: Ice connection state FAILED`,t,i)},ICEDisconnected(e,t=""){return new ji(Fi.WebrtcErrors.ICE_DISCONNECTED,"ICEDisconnected",e,`[${e.toString()}]: Ice connection state DISCONNECTED`,t)},StatsFailed(e,t=""){return new ji(Fi.WebrtcErrors.STATS_FAILED,"StatsFailed",e,`Failed to WebRTC get stats - ${t}`,t)}},WebsocketMethodErrors:{ServerErrors(e,t,i){return new ji(e,"ServerErrors",t,i,i,Vi.includes(t))},AlreadyJoined(e,t=""){return new ji(Fi.WebsocketMethodErrors.ALREADY_JOINED,"AlreadyJoined",e,"[JOIN]: You have already joined this room.",t)},CannotJoinPreviewInProgress(e,t=""){return new ji(Fi.WebsocketMethodErrors.CANNOT_JOIN_PREVIEW_IN_PROGRESS,"CannotJoinPreviewInProgress",e,"[JOIN]: Cannot join if preview is in progress",t)}},GenericErrors:{NotConnected(e,t=""){return new ji(Fi.GenericErrors.NOT_CONNECTED,"NotConnected",e,"Client is not connected",t)},Signalling(e,t){return new ji(Fi.GenericErrors.SIGNALLING,"Signalling",e,`Unknown signalling error: ${e.toString()} ${t} `,t)},Unknown(e,t){return new ji(Fi.GenericErrors.UNKNOWN,"Unknown",e,`Unknown exception: ${t}`,t)},NotReady(e,t=""){return new ji(Fi.GenericErrors.NOT_READY,"NotReady",e,t,t)},JsonParsingFailed(e,t,i=""){return new ji(Fi.GenericErrors.JSON_PARSING_FAILED,"JsonParsingFailed",e,`Failed to parse JSON message - ${t}`,i)},TrackMetadataMissing(e,t=""){return new ji(Fi.GenericErrors.TRACK_METADATA_MISSING,"TrackMetadataMissing",e,"Track Metadata Missing",t)},RTCTrackMissing(e,t=""){return new ji(Fi.GenericErrors.RTC_TRACK_MISSING,"RTCTrackMissing",e,"RTC Track missing",t)},PeerMetadataMissing(e,t=""){return new ji(Fi.GenericErrors.PEER_METADATA_MISSING,"PeerMetadataMissing",e,"Peer Metadata Missing",t)},ValidationFailed(e,t){return new ji(Fi.GenericErrors.VALIDATION_FAILED,"ValidationFailed","VALIDATION",e,t?JSON.stringify(t):"")},InvalidRole(e,t){return new ji(Fi.GenericErrors.INVALID_ROLE,"InvalidRole",e,"Invalid role. Join with valid role",t,!0)},PreviewAlreadyInProgress(e,t=""){return new ji(Fi.GenericErrors.PREVIEW_IN_PROGRESS,"PreviewAlreadyInProgress",e,"[Preview]: Cannot join if preview is in progress",t)},LocalStorageAccessDenied(e="Access to localStorage has been denied"){return new ji(Fi.GenericErrors.LOCAL_STORAGE_ACCESS_DENIED,"LocalStorageAccessDenied","NONE","LocalStorageAccessDenied",e)},MissingMediaDevices(){return new ji(Fi.GenericErrors.MISSING_MEDIADEVICES,"MissingMediaDevices","JOIN","navigator.mediaDevices is undefined. 100ms SDK won't work on this website as WebRTC is not supported on HTTP endpoints(missing navigator.mediaDevices). Please ensure you're using the SDK either on localhost or a valid HTTPS endpoint.","",!0)},MissingRTCPeerConnection(){return new ji(Fi.GenericErrors.MISSING_RTCPEERCONNECTION,"MissingRTCPeerConnection","JOIN","RTCPeerConnection which is a core requirement for WebRTC call was not found, this could be due to an unsupported browser or browser extensions blocking WebRTC","",!0)}},MediaPluginErrors:{PlatformNotSupported(e,t=""){return new ji(7001,"PlatformNotSupported",e,"Check HMS Docs to see the list of supported platforms",t)},InitFailed(e,t=""){return new ji(7002,"InitFailed",e,"Plugin init failed",t)},ProcessingFailed(e,t=""){return new ji(7003,"ProcessingFailed",e,"Plugin processing failed",t)},AddAlreadyInProgress(e,t=""){return new ji(7004,"AddAlreadyInProgress",e,"Plugin add already in progress",t)},DeviceNotSupported(e,t=""){return new ji(7005,"DeviceNotSupported",e,"Check HMS Docs to see the list of supported devices",t)}},PlaylistErrors:{NoEntryToPlay(e,t){return new ji(Fi.PlaylistErrors.NO_ENTRY_TO_PLAY,"NoEntryToPlay",e,"Reached end of playlist",t)},NoEntryPlaying(e,t){return new ji(Fi.PlaylistErrors.NO_ENTRY_IS_PLAYING,"NoEntryIsPlaying",e,"No entry is playing at this time",t)}}},Hi=class{constructor(){this.valuesMap=new Map}getItem(e){return this.valuesMap.has(e)?String(this.valuesMap.get(e)):null}setItem(e,t){this.valuesMap.set(e,t)}removeItem(e){this.valuesMap.delete(e)}clear(){this.valuesMap.clear()}key(e){if(0===arguments.length)throw new TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");return Array.from(this.valuesMap.keys())[e]}get length(){return this.valuesMap.size}},qi=()=>{try{_i&&!localStorage&&(window.localStorage=new Hi)}catch(Ge){bi.e("Error initialising localStorage",Wi.GenericErrors.LocalStorageAccessDenied())}},zi=class{constructor(e){this.key=e,this.storage=null}getStorage(){try{return _i&&!this.storage&&(qi(),this.storage=window.localStorage),this.storage}catch(e){return bi.e("Error initialising localStorage",Wi.GenericErrors.LocalStorageAccessDenied()),null}}get(){var e;let t=null==(e=this.getStorage())?void 0:e.getItem(this.key);return t?JSON.parse(t):void 0}set(e){var t;let i=JSON.stringify(e);null==(t=this.getStorage())||t.setItem(this.key,i)}clear(){var e;null==(e=this.getStorage())||e.removeItem(this.key)}},Ki=()=>{let e,t=new zi("hms-analytics-deviceId"),i=t.get();return i?e=i:(e=P(),t.set(e)),e},Ji="[VALIDATIONS]";function Qi(e){return null!=e}var Yi=()=>{if(!Qi(RTCPeerConnection)){let e=Wi.GenericErrors.MissingRTCPeerConnection();throw bi.e(Ji,e),e}},Zi=()=>{if(!Qi(navigator.mediaDevices)){let e=Wi.GenericErrors.MissingMediaDevices();throw bi.e(Ji,e),e}},Xi=e=>{if(!e.getPublishParams())throw Wi.GenericErrors.NotConnected("VALIDATION","call addTrack after preview or join is successful")},en=Xt().version;function tn(e="prod",t){let i="web",n="LOCAL"!==Ui&&"prod"===e?"prod":"debug";if(Ai)return rn({os:"web_nodejs",os_version:process.version,sdk:i,sdk_version:en,env:n,domain:Ui,is_prebuilt:!(null==t||!t.isPrebuilt),framework:"node",framework_version:process.version,framework_sdk_version:null==t?void 0:t.sdkVersion});let r=Ci.getOS(),s=Ci.getDevice(),o=Ci.getBrowser(),a=nn(`web_${r.name}`),l=r.version||"",c=nn(`${o.name}_${o.version}`),u=c;return s.type&&(u=`${nn(`${s.vendor}_${s.type}`)}/${c}`),rn({os:a,os_version:l,sdk:i,sdk_version:en,device_model:u,env:n,domain:Ui,is_prebuilt:!(null==t||!t.isPrebuilt),framework:null==t?void 0:t.type,framework_version:null==t?void 0:t.version,framework_sdk_version:null==t?void 0:t.sdkVersion})}function nn(e){return e.replace(/ /g,"_")}var rn=(e,t=",")=>Object.keys(e).filter((t=>Qi(e[t]))).map((t=>`${t}:${e[t]}`)).join(t),sn=class{constructor({name:e,level:t,properties:i,includesPII:n,timestamp:r}){this.metadata={peer:{},userAgent:tn()},this.name=e,this.level=t,this.includesPII=n||!1,this.properties=i||{},this.timestamp=r||(new Date).getTime(),this.event_id=P(),this.device_id=Ki()}toSignalParams(){return{name:this.name,info:Kt(zt({},this.properties),{timestamp:this.timestamp,domain:Ui}),timestamp:(new Date).getTime()}}},on=class{static connect(e,t,i=new Date,n=new Date,r){let s=this.eventNameFor("connect",void 0===e),o=e?2:1,a=this.getPropertiesWithError(Kt(zt({},t),{[this.KEY_REQUESTED_AT]:null==i?void 0:i.getTime(),[this.KEY_RESPONDED_AT]:null==n?void 0:n.getTime(),endpoint:r}),e);return new sn({name:s,level:o,properties:a})}static disconnect(e,t){let i="disconnected",n=e?2:1,r=this.getPropertiesWithError(t,e);return new sn({name:i,level:n,properties:r})}static preview(e){var t=e,{error:i}=t,n=Jt(t,["error"]);let r=this.eventNameFor("preview",void 0===i),s=i?2:1,o=this.getPropertiesWithError(n,i);return new sn({name:r,level:s,properties:o})}static join(e){var t=e,{error:i}=t,n=Jt(t,["error"]);let r=this.eventNameFor("join",void 0===i),s=i?2:1,o=this.getPropertiesWithError(Kt(zt({},n),{is_preview_called:!!n.is_preview_called}),i);return new sn({name:r,level:s,properties:o})}static publish({devices:e,settings:t,error:i}){let n=this.eventNameFor("publish",void 0===i),r=i?2:1,s=this.getPropertiesWithError({devices:e,audio:null==t?void 0:t.audio,video:null==t?void 0:t.video},i);return new sn({name:n,level:r,properties:s})}static hlsPlayerError(e){return new sn({name:"hlsPlayerError",level:2,properties:this.getErrorProperties(e)})}static subscribeFail(e){let t=this.eventNameFor("subscribe",!1),i=2,n=this.getErrorProperties(e);return new sn({name:t,level:i,properties:n})}static leave(){return new sn({name:"leave",level:1})}static autoplayError(){return new sn({name:"autoplayError",level:2})}static audioPlaybackError(e){return new sn({name:"audioPlaybackError",level:2,properties:this.getErrorProperties(e)})}static audioRecovered(e){return new sn({name:"audioRecovered",level:1,properties:{message:e}})}static deviceChange({isUserSelection:e,selection:t,type:i,devices:n,error:r}){let s=this.eventNameFor(r?"publish":`device.${i}`,void 0===r),o=r?2:1,a=this.getPropertiesWithError({selection:t,devices:n,isUserSelection:e},r);return new sn({name:s,level:o,properties:a})}static performance(e){let t="perf.stats",i=1,n=e.toAnalyticsProperties();return new sn({name:t,level:i,properties:n})}static rtcStats(e){let t="rtc.stats",i=1,n=e.toAnalyticsProperties();return new sn({name:t,level:i,properties:n})}static rtcStatsFailed(e){let t="rtc.stats.failed",i=2;return new sn({name:t,level:i,properties:this.getErrorProperties(e)})}static degradationStats(e,t){let i="video.degradation.stats",n=1,r={degradedAt:e.degradedAt,trackId:e.trackId};if(!t&&e.degradedAt instanceof Date){let t=new Date,i=t.valueOf()-e.degradedAt.valueOf();r=Kt(zt({},r),{duration:i,restoredAt:t})}return new sn({name:i,level:n,properties:r})}static audioDetectionFail(e,t){let i=this.getPropertiesWithError({device:t},e),n=2,r="audiopresence.failed";return new sn({name:r,level:n,properties:i})}static previewNetworkQuality(e){return new sn({name:"perf.networkquality.preview",level:e.error?2:1,properties:e})}static publishStats(e){return new sn({name:"publisher.stats",level:1,properties:e})}static subscribeStats(e){return new sn({name:"subscriber.stats",level:1,properties:e})}static getKrispUsage(e){return new sn({name:"krisp.usage",level:1,properties:{duration:e}})}static krispStart(){return new sn({name:"krisp.start",level:1})}static krispStop(){return new sn({name:"krisp.stop",level:1})}static interruption({started:e,type:t,reason:i,deviceInfo:n}){return new sn({name:""+(e?"interruption.start":"interruption.stop"),level:1,properties:zt({reason:i,type:t},n)})}static eventNameFor(e,t){return`${e}.${t?"success":"failed"}`}static getPropertiesWithError(e,t){let i=this.getErrorProperties(t);return e=zt(zt({},i),e),e}static getErrorProperties(e){return e?e instanceof ji?e.toAnalyticsProperties():{error_name:e.name,error_message:e.message,error_description:e.cause}:{}}};on.KEY_REQUESTED_AT="requested_at",on.KEY_RESPONDED_AT="responded_at";var an=e=>e?`{\n    trackId: ${e.id};\n    kind: ${e.kind};\n    enabled: ${e.enabled};\n    muted: ${e.muted};\n    readyState: ${e.readyState};\n  }`:"",ln=class{constructor(e,t,i){this.logIdentifier="",this.isTrackNotPublishing=()=>"ended"===this.nativeTrack.readyState||this.nativeTrack.muted,this.stream=e,this.nativeTrack=t,this.source=i}get enabled(){return this.nativeTrack.enabled}get trackId(){return this.firstTrackId||this.sdpTrackId||this.nativeTrack.id}getMediaTrackSettings(){return this.nativeTrack.getSettings()}setEnabled(e){return Zt(this,null,(function*(){this.nativeTrack.enabled=e}))}setSdpTrackId(e){this.sdpTrackId=e}setFirstTrackId(e){this.firstTrackId=e}sendInterruptionEvent({started:e,reason:t}){return on.interruption({started:e,type:this.type,reason:t,deviceInfo:{deviceId:this.nativeTrack.getSettings().deviceId,groupId:this.nativeTrack.getSettings().groupId}})}cleanup(){var e;bi.d("[HMSTrack]","Stopping track",this.toString()),null==(e=this.nativeTrack)||e.stop()}toString(){var e;return`{\n      streamId: ${this.stream.id};\n      peerId: ${this.peerId};\n      trackId: ${this.trackId};\n      mid: ${(null==(e=this.transceiver)?void 0:e.mid)||"-"};\n      logIdentifier: ${this.logIdentifier};\n      source: ${this.source};\n      enabled: ${this.enabled};\n      nativeTrack: ${an(this.nativeTrack)};\n    }`}},cn=class extends ln{constructor(e,t,i){if(super(e,t,i),this.type="audio",this.audioElement=null,"audio"!==t.kind)throw new Error("Expected 'track' kind = 'audio'")}getVolume(){return this.audioElement?Math.floor(100*this.audioElement.volume):null}setVolume(e){return Zt(this,null,(function*(){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");yield this.subscribeToAudio(0!==e&&this.enabled),this.audioElement&&(this.audioElement.volume=e/100)}))}setAudioElement(e){bi.d("[HMSAudioTrack]",this.logIdentifier,"adding audio element",`${this}`,e),this.audioElement=e}getAudioElement(){return this.audioElement}getOutputDevice(){return this.outputDevice}cleanup(){super.cleanup(),this.audioElement&&(this.audioElement.srcObject=null,this.audioElement.remove(),this.audioElement=null)}setOutputDevice(e){return Zt(this,null,(function*(){var t;if(e){if(!this.audioElement)return bi.d("[HMSAudioTrack]",this.logIdentifier,"no audio element to set output",`${this}`),void(this.outputDevice=e);try{"function"==typeof this.audioElement.setSinkId&&(Mi||(yield null==(t=this.audioElement)?void 0:t.setSinkId(e.deviceId)),this.outputDevice=e)}catch(Ne){bi.d("[HMSAudioTrack]","error in setSinkId",Ne)}}else bi.d("[HMSAudioTrack]",this.logIdentifier,"device is null",`${this}`)}))}subscribeToAudio(e){return Zt(this,null,(function*(){this.stream instanceof Wr&&(yield this.stream.setAudio(e,this.trackId,this.logIdentifier))}))}},un=class{constructor(){this.storage=new zi("hms-device-selection"),this.remember=!1,this.TAG="[HMSDeviceStorage]"}setDevices(e){this.devices=e}rememberDevices(e){this.remember=e}updateSelection(e,{deviceId:t,groupId:i}){if(!this.devices||!this.remember)return;let n=this.devices[e].find((e=>this.isSame({deviceId:t,groupId:i},e)));if(!n)return void bi.w(this.TAG,`Could not find device with deviceId: ${t}, groupId: ${i}`);let r=this.storage.get()||{};r[e]=n,this.storage.set(r)}getSelection(){if(this.remember)return this.storage.get()}cleanup(){this.remember=!1,this.devices=void 0}isSame(e,t){return e.deviceId===t.deviceId&&(e.groupId===t.groupId||!e.groupId)}},dn=new un,hn=(e=>(e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE",e))(hn||{}),pn=(e=>(e.PLATFORM_NOT_SUPPORTED="PLATFORM_NOT_SUPPORTED",e.DEVICE_NOT_SUPPORTED="DEVICE_NOT_SUPPORTED",e))(pn||{}),fn=class{static failure(e,t){let i="mediaPlugin.failed",n=2,r=zt({plugin_name:e},t.toAnalyticsProperties());return new sn({name:i,level:n,properties:r})}static audioPluginFailure(e,t,i){let n="mediaPlugin.failed",r=2,s=zt({plugin_name:e,sampleRate:t},i.toAnalyticsProperties());return new sn({name:n,level:r,properties:s})}static audioPluginStats({pluginName:e,duration:t,loadTime:i,sampleRate:n}){let r="mediaPlugin.stats",s=1,o={plugin_name:e,duration:t,load_time:i,sampleRate:n};return new sn({name:r,level:s,properties:o})}static added(e,t){let i="mediaPlugin.added",n=1,r={plugin_name:e,added_at:t};return new sn({name:i,level:n,properties:r})}static stats({pluginName:e,duration:t,loadTime:i,avgPreProcessingTime:n,avgProcessingTime:r,inputFrameRate:s,pluginFrameRate:o}){let a="mediaPlugin.stats",l=1,c={plugin_name:e,duration:t,load_time:i,avg_preprocessing_time:n,avg_processing_time:r,input_frame_rate:s,plugin_frame_rate:o};return new sn({name:a,level:l,properties:c})}},vn=class{constructor(e){this.eventBus=e,this.TAG="[AudioPluginsAnalytics]",this.initTime={},this.addedTimestamps={},this.pluginAdded={},this.pluginSampleRate={}}added(e,t){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.pluginSampleRate[e]=t,this.eventBus.analytics.publish(fn.added(e,this.addedTimestamps[e]))}removed(e){if(this.pluginAdded[e]){let t={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],sampleRate:this.pluginSampleRate[e]};this.eventBus.analytics.publish(fn.audioPluginStats(t)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(fn.audioPluginFailure(e,this.pluginSampleRate[e],t)),this.clean(e))}initWithTime(e,t){return Zt(this,null,(function*(){if(this.initTime[e])return void bi.i(this.TAG,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);let i;try{i=yield this.timeInMs(t),bi.i(this.TAG,`Time taken for Plugin ${e} initialization : ${i}`)}catch(Ne){let i=Wi.MediaPluginErrors.InitFailed("AUDIO_PLUGINS",`failed during initialization of plugin${Ne.message||Ne}`);throw bi.e(this.TAG,i),this.failure(e,i),i}i&&(this.initTime[e]=i)}))}timeInMs(e){return Zt(this,null,(function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)}))}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.pluginAdded[e],delete this.pluginSampleRate[e]}},gn=[{echoCancellation:{exact:!0}},{highpassFilter:{exact:!0}},{audioMirroring:{exact:!0}}],mn=(e=>(e.SIP="sip",e.REGULAR="regular",e))(mn||{}),yn=(e=>(e.NONE="none",e.INITIALISED="initialised",e.STARTED="started",e.PAUSED="paused",e.RESUMED="resumed",e.STOPPED="stopped",e.FAILED="failed",e))(yn||{}),bn=(e=>(e.DVR="dvr",e.NO_DVR="no-dvr",e))(bn||{}),kn=(e=>(e.REGULAR="regular",e.SCREEN="screen",e.COMPOSITE="composite",e))(kn||{}),Tn=(e=>(e.INITIALISED="initialised",e.STARTED="started",e.STOPPED="stopped",e.FAILED="failed",e))(Tn||{}),Sn=(e=>(e.CAPTION="caption",e))(Sn||{}),wn={f:"high",h:"medium",q:"low"},En=(e=>(e.VOICE="voice",e.MUSIC="music",e))(En||{}),Pn=(e=>(e.videoInput="videoInput",e.audioInput="audioInput",e.audioOutput="audioOutput",e))(Pn||{}),Cn=class{constructor(){this._volume=1,this._codec="opus",this._maxBitrate=32,this._deviceId="default",this._audioMode="voice",this._advanced=[...gn,{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}}]}volume(e){if(!(0<=e&&e<=1))throw Error("volume can only be in range [0.0, 1.0]");return this._volume=e,this}codec(e){return this._codec=e,this}maxBitrate(e){if(e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate="music"===this._audioMode?320:e,this}deviceId(e){return this._deviceId=e,this}audioMode(e="voice"){return this._audioMode=e,"music"===this._audioMode?this._maxBitrate=320:this._maxBitrate=32,this}advanced(e){return this._advanced=e,this}build(){return new _n(this._volume,this._codec,this._maxBitrate,this._deviceId,this._advanced,this._audioMode)}},_n=class{constructor(e,t,i,n,r,s){this.volume=e,this.codec=t,this.maxBitrate=i,this.deviceId=n,this.advanced=r,this.audioMode=s,"music"===this.audioMode?this.maxBitrate=320:this.maxBitrate=32}toConstraints(){return{deviceId:this.deviceId,advanced:"music"===this.audioMode?[]:this.advanced}}toAnalyticsProperties(){return{audio_bitrate:this.maxBitrate,audio_codec:this.codec}}},An=class{constructor(){this._width=320,this._height=180,this._codec="vp8",this._maxFramerate=30,this._maxBitrate=150,this._advanced=[]}setWidth(e){return this._width=e,this}setHeight(e){return this._height=e,this}codec(e){return this._codec=e,this}maxFramerate(e){if(e&&e<=0)throw Error("maxFramerate should be >= 1");return this._maxFramerate=e,this}maxBitrate(e,t=!0){if("number"==typeof e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,!this._maxBitrate&&t&&(this._maxBitrate=15e4),this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}facingMode(e){return this._facingMode=e,this}build(){return new In(this._width,this._height,this._codec,this._maxFramerate,this._deviceId,this._advanced,this._maxBitrate,this._facingMode)}},In=class{constructor(e,t,i,n,r,s,o,a){this.width=e,this.height=t,this.codec=i,this.maxFramerate=n,this.maxBitrate=o,this.deviceId=r,this.advanced=s,this.facingMode=a}toConstraints(e){let t="ideal";e&&(t="max");let i=this.improviseConstraintsAspect();return{width:{[t]:i.width},height:{[t]:i.height},frameRate:this.maxFramerate,deviceId:this.deviceId,facingMode:this.facingMode}}toAnalyticsProperties(){return{width:this.width,height:this.height,video_bitrate:this.maxBitrate,framerate:this.maxFramerate,video_codec:this.codec,facingMode:this.facingMode}}improviseConstraintsAspect(){return Ri()&&this.height&&this.width&&this.height>this.width?{width:this.height,height:this.width}:{width:this.width,height:this.height}}},Rn=class{constructor(){this._video=(new An).build(),this._audio=(new Cn).build(),this._screen=(new An).build(),this._simulcast=!1}video(e){return this._video=e,this}audio(e){return this._audio=e,this}screen(e){return this._screen=e,this}simulcast(e){return this._simulcast=e,this}build(){if(null===this._audio&&null===this._video)throw Wi.TracksErrors.NothingToReturn("TRACK");if(null===this._video&&this._simulcast)throw Wi.TracksErrors.InvalidVideoSettings("TRACK","Cannot enable simulcast when no video settings are provided");return new Ln(this._video,this._audio,this._simulcast,this._screen||void 0)}},Ln=class{constructor(e,t,i,n=null){this.video=e,this.audio=t,this.simulcast=i,this.screen=n}toAnalyticsProperties(){let e={audio_enabled:null!==this.audio,video_enabled:null!==this.video};return this.audio&&(e=zt(zt({},this.audio.toAnalyticsProperties()),e)),this.video&&(e=zt(zt({},this.video.toAnalyticsProperties()),e)),e}},Dn=class{constructor(e,t,i){this.eventBus=t,this.TAG="[AudioPluginsManager]",this.pluginAddInProgress=!1,this.hmsTrack=e,this.pluginsMap=new Map,this.analytics=new vn(t),this.audioContext=Bn.getAudioContext(),this.room=i}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e){return Zt(this,null,(function*(){var t,i;let n=null==(t=e.getName)?void 0:t.call(e);if(n){if(this.pluginAddInProgress){let e=Wi.MediaPluginErrors.AddAlreadyInProgress("AUDIO_PLUGINS","Add Plugin is already in Progress");throw this.analytics.added(n,this.audioContext.sampleRate),this.analytics.failure(n,e),bi.w("can't add another plugin when previous add is in progress"),e}switch(e.getName()){case"HMSKrispPlugin":{if(null==(i=this.room)||!i.isNoiseCancellationEnabled){let e="Krisp Noise Cancellation is not enabled for this room";if(0===this.pluginsMap.size)throw Error(e);return void bi.w(this.TAG,e)}this.eventBus.analytics.publish(on.krispStart());let{settings:e}=this.hmsTrack,t=(new Cn).codec(e.codec).maxBitrate(e.maxBitrate).deviceId(e.deviceId).advanced([...gn,{autoGainControl:{exact:!1}},{noiseSuppression:{exact:!1}}]).audioMode(e.audioMode).build();yield this.hmsTrack.setSettings(t);break}default:}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e)}finally{this.pluginAddInProgress=!1}}else bi.w("no name provided by the plugin")}))}addPluginInternal(e){return Zt(this,null,(function*(){var t,i;let n=null==(t=e.getName)?void 0:t.call(e);if(this.pluginsMap.get(n))bi.w(this.TAG,`plugin - ${n} already added.`);else{yield this.validateAndThrow(n,e),null==(i=e.setEventBus)||i.call(e,this.eventBus);try{0===this.pluginsMap.size?yield this.initAudioNodes():this.prevAudioNode&&this.prevAudioNode.disconnect(),this.analytics.added(n,this.audioContext.sampleRate),yield this.analytics.initWithTime(n,(()=>Zt(this,null,(function*(){return e.init()})))),this.pluginsMap.set(n,e),yield this.processPlugin(e),yield this.connectToDestination(),yield this.updateProcessedTrack()}catch(We){throw bi.e(this.TAG,"failed to add plugin",We),We}}}))}validatePlugin(e){return e.checkSupport(this.audioContext)}validateAndThrow(e,t){return Zt(this,null,(function*(){let i=this.validatePlugin(t);if(i.isSupported)bi.i(this.TAG,`plugin is supported,- ${t.getName()}`);else{if(this.analytics.added(e,this.audioContext.sampleRate),"PLATFORM_NOT_SUPPORTED"===i.errType){let t=Wi.MediaPluginErrors.PlatformNotSupported("AUDIO_PLUGINS","platform not supported, see docs");throw this.analytics.failure(e,t),yield this.cleanup(),t}if("DEVICE_NOT_SUPPORTED"===i.errType){let t=Wi.MediaPluginErrors.DeviceNotSupported("AUDIO_PLUGINS","audio device not supported, see docs");throw this.analytics.failure(e,t),yield this.cleanup(),t}}}))}removePlugin(e){return Zt(this,null,(function*(){switch(e.getName()){case"HMSKrispPlugin":{this.eventBus.analytics.publish(on.krispStop());let{settings:e}=this.hmsTrack,t=(new Cn).codec(e.codec).maxBitrate(e.maxBitrate).deviceId(e.deviceId).advanced([...gn,{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}}]).audioMode(e.audioMode).build();yield this.hmsTrack.setSettings(t);break}default:break}yield this.removePluginInternal(e),0===this.pluginsMap.size?(yield this.cleanup(),bi.i(this.TAG,"No plugins left, stopping plugins loop"),yield this.hmsTrack.setProcessedTrack(void 0)):yield this.reprocessPlugins()}))}cleanup(){return Zt(this,null,(function*(){var e,t,i;for(let n of this.pluginsMap.values())yield this.removePluginInternal(n);yield this.hmsTrack.setProcessedTrack(void 0),null==(e=this.sourceNode)||e.disconnect(),null==(t=this.prevAudioNode)||t.disconnect(),null==(i=this.outputTrack)||i.stop(),this.sourceNode=void 0,this.destinationNode=void 0,this.prevAudioNode=void 0,this.outputTrack=void 0}))}closeContext(){return Zt(this,null,(function*(){this.audioContext=void 0}))}reprocessPlugins(){return Zt(this,null,(function*(){if(0===this.pluginsMap.size||!this.sourceNode)return;let e=Array.from(this.pluginsMap.values());yield this.cleanup(),yield this.initAudioNodes();for(let t of e)yield this.addPlugin(t);yield this.updateProcessedTrack()}))}initAudioNodes(){return Zt(this,null,(function*(){if(this.audioContext){let e=new MediaStream([this.hmsTrack.nativeTrack]);this.sourceNode=this.audioContext.createMediaStreamSource(e),this.destinationNode||(this.destinationNode=this.audioContext.createMediaStreamDestination(),this.outputTrack=this.destinationNode.stream.getAudioTracks()[0])}}))}updateProcessedTrack(){return Zt(this,null,(function*(){try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(e){throw bi.e(this.TAG,"error in setting processed track",e),e}}))}processPlugin(e){return Zt(this,null,(function*(){try{let t=yield e.processAudioTrack(this.audioContext,this.prevAudioNode||this.sourceNode);this.prevAudioNode&&this.prevAudioNode.connect(t),this.prevAudioNode=t}catch(Ue){let i=e.getName();bi.e(this.TAG,`error in processing plugin ${i}`,Ue),yield this.removePluginInternal(e)}}))}connectToDestination(){return Zt(this,null,(function*(){try{this.prevAudioNode&&this.destinationNode&&this.prevAudioNode.context===this.destinationNode.context&&this.prevAudioNode.connect(this.destinationNode)}catch(e){bi.e(this.TAG,"error in connecting to destination node",e)}}))}removePluginInternal(e){return Zt(this,null,(function*(){var t;let i=null==(t=e.getName)?void 0:t.call(e);this.pluginsMap.get(i)?(bi.i(this.TAG,`removing plugin ${i}`),this.pluginsMap.delete(i),e.stop(),this.analytics.removed(i)):bi.w(this.TAG,`plugin - ${i} not found to remove.`)}))}};function On(e,t){let i=e.toLowerCase(),n=Wi.TracksErrors.GenericTrack("TRACK",e);return i.includes("device not found")?n=Wi.TracksErrors.DeviceNotAvailable("TRACK",t,e):i.includes("permission denied")&&(n=Wi.TracksErrors.CantAccessCaptureDevice("TRACK",t,e)),n}function Mn(e,t=""){if("chrome"===De.browserDetails.browser&&"NotAllowedError"===e.name&&e.message.includes("denied by system"))return Wi.TracksErrors.SystemDeniedPermission("TRACK",t,e.message);if("firefox"===De.browserDetails.browser&&"NotFoundError"===e.name){let i=Wi.TracksErrors.SystemDeniedPermission("TRACK",t,e.message);return i.description=`Capture device is either blocked at Operating System level or not available - ${t}`,i}switch(e.name){case"OverconstrainedError":return Wi.TracksErrors.OverConstrained("TRACK",t,e.constraint);case"NotAllowedError":return Wi.TracksErrors.CantAccessCaptureDevice("TRACK",t,e.message);case"NotFoundError":return Wi.TracksErrors.DeviceNotAvailable("TRACK",t,e.message);case"NotReadableError":return Wi.TracksErrors.DeviceInUse("TRACK",t,e.message);case"TypeError":return Wi.TracksErrors.NothingToReturn("TRACK",e.message);default:return On(e.message,t)}}function xn(e,t){let i=Mn(e,t);return i.addNativeError(e),i}function Nn(e){return Zt(this,null,(function*(){try{return(yield navigator.mediaDevices.getUserMedia({audio:!!e&&e.toConstraints()})).getAudioTracks()[0]}catch(t){throw xn(t,"audio")}}))}function Un(e){return Zt(this,null,(function*(){try{return(yield navigator.mediaDevices.getUserMedia({video:!!e&&e.toConstraints()})).getVideoTracks()[0]}catch(t){throw xn(t,"video")}}))}function Fn(e){return"canvas"in e||"MediaStreamAudioDestinationNode"===e.label||""===e.label}var jn=32e3,Bn={audioContext:null,getAudioContext(){return this.audioContext||(this.audioContext=Mi?new AudioContext:new AudioContext({sampleRate:jn})),this.audioContext},resumeContext(){return Zt(this,null,(function*(){try{return yield this.getAudioContext().resume()}catch(Ge){bi.e("AudioContext",Ge)}}))}},Gn=(e=>(e.SPEAKERPHONE="SPEAKERPHONE",e.WIRED="WIRED",e.BLUETOOTH="BLUETOOTH",e.EARPIECE="EARPIECE",e))(Gn||{}),$n=e=>{if(!e)return bi.w("[DeviceManager]:","No device label provided"),"SPEAKERPHONE";let t=e.toLowerCase();return t.includes("speakerphone")?"SPEAKERPHONE":t.includes("wired")?"WIRED":/airpods|buds|wireless|bluetooth/gi.test(t)?"BLUETOOTH":t.includes("earpiece")?"EARPIECE":"SPEAKERPHONE"},Vn=class{constructor(e=1/0){this.capacity=e,this.storage=[]}size(){return this.storage.length}toList(){return this.storage.slice(0)}enqueue(e){this.size()===this.capacity&&this.dequeue(),this.storage.push(e)}dequeue(){return this.storage.shift()}aggregate(e){return e(this.storage)}},Wn="(function workerSetup() {\n  function ticker() {\n    self.postMessage('tick');\n  }\n  self.onmessage = function (event) {\n    const [data, time] = event.data;\n    switch (data) {\n      case 'start':\n        setTimeout(ticker, time);\n        break;\n      default:\n        break;\n    }\n  };\n})()";function Hn(e){if(e<0)throw Error("`ms` should be a positive integer");return new Promise((t=>{setTimeout(t,e)}))}function qn(e){if(e<0)throw Error("`ms` should be a positive integer");if("undefined"==typeof Worker)return Hn(e);let t=new Worker(URL.createObjectURL(new Blob([Wn],{type:"application/javascript"})));return t.postMessage(["start",e]),new Promise((e=>{t.onmessage=i=>{"tick"===i.data&&(e(),t.terminate())}}))}function zn(){if("undefined"==typeof Worker)return{sleep:e=>Hn(e)};let e=new Worker(URL.createObjectURL(new Blob([Wn],{type:"application/javascript"})));return{sleep:t=>(e.postMessage(["start",t]),new Promise((t=>{e.onmessage=e=>{"tick"===e.data&&t()}})))}}function Kn(e,t=300){let i;return function(...n){clearTimeout(i),i=void 0;let r=this;i=setTimeout((()=>{e.apply(r,n)}),t)}}var Jn=35,Qn=5,Yn=class{constructor(e,t,i){this.track=e,this.audioLevelEvent=t,this.silenceEvent=i,this.TAG="[TrackAudioLevelMonitor]",this.audioLevel=0,this.isMonitored=!1,this.interval=100,this.historyInterval=700,this.history=new Vn(this.historyInterval/this.interval),this.detectSilence=()=>Zt(this,null,(function*(){let e=0;for(;this.isMonitored;){if(this.track.enabled){if(!this.isSilentThisInstant())break;if(e++,e>50){this.silenceEvent.publish({track:this.track});break}}yield Hn(20)}}));try{let e=new MediaStream([this.track.nativeTrack]);this.analyserNode=this.createAnalyserNodeForStream(e);let t=this.analyserNode.frequencyBinCount;this.dataArray=new Uint8Array(t)}catch(Ne){bi.w(this.TAG,"Unable to initialize AudioContext",Ne)}}start(){this.stop(),this.isMonitored=!0,bi.d(this.TAG,"Starting track Monitor",`${this.track}`),this.loop().then((()=>bi.d(this.TAG,"Stopping track Monitor",`${this.track}`)))}stop(){this.analyserNode?(this.sendAudioLevel(0),this.isMonitored=!1):bi.d(this.TAG,"AudioContext not initialized")}loop(){return Zt(this,null,(function*(){for(;this.isMonitored;)this.sendAudioLevel(this.getMaxAudioLevelOverPeriod()),yield Hn(this.interval)}))}sendAudioLevel(e=0){if(e=e>Jn?e:0,Math.abs(this.audioLevel-e)>Qn){this.audioLevel=e;let t={track:this.track,audioLevel:this.audioLevel};this.audioLevelEvent.publish(t)}}getMaxAudioLevelOverPeriod(){if(!this.analyserNode)return void bi.d(this.TAG,"AudioContext not initialized");let e=this.calculateAudioLevel();return void 0!==e&&this.history.enqueue(e),this.history.aggregate((e=>Math.max(...e)))}calculateAudioLevel(){if(!this.analyserNode||!this.dataArray)return void bi.d(this.TAG,"AudioContext not initialized");this.analyserNode.getByteTimeDomainData(this.dataArray);let e=.009,t=e;for(let n of this.dataArray)t=Math.max(t,(n-128)/128);let i=(Math.log(e)-Math.log(t))/Math.log(e);return Math.ceil(Math.min(Math.max(100*i,0),100))}isSilentThisInstant(){if(this.analyserNode&&this.dataArray)return this.analyserNode.getByteTimeDomainData(this.dataArray),this.dataArray.every((e=>128===e||0===e));bi.d(this.TAG,"AudioContext not initialized")}createAnalyserNodeForStream(e){let t=Bn.getAudioContext(),i=t.createMediaStreamSource(e),n=t.createAnalyser();return n.fftSize=2048,i.connect(n),n}};function Zn(e,t){return function(i){return!_()(e[i],t[i])}}var Xn,er,tr=class e extends cn{constructor(e,t,i,n,r=(new Cn).build(),s){super(e,t,i),this.eventBus=n,this.room=s,this.TAG="[HMSLocalAudioTrack]",this.tracksCreated=new Set,this.isPublished=!1,this.handleVisibilityChange=()=>Zt(this,null,(function*(){if(this.shouldReacquireTrack())if("hidden"===document.visibilityState)this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:"visibility-change"}));else{bi.d(this.TAG,"On visibile replacing track as it is not publishing");try{yield this.replaceTrackWith(this.settings)}catch(e){this.eventBus.error.publish(e)}this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:"visibility-change"}))}else bi.d(this.TAG,`visibiltiy: ${document.visibilityState}`,`${this}`)})),this.handleTrackMute=()=>{bi.d(this.TAG,"muted natively");let e="hidden"===document.visibilityState?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:e}))},this.handleTrackUnmute=()=>Zt(this,null,(function*(){bi.d(this.TAG,"unmuted natively");let e="hidden"===document.visibilityState?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:e}));try{yield this.setEnabled(this.enabled),this.eventBus.localAudioUnmutedNatively.publish()}catch(t){this.eventBus.error.publish(t)}})),this.replaceSenderTrack=()=>Zt(this,null,(function*(){this.transceiver&&"sendonly"===this.transceiver.direction?yield this.transceiver.sender.replaceTrack(this.processedTrack||this.nativeTrack):bi.d(this.TAG,`transceiver for ${this.trackId} not available or not connected yet`)})),this.shouldReacquireTrack=()=>Fn(this.nativeTrack)||this.isTrackNotPublishing(),this.handleSettingsChange=e=>Zt(this,null,(function*(){let t=this.stream,i=Zn(e,this.settings);(i("maxBitrate")||i("audioMode"))&&e.maxBitrate&&(yield t.setMaxBitrateAndFramerate(this,e)),(i("advanced")||i("audioMode"))&&(yield this.replaceTrackWith(e))})),this.handleDeviceChange=(e,t=!1)=>Zt(this,null,(function*(){if(Zn(e,this.settings)("deviceId")){this.manuallySelectedDeviceId=t?this.manuallySelectedDeviceId:e.deviceId,bi.d(this.TAG,"device change","manual selection:",this.manuallySelectedDeviceId,"new device:",e.deviceId),yield this.replaceTrackWith(e);let i=this.nativeTrack.getSettings().groupId;!t&&e.deviceId&&(dn.updateSelection("audioInput",{deviceId:e.deviceId,groupId:i}),this.eventBus.deviceChange.publish({isUserSelection:!0,type:"audioInput",selection:{deviceId:e.deviceId,groupId:i}}))}})),e.tracks.push(this),this.addTrackEventListeners(t),this.settings=r,r.deviceId!==t.getSettings().deviceId&&!Fn(t)&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new Dn(this,n,s),this.setFirstTrackId(t.id),"regular"===i&&document.addEventListener("visibilitychange",this.handleVisibilityChange)}clone(t){let i=new e(t,this.nativeTrack.clone(),this.source,this.eventBus,this.settings,this.room);return i.peerId=this.peerId,this.pluginsManager.pluginsMap.size>0&&this.pluginsManager.pluginsMap.forEach((e=>{i.addPlugin(e).catch((t=>bi.e(this.TAG,"Plugin add failed while migrating",e,t)))})),i}getManuallySelectedDeviceId(){return this.manuallySelectedDeviceId}resetManuallySelectedDeviceId(){this.manuallySelectedDeviceId=void 0}updateTrack(e){return Zt(this,null,(function*(){e.enabled=this.enabled,yield this.stream.replaceStreamTrack(this.nativeTrack,e),this.nativeTrack=e,yield this.replaceSenderTrack(),this.audioLevelMonitor&&this.initAudioLevelMonitor()}))}replaceTrackWith(e){return Zt(this,null,(function*(){let t=this.nativeTrack;null==t||t.stop(),this.removeTrackEventListeners(t),this.tracksCreated.forEach((e=>e.stop())),this.tracksCreated.clear();try{let i=yield Nn(e);this.addTrackEventListeners(i),this.tracksCreated.add(i),bi.d(this.TAG,"replaceTrack, Previous track stopped",t,"newTrack",i),yield this.updateTrack(i)}catch(Ne){let t=yield Nn(this.settings);throw this.addTrackEventListeners(t),this.tracksCreated.add(t),yield this.updateTrack(t),this.isPublished&&this.eventBus.analytics.publish(on.publish({error:Ne})),Ne}try{yield this.pluginsManager.reprocessPlugins()}catch(Ne){this.eventBus.audioPluginFailed.publish(Ne)}}))}setEnabled(t){return Zt(this,null,(function*(){t!==this.enabled&&(t&&this.shouldReacquireTrack()&&(yield this.replaceTrackWith(this.settings)),yield Yt(e.prototype,this,"setEnabled").call(this,t),t&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),this.eventBus.localAudioEnabled.publish({enabled:t,track:this}))}))}isPublishedTrackId(e){return this.publishedTrackId===e}setSettings(e,t=!1){return Zt(this,null,(function*(){let i=this.buildNewSettings(e);Fn(this.nativeTrack)||(yield this.handleDeviceChange(i,t),yield this.handleSettingsChange(i)),this.settings=i}))}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(e){return Zt(this,null,(function*(){return this.pluginsManager.addPlugin(e)}))}removePlugin(e){return Zt(this,null,(function*(){return this.pluginsManager.removePlugin(e)}))}validatePlugin(e){return this.pluginsManager.validatePlugin(e)}setProcessedTrack(e){return Zt(this,null,(function*(){e?e!==this.processedTrack&&(this.processedTrack=e):this.processedTrack=void 0,yield this.replaceSenderTrack()}))}initAudioLevelMonitor(){this.audioLevelMonitor&&this.destroyAudioLevelMonitor(),bi.d(this.TAG,"Monitor Audio Level for",this,this.getMediaTrackSettings().deviceId),this.audioLevelMonitor=new Yn(this,this.eventBus.trackAudioLevelUpdate,this.eventBus.localAudioSilence),this.audioLevelMonitor.start(),this.audioLevelMonitor.detectSilence()}destroyAudioLevelMonitor(){var e;null==(e=this.audioLevelMonitor)||e.stop(),this.audioLevelMonitor=void 0}cleanup(){return Zt(this,null,(function*(){var t;Yt(e.prototype,this,"cleanup").call(this),yield this.pluginsManager.cleanup(),yield this.pluginsManager.closeContext(),this.transceiver=void 0,null==(t=this.processedTrack)||t.stop(),this.tracksCreated.forEach((e=>e.stop())),this.tracksCreated.clear(),this.isPublished=!1,this.destroyAudioLevelMonitor(),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}))}getTrackIDBeingSent(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}getTrackBeingSent(){return this.processedTrack||this.nativeTrack}addTrackEventListeners(e){e.addEventListener("mute",this.handleTrackMute),e.addEventListener("unmute",this.handleTrackUnmute)}removeTrackEventListeners(e){e.removeEventListener("mute",this.handleTrackMute),e.removeEventListener("unmute",this.handleTrackUnmute)}buildNewSettings(e){let{volume:t,codec:i,maxBitrate:n,deviceId:r,advanced:s,audioMode:o}=zt(zt({},this.settings),e);return new _n(t,i,n,r,s,o)}},ir=class e extends cn{setEnabled(t){return Zt(this,null,(function*(){t!==this.enabled&&(yield Yt(e.prototype,this,"setEnabled").call(this,t),yield this.subscribeToAudio(t))}))}},nr=class extends ln{constructor(e,t,i){if(super(e,t,i),this.type="video",this.sinkCount=0,this.handleTrackUnmute=()=>{this.getSinks().forEach((e=>this.reTriggerPlay({videoElement:e})))},this.reTriggerPlay=({videoElement:e})=>{setTimeout((()=>{e.play().catch((e=>{bi.w("[HMSVideoTrack]","failed to play",e.message)}))}),0)},"video"!==t.kind)throw new Error("Expected 'track' kind = 'video'")}setVideoHandler(e){this.videoHandler=e}hasSinks(){return this.sinkCount>0}getSinks(){return this.videoHandler.getVideoElements()||[]}attach(e){this.videoHandler.addVideoElement(e)}detach(e){this.videoHandler.removeVideoElement(e)}addSink(e){this.addSinkInternal(e,this.nativeTrack)}removeSink(e){null!==e.srcObject&&(e.srcObject=null,this.reduceSinkCount())}cleanup(){super.cleanup(),this.videoHandler.cleanup()}addSinkInternal(e,t){let i=e.srcObject;if(null!==i&&i instanceof MediaStream){let e=i.getVideoTracks()[0];if((null==e?void 0:e.id)===t.id){if(!e.muted&&"live"===e.readyState)return;this.reduceSinkCount()}else this.reduceSinkCount()}this.addPropertiesToElement(e);let n=new MediaStream([t]);e.srcObject=n,this.reTriggerPlay({videoElement:e}),this.sinkCount++}reduceSinkCount(){this.sinkCount>0&&this.sinkCount--}addPropertiesToElement(e){Oi||(e.autoplay=!0),e.playsInline=!0,e.muted=!0,e.controls=!1}},rr={none:-1,low:0,medium:1,high:2},sr=.5,or=(e,t)=>{let i="high",n=t.width>t.height?"width":"height",r=[...e].sort(((e,t)=>rr[e.layer]-rr[t.layer])),s=t[n]*((null==window?void 0:window.devicePixelRatio)||1);for(let o=0;o<r.length;o++){let{resolution:e,layer:t}=r[o],a=e[n];if(s<=a){i=t;break}{let e=r[o+1],l=e?e.resolution[n]:Number.POSITIVE_INFINITY;if((s-a)/(l-a)<sr){i=t;break}}}return i},ar=class{constructor(){this.TAG="[HMSIntersectionObserverWrapper]",this.listeners=new WeakMap,this.observe=(e,t)=>{var i;this.createObserver(),this.unobserve(e),null==(i=this.intersectionObserver)||i.observe(e),this.listeners.set(e,t)},this.unobserve=e=>{var t;null==(t=this.intersectionObserver)||t.unobserve(e),this.listeners.delete(e)},this.createObserver=()=>{this.isSupported()&&!this.intersectionObserver&&(this.intersectionObserver=new IntersectionObserver(this.handleIntersection))},this.handleIntersection=e=>{var t;for(let i of e)null==(t=this.listeners.get(i.target))||t(i)},this.createObserver()}isSupported(){let e=_i&&"undefined"!=typeof window.IntersectionObserver;return e||bi.w(this.TAG,"IntersectionObserver is not supported, fallback will be used instead"),e}},lr=new ar,cr=class{constructor(){this.TAG="[HMSResizeObserverWrapper]",this.listeners=new WeakMap,this.observe=(e,t,i={box:"border-box"})=>{var n;this.createObserver(),this.unobserve(e),null==(n=this.resizeObserver)||n.observe(e,i),this.listeners.set(e,t)},this.unobserve=e=>{var t;null==(t=this.resizeObserver)||t.unobserve(e),this.listeners.delete(e)},this.createObserver=()=>{this.isSupported()&&!this.resizeObserver&&(this.resizeObserver=new ResizeObserver(Kn(this.handleResize,300)))},this.handleResize=e=>{var t;for(let i of e)null==(t=this.listeners.get(i.target))||t(i)},this.createObserver()}isSupported(){let e=_i&&"undefined"!=typeof window.ResizeObserver;return e||bi.w(this.TAG,"Resize Observer is not supported"),e}},ur=new cr,dr=class{constructor(e){this.track=e,this.TAG="[VideoElementManager]",this.videoElements=new Set,this.entries=new WeakMap,this.handleIntersection=e=>Zt(this,null,(function*(){let t="visible"===getComputedStyle(e.target).visibility;this.track.enabled&&(e.isIntersecting&&t||!document.contains(e.target))?(bi.d(this.TAG,"add sink intersection",`${this.track}`,this.id),this.entries.set(e.target,e.boundingClientRect),yield this.selectMaxLayer(),yield this.track.addSink(e.target)):(bi.d(this.TAG,"remove sink intersection",`${this.track}`,this.id),yield this.track.removeSink(e.target))})),this.handleResize=e=>Zt(this,null,(function*(){!this.track.enabled||!(this.track instanceof Gr)||(this.entries.set(e.target,e.contentRect),yield this.selectMaxLayer())})),this.cleanup=()=>{this.videoElements.forEach((e=>{var t,i;e.srcObject=null,null==(t=this.resizeObserver)||t.unobserve(e),null==(i=this.intersectionObserver)||i.unobserve(e)})),this.videoElements.clear(),this.resizeObserver=void 0,this.intersectionObserver=void 0},this.init(),this.id=P()}updateSinks(e=!1){for(let t of this.videoElements)this.track.enabled?this.track.addSink(t,e):this.track.removeSink(t,e)}addVideoElement(e){return Zt(this,null,(function*(){var t;this.videoElements.has(e)||(this.init(),bi.d(this.TAG,`Adding video element for ${this.track}`,this.id),this.videoElements.add(e),this.videoElements.size>=10&&bi.w(this.TAG,`${this.track}`,`the track is added to ${this.videoElements.size} video elements, while this may be intentional, it's likely that there is a bug leading to unnecessary creation of video elements in the UI`),null!=(t=this.intersectionObserver)&&t.isSupported()?this.intersectionObserver.observe(e,this.handleIntersection):_i&&(this.isElementInViewport(e)?this.track.addSink(e):this.track.removeSink(e)),this.resizeObserver?this.resizeObserver.observe(e,this.handleResize):this.track instanceof Gr&&(yield this.track.setPreferredLayer(this.track.getPreferredLayer())))}))}removeVideoElement(e){var t,i;this.track.removeSink(e),this.videoElements.delete(e),this.entries.delete(e),null==(t=this.resizeObserver)||t.unobserve(e),null==(i=this.intersectionObserver)||i.unobserve(e),bi.d(this.TAG,`Removing video element for ${this.track}`)}getVideoElements(){return Array.from(this.videoElements)}init(){_i&&(this.resizeObserver=ur,this.intersectionObserver=lr)}isElementInViewport(e){let t=e.offsetTop,i=e.offsetLeft,n=e.offsetWidth,r=e.offsetHeight,{hidden:s}=e,{opacity:o,display:a}=getComputedStyle(e);for(;e.offsetParent;)e=e.offsetParent,t+=e.offsetTop,i+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&i<window.pageXOffset+window.innerWidth&&t+r>window.pageYOffset&&i+n>window.pageXOffset&&!s&&(""===o||parseFloat(o)>0)&&"none"!==a}selectMaxLayer(){return Zt(this,null,(function*(){if(!(this.track instanceof Gr)||0===this.videoElements.size)return;let e;for(let t of this.videoElements){let i=this.entries.get(t);if(!i)continue;let{width:n,height:r}=i;if(0===n||0===r)continue;let s=or(this.track.getSimulcastDefinitions(),{width:n,height:r});e=e?rr[s]>rr[e]?s:e:s}e&&(bi.d(this.TAG,`selecting max layer ${e} for the track`,`${this.track}`),yield this.track.setPreferredLayer(e))}))}},hr=(e=>(e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE",e))(hr||{}),pr=(e=>(e["2D"]="2d",e.WEBGL="webgl",e.WEBGL2="webgl2",e))(pr||{}),fr=class{constructor(){this.total=0,this.count=0}add(e){this.count++,this.total+=e}getAvg(){return Math.floor(this.total/this.count)}reset(){this.total=0,this.count=0}},vr=class{constructor(e){this.eventBus=e,this.TAG="[VideoPluginsAnalytics]",this.initTime={},this.preProcessingAvgs=new fr,this.addedTimestamps={},this.processingAvgs={},this.pluginAdded={},this.pluginInputFrameRate={},this.pluginFrameRate={}}added(e,t,i){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.processingAvgs[e]=new fr,t&&(this.pluginInputFrameRate[e]=t,this.pluginFrameRate[e]=i||t),this.eventBus.analytics.publish(fn.added(e,this.addedTimestamps[e]))}removed(e){var t;if(this.pluginAdded[e]){let i={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],avgPreProcessingTime:this.preProcessingAvgs.getAvg(),avgProcessingTime:null==(t=this.processingAvgs[e])?void 0:t.getAvg(),inputFrameRate:this.pluginInputFrameRate[e],pluginFrameRate:this.pluginFrameRate[e]};this.eventBus.analytics.publish(fn.stats(i)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(fn.failure(e,t)),this.clean(e))}initWithTime(e,t){return Zt(this,null,(function*(){if(this.initTime[e])return void bi.i(this.TAG,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);let i;try{i=yield this.timeInMs(t),bi.i(this.TAG,`Time taken for Plugin ${e} initialization : ${i}`)}catch(Ne){let i=Wi.MediaPluginErrors.InitFailed("VIDEO_PLUGINS",`failed during initialization of plugin${Ne.message||Ne}`);throw bi.e(this.TAG,i),this.failure(e,i),i}i&&(this.initTime[e]=i)}))}preProcessWithTime(e){return Zt(this,null,(function*(){let t=yield this.timeInMs(e);this.preProcessingAvgs.add(t)}))}processWithTime(e,t){return Zt(this,null,(function*(){var i;let n;try{n=yield this.timeInMs(t)}catch(We){let i=Wi.MediaPluginErrors.ProcessingFailed("VIDEO_PLUGINS",`Failed during processing of plugin${We.message||We}`);throw bi.e(this.TAG,i),this.failure(e,i),i}n&&(null==(i=this.processingAvgs[e])||i.add(n))}))}timeInMs(e){return Zt(this,null,(function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)}))}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.processingAvgs[e],delete this.pluginAdded[e],delete this.pluginInputFrameRate[e],delete this.pluginFrameRate[e]}},gr=24,mr=320,yr=240,br=class{constructor(e,t){this.TAG="[VideoPluginsManager]",this.pluginsLoopRunning=!1,this.pluginsLoopState="paused",this.pluginAddInProgress=!1,this.reusableWorker=zn(),this.hmsTrack=e,this.pluginsMap=new Map,this.pluginNumFramesToSkip={},this.pluginNumFramesSkipped={},this.analytics=new vr(t),this.canvases=new Array}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e,t){return Zt(this,null,(function*(){var i;if(this.pluginAddInProgress){let t=null==(i=e.getName)?void 0:i.call(e);if(!t||""===t)return void bi.w("no name provided by the plugin");let n=Wi.MediaPluginErrors.AddAlreadyInProgress("VIDEO_PLUGINS","Add Plugin is already in Progress");throw this.analytics.failure(t,n),bi.w("can't add another plugin when previous add is in progress"),n}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e,t)}finally{this.pluginAddInProgress=!1}}))}addPluginInternal(e,t){return Zt(this,null,(function*(){var i,n;let r=null==(i=e.getName)?void 0:i.call(e);if(!r||""===r)return void bi.w("no name provided by the plugin");if(this.pluginsMap.has(r))return void bi.w(this.TAG,`plugin - ${e.getName()} already added.`);let s=this.hmsTrack.getMediaTrackSettings().frameRate||gr,o=0;t&&t>0?(bi.i(this.TAG,`adding plugin ${e.getName()} with framerate ${t}`),t<s&&(o=Math.ceil(s/t)-1),this.analytics.added(r,s,t)):(bi.i(this.TAG,`adding plugin ${e.getName()}`),this.analytics.added(r,s)),bi.i(this.TAG,"numFrames to skip processing",o),this.pluginNumFramesToSkip[r]=o,this.pluginNumFramesSkipped[r]=o,this.validateAndThrow(r,e);try{if(yield this.analytics.initWithTime(r,(()=>Zt(this,null,(function*(){return yield e.init()})))),this.pluginsMap.set(r,e),this.pluginsMap.size+1>this.canvases.length)for(let e=this.canvases.length;e<=this.pluginsMap.size;e++)this.canvases[e]=document.createElement("canvas");yield this.startPluginsLoop(null==(n=e.getContextType)?void 0:n.call(e))}catch(Ke){throw bi.e(this.TAG,"failed to add plugin",Ke),yield this.removePlugin(e),Ke}}))}validatePlugin(e){return e.checkSupport()}validateAndThrow(e,t){let i=this.validatePlugin(t);if(i.isSupported)bi.i(this.TAG,`plugin is supported,- ${t.getName()}`);else{let t;switch(i.errType){case"PLATFORM_NOT_SUPPORTED":throw t=Wi.MediaPluginErrors.PlatformNotSupported("VIDEO_PLUGINS","platform not supported, see docs"),this.analytics.failure(e,t),t;case"DEVICE_NOT_SUPPORTED":throw t=Wi.MediaPluginErrors.DeviceNotSupported("VIDEO_PLUGINS","video device not supported, see docs"),this.analytics.failure(e,t),t}}}removePlugin(e){return Zt(this,null,(function*(){let t=e.getName();this.pluginsMap.get(t)?(bi.i(this.TAG,`removing plugin ${t}`),this.removePluginEntry(t),0===this.pluginsMap.size&&(bi.i(this.TAG,"No plugins left, stopping plugins loop"),yield this.stopPluginsLoop()),e.stop(),this.analytics.removed(t)):bi.w(this.TAG,`plugin - ${t} not found to remove.`)}))}removePluginEntry(e){this.pluginsMap.delete(e),this.pluginNumFramesToSkip[e]&&delete this.pluginNumFramesToSkip[e],this.pluginNumFramesSkipped[e]&&delete this.pluginNumFramesSkipped[e]}waitForRestart(){return Zt(this,null,(function*(){if(this.pluginsLoopRunning&&"running"!==this.pluginsLoopState)for(;"paused"===this.pluginsLoopState;)yield qn(100)}))}cleanup(){return Zt(this,null,(function*(){var e;for(let t of this.pluginsMap.values())yield this.removePlugin(t);null==(e=this.outputTrack)||e.stop()}))}initElementsAndStream(e){this.inputCanvas||(this.inputCanvas=document.createElement("canvas")),this.outputCanvas=document.createElement("canvas"),this.inputVideo||(this.inputVideo=document.createElement("video")),this.inputCanvas.getContext("2d"),this.outputCanvas.getContext(e||"2d");let t=this.outputCanvas.captureStream();this.outputTrack=t.getVideoTracks()[0]}startPluginsLoop(e){return Zt(this,null,(function*(){if(!this.pluginsLoopRunning){this.initElementsAndStream(e),this.pluginsLoopRunning=!0;try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(Ue){throw this.pluginsLoopRunning=!1,bi.e(this.TAG,"error in setting processed track",Ue),Ue}this.pluginsLoop().then((()=>{bi.d(this.TAG,"processLoop stopped")}))}}))}stopPluginsLoop(){return Zt(this,null,(function*(){var e;this.pluginsLoopRunning=!1,yield this.hmsTrack.setProcessedTrack(void 0),this.resetCanvases(),null==(e=this.outputTrack)||e.stop(),this.inputVideo&&(this.inputVideo.srcObject=null,this.inputVideo=void 0)}))}pluginsLoop(){return Zt(this,null,(function*(){for(;this.pluginsLoopRunning;){let e=this.hmsTrack.getMediaTrackSettings().frameRate||gr,t=Math.floor(1e3/e);if(!this.hmsTrack.enabled||"ended"===this.hmsTrack.nativeTrack.readyState){"running"===this.pluginsLoopState&&this.resetCanvases(),this.pluginsLoopState="paused",yield this.reusableWorker.sleep(t);continue}let i=0;try{yield this.analytics.preProcessWithTime((()=>Zt(this,null,(function*(){return yield this.doPreProcessing()}))));let e=Date.now();yield this.processFramesThroughPlugins(),i=Math.floor(Date.now()-e),i>t&&(i=t)}catch(Ne){bi.e(this.TAG,"error in plugins loop",Ne)}this.pluginsLoopState="running",yield this.reusableWorker.sleep(t-i)}}))}doPreProcessing(){return Zt(this,null,(function*(){yield this.addTrackToVideo(),yield this.updateInputCanvas()}))}processFramesThroughPlugins(){return Zt(this,null,(function*(){this.canvases[0]=this.inputCanvas;let e=0;for(let t of this.pluginsMap.values()){let i=t.getName();if(t){try{let n=this.checkIfSkipRequired(i);if("TRANSFORM"===t.getPluginType()){let r=(e,r)=>Zt(this,null,(function*(){try{yield t.processVideoFrame(e,r,n)}catch(Ke){bi.e(this.TAG,`error in processing plugin ${i}`,Ke)}}));if(n)e===this.pluginsMap.size-1?yield r(this.canvases[e],this.outputCanvas):yield r(this.canvases[e],this.canvases[e+1]);else{let t=this.canvases[e],n=this.canvases[e+1];e===this.pluginsMap.size-1?yield this.analytics.processWithTime(i,(()=>Zt(this,null,(function*(){return r(t,this.outputCanvas)})))):yield this.analytics.processWithTime(i,(()=>Zt(this,null,(function*(){return r(t,n)}))))}}else"ANALYZE"===t.getPluginType()&&!n&&(yield this.analytics.processWithTime(i,(()=>Zt(this,null,(function*(){return yield t.processVideoFrame(this.inputCanvas)})))))}catch(Ne){bi.e(this.TAG,`error in processing plugin ${i}`,Ne),yield this.removePlugin(t)}e++}}}))}addTrackToVideo(){return Zt(this,null,(function*(){var e;if(!this.inputVideo)return;let t=this.inputVideo.srcObject;null!==t&&t instanceof MediaStream&&(null==(e=t.getVideoTracks()[0])?void 0:e.id)===this.hmsTrack.nativeTrack.id||(this.inputVideo.pause(),this.inputVideo.srcObject=new MediaStream([this.hmsTrack.nativeTrack]),this.inputVideo.muted=!0,this.inputVideo.playsInline=!0,yield this.inputVideo.play())}))}updateInputCanvas(){return Zt(this,null,(function*(){if(!this.inputCanvas||!this.inputVideo)return;let{width:e=mr,height:t=yr}=this.hmsTrack.getMediaTrackSettings();this.inputCanvas.height!==t&&(this.inputCanvas.height=t),this.inputCanvas.width!==e&&(this.inputCanvas.width=e),this.inputCanvas.getContext("2d").drawImage(this.inputVideo,0,0,e,t)}))}resetCanvases(){if(!this.outputCanvas||!this.inputCanvas)return;let e=this.inputCanvas.getContext("2d");e&&(e.fillStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height)),this.canvases=[]}checkIfSkipRequired(e){let t=!1;return this.pluginNumFramesSkipped[e]<this.pluginNumFramesToSkip[e]?(this.pluginNumFramesSkipped[e]++,t=!0):(t=!1,this.pluginNumFramesSkipped[e]=0),t}},kr=class{constructor(e,t){this.TAG="[MediaStreamPluginsManager]",this.plugins=new Set,this.analytics=new vr(e),this.room=t}addPlugins(e){e.forEach((e=>{var t;switch(e.getName()){case"HMSEffectsPlugin":if(null==(t=this.room)||!t.isEffectsEnabled){let e="Effects Virtual Background is not enabled for this room";if(0===this.plugins.size)throw Error(e);return void bi.w(this.TAG,e)}break;default:}this.plugins.add(e)}))}removePlugins(e){e.forEach((e=>{e.stop(),this.analytics.removed(e.getName()),this.plugins.delete(e)}))}applyPlugins(e){let t=e;for(let i of this.plugins){let e=i.getName();try{t=i.apply(t),this.analytics.added(e)}catch(We){this.analytics.failure(e,We),bi.e("Could not apply plugin",We,e)}}return t}getPlugins(){return Array.from(this.plugins).map((e=>e.getName()))}cleanup(){return Zt(this,null,(function*(){this.removePlugins(Array.from(this.plugins))}))}},Tr=["init_response_time","ws_connect_time","on_policy_change_time","local_audio_track_time","local_video_track_time","peer_list_time","room_state_time","join_response_time"],Sr=class{constructor(){this.eventPerformanceMeasures={}}start(e){performance.mark(e)}end(e){var t;try{this.eventPerformanceMeasures[e]=performance.measure(e,e),bi.d("[HMSPerformanceTiming]",e,null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration)}catch(T){bi.w("[AnalyticsTimer]",`Error in measuring performance for event ${e}`,{error:T})}}getTimeTaken(e){var t;return null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration}getTimes(...e){return[...Tr,...e].reduce(((e,t)=>Kt(zt({},e),{[t]:this.getTimeTaken(t)})),{})}cleanup(){this.eventPerformanceMeasures={}}},wr={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default",audioMode:"voice"},Er=class e{constructor(e,t,i,n,r){this.store=e,this.observer=t,this.deviceManager=i,this.eventBus=n,this.analyticsTimer=r,this.TAG="[LocalTrackManager]",this.setScreenCaptureHandleConfig()}getTracksToPublish(){return Zt(this,arguments,(function*(e=wr){let t=this.getAVTrackSettings(e);if(!t)return[];let i=!!t.audio,n=!!t.video,r=[],{videoTrack:s,audioTrack:o}=yield this.updateCurrentLocalTrackSettings(t),a=(null==s?void 0:s.stream)||(null==o?void 0:o.stream),l=!(!s||!this.store.getTrackById(s.trackId)),c=!(!o||!this.store.getTrackById(o.trackId));if(l&&c)return[];let u={audio:i&&!o&&(!e.isAudioMuted||"empty"),video:n&&!s&&(!e.isVideoMuted||"empty")};u.audio&&this.analyticsTimer.start("local_audio_track_time"),u.video&&this.analyticsTimer.start("local_video_track_time");try{bi.d(this.TAG,"Init Local Tracks",{fetchTrackOptions:u}),r=yield this.getLocalTracks(u,t,a)}catch(d){r=yield this.retryGetLocalTracks(d,t,u,a)}return u.audio&&this.analyticsTimer.end("local_audio_track_time"),u.video&&this.analyticsTimer.end("local_video_track_time"),s&&n&&!l&&r.push(s),o&&i&&!c&&r.push(o),r}))}getLocalTracks(){return Zt(this,arguments,(function*(e={audio:!0,video:!0},t,i){try{let n=yield this.getNativeLocalTracks(e,t);return this.createHMSLocalTracks(n,t,i)}catch(Ne){throw this.eventBus.analytics.publish(on.publish({devices:this.deviceManager.getDevices(),error:Ne,settings:t})),Ne}}))}getNativeLocalTracks(){return Zt(this,arguments,(function*(e={audio:!1,video:!1},t){let i=new Ln(!0===e.video?t.video:null,!0===e.audio?t.audio:null,t.simulcast),n=[];return(i.audio||i.video)&&n.push(...yield this.getAVTracks(i)),n.push(...this.getEmptyTracks(e)),n}))}optimizeScreenShareConstraint(e,t){return Zt(this,null,(function*(){var i,n,r;if("boolean"==typeof t.video||null==(i=t.video)||!i.width||null==(n=t.video)||!n.height)return;let s=this.store.getPublishParams();if(!s||null==(r=s.allowed)||!r.includes("screen"))return;let o=document.createElement("video");o.srcObject=e,o.addEventListener("loadedmetadata",(()=>Zt(this,null,(function*(){let{videoWidth:i,videoHeight:n}=o,r=s.screen,a=r.width*r.height,l=i/n,c=r.width/r.height;if(l>c){let r=t.video,s=l/c,o=Math.sqrt(s);i*n>a?(r.width=i/o,r.height=n/o):(r.height=n*o,r.width=i*o),yield e.getVideoTracks()[0].applyConstraints(r)}}))))}))}getLocalScreen(e,t=!1){return Zt(this,null,(function*(){var i;let n,r=yield this.getOrDefaultScreenshareConfig(e),s=this.getScreenshareSettings(r.videoOnly),o={video:Kt(zt({},null==s?void 0:s.video.toConstraints(!0)),{displaySurface:r.displaySurface}),preferCurrentTab:r.preferCurrentTab,selfBrowserSurface:r.selfBrowserSurface,surfaceSwitching:r.surfaceSwitching,systemAudio:r.systemAudio};if(null!=s&&s.audio){let e=null==(i=null==s?void 0:s.audio)?void 0:i.toConstraints();delete e.advanced,o.audio=Kt(zt({},e),{autoGainControl:!1,noiseSuppression:!1,googAutoGainControl:!1,echoCancellation:!1})}else null!=e&&e.forceCurrentTab&&e.preferCurrentTab&&e.cropElement&&(o.audio={echoCancellation:!0,noiseSuppression:!0});try{bi.d("retrieving screenshare with ",{config:r},{constraints:o}),n=yield navigator.mediaDevices.getDisplayMedia(o),t&&(yield this.optimizeScreenShareConstraint(n,o))}catch(et){bi.w(this.TAG,"error in getting screenshare - ",et);let t=xn(et,"screen");throw this.eventBus.analytics.publish(on.publish({error:t,devices:this.deviceManager.getDevices(),settings:new Ln(null==s?void 0:s.video,null==s?void 0:s.audio,!1)})),t}let a=[],l=new Vr(n),c=n.getVideoTracks()[0],u=new Cr(l,c,"screen",this.eventBus,null==s?void 0:s.video,this.store.getRoom());u.setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"screen"));try{let e=this.validateCurrentTabCapture(u,r.forceCurrentTab);u.isCurrentTab=e,yield u.cropTo(r.cropTarget)}catch(et){throw n.getTracks().forEach((e=>e.stop())),et}a.push(u);let d=n.getAudioTracks()[0];if(d){let e=new tr(l,d,"screen",this.eventBus,null==s?void 0:s.audio,this.store.getRoom());a.push(e)}return bi.v(this.TAG,"getLocalScreen",a),a}))}setScreenCaptureHandleConfig(e){var t;null==(t=navigator.mediaDevices)||!t.setCaptureHandleConfig||this.isInIframe()||(e=e||{},Object.assign(e,{handle:P(),exposeOrigin:!1,permittedOrigins:[window.location.origin]}),bi.d("setting capture handle - ",e.handle),navigator.mediaDevices.setCaptureHandleConfig(e),this.captureHandleIdentifier=e.handle)}validateCurrentTabCapture(e,t){let i=e.getCaptureHandle(),n=!(!this.captureHandleIdentifier||(null==i?void 0:i.handle)!==this.captureHandleIdentifier);if(t&&!n)throw bi.e(this.TAG,"current tab was not shared with forceCurrentTab as true"),Wi.TracksErrors.CurrentTabNotShared();return n}requestPermissions(){return Zt(this,null,(function*(){try{(yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach((e=>e.stop()))}catch(e){bi.e(this.TAG,e)}}))}static getEmptyVideoTrack(e){var t,i,n;let r=(null==(t=null==e?void 0:e.getSettings())?void 0:t.width)||320,s=(null==(i=null==e?void 0:e.getSettings())?void 0:i.height)||240,o=1;Xn||(Xn=document.createElement("canvas"),Xn.width=r,Xn.height=s,null==(n=Xn.getContext("2d"))||n.fillRect(0,0,r,s)),er||(er=setInterval((()=>{let e=null==Xn?void 0:Xn.getContext("2d");e&&e.fillRect(0,0,1,1)}),1e3/o));let a=Xn.captureStream(o).getVideoTracks()[0];return a.enabled=!1,a}static getEmptyAudioTrack(){let e=Bn.getAudioContext(),t=e.createOscillator(),i=e.createMediaStreamDestination();t.connect(i),t.start();let n=i.stream.getAudioTracks()[0];return n.enabled=!1,n}static cleanup(){clearInterval(er),er=void 0,Xn=void 0}getAVTracks(e){return Zt(this,null,(function*(){try{let t=yield navigator.mediaDevices.getUserMedia({audio:!!e.audio&&e.audio.toConstraints(),video:!!e.video&&e.video.toConstraints()});return t.getVideoTracks().concat(t.getAudioTracks())}catch(Ue){yield this.deviceManager.init();let i=!(this.deviceManager.hasWebcamPermission||!e.video),n=!(this.deviceManager.hasMicrophonePermission||!e.audio),r=this.getErrorType(i,n);throw xn(Ue,r)}}))}getAVTrackSettings(e){let t=this.getAudioSettings(e),i=this.getVideoSettings(e);return t||i?(new Rn).video(i).audio(t).build():null}isInIframe(){try{return window.self!==window.top}catch(e){return!0}}retryGetLocalTracks(e,t,i,n){return Zt(this,null,(function*(){if(!(e instanceof ji&&"TRACK"===e.action))return bi.w(this.TAG,"Fetch AV Tracks failed - unknown exception",e),this.observer.onFailure(e),[];{this.observer.onFailure(e);let r=e.code===Fi.TracksErrors.OVER_CONSTRAINED,s=e.message.includes("audio"),o=e.message.includes("video");if(r){let r=(new Rn).video(new In).audio(new _n).build();bi.w(this.TAG,"Fetch AV Tracks failed with overconstrained error",{fetchTrackOptions:i},{error:e});try{return yield this.getLocalTracks(i,r,n)}catch(Be){let r=Be instanceof ji?Be.nativeError:Be,s=Be;if("OverconstrainedError"===(null==r?void 0:r.name)){let e=Wi.TracksErrors.GenericTrack("TRACK","Overconstrained error after dropping all constraints");e.addNativeError(r),s=e}return yield this.retryGetLocalTracks(s,t,i,n)}}i.audio=s?"empty":i.audio,i.video=o?"empty":i.video,bi.w(this.TAG,"Fetch AV Tracks failed",{fetchTrackOptions:i},e);try{return yield this.getLocalTracks(i,t,n)}catch(Ke){return bi.w(this.TAG,"Fetch empty tacks failed",Ke),i.audio=i.audio&&"empty",i.video=i.video&&"empty",this.observer.onFailure(Ke),yield this.getLocalTracks(i,t,n)}}}))}getErrorType(e,t){return e&&t?"audio, video":e?"video":t?"audio":"audio, video"}getEmptyTracks(t){let i=[];return"empty"===t.audio&&i.push(e.getEmptyAudioTrack()),"empty"===t.video&&i.push(e.getEmptyVideoTrack()),i}updateCurrentLocalTrackSettings(e){return Zt(this,null,(function*(){let t=this.store.getLocalPeerTracks(),i=t.find((e=>"video"===e.type&&"regular"===e.source)),n=t.find((e=>"audio"===e.type&&"regular"===e.source)),r=t.find((e=>"video"===e.type&&"screen"===e.source));null!=e&&e.video&&(yield null==i?void 0:i.setSettings(e.video)),null!=e&&e.audio&&(yield null==n?void 0:n.setSettings(e.audio));let s=this.getScreenshareSettings(!0);return null!=s&&s.video&&(yield null==r?void 0:r.setSettings(null==s?void 0:s.video)),{videoTrack:i,audioTrack:n}}))}getAudioSettings(e){var t;let i=this.store.getPublishParams();if(!i||null==(t=i.allowed)||!t.includes("audio"))return null;let n=this.store.getLocalPeer(),r=null==n?void 0:n.audioTrack,s=(null==r?void 0:r.settings.deviceId)||e.audioInputDeviceId;return(new Cn).codec(i.audio.codec).maxBitrate(i.audio.bitRate).deviceId(s||wr.audioInputDeviceId).build()}getVideoSettings(e){var t;let i=this.store.getPublishParams();if(!i||null==(t=i.allowed)||!t.includes("video"))return null;let n=this.store.getLocalPeer(),r=null==n?void 0:n.videoTrack,s=(null==r?void 0:r.settings.deviceId)||e.videoDeviceId,o=i.video;return(new An).codec(o.codec).maxBitrate(o.bitRate).maxFramerate(o.frameRate).setWidth(o.width).setHeight(o.height).deviceId(s||wr.videoDeviceId).build()}getScreenshareSettings(e=!1){var t;let i=this.store.getPublishParams();if(!i||null==(t=i.allowed)||!t.includes("screen"))return null;let n=i.screen;return{video:(new An).maxBitrate(n.bitRate,!1).codec(n.codec).maxFramerate(n.frameRate).setWidth(n.width).setHeight(n.height).build(),audio:e?void 0:(new Cn).build()}}getOrDefaultScreenshareConfig(e){return Zt(this,null,(function*(){var t;let i=Object.assign({videoOnly:!1,audioOnly:!1,forceCurrentTab:!1,preferCurrentTab:!1,selfBrowserSurface:"exclude",surfaceSwitching:"include",systemAudio:"exclude",displaySurface:"monitor"},e||{});return i.forceCurrentTab&&(i.videoOnly=!0,i.preferCurrentTab=!0,i.selfBrowserSurface="include",i.surfaceSwitching="exclude"),i.preferCurrentTab&&(i.selfBrowserSurface="include",i.displaySurface=void 0),i.cropElement&&null!=(t=window.CropTarget)&&t.fromElement&&(i.cropTarget=yield window.CropTarget.fromElement(i.cropElement)),i}))}createHMSLocalTracks(e,t,i){let n=e.find((e=>"video"===e.kind)),r=e.find((e=>"audio"===e.kind));i?e.forEach((e=>null==i?void 0:i.nativeStream.addTrack(e))):i=new Vr(new MediaStream(e));let s=[];if(r&&null!=t&&t.audio){let e=new tr(i,r,"regular",this.eventBus,t.audio,this.store.getRoom());s.push(e)}if(n&&null!=t&&t.video){let e=new Cr(i,n,"regular",this.eventBus,t.video,this.store.getRoom());e.setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"regular")),s.push(e)}return s}};function Pr(e,t){return function(i){return!_()(e[i],t[i])}}var Cr=class e extends nr{constructor(e,t,i,n,r=(new An).build(),s){super(e,t,i),this.eventBus=n,this.room=s,this._layerDefinitions=[],this.TAG="[HMSLocalVideoTrack]",this.enabledStateBeforeBackground=!1,this.isCurrentTab=!1,this.isPublished=!1,this.replaceSenderTrack=e=>Zt(this,null,(function*(){this.transceiver&&"sendonly"===this.transceiver.direction?yield this.transceiver.sender.replaceTrack(e):bi.d(this.TAG,`transceiver for ${this.trackId} not available or not connected yet`)})),this.buildNewSettings=e=>{let{width:t,height:i,codec:n,maxFramerate:r,maxBitrate:s,deviceId:o,advanced:a,facingMode:l}=zt(zt({},this.settings),e);return new In(t,i,n,r,o,a,s,l)},this.handleSettingsChange=e=>Zt(this,null,(function*(){let t=this.stream,i=Pr(e,this.settings);if(i("maxBitrate")&&e.maxBitrate&&(yield t.setMaxBitrateAndFramerate(this)),i("width")||i("height")||i("advanced"))if("video"===this.source){let t=yield this.replaceTrackWith(e);yield this.replaceSender(t,this.enabled),this.nativeTrack=t,yield this.processPlugins(),this.videoHandler.updateSinks()}else yield this.nativeTrack.applyConstraints(e.toConstraints())})),this.handleDeviceChange=(e,t=!1)=>Zt(this,null,(function*(){if(Pr(e,this.settings)("deviceId")&&"regular"===this.source){if(this.enabled){delete e.facingMode;let t=yield this.replaceTrackWith(e);yield this.replaceSender(t,this.enabled),this.nativeTrack=t,yield this.processPlugins(),this.videoHandler.updateSinks()}let i=this.nativeTrack.getSettings().groupId;!t&&e.deviceId&&(dn.updateSelection("videoInput",{deviceId:e.deviceId,groupId:i}),this.eventBus.deviceChange.publish({isUserSelection:!0,type:"video",selection:{deviceId:e.deviceId,groupId:i}}))}})),this.handleTrackMute=()=>{bi.d(this.TAG,"muted natively",document.visibilityState);let e="hidden"===document.visibilityState?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:e})),this.eventBus.localVideoEnabled.publish({enabled:!1,track:this})},this.handleTrackUnmuteNatively=()=>Zt(this,null,(function*(){bi.d(this.TAG,"unmuted natively");let e="hidden"===document.visibilityState?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:e})),this.handleTrackUnmute(),this.eventBus.localVideoEnabled.publish({enabled:this.enabled,track:this}),this.eventBus.localVideoUnmutedNatively.publish(),yield this.setEnabled(this.enabled)})),this.removeOrReplaceProcessedTrack=e=>Zt(this,null,(function*(){e?e!==this.processedTrack&&(this.processedTrack=e):this.processedTrack=void 0,yield this.replaceSenderTrack(this.processedTrack||this.nativeTrack)})),this.handleVisibilityChange=()=>Zt(this,null,(function*(){if("hidden"===document.visibilityState)this.enabledStateBeforeBackground=this.enabled,this.enabled&&(yield this.setEnabled(!1)),this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:"visibility-change"}));else{if(bi.d(this.TAG,"visibility visible, restoring track state",this.enabledStateBeforeBackground),this.enabledStateBeforeBackground)try{yield this.setEnabled(!0)}catch(e){this.eventBus.error.publish(e)}this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:"visibility-change"}))}})),this.addTrackEventListeners(t),e.tracks.push(this),this.setVideoHandler(new dr(this)),this.settings=r,r.deviceId!==t.getSettings().deviceId&&t.enabled&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new br(this,n),this.mediaStreamPluginsManager=new kr(n,s),this.setFirstTrackId(this.trackId),this.eventBus.localAudioUnmutedNatively.subscribe(this.handleTrackUnmute),_i&&"regular"===i&&Ri()&&document.addEventListener("visibilitychange",this.handleVisibilityChange)}clone(t){let i=new e(t,this.nativeTrack.clone(),this.source,this.eventBus,this.settings,this.room);return i.peerId=this.peerId,this.pluginsManager.pluginsMap.size>0&&this.pluginsManager.pluginsMap.forEach((e=>{i.addPlugin(e).catch((t=>bi.e(this.TAG,"Plugin add failed while migrating",e,t)))})),this.mediaStreamPluginsManager.plugins.size>0&&i.addStreamPlugins(Array.from(this.mediaStreamPluginsManager.plugins)),i}setSimulcastDefinitons(e){this._layerDefinitions=e}getSimulcastDefinitions(){return this._layerDefinitions}setEnabled(t){return Zt(this,null,(function*(){var i;if(t!==this.enabled){if("regular"===this.source){let n;n=t?yield this.replaceTrackWith(this.settings):yield this.replaceTrackWithBlank(),yield this.replaceSender(n,t),null==(i=this.nativeTrack)||i.stop(),this.nativeTrack=n,yield Yt(e.prototype,this,"setEnabled").call(this,t),t&&(yield this.pluginsManager.waitForRestart(),yield this.processPlugins(),this.settings=this.buildNewSettings({deviceId:n.getSettings().deviceId})),this.videoHandler.updateSinks()}this.eventBus.localVideoEnabled.publish({enabled:t,track:this})}}))}processPlugins(){return Zt(this,null,(function*(){try{if(this.pluginsManager.getPlugins().length>0)return;if(this.mediaStreamPluginsManager.getPlugins().length>0){let e=this.mediaStreamPluginsManager.applyPlugins(new MediaStream([this.nativeTrack])).getVideoTracks()[0];yield this.setProcessedTrack(e)}else yield this.setProcessedTrack();this.videoHandler.updateSinks()}catch(Ue){console.error("error in processing plugin(s)",Ue)}}))}addStreamPlugins(e){return Zt(this,null,(function*(){if(this.pluginsManager.getPlugins().length>0)throw Error("Plugins of type HMSMediaStreamPlugin and HMSVideoPlugin cannot be used together");this.mediaStreamPluginsManager.addPlugins(e),yield this.processPlugins()}))}removeStreamPlugins(e){return Zt(this,null,(function*(){this.mediaStreamPluginsManager.removePlugins(e),yield this.processPlugins()}))}isPublishedTrackId(e){return this.publishedTrackId===e}addSink(e){this.addSinkInternal(e,this.processedTrack||this.nativeTrack)}setSettings(e,t=!1){return Zt(this,null,(function*(){let i=this.buildNewSettings(e);yield this.handleDeviceChange(i,t),this.enabled&&!Fn(this.nativeTrack)?(yield this.pluginsManager.waitForRestart(),yield this.handleSettingsChange(i),this.settings=i):this.settings=i}))}getPlugins(){return this.mediaStreamPluginsManager.getPlugins().length>0?this.mediaStreamPluginsManager.getPlugins():this.pluginsManager.getPlugins()}addPlugin(e,t){return Zt(this,null,(function*(){if(this.mediaStreamPluginsManager.getPlugins().length>0)throw Error("Plugins of type HMSVideoPlugin and HMSMediaStreamPlugin cannot be used together");return this.pluginsManager.addPlugin(e,t)}))}removePlugin(e){return Zt(this,null,(function*(){return this.pluginsManager.removePlugin(e)}))}validatePlugin(e){return this.pluginsManager.validatePlugin(e)}cleanup(){return Zt(this,null,(function*(){var t;this.eventBus.localAudioUnmutedNatively.unsubscribe(this.handleTrackUnmute),this.removeTrackEventListeners(this.nativeTrack),yield this.mediaStreamPluginsManager.cleanup(),yield this.pluginsManager.cleanup(),Yt(e.prototype,this,"cleanup").call(this),this.transceiver=void 0,null==(t=this.processedTrack)||t.stop(),this.isPublished=!1,_i&&Ri()&&document.removeEventListener("visibilitychange",this.handleVisibilityChange)}))}cropTo(e){return Zt(this,null,(function*(){if(e&&"screen"===this.source)try{this.nativeTrack.cropTo&&(yield this.nativeTrack.cropTo(e))}catch(T){throw bi.e(this.TAG,"failed to crop screenshare capture - ",T),Wi.TracksErrors.GenericTrack("TRACK","failed to crop screenshare capture")}}))}getCaptureHandle(){if(this.nativeTrack.getCaptureHandle)return this.nativeTrack.getCaptureHandle()}setProcessedTrack(e){return Zt(this,null,(function*(){this.nativeTrack.enabled?(yield this.removeOrReplaceProcessedTrack(e),this.videoHandler.updateSinks()):this.processedTrack=e}))}getTrackIDBeingSent(){return this.getTrackBeingSent().id}getTrackBeingSent(){return this.enabled&&this.processedTrack||this.nativeTrack}switchCamera(){return Zt(this,null,(function*(){var e;let t=this.getMediaTrackSettings().facingMode;if(!t||"regular"!==this.source)return void bi.d(this.TAG,"facingMode not supported");let i="environment"===t?"user":"environment";null==(e=this.nativeTrack)||e.stop();let n=yield this.replaceTrackWith(this.buildNewSettings({facingMode:i,deviceId:void 0}));yield this.replaceSender(n,this.enabled),this.nativeTrack=n,yield this.processPlugins(),this.videoHandler.updateSinks(),this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId,facingMode:i}),dn.updateSelection("videoInput",{deviceId:this.settings.deviceId,groupId:this.nativeTrack.getSettings().groupId})}))}replaceTrackWith(e){return Zt(this,null,(function*(){let t=this.nativeTrack;this.removeTrackEventListeners(t),null==t||t.stop();try{let i=yield Un(e);return this.addTrackEventListeners(i),bi.d(this.TAG,"replaceTrack, Previous track stopped",t,"newTrack",i),"default"===this.settings.deviceId&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),i}catch(Ne){let t=yield Un(this.settings);throw this.addTrackEventListeners(t),yield this.replaceSender(t,this.enabled),this.nativeTrack=t,yield this.processPlugins(),this.videoHandler.updateSinks(),this.isPublished&&this.eventBus.analytics.publish(on.publish({error:Ne})),Ne}}))}replaceTrackWithBlank(){return Zt(this,null,(function*(){let e=this.nativeTrack,t=Er.getEmptyVideoTrack(e);return this.removeTrackEventListeners(e),this.addTrackEventListeners(t),null==e||e.stop(),bi.d(this.TAG,"replaceTrackWithBlank, Previous track stopped",e,"newTrack",t),t}))}replaceSender(e,t){return Zt(this,null,(function*(){t?yield this.replaceSenderTrack(this.processedTrack||e):yield this.replaceSenderTrack(e),this.stream.replaceStreamTrack(this.nativeTrack,e)}))}addTrackEventListeners(e){e.addEventListener("mute",this.handleTrackMute),e.addEventListener("unmute",this.handleTrackUnmuteNatively)}removeTrackEventListeners(e){e.removeEventListener("mute",this.handleTrackMute),e.removeEventListener("unmute",this.handleTrackUnmuteNatively)}},_r="renegotiation-callback-id",Ar="ion-sfu",Ir="SUBSCRIBE_ICE_CONNECTION_CALLBACK_ID",Rr="https://event.100ms.live/v2/client/report",Lr="https://event-nonprod.100ms.live/v2/client/report",Dr=Math.pow(2,31)-1,Or={DEVICE_CHANGE:"device-change",LOCAL_AUDIO_ENABLED:"local-audio-enabled",LOCAL_VIDEO_ENABLED:"local-video-enabled",LOCAL_VIDEO_UNMUTED_NATIVELY:"local-video-unmuted-natively",LOCAL_AUDIO_UNMUTED_NATIVELY:"local-audio-unmuted-natively",STATS_UPDATE:"stats-update",RTC_STATS_UPDATE:"rtc-stats-update",TRACK_DEGRADED:"track-degraded",TRACK_RESTORED:"track-restored",TRACK_AUDIO_LEVEL_UPDATE:"track-audio-level-update",LOCAL_AUDIO_SILENCE:"local-audio-silence",ANALYTICS:"analytics",AUDIO_PLUGIN_FAILED:"audio-plugin-failed",POLICY_CHANGE:"policy-change",LOCAL_ROLE_UPDATE:"local-role-update",AUDIO_TRACK_UPDATE:"audio-track-update",AUDIO_TRACK_ADDED:"audio-track-added",AUDIO_TRACK_REMOVED:"audio-track-removed",AUTOPLAY_ERROR:"autoplay-error",LEAVE:"leave",ERROR:"error"},Mr="2.5",xr="20240720",Nr="_handraise",Ur=1e3,Fr=64,jr="https://whiteboard.100ms.live",Br="https://whiteboard-qa.100ms.live",Gr=class e extends nr{constructor(e,t,i,n){super(e,t,i),this._degraded=!1,this._degradedAt=null,this._layerDefinitions=[],this.history=new $r,this.preferredLayer="high",this.disableNoneLayerRequest=!1,this.disableNoneLayerRequest=!!n,this.setVideoHandler(new dr(this))}setTrackId(e){this.bizTrackId=e}get trackId(){return this.bizTrackId||super.trackId}get degraded(){return this._degraded}get degradedAt(){return this._degradedAt}setEnabled(t){return Zt(this,null,(function*(){t!==this.enabled&&(Yt(e.prototype,this,"setEnabled").call(this,t),this.videoHandler.updateSinks(!0))}))}setPreferredLayer(e){return Zt(this,null,(function*(){if("none"!==e){if(this.preferredLayer=e,this.shouldSendVideoLayer(e,"preferLayer")){if(!this.hasSinks())return void bi.d(`[Remote Track] ${this.logIdentifier}\n        streamId=${this.stream.id} \n        trackId=${this.trackId}\n        saving ${e}, source=${this.source}\n        Track does not have any sink`);yield this.requestLayer(e,"preferLayer"),this.pushInHistory(`uiPreferLayer-${e}`)}}else bi.w("layer none will be ignored")}))}getSimulcastLayer(){return this.stream.getSimulcastLayer()}getLayer(){return this.stream.getVideoLayer()}getPreferredLayer(){return this.preferredLayer}getPreferredLayerDefinition(){return this._layerDefinitions.find((e=>e.layer===this.preferredLayer))}replaceTrack(e){this.nativeTrack=e.nativeTrack,e.transceiver&&(this.transceiver=e.transceiver,this.stream.updateId(e.stream.id)),this.videoHandler.updateSinks()}addSink(t,i=!0){return Zt(this,null,(function*(){Fn(this.nativeTrack)?yield this.requestLayer(this.preferredLayer,"addSink"):(Yt(e.prototype,this,"addSink").call(this,t),i&&(yield this.updateLayer("addSink"))),this.pushInHistory("uiSetLayer-high")}))}removeSink(t,i=!0){return Zt(this,null,(function*(){Yt(e.prototype,this,"removeSink").call(this,t),i&&(yield this.updateLayer("removeSink")),this._degraded=!1,this.pushInHistory("uiSetLayer-none")}))}getSimulcastDefinitions(){return[...this._layerDefinitions]}setSimulcastDefinitons(e){this._layerDefinitions=e}setLayerFromServer(e){this._degraded=this.getDegradationValue(e),this._degradedAt=this._degraded?new Date:this._degradedAt;let t=e.current_layer;return bi.d(`[Remote Track] ${this.logIdentifier} \n      streamId=${this.stream.id} \n      trackId=${this.trackId}\n      layer update from sfu\n      currLayer=${e.current_layer}\n      preferredLayer=${e.expected_layer}\n      sub_degraded=${e.subscriber_degraded}\n      pub_degraded=${e.publisher_degraded}\n      isDegraded=${this._degraded}`),this.stream.setVideoLayerLocally(t,this.logIdentifier,"setLayerFromServer"),this.pushInHistory(`sfuLayerUpdate-${t}`),this._degraded}getDegradationValue(e){return this.enabled&&(e.publisher_degraded||e.subscriber_degraded)&&"none"===e.current_layer}updateLayer(e){return Zt(this,null,(function*(){let t=this.preferredLayer;this.enabled&&this.hasSinks()?t=this.preferredLayer:this.disableNoneLayerRequest||(t="none"),this.shouldSendVideoLayer(t,e)&&(yield this.requestLayer(t,e))}))}pushInHistory(e){}requestLayer(e,t){return Zt(this,null,(function*(){try{let i=yield this.stream.setVideoLayer(e,this.trackId,this.logIdentifier,t);return bi.d(`[Remote Track] ${this.logIdentifier} \n      streamId=${this.stream.id}\n      trackId=${this.trackId}\n      Requested layer ${e}, source=${t}`),i}catch(Ne){throw bi.d(`[Remote Track] ${this.logIdentifier} \n      streamId=${this.stream.id}\n      trackId=${this.trackId}\n      Failed to set layer ${e}, source=${t}\n      error=${Ne.message}`),Ne}}))}shouldSendVideoLayer(e,t){let i=this.getLayer();return!(!this.degraded||"none"!==e)||(i!==e||(bi.d(`[Remote Track] ${this.logIdentifier}`,`Not sending update, already on layer ${e}, source=${t}`),!1))}},$r=class{constructor(){this.history=[]}push(e){e.time=(new Date).toISOString().split("T")[1],this.history.push(e)}},Vr=class extends Pi{constructor(){super(...arguments),this.TAG="[HMSLocalStream]",this.connection=null}setConnection(e){this.connection=e}addTransceiver(e,t){let i=this.connection.addTransceiver(e.getTrackBeingSent(),{streams:[this.nativeStream],direction:"sendonly",sendEncodings:this.getTrackEncodings(e,t)});return this.setPreferredCodec(i,e.nativeTrack.kind),e.transceiver=i,i}setMaxBitrateAndFramerate(e,t){return Zt(this,null,(function*(){var i;yield null==(i=this.connection)?void 0:i.setMaxBitrateAndFramerate(e,t)}))}setPreferredCodec(e,t){}replaceStreamTrack(e,t){this.nativeStream.addTrack(t),this.nativeStream.removeTrack(e)}removeSender(e){var t,i;if(!this.connection||"closed"===this.connection.connectionState)return void bi.d(this.TAG,"publish connection is not initialised or closed");let n=null==(t=e.transceiver)?void 0:t.sender;if(!n)return void bi.w(this.TAG,`No sender found for trackId=${e.trackId}`);null==(i=this.connection)||i.removeTrack(n);let r=this.tracks.indexOf(e);-1!==r?this.tracks.splice(r,1):bi.w(this.TAG,`Cannot find ${e.trackId} in locally stored tracks`)}getTrackEncodings(e,t){let i=[];if(e instanceof Cr)if(t.length>0)bi.d(this.TAG,"Simulcast enabled with layers",t),i.push(...t);else{let t={active:this.nativeStream.active};e.settings.maxBitrate&&!Ai&&(t.maxBitrate=e.settings.maxBitrate),i.push(t)}return i}},Wr=class extends Pi{constructor(e,t){super(e),this.audio=!0,this.video="none",this.connection=t}setAudio(e,t,i){return Zt(this,null,(function*(){this.audio!==e&&(this.audio=e,bi.d(`[Remote stream] ${i||""} \n    streamId=${this.id}\n    trackId=${t}\n    subscribing audio - ${this.audio}`),yield this.connection.sendOverApiDataChannelWithResponse({params:{subscribed:this.audio,track_id:t},method:"prefer-audio-track-state"}))}))}setVideoLayerLocally(e,t,i){this.video=e,bi.d(`[Remote stream] ${t}\n    streamId=${this.id}\n    source: ${i}\n    Setting layer field to=${e}`)}setVideoLayer(e,t,i,n){return bi.d(`[Remote stream] ${i} \n      streamId=${this.id}\n      trackId=${t} \n      source: ${n} request ${e} layer`),this.setVideoLayerLocally(e,i,n),this.connection.sendOverApiDataChannelWithResponse({params:{max_spatial_layer:this.video,track_id:t},method:"prefer-video-track-state"})}getSimulcastLayer(){return this.video}getVideoLayer(){return this.video}isAudioSubscribed(){return this.audio}},Hr=(e,t,i,n)=>Zt(void 0,null,(function*(){var r;let s,o={};if(null!=(r=t.transceiver)&&r.sender.track){try{s=yield t.transceiver.sender.getStats();let e={},r={},a={};null==s||s.forEach((t=>{switch(t.type){case"outbound-rtp":r[t.id]=t;break;case"remote-inbound-rtp":a[t.ssrc]=t;break;case"codec":e[t.id]=t.mimeType;break;default:break}})),Object.keys(zt({},r)).forEach((s=>{var l,c;let u,d=null==(l=r[s])?void 0:l.codecId,h=d?e[d]:void 0;h&&(u=h.substring(h.indexOf("/")+1));let p=Kt(zt({},r[s]),{rid:null==(c=r[s])?void 0:c.rid}),f=a[p.ssrc];o[s]=Kt(zt({},p),{bitrate:Zr("bytesSent",p,null==n?void 0:n[s]),packetsLost:null==f?void 0:f.packetsLost,jitter:null==f?void 0:f.jitter,roundTripTime:null==f?void 0:f.roundTripTime,totalRoundTripTime:null==f?void 0:f.totalRoundTripTime,peerName:i,peerID:t.peerId,enabled:t.enabled,codec:u})}))}catch(xe){e.analytics.publish(on.rtcStatsFailed(Wi.WebrtcErrors.StatsFailed("TRACK",`Error getting local track stats ${t.trackId} - ${xe.message}`))),bi.w("[HMSWebrtcStats]","Error in getting local track stats",t,xe,xe.name)}return o}})),qr=(e,t,i,n)=>Zt(void 0,null,(function*(){var r;let s;try{s=yield null==(r=t.transceiver)?void 0:r.receiver.getStats()}catch(Be){e.analytics.publish(on.rtcStatsFailed(Wi.WebrtcErrors.StatsFailed("TRACK",`Error getting remote track stats ${t.trackId} - ${Be.message}`))),bi.w("[HMSWebrtcStats]","Error in getting remote track stats",t,Be)}let o=zr(s),a=Zr("bytesReceived",o,n),l=Xr("packetsLost",o,n);return null!=o&&o.remote&&Object.assign(o.remote,{packetsLostRate:Xr("packetsLost",o.remote,null==n?void 0:n.remote)}),o&&Kt(zt({},o),{bitrate:a,packetsLostRate:l,peerID:t.peerId,enabled:t.enabled,peerName:i,codec:o.codec})})),zr=e=>{let t,i,n={};null==e||e.forEach((e=>{switch(e.type){case"inbound-rtp":t=e;break;case"outbound-rtp":t=e;break;case"remote-inbound-rtp":i=e;break;case"codec":n[e.id]=e.mimeType;break;default:break}}));let r,s=null!=t&&t.codecId?n[t.codecId]:void 0;return s&&(r=s.substring(s.indexOf("/")+1)),t&&Object.assign(t,{remote:i,codec:r})},Kr=(e,t,i)=>{let n=Jr(t),r=Zr("publish"===e?"bytesSent":"bytesReceived",n,i&&i[e]);return n&&Object.assign(n,{bitrate:r})},Jr=e=>{let t;return null==e||e.forEach((i=>{"transport"===i.type&&(t=null==e?void 0:e.get(i.selectedCandidatePairId))})),t||null==e||e.forEach((e=>{"candidate-pair"===e.type&&e.selected&&(t=e)})),t},Qr=e=>{let t={packetsLost:0,jitter:0};return null==e||e.forEach((e=>{e.packetsLost&&(t.packetsLost+=e.packetsLost),e.jitter>t.jitter&&(t.jitter=e.jitter)})),t},Yr=(e,t)=>Array.from(new Set(e.concat(t))),Zr=(e,t,i)=>8*Xr(e,t,i),Xr=(e,t,i)=>{let n=t&&t[e],r=i?i[e]:null;return[t,i,Qi(n),Qi(r)].every((e=>!!e))?1e3*es(n,r,null==t?void 0:t.timestamp,null==i?void 0:i.timestamp):0},es=(e,t,i,n)=>Qi(e)&&Qi(t)&&i&&n?(e-t)/(i-n):0,ts=class{constructor(e,t,i,n){var r;this.store=e,this.eventBus=t,this.publishConnection=i,this.subscribeConnection=n,this.TAG="[HMSWebrtcStats]",this.peerStats={},this.remoteTrackStats={},this.localTrackStats={},this.getLocalPeerStats=()=>this.peerStats[this.localPeerID],this.getRemoteTrackStats=e=>this.remoteTrackStats[e],this.getAllRemoteTracksStats=()=>this.remoteTrackStats,this.getLocalTrackStats=()=>this.localTrackStats,this.updateStats=()=>Zt(this,null,(function*(){yield this.updateLocalPeerStats(),yield this.updateLocalTrackStats(),yield this.updateRemoteTrackStats()})),this.updateLocalPeerStats=()=>Zt(this,null,(function*(){var e,t,i,n;let r,s=this.getLocalPeerStats();try{r=yield null==(e=this.publishConnection)?void 0:e.getStats()}catch($e){this.eventBus.analytics.publish(on.rtcStatsFailed(Wi.WebrtcErrors.StatsFailed("PUBLISH",$e.message))),bi.w(this.TAG,"Error in getting publish stats",$e)}let o,a=r&&Kr("publish",r,s);try{o=yield null==(t=this.subscribeConnection)?void 0:t.getStats()}catch($e){this.eventBus.analytics.publish(on.rtcStatsFailed(Wi.WebrtcErrors.StatsFailed("SUBSCRIBE",$e.message))),bi.w(this.TAG,"Error in getting subscribe stats",$e)}let l=o&&Kr("subscribe",o,s),{packetsLost:c,jitter:u}=Qr(o),d=es(c,null==(i=null==s?void 0:s.subscribe)?void 0:i.packetsLost,null==l?void 0:l.timestamp,null==(n=null==s?void 0:s.subscribe)?void 0:n.timestamp),h=l&&Object.assign(l,{packetsLostRate:d,jitter:u,packetsLost:c});this.peerStats[this.localPeerID]={publish:a,subscribe:h}})),this.updateRemoteTrackStats=()=>Zt(this,null,(function*(){var e;let t=Array.from(this.store.getTracksMap().values()).filter((e=>e instanceof Gr||e instanceof ir)),i=t.map((e=>e.trackId));Object.keys(this.remoteTrackStats).forEach((e=>{i.includes(e)||delete this.remoteTrackStats[e]}));for(let n of t){let t=n.peerId&&(null==(e=this.store.getPeerById(n.peerId))?void 0:e.name),i=this.getRemoteTrackStats(n.trackId),r=yield qr(this.eventBus,n,t,i);r&&(this.remoteTrackStats[n.trackId]=r)}})),this.updateLocalTrackStats=()=>Zt(this,null,(function*(){var e;let t=this.store.getLocalPeerTracks().reduce(((e,t)=>(e[t.getTrackIDBeingSent()]=t,e)),{}),i=Yr(Object.keys(this.localTrackStats),Object.keys(t));for(let n of i){let i=t[n];if(i){let t=null==(e=this.store.getLocalPeer())?void 0:e.name,r=yield Hr(this.eventBus,i,t,this.localTrackStats[n]);r&&(this.localTrackStats[n]=r)}else delete this.localTrackStats[n]}})),this.localPeerID=null==(r=this.store.getLocalPeer())?void 0:r.peerId}setPeerConnections({publish:e,subscribe:t}){this.publishConnection=e,this.subscribeConnection=t}getPublishPeerConnection(){return this.publishConnection}getSubscribePeerConnection(){return this.subscribeConnection}},is=class{constructor(e,t){this.store=e,this.eventBus=t,this.TAG="[HMSWebrtcInternals]",this.interval=1e3,this.isMonitored=!1,this.handleStatsUpdate=()=>Zt(this,null,(function*(){var e;yield null==(e=this.hmsStats)?void 0:e.updateStats(),this.hmsStats&&this.eventBus.statsUpdate.publish(this.hmsStats)}))}getCurrentStats(){return this.hmsStats}getPublishPeerConnection(){var e;return null==(e=this.hmsStats)?void 0:e.getPublishPeerConnection()}getSubscribePeerConnection(){var e;return null==(e=this.hmsStats)?void 0:e.getSubscribePeerConnection()}onStatsChange(e){return this.eventBus.statsUpdate.subscribe(e),()=>{this.eventBus.statsUpdate.unsubscribe(e)}}setPeerConnections({publish:e,subscribe:t}){this.hmsStats?this.hmsStats.setPeerConnections({publish:e,subscribe:t}):this.hmsStats=new ts(this.store,this.eventBus,e,t)}start(){return Zt(this,null,(function*(){this.isMonitored?bi.d(this.TAG,"Already started"):(this.stop(),this.isMonitored=!0,bi.d(this.TAG,"Starting Webrtc Stats Monitor"),this.startLoop().then((()=>bi.d(this.TAG,"Stopping Webrtc Stats Monitor"))).catch((e=>{this.eventBus.analytics.publish(on.rtcStatsFailed(Wi.WebrtcErrors.StatsFailed("PUBLISH",e.message))),bi.e(this.TAG,e.message)})))}))}stop(){this.isMonitored=!1}startLoop(){return Zt(this,null,(function*(){for(;this.isMonitored;)yield this.handleStatsUpdate(),yield Hn(this.interval)}))}cleanup(){this.stop(),this.eventBus.statsUpdate.removeAllListeners()}},ns=class{constructor({peerId:e,name:t,isLocal:i,customerUserId:n,metadata:r,role:s,joinedAt:o,groups:a,realtime:l,type:c}){this.customerUserId="",this.metadata="",this.auxiliaryTracks=[],this.name=t,this.peerId=e,this.isLocal=i,this.customerUserId=n,this.metadata=r,this.joinedAt=o,this.groups=a,this.realtime=l,this.type=c,s&&(this.role=s)}get isHandRaised(){var e;return!(null==(e=this.groups)||!e.includes(Nr))}updateRole(e){this.role=e}updateName(e){this.name=e}updateNetworkQuality(e){this.networkQuality=e}updateMetadata(e){this.metadata=e}updateGroups(e){this.groups=e}toString(){var e,t,i,n;return`{\n      name: ${this.name};\n      role: ${null==(e=this.role)?void 0:e.name};\n      peerId: ${this.peerId};\n      customerUserId: ${this.customerUserId};\n      ${this.audioTrack?`audioTrack: ${null==(t=this.audioTrack)?void 0:t.trackId};`:""}\n      ${this.videoTrack?`videoTrack: ${null==(i=this.videoTrack)?void 0:i.trackId};`:""}\n      groups: ${null==(n=this.groups)?void 0:n.join()}\n    }`}},rs=class{};rs.makePeerId=()=>P();var ss=class extends ns{constructor(e){super(Kt(zt({},e),{peerId:rs.makePeerId(),isLocal:!0})),this.isLocal=!0,this.auxiliaryTracks=[],this.asRole=e.asRole}isInPreview(){return!!this.asRole}toString(){var e,t,i;return`{\n      name: ${this.name};\n      role: ${null==(e=this.role)?void 0:e.name};\n      peerId: ${this.peerId};\n      customerUserId: ${this.customerUserId};\n      ${this.asRole?`asRole: ${this.asRole.name};`:""}\n      ${this.audioTrack?`audioTrack: ${null==(t=this.audioTrack)?void 0:t.trackId};`:""}\n      ${this.videoTrack?`videoTrack: ${null==(i=this.videoTrack)?void 0:i.trackId};`:""}\n    }`}},os=class extends ns{constructor(e){super(Kt(zt({},e),{isLocal:!1})),this.isLocal=!1,this.auxiliaryTracks=[],this.fromRoomState=!1,this.fromRoomState=!!e.fromRoomState}},as=(e,t)=>new os({peerId:e.peer_id,name:e.info.name,role:t.getPolicyForRole(e.role),customerUserId:e.info.user_id,metadata:e.info.data,groups:e.groups,type:e.info.type}),ls=class{constructor(e,t,i){this.transport=e,this.store=t,this.options=i,this.isEnd=!1,this.iterator=null,this.total=0,this.defaultPaginationLimit=10}validateConnection(){if(!this.transport||!this.store)throw Error("Use usePaginatedParticipants or hmsActions.getPeerListIterator after preview or join has happened")}hasNext(){return!this.isEnd}getTotal(){return this.total}findPeers(){return Zt(this,null,(function*(){var e;this.validateConnection();let t=yield this.transport.signal.findPeers(Kt(zt({},this.options||{}),{limit:(null==(e=this.options)?void 0:e.limit)||this.defaultPaginationLimit}));return this.updateState(t),this.processPeers(t.peers)}))}next(){return Zt(this,null,(function*(){var e;let t;return this.validateConnection(),this.iterator||this.isEnd?this.iterator?(t=yield this.transport.signal.peerIterNext({iterator:this.iterator,limit:(null==(e=this.options)?void 0:e.limit)||this.defaultPaginationLimit}),this.updateState(t),this.processPeers(t.peers)):[]:yield this.findPeers()}))}processPeers(e){let t=[];return e.forEach((e=>{let i=as(e,this.store);t.push(i)})),t}updateState(e){this.isEnd=e.eof,this.total=e.total,e.iterator&&(this.iterator=e.iterator)}},cs=class{constructor(e){this.TAG="[AudioContextManager]",this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(e),this.source.connect(this.audioContext.destination)}resumeContext(){return Zt(this,null,(function*(){"suspended"===this.audioContext.state&&(yield this.audioContext.resume(),bi.d(this.TAG,"AudioContext is resumed"))}))}getAudioTrack(){return this.destinationNode&&this.source.disconnect(this.destinationNode),this.destinationNode=this.audioContext.createMediaStreamDestination(),this.source.connect(this.destinationNode),this.destinationNode.stream.getAudioTracks()[0]}cleanup(){"closed"!==this.audioContext.state&&this.audioContext.close().catch((e=>{bi.d(this.TAG,"AudioContext close error",e.message)}))}},us=class extends Oe.EventEmitter2{on(e,t){return super.on(e,t)}off(e,t){return super.off(e,t)}emit(e,t){return super.emit(e,t)}listeners(e){return super.listeners(e)}},ds=class extends us{constructor(){super(...arguments),this.audioElement=null,this.TAG="[PlaylistAudioManager]",this.seeked=!1}play(e){return Zt(this,null,(function*(){return this.audioElement=this.getAudioElement(),new Promise(((t,i)=>{this.audioElement=this.getAudioElement(),this.audioElement.src=e,this.seeked=!1,this.audioElement.onerror=()=>{let t=`Error loading ${e}`;bi.e(this.TAG,t),this.stop(),i(t)},this.audioElement.oncanplaythrough=()=>Zt(this,null,(function*(){try{if(!this.audioElement)return;if(this.audioContextManager.resumeContext(),this.track)this.seeked?this.seeked=!1:(yield this.audioElement.play(),t([this.track]));else{yield this.audioElement.play();let e=this.audioContextManager.getAudioTrack();this.track=e,t([e])}}catch(We){bi.e(this.TAG,"Error playing audio",e,We.message),i(We)}})),this.audioElement.onseeked=()=>{this.seeked=!0}}))}))}getTracks(){return this.track?[this.track.id]:[]}getElement(){return this.audioElement||(this.audioElement=this.getAudioElement()),this.audioElement}stop(){var e,t,i;null==(e=this.audioElement)||e.pause(),null==(t=this.audioElement)||t.removeAttribute("src"),this.audioElement=null,null==(i=this.audioContextManager)||i.cleanup(),this.track=void 0}getAudioElement(){if(this.audioElement)return this.audioElement;let e=document.createElement("audio");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",(e=>this.emit("progress",e))),e.addEventListener("ended",(()=>{this.emit("ended",null)})),this.audioContextManager=new cs(e),e}},hs=class extends us{constructor(){super(...arguments),this.TAG="[PlaylistVideoManager]",this.videoElement=null,this.canvasContext=null,this.tracks=[],this.DEFAUL_FPS=24,this.seeked=!1,this.drawImage=()=>{var e,t,i;this.videoElement&&!this.videoElement.paused&&!this.videoElement.ended&&(null==(i=this.canvasContext)||i.drawImage(this.videoElement,0,0,null==(e=this.canvas)?void 0:e.width,null==(t=this.canvas)?void 0:t.height),this.timer=setTimeout((()=>{this.drawImage()}),1e3/this.DEFAUL_FPS))}}play(e){return this.videoElement=this.getVideoElement(),this.createCanvas(),new Promise(((t,i)=>{this.videoElement=this.getVideoElement(),this.videoElement.src=e,this.seeked=!1,this.videoElement.onerror=()=>{let t=`Error loading ${e}`;bi.e(this.TAG,t),this.stop(),i(t)},this.videoElement.oncanplaythrough=()=>Zt(this,null,(function*(){var n,r,s;try{if(!this.videoElement)return;if(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight,0===this.tracks.length){this.clearCanvasAndTracks();let e=this.canvas.captureStream();if(!e)return void bi.e(this.TAG,"Browser does not support captureStream");this.videoElement.onplay=this.drawImage,yield this.audioContextManager.resumeContext(),yield this.videoElement.play();let i=this.audioContextManager.getAudioTrack();e.addTrack(i),e.getTracks().forEach((e=>{this.tracks.push(e)})),t(this.tracks)}else this.seeked?(this.seeked=!1,null==(s=this.canvasContext)||s.drawImage(this.videoElement,0,0,null==(n=this.canvas)?void 0:n.width,null==(r=this.canvas)?void 0:r.height)):(yield this.videoElement.play(),t(this.tracks))}catch(Ke){bi.e(this.TAG,"Error playing video",e,Ke.message),i(Ke)}})),this.videoElement.onseeked=()=>{this.seeked=!0}}))}getTracks(){return this.tracks.map((e=>e.id))}getElement(){return this.videoElement||(this.videoElement=this.getVideoElement()),this.videoElement}stop(){var e,t,i;null==(e=this.videoElement)||e.pause(),null==(t=this.videoElement)||t.removeAttribute("src"),this.videoElement=null,null==(i=this.audioContextManager)||i.cleanup(),this.clearCanvasAndTracks()}clearCanvasAndTracks(){var e;this.tracks=[],null==(e=this.canvasContext)||e.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(this.timer)}getVideoElement(){if(this.videoElement)return this.videoElement;let e=document.createElement("video");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",(e=>this.emit("progress",e))),e.addEventListener("ended",(()=>{this.emit("ended",null)})),this.audioContextManager=new cs(e),e}createCanvas(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"))}},ps={audio:{list:[],currentIndex:-1,isAutoplayOn:!0},video:{list:[],currentIndex:-1,isAutoplayOn:!0}},fs=class extends us{constructor(e,t){super(),this.sdk=e,this.eventBus=t,this.state={audio:zt({},ps.audio),video:zt({},ps.video)},this.TAG="[PlaylistManager]",this.handlePausePlaylist=e=>Zt(this,[e],(function*({enabled:e,track:t}){var i;if(e)return;let n;"audioplaylist"===t.source&&(n="audio"),"videoplaylist"===t.source&&(n="video"),n&&(null==(i=this.getElement(n))||i.pause())})),this.addTrack=(e,t)=>Zt(this,null,(function*(){yield this.sdk.addTrack(e,t),bi.d(this.TAG,"Playlist track added",an(e))})),this.removeTrack=e=>Zt(this,null,(function*(){yield this.sdk.removeTrack(e,!0),bi.d(this.TAG,"Playlist track removed",e)})),this.audioManager=new ds,this.videoManager=new hs,this.addListeners()}getList(e="audio"){return this.state[e].list}setList(e){e&&0!==e.length?e.forEach((e=>{this.state[e.type].list.find((t=>t.id===e.id))||this.state[e.type].list.push(e)})):bi.w(this.TAG,"Please pass in a list of HMSPlaylistItem's")}clearList(e){return Zt(this,null,(function*(){this.isPlaying(e)&&(yield this.stop(e)),this.state[e].list=[]}))}removeItem(e,t){return Zt(this,null,(function*(){let{list:i,currentIndex:n}=this.state[t],r=i.findIndex((t=>e===t.id));return r>-1&&(n===r&&this.isPlaying(t)&&(yield this.stop(t)),i.splice(r,1),!0)}))}seek(e,t="audio"){let{currentIndex:i}=this.state[t];if(-1===i)throw Wi.PlaylistErrors.NoEntryToPlay("PLAYLIST","No item is currently playing");let n=this.getElement(t);if(n){let t=Math.max(n.currentTime+e,0);n.currentTime=Math.min(t,n.duration)}}seekTo(e,t="audio"){let{currentIndex:i}=this.state[t];if(-1===i)throw Wi.PlaylistErrors.NoEntryToPlay("PLAYLIST","No item is currently playing");if(e<0)throw Error("value cannot be negative");let n=this.getElement(t);n&&(n.currentTime=Math.min(e,n.duration))}setVolume(e,t="audio"){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");let i=this.getElement(t);i&&(i.volume=.01*e)}getVolume(e="audio"){let t=this.getElement(e);return t?Math.floor(100*t.volume):0}getCurrentTime(e="audio"){let t=this.getElement(e);return(null==t?void 0:t.currentTime)||0}getCurrentIndex(e="audio"){return this.state[e].currentIndex}getCurrentProgress(e="audio"){var t;let{list:i,currentIndex:n}=this.state[e],r=null==(t=i[n])?void 0:t.url,s=this.getElement(e);return r&&s?Math.floor(s.currentTime/s.duration*100):0}getCurrentSelection(e="audio"){let{list:t,currentIndex:i}=this.state[e];if(-1!==i)return t[i]}isPlaying(e="audio"){let t=this.getElement(e);return!!t&&!t.paused}setIsAutoplayOn(e="audio",t){this.state[e].isAutoplayOn=t}getPlaybackRate(e="audio"){let t=this.getElement(e);return t?t.playbackRate:1}setPlaybackRate(e="audio",t){if(t<.25||t>2)throw Error("Please pass a value between 0.25 and 2.0");let i=this.getElement(e);i&&(i.playbackRate=t)}setEnabled(e,t){return Zt(this,arguments,(function*(e,{id:t,type:i="audio"}){let n=this.state[i].list.findIndex((e=>e.id===t));if(!t||-1===n)return void bi.w(this.TAG,"Pass a valid id");let r=this.state[i].list[n].url;e?yield this.play(r,i):yield this.pause(r,i),this.state[i].currentIndex=n,this.setDuration(i)}))}playNext(){return Zt(this,arguments,(function*(e="audio"){let{list:t,currentIndex:i}=this.state[e];if(i>=t.length-1)throw Wi.PlaylistErrors.NoEntryToPlay("PLAYLIST","Reached end of playlist");yield this.play(t[i+1].url,e),this.state[e].currentIndex=i+1,this.setDuration(e)}))}playPrevious(){return Zt(this,arguments,(function*(e="audio"){let{list:t,currentIndex:i}=this.state[e];if(i<=0)throw Wi.PlaylistErrors.NoEntryToPlay("PLAYLIST","Reached start of playlist");yield this.play(t[i-1].url,e),this.state[e].currentIndex=i-1,this.setDuration(e)}))}stop(){return Zt(this,arguments,(function*(e="audio"){var t;let i="audio"===e?this.audioManager:this.videoManager;null==(t=i.getElement())||t.pause(),yield this.removeTracks(e),i.stop(),this.state[e].currentIndex=-1}))}cleanup(){this.state={audio:zt({},ps.audio),video:zt({},ps.video)},this.eventBus.localAudioEnabled.unsubscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.unsubscribe(this.handlePausePlaylist),this.audioManager.stop(),this.videoManager.stop()}onProgress(e){this.videoManager.on("progress",(()=>{try{e({type:"video",progress:this.getCurrentProgress("video")})}catch(T){bi.e(this.TAG,"Error in onProgress callback")}})),this.audioManager.on("progress",(()=>{try{e({type:"audio",progress:this.getCurrentProgress("audio")})}catch(T){bi.e(this.TAG,"Error in onProgress callback")}}))}onNewTrackStart(e){this.on("newTrackStart",e)}onPlaylistEnded(e){this.on("playlistEnded",e)}onCurrentTrackEnded(e){this.on("currentTrackEnded",e)}getElement(e="audio"){return"audio"===e?this.audioManager.getElement():this.videoManager.getElement()}removeTracks(){return Zt(this,arguments,(function*(e="audio"){let t=("audio"===e?this.audioManager:this.videoManager).getTracks();for(let i of t)yield this.removeTrack(i)}))}play(e){return Zt(this,arguments,(function*(e,t="audio"){let i="audio"===t?this.audioManager:this.videoManager,n=i.getElement();if(this.isItemCurrentlyPlaying(e,t))bi.w(this.TAG,`The ${t} is currently playing`);else if(null!=n&&n.src.includes(e))yield n.play();else{null==n||n.pause();let r=yield i.play(e);for(let e of r)yield this.addTrack(e,"audio"===t?"audioplaylist":"videoplaylist")}}))}isItemCurrentlyPlaying(e,t){let i=this.getElement(t);return!(!i||i.paused||!i.src.includes(e))}setDuration(e="audio"){let t=this.getElement(e),{list:i,currentIndex:n}=this.state[e];i[n]&&(i[n].duration=(null==t?void 0:t.duration)||0),this.emit("newTrackStart",i[n])}pause(e){return Zt(this,arguments,(function*(e,t="audio"){let i=this.getElement(t);i&&!i.paused&&i.src.includes(e)?(i.pause(),bi.d(this.TAG,"paused url",e)):bi.w(this.TAG,"The passed in url is not currently playing")}))}addListeners(){this.audioManager.on("ended",(()=>this.handleEnded("audio"))),this.videoManager.on("ended",(()=>this.handleEnded("video"))),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.subscribe(this.handlePausePlaylist)}handleEnded(){return Zt(this,arguments,(function*(e="audio"){let{list:t,currentIndex:i,isAutoplayOn:n}=this.state[e];i===t.length-1?(yield this.stop(e),this.emit("playlistEnded",e)):n?this.playNext(e):yield this.pause(t[i].url,e),this.emit("currentTrackEnded",t[i])}))}},vs=e=>e.room,gs=e=>e.errors,ms=(h(gs,(e=>0===e.length?null:e.at(-1))),h(vs,(e=>e.id)),e=>e.peers),ys=e=>e.messages.byID,bs=e=>e.messages.allIDs,ks=e=>e.tracks,Ts=e=>e.settings,Ss=e=>e.appData,ws=e=>e.devices,Es=e=>e.speakers,Ps=h([vs],(e=>e&&e.isConnected)),Cs=(h([Ps,vs],((e,t)=>e?void 0!==t.peerCount?t.peerCount||1:t.peers.length:Math.max(void 0!==t.peerCount?t.peerCount:t.peers.length-1,0))),e=>e.hideLocalPeer),_s=h([vs,ms,Cs],((e,t,i)=>i?e.peers.filter((t=>e.localPeer!==t)).map((e=>t[e])):e.peers.map((e=>t[e])))),As=h(ks,(e=>Object.values(e))),Is=h(vs,ms,((e,t)=>t[e.localPeer])),Rs=h(vs,(e=>e.localPeer)),Ls=(h(Is,(e=>null==e?void 0:e.name)),h(Is,(e=>null==e?void 0:e.roleName)),h(Is,(e=>null==e?void 0:e.audioTrack))),Ds=h(Is,(e=>null==e?void 0:e.videoTrack)),Os=h(Is,(e=>null==e?void 0:e.auxiliaryTracks)),Ms=h([Ls,Ds,Os],((e,t,i)=>{let n=i?[...i]:[];return e&&n.unshift(e),t&&n.unshift(t),n})),xs=(h(_s,(e=>e.filter((e=>!e.isLocal)))),h(ms,Es,((e,t)=>{let i=Object.entries(t).sort(((e,t)=>{var i,n;let r=(null==(i=e[1])?void 0:i.audioLevel)||0;return((null==(n=t[1])?void 0:n.audioLevel)||0)>r?1:-1}));if(i.length>0&&i[0][1].audioLevel&&i[0][1].audioLevel>0){let t=i[0][1].peerID;if(t in e)return e[t]}return null})),e=>{let t=Is(e);return fi(e,null==t?void 0:t.audioTrack)}),Ns=e=>{let t=Is(e);return fi(e,null==t?void 0:t.videoTrack)},Us=e=>{let t=Is(e);return vi(e,null==t?void 0:t.videoTrack)},Fs=h(Is,ks,((e,t)=>{let{video:i,audio:n}=ai(t,e);return!(!i&&!n)})),js=h(ms,ks,((e,t)=>{let i;for(let n in e){let r=e[n],{video:s,audio:o}=ai(t,r);if(s)return r;o&&!i&&(i=r)}return i})),Bs=h(js,(e=>!!e)),Gs=(h(ms,ks,((e,t)=>{for(let i in e){let n=e[i],{audio:r,video:s}=ai(t,n);if(!s&&r)return n}})),h(ms,ks,((e,t)=>{let i=[],n=[];for(let r in e){let s=e[r],{video:o,audio:a}=ai(t,s);o?i.push(s):a&&n.push(s)}return i.concat(n)}))),$s=(h(ms,ks,((e,t)=>{for(let i in t){let n=t[i];if(hi(n)&&ci(n)&&n.peerId)return e[n.peerId]}})),h(ms,ks,((e,t)=>{for(let i in t){let n=t[i];if(di(n)&&n.peerId)return e[n.peerId]}})),h(As,(e=>e.filter(pi))),h(bs,(e=>e.length)),h(ys,(e=>Object.values(e).filter((e=>!e.read)).length)),h(bs,ys,((e,t)=>{let i=[];return e.forEach((e=>{i.push(t[e])})),i}))),Vs=h($s,(e=>e.filter((e=>{var t;return!e.recipientPeer&&!(e.recipientRoles&&(null==(t=e.recipientRoles)?void 0:t.length)>0)})))),Ws=(h(Vs,(e=>e.filter((e=>!e.read)).length)),h([vs],(e=>e&&e.roomState))),Hs=h(Ws,(e=>"Preview"===e)),qs=(h(vs,(e=>"Disconnected"!==e.roomState)),h(vs,(e=>!(!e.transcriptions||e.transcriptions.length<=0)&&e.transcriptions.some((e=>"caption"===e.mode&&"started"===e.state)))),e=>e.roles),zs=h([qs],(e=>Object.keys(e))),Ks=h([Is,qs],((e,t)=>null!=e&&e.roleName?t[e.roleName]:null)),Js=e=>{var t;return null==(t=e.preview)?void 0:t.asRole},Qs=h([Js,qs],((e,t)=>e?t[e]:null)),Ys=(h([Ks],(e=>{var t;return!(null==(t=null==e?void 0:e.subscribeParams)||!t.subscribeToRoles)&&e.subscribeParams.subscribeToRoles.length>0})),h(Ks,(e=>null==e?void 0:e.permissions))),Zs=(h(vs,(e=>e.recording)),h(vs,(e=>e.rtmp)),h(vs,(e=>e.hls))),Xs=(h(vs,(e=>e.transcriptions)),h(vs,(e=>e.sessionId)),h(vs,(e=>e.startedAt)),h(vs,(e=>!!e.isLargeRoom)),h(vs,(e=>!!e.isEffectsEnabled)),h(vs,(e=>!!e.isVBEnabled)),h(vs,(e=>e.effectsKey)),e=>e.polls),eo=e=>Object.values(e.polls),to=h(_s,(e=>e.filter((e=>e.isHandRaised)))),io=e=>e.whiteboards,no=h(io,(e=>Object.values(e)[0])),ro=(e="audio")=>t=>t.playlist[e].list,so=(e="audio")=>t=>t.playlist[e].selection,oo=(e="audio")=>t=>t.playlist[e].progress,ao=(e="audio")=>t=>t.playlist[e].currentTime,lo=(e="audio")=>t=>t.playlist[e].playbackRate,co=(e="audio")=>t=>t.playlist[e].volume,uo=(e="audio")=>h(ro(e),(e=>Object.values(e))),ho=(e="audio")=>h(ro(e),so(e),((e,t)=>{if(t.id)return e[t.id]})),po={selection:so("audio"),progress:oo("audio"),currentTime:ao("audio"),playbackRate:lo("audio"),volume:co("audio"),list:uo("audio"),selectedItem:ho("audio")},fo={selection:so("video"),progress:oo("video"),currentTime:ao("video"),playbackRate:lo("video"),volume:co("video"),list:uo("video"),selectedItem:ho("video")};function vo(e){return t=>i=>e(i,t)}var go="HMS-Store:",mo=class{static v(e,...t){this.log(0,e,...t)}static d(...e){this.log(1,...e)}static i(...e){this.log(2,...e)}static w(...e){this.log(3,...e)}static e(...e){this.log(6,...e)}static time(e){this.log(4,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(5,"[HMSPerformanceTiming]",e,e)}static cleanup(){performance.clearMarks(),performance.clearMeasures()}static log(e,...t){if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:console.log(go,...t);break;case 1:console.debug(go,...t);break;case 2:console.info(go,...t);break;case 3:console.warn(go,...t);break;case 6:console.error(go,...t);break;case 4:performance.mark(t[1]);break;case 5:{let e=t[0],i=t[1];try{let t=performance.measure(i,i);this.log(1,e,i,null==t?void 0:t.duration),performance.clearMarks(i),performance.clearMeasures(i)}catch(We){this.log(1,e,i,We)}break}}}};mo.level=0;var yo=(e,t)=>t,bo=(e,t)=>t,ko=(e,t)=>t,To=(e,t)=>t,So=(e,t)=>t,wo=h([ms,yo],((e,t)=>t?e[t]:null)),Eo=h([ks,bo],((e,t)=>t?e[t]:null)),Po=h([ks,bo],((e,t)=>{if(!t)return null;let i=e[t];return"video"===(null==i?void 0:i.type)?i:null})),Co=h([ks,bo],((e,t)=>{if(!t)return null;let i=e[t];return"audio"===(null==i?void 0:i.type)?i:null})),_o=h([ks,bo],((e,t)=>{if(!t)return null;let i=e[t];return"audio"===(null==i?void 0:i.type)&&"screen"===(null==i?void 0:i.source)?i:null})),Ao=h([ks,bo],((e,t)=>{if(!t)return null;let i=e[t];return"video"===(null==i?void 0:i.type)&&"screen"===(null==i?void 0:i.source)?i:null})),Io=h([Xs,So],((e,t)=>t?e[t]:null)),Ro=vo(wo);vo(h([Ss,To],((e,t)=>{if(e)return t?e[t]:e})));function Lo(e){return t=>{if(t.sessionStore)return e?t.sessionStore[e]:t.sessionStore}}vo(h(wo,(e=>null==e?void 0:e.name))),vo(h(wo,(e=>null==e?void 0:e.type)));var Do=vo(Eo),Oo=vo(Po),Mo=(vo(Co),vo(_o),vo(Ao),vo(((e,t)=>{let i=wo(e,t);if(i&&i.videoTrack&&""!==i.videoTrack)return e.tracks[i.videoTrack]}))),xo=vo(((e,t)=>{let i=wo(e,t);if(i&&i.audioTrack&&""!==i.audioTrack)return e.tracks[i.audioTrack]})),No=Mo,Uo=(vo(((e,t)=>{let i=wo(e,t);return(null==i?void 0:i.auxiliaryTracks.map((t=>e.tracks[t])))||[]})),(e,t)=>t?e.speakers[t]:null),Fo=(vo(h(Uo,(e=>(null==e?void 0:e.audioLevel)||0))),(e,t)=>{let i=xo(t)(e);return Uo(e,null==i?void 0:i.id)}),jo=vo(h(Fo,(e=>(null==e?void 0:e.audioLevel)||0))),Bo=vo(((e,t)=>{if(t)return e.connectionQualities[t]})),Go=(vo(((e,t)=>{let i=wo(e,t);if(i){let t=null==i?void 0:i.auxiliaryTracks.find((t=>li(e.tracks[t])));return t?e.tracks[t]:void 0}})),vo(h(ks,wo,((e,t)=>{let i=null==t?void 0:t.auxiliaryTracks.find((t=>{let i=e[t];return hi(i)&&ci(i)}));return i?e[i]:void 0}))),vo(h(ks,wo,((e,t)=>{let i=null==t?void 0:t.auxiliaryTracks.find((t=>{let i=e[t];return hi(i)&&li(i)}));return i?e[i]:void 0}))),vo(h(ks,wo,((e,t)=>{let i=null==t?void 0:t.auxiliaryTracks.find((t=>{let i=e[t];return di(i)&&li(i)}));return i?e[i]:void 0}))),vo(h(ks,wo,((e,t)=>ai(e,t))))),$o=e=>h(Go(e),(e=>e.video)),Vo=e=>h(Go(e),(e=>e.audio)),Wo=vo(((e,t)=>{let i=wo(e,t);return fi(e,null==i?void 0:i.audioTrack)})),Ho=vo(((e,t)=>{let i=wo(e,t);return fi(e,null==i?void 0:i.videoTrack)})),qo=vo(((e,t)=>{if(t&&e.tracks[t])return 0===e.tracks[t].volume})),zo=(vo(((e,t)=>{let i=wo(e,t);return qo(null==i?void 0:i.audioTrack)(e)})),vo(((e,t)=>{let i=Vo(t)(e);return qo(null==i?void 0:i.id)(e)})),vo(((e,t)=>{let i=Eo(e,t);if(i)return"audio"!==i.type?void mo.w("Please pass audio track here"):i.volume}))),Ko=(vo(((e,t)=>{let i=wo(e,t);return zo(null==i?void 0:i.audioTrack)(e)})),vo(((e,t)=>{let i=Vo(t)(e);return zo(null==i?void 0:i.id)(e)})),vo(((e,t)=>{let i=Eo(e,t);if(i)return"video"!==i.type?void mo.w("Please pass video track here"):i.layer})),h([$s,Rs,yo],((e,t,i)=>{if(i)return e.filter((e=>{var n;return!(!(e.recipientPeer||null!=(n=e.recipientRoles)&&n.length)||e.sender&&![t,i].includes(e.sender))&&[t,i].includes(e.recipientPeer)}))}))),Jo=h([$s,ko],((e,t)=>{if(t)return e.filter((e=>{var i,n;return!(null==(i=e.recipientRoles)||!i.length)&&(null==(n=e.recipientRoles)?void 0:n.includes(t))}))})),Qo=h($s,(e=>e.filter((e=>{var t;return!e.recipientPeer&&!(null!=(t=e.recipientRoles)&&t.length)})))),Yo=h([Jo,ko],(e=>e?e.filter((e=>!e.read)).length:0)),Zo=h([Ko,yo],(e=>e?e.filter((e=>!e.read)).length:0)),Xo=(h(Qo,(e=>e.filter((e=>!e.read)).length)),vo(Ko),vo(Jo),vo(Yo),vo(Zo),e=>h(Ro(e),(e=>{try{return null!=e&&e.metadata&&""!==e.metadata?JSON.parse(e.metadata):{}}catch(Ue){return console.error("cannot parse peer metadata",Ue),{}}}))),ea=vo(Io),ta=(h([ms,ks],((e,t)=>Object.values(e).map((e=>{var i;return{peer:e,isAudioEnabled:!!e.audioTrack&&(null==(i=t[e.audioTrack])?void 0:i.enabled)}})))),e=>e.roleChangeRequests[0]||null),ia=(h([ta,ms,qs],((e,t,i)=>e?{requestedBy:e.requestedBy?t[e.requestedBy]:void 0,role:i[e.roleName],token:e.token}:null)),h([Ks],(e=>gi(e))),h([Qs],(e=>gi(e))),h([Ds,ks],((e,t)=>{let i=null;return e&&(i=t[e]),(null==i?void 0:i.plugins)||[]})),h([Ls,ks],((e,t)=>{let i=null;return e&&(i=t[e]),(null==i?void 0:i.plugins)||[]})),{0:"PEER_JOINED",1:"PEER_LEFT",8:"ROLE_UPDATED",10:"NAME_UPDATED",11:"METADATA_UPDATED",12:"HAND_RAISE_CHANGED"}),na={0:"TRACK_ADDED",1:"TRACK_REMOVED",2:"TRACK_MUTED",3:"TRACK_UNMUTED",5:"TRACK_DEGRADED",6:"TRACK_RESTORED",4:"TRACK_DESCRIPTION_CHANGED"},ra={0:"POLL_CREATED",1:"POLL_STARTED",2:"POLL_STOPPED",4:"POLL_VOTES_UPDATED",3:"POLLS_LIST"},sa={TRANSCRIPTION_STATE_UPDATED:"TRANSCRIPTION_STATE_UPDATED"},oa="hmsNotification",aa=class{constructor(e){this.id=0,this.onNotification=(e,t)=>{let i=i=>{if(t){let e;if(e=Array.isArray(t)?t.includes(i.type):t===i.type,!e)return}e(i)};return this.eventEmitter.addListener(oa,i),()=>{this.eventEmitter.removeListener(oa,i)}},this.store=e,this.eventEmitter=new Oe.EventEmitter2({maxListeners:Object.keys(si).length})}sendPlaylistTrackEnded(e){let t=this.createNotification("PLAYLIST_TRACK_ENDED",e,"info");this.emitEvent(t)}sendDeviceChange(e){var t;let i=this.createNotification("DEVICE_CHANGE_UPDATE",e,e.error?"error":"info",`Selected ${e.type} device - ${null==(t=e.selection)?void 0:t.label}`);this.emitEvent(i)}sendLeaveRoom(e){var t;let i=null==(t=e.requestedBy)?void 0:t.name,n=this.createNotification(e.roomEnded||!i?"ROOM_ENDED":"REMOVED_FROM_ROOM",e,"info",`${e.roomEnded?"Room ended":"Removed from room"} ${i?`by ${i}`:""}`);this.emitEvent(n)}sendPeerList(e){if(0===e.length)return;let t=this.createNotification("PEER_LIST",e,"info");this.emitEvent(t)}sendPeerUpdate(e,t){let i=this.store.getState(Ro(null==t?void 0:t.id))||t,n=ia[e];if(n&&i){let e=this.createNotification(n,i,"info");this.emitEvent(e)}}sendTrackUpdate(e,t){let i=this.store.getState(Do(t)),n=na[e];if(n){let e=this.createNotification(n,i,"info");this.emitEvent(e)}}sendMessageReceived(e){let t=this.createNotification("NEW_MESSAGE",e,"info");this.emitEvent(t)}sendError(e){let t=this.createNotification("ERROR",e,"error");this.emitEvent(t)}sendReconnecting(e){let t=this.createNotification("RECONNECTING",e,"error");this.emitEvent(t)}sendReconnected(){let e=this.createNotification("RECONNECTED",null,"info");this.emitEvent(e)}sendChangeTrackStateRequest(e){let t=this.createNotification("CHANGE_TRACK_STATE_REQUEST",e,"info");this.emitEvent(t)}sendChangeMultiTrackStateRequest(e){let t=this.createNotification("CHANGE_MULTI_TRACK_STATE_REQUEST",e,"info");this.emitEvent(t)}sendPollUpdate(e,t){let i=ra[e],n=this.store.getState(ea(t));if(i){let e=this.createNotification(i,n,"info");this.emitEvent(e)}}sendTranscriptionUpdate(e){let t=this.createNotification(sa.TRANSCRIPTION_STATE_UPDATED,e,"info");this.emitEvent(t)}emitEvent(e){this.eventEmitter.emit(oa,e)}createNotification(e,t,i,n=""){return this.id++,{id:this.id,type:e,message:n,data:t,severity:i}}},la=class{constructor(e){this.queuedUpdates={},this.timers={},this.DEFAULT_INTERVAL_MS=50,this.store=e}setState(e,t,i=this.DEFAULT_INTERVAL_MS){this.queuedUpdates[t]=this.queuedUpdates[t]||[],this.queuedUpdates[t].push(e),!this.timers[t]&&(window?this.timers[t]=window.setTimeout((()=>this.setStateBatched(t)),i):this.setStateBatched(t))}setStateBatched(e){var t;if((null==(t=this.queuedUpdates[e])?void 0:t.length)>0){let t=t=>{this.queuedUpdates[e].forEach((e=>{try{e(t)}catch(je){mo.w("failed to update store",je)}}))};console.time(`timed-${e}`),this.store.namedSetState(t,e),console.timeEnd(`timed-${e}`)}delete this.queuedUpdates[e],window&&this.timers[e]&&(window.clearTimeout(this.timers[e]),delete this.timers[e])}};function ca(e){return e instanceof ir||e instanceof Gr}var ua,da,ha=(e,t)=>{let i=Sa(Object.keys(e),Object.keys(t));for(let n of i){let i=e[n],r=t[n];ya(i,r)?(Ta(i.auxiliaryTracks,r.auxiliaryTracks)&&(r.auxiliaryTracks=i.auxiliaryTracks),i.groups&&Ta(i.groups,r.groups)&&(r.groups=i.groups),Object.assign(i,r)):ba(i,r)?delete e[n]:ka(i,r)&&(e[n]=r)}},pa=(e,t)=>{let i=Sa(Object.keys(e),Object.keys(t));for(let n of i){let i=e[n],r=t[n];ya(i,r)?(ma(i,r),Object.assign(i,r)):ba(i,r)?delete e[n]:ka(i,r)&&(e[n]=r)}},fa=(e,t)=>{let i=Sa(Object.keys(e),Object.keys(t));for(let n of i){let i=e[n],r=t[n];ya(i,r)?(i.questions&&Ta(i.questions,r.questions)&&(r.questions=i.questions),Object.assign(i,r)):ka(i,r)&&(e[n]=r)}},va=(e,t)=>{let i=Sa(Object.keys(e),Object.keys(t));for(let n of i){let i=e[n],r=t[n];ya(i,r)?Object.assign(i,r):ba(i,r)?delete e[n]:ka(i,r)&&(e[n]=r)}},ga=(e,t,i)=>{let n=i.reduce(((e,i)=>(e[i.firstTrackId]=Object.values(t[i.getTrackIDBeingSent()]||{}).sort(((e,t)=>e.rid&&t.rid?e.rid<t.rid?-1:1:0)),e)),{}),r=Sa(Object.keys(e),Object.keys(n));for(let s of r)n[s]?e[s]=n[s]:delete e[s]},ma=(e,t)=>{e.plugins&&Ta(e.plugins,t.plugins)&&(t.plugins=e.plugins),"video"===e.type&&e.layerDefinitions&&Ta(e.layerDefinitions,t.layerDefinitions)&&(t.layerDefinitions=e.layerDefinitions)},ya=(e,t)=>e&&t,ba=(e,t)=>e&&!t,ka=(e,t)=>!e&&t,Ta=(e,t)=>{if(e===t||0===e.length&&0===(null==t?void 0:t.length))return!0;if(!e||!t||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},Sa=(e,t)=>{let i=new Set;for(let n of e)i.add(n);for(let n of t)i.add(n);return Array.from(i)},wa=class e{static convertPeer(e){var t,i,n;return{id:e.peerId,name:e.name,roleName:null==(t=e.role)?void 0:t.name,isLocal:e.isLocal,videoTrack:null==(i=e.videoTrack)?void 0:i.trackId,audioTrack:null==(n=e.audioTrack)?void 0:n.trackId,auxiliaryTracks:e.auxiliaryTracks.map((e=>e.trackId)),customerUserId:e.customerUserId,metadata:e.metadata,joinedAt:e.joinedAt,groups:e.groups,isHandRaised:e.isHandRaised,type:e.type}}static convertTrack(e,t){let i={id:e.trackId,source:e.source,type:e.type,enabled:e.enabled,displayEnabled:e.enabled,peerId:e.peerId||t};return this.enrichTrack(i,e),i}static enrichTrack(t,i){let n=i.getMediaTrackSettings();i instanceof ir&&(t.volume=i.getVolume()||0),e.updateDeviceID(t,i),e.enrichLocalTrack(t,i),"video"===t.type&&("screen"===t.source?(t.displaySurface=n.displaySurface,e.enrichScreenTrack(t,i)):"regular"===t.source&&(t.facingMode=n.facingMode),t.height=n.height,t.width=n.width,e.enrichVideoTrack(t,i)),e.enrichPluginsDetails(t,i)}static enrichLocalTrack(e,t){(t instanceof Cr||t instanceof tr)&&(e.isPublished=t.isPublished)}static updateDeviceID(e,t){var i;e.deviceID=t instanceof Cr||t instanceof tr?t.settings.deviceId:null==(i=t.getMediaTrackSettings())?void 0:i.deviceId}static enrichVideoTrack(e,t){t instanceof Gr&&(e.layer=t.getLayer(),e.preferredLayer=t.getPreferredLayer(),e.degraded=t.degraded),(t instanceof Gr||t instanceof Cr)&&(Ta(t.getSimulcastDefinitions(),e.layerDefinitions)||(e.layerDefinitions=t.getSimulcastDefinitions()))}static enrichScreenTrack(e,t){var i,n;if(t instanceof Cr){let r=null==(i=t.getCaptureHandle)?void 0:i.call(t);(null==r?void 0:r.handle)!==(null==(n=e.captureHandle)?void 0:n.handle)&&(e.captureHandle=r),t.isCurrentTab&&(e.displaySurface="selfBrowser")}}static enrichPluginsDetails(e,t){(t instanceof Cr||t instanceof tr)&&(Ta(t.getPlugins(),e.plugins)||(e.plugins=t.getPlugins()))}static convertRoom(t,i){let{recording:n,rtmp:r,hls:s,transcriptions:o}=e.convertRecordingStreamingState(t.recording,t.rtmp,t.hls,t.transcriptions);return{id:t.id,name:t.name,localPeer:i,recording:n,rtmp:r,hls:s,transcriptions:o,sessionId:t.sessionId,startedAt:t.startedAt,joinedAt:t.joinedAt,peerCount:t.peerCount,isLargeRoom:t.large_room_optimization,isEffectsEnabled:t.isEffectsEnabled,disableNoneLayerRequest:t.disableNoneLayerRequest,isVBEnabled:t.isVBEnabled,effectsKey:t.effectsKey,isHipaaEnabled:t.isHipaaEnabled,isNoiseCancellationEnabled:t.isNoiseCancellationEnabled}}static convertMessage(e,t){var i,n,r,s;return{sender:null==(i=e.peer)?void 0:i.peer_id,senderName:null==(n=e.peer)?void 0:n.info.name,senderRole:null==(r=e.peer)?void 0:r.role,senderUserId:null==(s=e.peer)?void 0:s.info.user_id,recipientPeer:e.private?t:void 0,recipientRoles:e.roles,time:new Date(e.timestamp),type:e.info.type,message:e.info.message,id:e.message_id}}static convertRoles(e){let t={};return e&&e.forEach((e=>{t[e.name]=e})),t}static convertRoleChangeRequest(e){var t;return{requestedBy:null==(t=e.requestedBy)?void 0:t.peerId,roleName:e.role.name,token:e.token}}static convertException(e){let t="trackType"in e,i={code:e.code,action:e.action,name:e.name,message:e.message,description:e.description,isTerminal:e.isTerminal,nativeError:e.nativeError,timestamp:new Date};return t&&(i.trackType=null==e?void 0:e.trackType),i}static convertDeviceChangeUpdate(e){let t={devices:e.devices,selection:e.selection,type:e.type};return e.error&&(t.error=this.convertException(e.error)),t}static convertPlaylist(e){let t=this.getConvertedPlaylistType(e,"audio"),i=this.getConvertedPlaylistType(e,"video");return{audio:t,video:i}}static convertPlaylistItem(e,t){let i=t.type,n=e.getCurrentSelection(i),r=e.isPlaying(i),s=t.url===(null==n?void 0:n.url);return Kt(zt({},t),{type:t.type,selected:s,playing:s&&r})}static getConvertedPlaylistType(t,i){let n={},r=t.getCurrentSelection(i),s=t.getCurrentProgress(i),o=t.getVolume(i),a=t.getList(i),l=t.getCurrentIndex(i);return t.getList(i).forEach((i=>{n[i.id]=e.convertPlaylistItem(t,i)})),{list:n,selection:{id:null==r?void 0:r.id,hasPrevious:l>0,hasNext:l<a.length-1},progress:s,volume:o,currentTime:t.getCurrentTime(i),playbackRate:t.getPlaybackRate(i)}}static convertRecordingStreamingState(e,t,i,n){var r;return{recording:{browser:zt({running:!1},null==e?void 0:e.browser),server:zt({running:!1},null==e?void 0:e.server),hls:zt({running:!1},null==e?void 0:e.hls)},rtmp:zt({running:!1},t),hls:{variants:(null==(r=null==i?void 0:i.variants)?void 0:r.map((e=>e)))||[],running:!(null==i||!i.running),error:null==i?void 0:i.error},transcriptions:n||[]}}},Ea=class{constructor(e,t,i,n){this.playlistManager=e,this.syncPlaylistState=i,this.store=n,this.type=t}play(e){return Zt(this,null,(function*(){e?yield this.playlistManager.setEnabled(!0,{id:e,type:this.type}):mo.w("Please pass id to play")}))}pause(){return Zt(this,null,(function*(){let e="audio"===this.type?po:fo,t=this.store.getState(e.selection);t.id?yield this.playlistManager.setEnabled(!1,{id:t.id,type:this.type}):mo.w("No item is currently playing to pause")}))}playNext(){return Zt(this,null,(function*(){yield this.playlistManager.playNext(this.type)}))}playPrevious(){return Zt(this,null,(function*(){yield this.playlistManager.playPrevious(this.type)}))}seek(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState(`seekOn${this.type}Playlist`)}seekTo(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState(`seekToOn${this.type}Playlist`)}setVolume(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState(`setVolumeOn${this.type}Playlist`)}setList(e){this.playlistManager.setList(e),this.syncPlaylistState(`setListOn${this.type}Playlist`)}stop(){return Zt(this,null,(function*(){yield this.playlistManager.stop(this.type),this.syncPlaylistState(`stop${this.type}Playlist`)}))}setIsAutoplayOn(e){this.playlistManager.setIsAutoplayOn(this.type,e)}setPlaybackRate(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState(`set${this.type}PlaybackRate`)}removeItem(e){return Zt(this,null,(function*(){let t=yield this.playlistManager.removeItem(e,this.type);return t&&this.syncPlaylistState(`remove${this.type}PlaylistItem`),t}))}clearList(){return Zt(this,null,(function*(){yield this.playlistManager.clearList(this.type),this.syncPlaylistState(`clear${this.type}Playlist`)}))}},Pa=class{constructor(e,t){this.sdk=e,this.setLocally=t}get sdkSessionStore(){return this.sdk.getSessionStore()}set(e,t){return Zt(this,null,(function*(){let{value:i}=yield this.sdkSessionStore.set(String(e),t);this.setLocally({key:e,value:i})}))}observe(e){return Zt(this,null,(function*(){let t=Array.isArray(e)?e.map((e=>String(e))):[String(e)];yield this.sdkSessionStore.observe(t)}))}unobserve(e){return Zt(this,null,(function*(){let t=Array.isArray(e)?e.map((e=>String(e))):[String(e)];yield this.sdkSessionStore.unobserve(t)}))}},Ca=class{constructor(e,t){this.intervalMs=100,this.shouldMonitor=!1,this.hasStarted=!1,this.unsubs=[],this.analysers={},this.store=e,this.actions=t}start(){return Zt(this,null,(function*(){if(this.hasStarted)return;this.hasStarted=!0,mo.d("starting audio level monitor for remote peers",this.store);let e=this.store.getState(Ps);mo.d("starting audio levels is connected to room",e),e&&(yield this.monitorAudioLevels());let t=this.store.subscribe(this.monitorAudioLevels.bind(this),Ps);this.unsubs.push(t)}))}stop(){return Zt(this,null,(function*(){this.hasStarted&&(this.hasStarted=!1,this.shouldMonitor=!1,this.unsubs.forEach((e=>e())),mo.d("stopped audio level monitor for remote peers"))}))}monitorAudioLevels(){return Zt(this,null,(function*(){if(!this.store.getState(Ps))return void(this.shouldMonitor&&(mo.i("room no longer connected, stopping audio level monitoring for remote"),this.shouldMonitor=!1));if(this.shouldMonitor)return;mo.i("monitoring audio levels"),this.shouldMonitor=!0;let e=()=>{this.shouldMonitor?(this.logAllPeersAudioLevels(),setTimeout(e,this.intervalMs)):mo.i("stopped monitoring audio levels")};setTimeout(e,1e3)}))}logAllPeersAudioLevels(){return Zt(this,null,(function*(){var e;if(!window.__triggerBeamEvent__)return;let t=this.store.getState(_s).filter((e=>!!e.audioTrack)),i=[];for(let n of t){let t=this.actions.getTrackById(n.audioTrack||""),r=null==(e=null==t?void 0:t.stream)?void 0:e.nativeStream;if(n.joinedAt&&r){let e=yield this.getAudioLevel(n,r);e.level>0&&i.push(e)}}if(i.length>0){let e={event:"app-audio-level",data:i};mo.d("logging audio levels",i),window.__triggerBeamEvent__(JSON.stringify(e))}}))}getAudioLevel(e,t){return Zt(this,null,(function*(){this.analysers[t.id]||(this.analysers[t.id]=this.createAnalyserNode(t));let i=this.analysers[t.id],n=this.calculateAudioLevel(i);return{peerId:e.id,peerName:e.name,level:n}}))}createAnalyserNode(e){this.audioContext||(this.audioContext=new AudioContext);let t=this.audioContext.createAnalyser();return this.audioContext.createMediaStreamSource(e).connect(t),t}calculateAudioLevel(e){let t=new Uint8Array(e.fftSize);e.getByteTimeDomainData(t);let i=.009,n=i;for(let s of t)n=Math.max(n,(s-128)/128);let r=(Math.log(i)-Math.log(n))/Math.log(i);return Math.ceil(Math.min(Math.max(100*r,0),100))}},_a=2e4,Aa=1e4,Ia={name:"diagnostics-role",priority:1,publishParams:{allowed:["audio","video"],audio:{bitRate:32,codec:"opus"},video:{bitRate:100,codec:"vp8",frameRate:30,height:720,width:1280},screen:{bitRate:100,codec:"vp8",frameRate:10,height:1080,width:1920}},subscribeParams:{subscribeToRoles:[],maxSubsBitRate:3200},permissions:{browserRecording:!1,changeRole:!1,endRoom:!1,hlsStreaming:!1,mute:!1,pollRead:!1,pollWrite:!1,removeOthers:!1,rtmpStreaming:!1,unmute:!1}},Ra="https://100ms.live/test-audio.wav",La=class{constructor(){this.networkScores=[],this.lastPushedAt=0}pushScore(e){!e||e<0||(0===this.networkScores.length?(this.networkScores.push(e),this.lastPushedAt=Date.now()):this.addPendingCQSTillNow())}addPendingCQSTillNow(){if(this.networkScores.length>0){let e=(Date.now()-this.lastPushedAt)/1e3;for(;e>0;)this.networkScores.push(this.networkScores[this.networkScores.length-1]),e-=1;this.lastPushedAt=Date.now()}}getCQS(){return this.networkScores.reduce(((e,t)=>e+t),0)/this.networkScores.length}},Da=e=>!!e&&!isNaN(e),Oa=e=>e[e.length-1],Ma=(e,t)=>{let i=e.filter((e=>Da(t(e))));return i.reduce(((e,i)=>e+(t(i)||0)),0)/i.length},xa=class{constructor(e){this.sdk=e,this.peerStatsList=[],this.localAudioTrackStatsList=[],this.localVideoTrackStatsList=[],this.remoteAudioTrackStatsList=[],this.remoteVideoTrackStatsList=[]}handleStatsUpdate(e){return Zt(this,null,(function*(){var t,i,n,r,s,o,a,l;let c=e.getLocalPeerStats();c&&this.peerStatsList.push(c);let u=null==(n=null==(i=null==(t=this.sdk.getLocalPeer())?void 0:t.audioTrack)?void 0:i.nativeTrack)?void 0:n.id,d=null==(o=null==(s=null==(r=this.sdk.getLocalPeer())?void 0:r.videoTrack)?void 0:s.nativeTrack)?void 0:o.id,h=e.getLocalTrackStats();h&&(u&&this.localAudioTrackStatsList.push(h[u]),d&&this.localVideoTrackStatsList.push(h[d]));let p=yield null==(l=null==(a=this.sdk.getWebrtcInternals())?void 0:a.getSubscribePeerConnection())?void 0:l.getStats();null==p||p.forEach((e=>{if("inbound-rtp"===e.type){let t="audio"===e.kind?this.remoteAudioTrackStatsList:this.remoteVideoTrackStatsList,i=Zr("bytesReceived",e,Oa(t));t.push(Kt(zt({},e),{bitrate:i}))}}))}))}buildReport(){var e,t,i,n,r,s,o,a,l,c;let u=null==(e=Oa(this.peerStatsList))?void 0:e.publish,d=null==(t=Oa(this.peerStatsList))?void 0:t.subscribe,h=null!=u&&u.responsesReceived?((null==u?void 0:u.totalRoundTripTime)||0)/u.responsesReceived:0,p=null!=d&&d.responsesReceived?((null==d?void 0:d.totalRoundTripTime)||0)/d.responsesReceived:0,f=Number(((h+p)/2*1e3).toFixed(2)),v=(null==(i=Oa(this.remoteAudioTrackStatsList))?void 0:i.packetsReceived)||0,g=(null==(n=Oa(this.remoteVideoTrackStatsList))?void 0:n.packetsReceived)||0,m=this.localAudioTrackStatsList.map((e=>e?Ma(Object.values(e),(e=>e.bitrate)):0)),y=this.localVideoTrackStatsList.map((e=>e?Ma(Object.values(e),(e=>e.bitrate)):0)),b=(null==(r=Oa(this.remoteAudioTrackStatsList))?void 0:r.jitter)||0,k=(null==(s=Oa(this.remoteVideoTrackStatsList))?void 0:s.jitter)||0,T=Math.max(b,k),S=Oa(this.localAudioTrackStatsList),w=Oa(this.localVideoTrackStatsList);return{combined:{roundTripTime:f,packetsReceived:v+g,packetsLost:(null==d?void 0:d.packetsLost)||0,bytesSent:(null==u?void 0:u.bytesSent)||0,bytesReceived:(null==d?void 0:d.bytesReceived)||0,bitrateSent:Ma(this.peerStatsList,(e=>{var t;return null==(t=e.publish)?void 0:t.bitrate})),bitrateReceived:Ma(this.peerStatsList,(e=>{var t;return null==(t=e.subscribe)?void 0:t.bitrate})),jitter:T},audio:{roundTripTime:f,packetsReceived:v,packetsLost:(null==(o=Oa(this.remoteAudioTrackStatsList))?void 0:o.packetsLost)||0,bytesReceived:(null==(a=Oa(this.remoteAudioTrackStatsList))?void 0:a.bytesReceived)||0,bitrateSent:Ma(m,(e=>e)),bitrateReceived:Ma(this.remoteAudioTrackStatsList,(e=>e.bitrate)),bytesSent:S?Object.values(S).reduce(((e,t)=>e+(t.bytesSent||0)),0):0,jitter:b},video:{roundTripTime:f,packetsLost:(null==(l=Oa(this.remoteVideoTrackStatsList))?void 0:l.packetsLost)||0,bytesReceived:(null==(c=Oa(this.remoteVideoTrackStatsList))?void 0:c.bytesReceived)||0,packetsReceived:g,bitrateSent:Ma(y,(e=>e)),bitrateReceived:Ma(this.remoteVideoTrackStatsList,(e=>e.bitrate)),bytesSent:w?Object.values(w).reduce(((e,t)=>e+(t.bytesSent||0)),0):0,jitter:k}}}},Na=(e=>(e[e.STARTING=0]="STARTING",e[e.INIT_FETCHED=1]="INIT_FETCHED",e[e.SIGNAL_CONNECTED=2]="SIGNAL_CONNECTED",e[e.ICE_ESTABLISHED=3]="ICE_ESTABLISHED",e[e.MEDIA_CAPTURED=4]="MEDIA_CAPTURED",e[e.MEDIA_PUBLISHED=5]="MEDIA_PUBLISHED",e[e.COMPLETED=6]="COMPLETED",e))(Na||{}),Ua=class{constructor(e,t,i,n){this.sdk=e,this.sdkListener=t,this.progressCallback=i,this.completionCallback=n,this.wsConnected=!1,this.initConnected=!1,this.isPublishICEConnected=!1,this.isSubscribeICEConnected=!1,this.gatheredPublishICECandidates=[],this.gatheredSubscribeICECandidates=[],this.errors=[],this.isAudioTrackCaptured=!1,this.isVideoTrackCaptured=!1,this.isAudioTrackPublished=!1,this.isVideoTrackPublished=!1,this.cqsCalculator=new La,this.timestamp=Date.now(),this.onRoomUpdate=this.sdkListener.onRoomUpdate.bind(this.sdkListener),this.onPeerUpdate=this.sdkListener.onPeerUpdate.bind(this.sdkListener),this.onMessageReceived=this.sdkListener.onMessageReceived.bind(this.sdkListener),this.onReconnected=this.sdkListener.onReconnected.bind(this.sdkListener),this.onRoleChangeRequest=this.sdkListener.onRoleChangeRequest.bind(this.sdkListener),this.onRoleUpdate=this.sdkListener.onRoleUpdate.bind(this.sdkListener),this.onChangeTrackStateRequest=this.sdkListener.onChangeTrackStateRequest.bind(this.sdkListener),this.onChangeMultiTrackStateRequest=this.sdkListener.onChangeMultiTrackStateRequest.bind(this.sdkListener),this.onRemovedFromRoom=this.sdkListener.onRemovedFromRoom.bind(this.sdkListener),this.onNetworkQuality=null==(ua=this.sdkListener.onNetworkQuality)?void 0:ua.bind(this.sdkListener),this.onPreview=this.sdkListener.onPreview.bind(this.sdkListener),this.onDeviceChange=null==(da=this.sdkListener.onDeviceChange)?void 0:da.bind(this.sdkListener),this.onSessionStoreUpdate=this.sdkListener.onSessionStoreUpdate.bind(this.sdkListener),this.onPollsUpdate=this.sdkListener.onPollsUpdate.bind(this.sdkListener),this.onWhiteboardUpdate=this.sdkListener.onWhiteboardUpdate.bind(this.sdkListener),this.handleConnectionQualityUpdate=e=>{let t=e.find((e=>{var t,i;return e.peerID===(null==(i=null==(t=this.sdk)?void 0:t.store.getLocalPeer())?void 0:i.peerId)}));this.cqsCalculator.pushScore(null==t?void 0:t.downlinkQuality)},this.statsCollector=new xa(e),this.state=0}get state(){return this._state}set state(e){var t;void 0===e||void 0!==this._state&&e<this._state||(this._state=e,null==(t=this.progressCallback)||t.call(this,e))}onICESuccess(e){e?this.isPublishICEConnected=!0:this.isSubscribeICEConnected=!0,this.isPublishICEConnected&&this.isSubscribeICEConnected&&(this.state=3)}onSelectedICECandidatePairChange(e,t){t?this.selectedPublishICECandidate=e:this.selectedSubscribeICECandidate=e}onICECandidate(e,t){t?this.gatheredPublishICECandidates.push(e):this.gatheredSubscribeICECandidates.push(e)}onMediaPublished(e){switch(e.type){case"audio":this.isAudioTrackPublished=!0;break;case"video":this.isVideoTrackPublished=!0;break;default:break}this.isVideoTrackPublished&&this.isAudioTrackPublished&&(this.state=5)}onInitSuccess(e){this.websocketURL=e,this.initConnected=!0,this.state=1}onSignallingSuccess(){this.wsConnected=!0,this.state=2}onJoin(e){var t,i;this.sdkListener.onJoin(e),null==(t=this.sdk.getWebrtcInternals())||t.onStatsChange((e=>this.statsCollector.handleStatsUpdate(e))),null==(i=this.sdk.getWebrtcInternals())||i.start(),this.cleanupTimer=window.setTimeout((()=>{this.cleanupAndReport()}),_a)}onError(e){this.sdkListener.onError(e),this.errors.push(e),null!=e&&e.isTerminal&&this.cleanupAndReport()}onTrackUpdate(e,t,i){if(this.sdkListener.onTrackUpdate(e,t,i),i.isLocal&&0===e){switch(t.type){case"audio":this.isAudioTrackCaptured=!0;break;case"video":this.isVideoTrackCaptured=!0;break;default:break}this.isVideoTrackCaptured&&this.isAudioTrackCaptured&&(this.state=4)}}onReconnecting(e){this.sdkListener.onReconnecting(e),this.cqsCalculator.addPendingCQSTillNow()}cleanupAndReport(){var e;clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0,5===this.state&&(this.state=6),null==(e=this.completionCallback)||e.call(this,this.buildReport()),this.sdk.leave()}buildReport(){this.cqsCalculator.addPendingCQSTillNow();let e=this.cqsCalculator.getCQS(),t=this.statsCollector.buildReport();return{testTimestamp:this.timestamp,connectivityState:this.state,errors:this.errors,signallingReport:{isConnected:this.wsConnected,isInitConnected:this.initConnected,websocketUrl:this.websocketURL},mediaServerReport:{stats:t,connectionQualityScore:e,isPublishICEConnected:this.isPublishICEConnected,isSubscribeICEConnected:this.isSubscribeICEConnected,publishICECandidatePairSelected:this.selectedPublishICECandidate,subscribeICECandidatePairSelected:this.selectedSubscribeICECandidate,publishIceCandidatesGathered:this.gatheredPublishICECandidates,subscribeIceCandidatesGathered:this.gatheredSubscribeICECandidates}}}},Fa=class{constructor(e){this.recording={server:{running:!1},browser:{running:!1},hls:{running:!1}},this.rtmp={running:!1},this.hls={running:!1,variants:[]},this.transcriptions=[],this.id=e}},ja=(e,t,i)=>Zt(void 0,null,(function*(){let n=Error("something went wrong during fetch");for(let r=0;r<4;r++)try{let n=yield fetch(e,t),r=yield n.clone().json();if(i&&i.length&&!n.ok&&i.includes(r.code))throw Wi.APIErrors.ServerErrors(r.code,"GET_TOKEN",r.message,!1);return n}catch(je){n=je}throw["Failed to fetch","NetworkError"].some((e=>n.message.includes(e)))?Wi.APIErrors.EndpointUnreachable("GET_TOKEN",n.message):n})),Ba=class{constructor(e,t){this.sdk=e,this.sdkListener=t,this.recordedAudio=Ra,this.sdk.setIsDiagnostics(!0),this.initSdkWithLocalPeer()}get localPeer(){var e;return null==(e=this.sdk)?void 0:e.store.getLocalPeer()}checkBrowserSupport(){Zi(),Yi()}requestPermission(e){return Zt(this,null,(function*(){try{let t=yield navigator.mediaDevices.getUserMedia(e);return t.getTracks().forEach((e=>e.stop())),yield this.sdk.deviceManager.init(!0),{audio:t.getAudioTracks().length>0,video:t.getVideoTracks().length>0}}catch(Ue){throw xn(Ue,this.sdk.localTrackManager.getErrorType(!!e.video,!!e.audio))}}))}startCameraCheck(e){return Zt(this,null,(function*(){var t,i,n,r;if(this.initSdkWithLocalPeer(),!this.localPeer)throw new Error("Local peer not found");this.sdk.store.setSimulcastEnabled(!1),this.localPeer.role=Kt(zt({},Ia),{publishParams:Kt(zt({},Ia.publishParams),{allowed:["video"]})});let s=(new Rn).video((new An).deviceId(e||"default").build()).build(),o=yield null==(t=this.sdk)?void 0:t.localTrackManager.getLocalTracks({audio:!1,video:!0},s),a=null==o?void 0:o.find((e=>"video"===e.type));if(!a)throw new Error("No video track found");null==(i=this.sdk)||i.deviceManager.init(!0),this.localPeer.videoTrack=a,null==(r=null==(n=this.sdk)?void 0:n.listener)||r.onPeerUpdate(9,[this.localPeer])}))}stopCameraCheck(){var e,t;null==(t=null==(e=this.localPeer)?void 0:e.videoTrack)||t.cleanup(),this.localPeer&&(this.localPeer.videoTrack=void 0)}startMicCheck(e){return Zt(this,arguments,(function*({inputDevice:e,onError:t,onStop:i,time:n=Aa}){var r,s,o,a;this.initSdkWithLocalPeer((e=>{this.stopMicCheck(),null==t||t(e)}));let l=yield this.getLocalAudioTrack(e);if(null==(r=this.sdk)||r.deviceManager.init(!0),!this.localPeer)throw new Error("Local peer not found");if(!l)throw new Error("No audio track found");this.localPeer.audioTrack=l,null==(s=this.sdk)||s.initPreviewTrackAudioLevelMonitor(),null==(a=null==(o=this.sdk)?void 0:o.listener)||a.onPeerUpdate(9,[this.localPeer]),this.mediaRecorder=new MediaRecorder(l.stream.nativeStream);let c=[];this.mediaRecorder.ondataavailable=function(e){c.push(e.data)},this.mediaRecorder.onstop=()=>{var e,t;let i=new Blob(c,{type:null==(e=this.mediaRecorder)?void 0:e.mimeType});this.recordedAudio=URL.createObjectURL(i),null==(t=this.onStopMicCheck)||t.call(this)},this.mediaRecorder.start();let u=setTimeout((()=>{this.stopMicCheck()}),n);this.onStopMicCheck=()=>{clearTimeout(u),null==i||i()}}))}stopMicCheck(){var e,t,i;null==(e=this.mediaRecorder)||e.stop(),null==(i=null==(t=this.localPeer)?void 0:t.audioTrack)||i.cleanup(),this.localPeer&&(this.localPeer.audioTrack=void 0)}getRecordedAudio(){return this.recordedAudio}startConnectivityCheck(e,t,i){return Zt(this,null,(function*(){if(!this.sdk)throw new Error("SDK not found");this.connectivityCheck=new Ua(this.sdk,this.sdkListener,e,t);let n=yield this.getAuthToken(i);yield this.sdk.leave(),yield this.sdk.join({authToken:n,userName:"diagnostics-test"},this.connectivityCheck),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:e=>{var t;null==(t=this.connectivityCheck)||t.handleConnectionQualityUpdate(e)}})}))}stopConnectivityCheck(){return Zt(this,null,(function*(){var e;return null==(e=this.connectivityCheck)?void 0:e.cleanupAndReport()}))}initSdkWithLocalPeer(e){var t,i,n;this.sdkListener&&(null==(t=this.sdk)||t.initStoreAndManagers(Kt(zt({},this.sdkListener),{onError:t=>{null==e||e(t),this.sdkListener.onError(t)}})));let r=new ss({name:"diagnostics-peer",role:Ia,type:"regular"});null==(i=this.sdk)||i.store.addPeer(r);let s=new Fa("diagnostics-room");this.sdk.store.setRoom(s),this.sdkListener.onRoomUpdate("ROOM_PEER_COUNT_UPDATED",s),null==(n=this.sdk)||n.deviceManager.init(!0)}getAuthToken(e){return Zt(this,null,(function*(){let t=new URL("https://api.100ms.live/v2/diagnostics/token");e&&t.searchParams.append("region",e);let i=yield ja(t.toString(),{method:"GET"},[429,500,501,502,503,504,505,506,507,508,509,510,511]),n=yield i.json();if(!i.ok)throw Wi.APIErrors.ServerErrors(n.code,"GET_TOKEN",n.message,!1);let{token:r}=n;if(!r)throw Error(n.message);return r}))}getLocalAudioTrack(e){return Zt(this,null,(function*(){var t;if(!this.localPeer)return;this.localPeer.role=Kt(zt({},Ia),{publishParams:Kt(zt({},Ia.publishParams),{allowed:["audio"]})});let i=(new Rn).audio((new Cn).deviceId(e||"default").build()).build(),n=yield null==(t=this.sdk)?void 0:t.localTrackManager.getLocalTracks({audio:!0,video:!1},i);return null==n?void 0:n.find((e=>"audio"===e.type))}))}},Ga=class{constructor(e,t,i){this.isRoomJoinCalled=!1,this.ignoredMessageTypes=[],this.setProgress=({type:e,progress:t})=>{this.setState((i=>{i.playlist[e].progress=t,i.playlist[e].currentTime=this.sdk.getPlaylistManager().getCurrentTime(e)}),"playlistProgress")},this.syncPlaylistState=e=>{this.setState((e=>{Object.assign(e.playlist,wa.convertPlaylist(this.sdk.getPlaylistManager()))}),e)},this.sendPeerUpdateNotification=(e,t)=>{let i=this.store.getState(Ro(t.peerId)),n=ia[e]||"peerUpdate";if(8===e)this.syncRoomState(n),this.updateMidCallPreviewRoomState(e,t);else if([0,1].includes(e))this.syncRoomState(n),i||(i=this.store.getState(Ro(t.peerId)));else if([12,13,14].includes(e))this.syncRoomState(n),i||(i=this.store.getState(Ro(t.peerId)));else{let e=wa.convertPeer(t);this.setState((t=>{let n=t.peers[e.id];ya(n,e)&&(Ta(n.auxiliaryTracks,e.auxiliaryTracks)&&(n.auxiliaryTracks=e.auxiliaryTracks),Object.assign(n,e)),i=e}),n)}this.hmsNotifications.sendPeerUpdate(e,i)},this.getSDKHMSPeer=e=>this.sdk.getPeerMap()[e],this.setState=(e,t)=>this.store.namedSetState(e,t),this.store=e,this.sdk=t,this.hmsNotifications=i,this.sessionStore=new Pa(this.sdk,this.setSessionStoreValueLocally.bind(this)),this.actionBatcher=new la(e)}submitSessionFeedback(e,t){return this.sdk.submitSessionFeedback(e,t)}getLocalTrack(e){return this.sdk.store.getLocalPeerTracks().find((t=>t.trackId===e))}get interactivityCenter(){return this.sdk.getInteractivityCenter()}setPlaylistSettings(e){this.sdk.updatePlaylistSettings(e)}refreshDevices(){return Zt(this,null,(function*(){yield this.sdk.refreshDevices()}))}unblockAudio(){return Zt(this,null,(function*(){yield this.sdk.getAudioOutput().unblockAutoplay()}))}setVolume(e,t){return Zt(this,null,(function*(){t?yield this.setTrackVolume(e,t):(yield this.sdk.getAudioOutput().setVolume(e),this.syncRoomState("setOutputVolume"))}))}setAudioOutputDevice(e){return Zt(this,null,(function*(){(yield this.sdk.getAudioOutput().setDevice(e))&&this.setState((t=>{t.settings.audioOutputDeviceId=e}),"setAudioOutputDevice")}))}setPreferredLayer(e,t){return Zt(this,null,(function*(){var i;let n=this.getTrackById(e);if(n)if(n instanceof Gr){if("none"===t)return void mo.d("layer none will be ignored");if((null==(i=this.store.getState(Oo(e)))?void 0:i.preferredLayer)===t)return void mo.d(`preferred layer is already ${t}`);this.setState((i=>{let n=i.tracks[e];n&&(n.preferredLayer=t)}),"setPreferredLayer"),yield n.setPreferredLayer(t)}else mo.d(`track ${e} is not a remote video track`);else this.logPossibleInconsistency(`track ${e} not present, unable to set preffer layer`)}))}getNativeTrackById(e){var t;return null==(t=this.sdk.store.getTrackById(e))?void 0:t.nativeTrack}getTrackById(e){return this.sdk.store.getTrackById(e)}getAuthTokenByRoomCode(e,t){return this.sdk.getAuthTokenByRoomCode(e,t)}preview(e){return Zt(this,null,(function*(){let t=this.store.getState(Ws);if("Preview"!==t&&"Connecting"!==t)try{"Connected"!==t&&this.setState((e=>{e.room.roomState="Connecting"}),"connecting"),yield this.sdkPreviewWithListeners(e)}catch(T){throw mo.e("Cannot show preview. Failed to connect to room - ",T),T}else this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting")}))}cancelMidCallPreview(){return Zt(this,null,(function*(){return this.sdk.cancelMidCallPreview()}))}join(e){return Zt(this,null,(function*(){if(this.isRoomJoinCalled)this.logPossibleInconsistency("room join is called again");else try{this.isRoomJoinCalled=!0,this.setState((e=>{e.room.roomState="Connecting"}),"join"),yield this.sdkJoinWithListeners(e)}catch(Ue){throw this.isRoomJoinCalled=!1,mo.e("Failed to connect to room - ",Ue),Ue}}))}leave(){return Zt(this,null,(function*(){let e=this.store.getState(Ps),t=!0;e||(t=!1,this.logPossibleInconsistency("room leave is called when no room is connected"));let i=this.store.getState(Ws);return this.setState((e=>{e.room.roomState="Disconnecting"}),"leaving"),this.sdk.leave(t).then((()=>{this.resetState("leave"),this.beamSpeakerLabelsLogger&&this.beamSpeakerLabelsLogger.stop().catch(mo.e),mo.i("left room")})).catch((e=>{mo.e("error in leaving room - ",e),this.setState((e=>{e.room.roomState=i}),"revertLeave")}))}))}setScreenShareEnabled(e,t){return Zt(this,null,(function*(){"boolean"==typeof t&&(t={audioOnly:t});try{e?yield this.startScreenShare(t):yield this.stopScreenShare()}catch(T){throw this.hmsNotifications.sendError(wa.convertException(T)),T}}))}addTrack(e,t="regular"){return Zt(this,null,(function*(){yield this.sdk.addTrack(e,t),this.syncRoomState("addTrack")}))}removeTrack(e){return Zt(this,null,(function*(){yield this.sdk.removeTrack(e),this.syncRoomState("removeTrack")}))}setLocalAudioEnabled(e){return Zt(this,null,(function*(){let t=this.store.getState(Ls);t&&(yield this.setEnabledTrack(t,e))}))}setLocalVideoEnabled(e){return Zt(this,null,(function*(){let t=this.store.getState(Ds);t&&(yield this.setEnabledTrack(t,e))}))}setEnabledTrack(e,t){return Zt(this,null,(function*(){var i;if((null==(i=this.store.getState().tracks[e])?void 0:i.enabled)===t)return void this.logPossibleInconsistency(`local track[${e}] enabled state - ${t}`);this.setState((i=>{i.tracks[e]?i.tracks[e].displayEnabled=t:this.logPossibleInconsistency("track id not found for setEnabled")}),"displayEnabled");try{yield this.setEnabledSDKTrack(e,t),this.syncRoomState("setEnabled")}catch(je){throw this.setState((i=>{i.tracks[e].displayEnabled=!t}),"rollbackDisplayEnabled"),this.hmsNotifications.sendError(wa.convertException(je)),je}let n=t?3:2;this.hmsNotifications.sendTrackUpdate(n,e)}))}setAudioSettings(e){return Zt(this,null,(function*(){let t=this.store.getState(Ls);t&&(yield this.setSDKLocalAudioTrackSettings(t,e),this.syncRoomState("setAudioSettings"))}))}setVideoSettings(e){return Zt(this,null,(function*(){let t=this.store.getState(Ds);t&&(yield this.setSDKLocalVideoTrackSettings(t,e),this.syncRoomState("setVideoSettings"))}))}switchCamera(){return Zt(this,null,(function*(){let e=this.store.getState(Ds);if(e){let t=this.sdk.store.getLocalPeerTracks().find((t=>t.trackId===e));t&&(yield t.switchCamera(),this.syncRoomState("switchCamera"))}}))}sendMessage(e){this.sendBroadcastMessage(e)}sendBroadcastMessage(e,t){return Zt(this,null,(function*(){let{message_id:i,timestamp:n}=yield this.sdk.sendBroadcastMessage(e,t);this.updateMessageInStore({message:e,type:t,id:i,time:n})}))}sendGroupMessage(e,t,i){return Zt(this,null,(function*(){let n=this.store.getState(qs),r=t.map((e=>n[e])),{message_id:s,timestamp:o}=yield this.sdk.sendGroupMessage(e,r,i);this.updateMessageInStore({message:e,recipientRoles:t,type:i,id:s,time:o})}))}sendDirectMessage(e,t,i){return Zt(this,null,(function*(){let{message_id:n,timestamp:r}=yield this.sdk.sendDirectMessage(e,t,i);this.updateMessageInStore({message:e,recipientPeer:t,type:i,id:n,time:r})}))}updateMessageInStore(e){var t;if(!e.message)throw mo.w("sendMessage","Failed to send message",e),Error(`sendMessage Failed - ${JSON.stringify(e)}`);if(e.type&&this.ignoredMessageTypes.includes(e.type))return;let i=this.sdk.getLocalPeer(),n={read:!0,id:e.id,time:new Date(e.time),message:e.message,type:e.type||"chat",recipientPeer:e.recipientPeer,recipientRoles:e.recipientRoles,senderName:null==i?void 0:i.name,sender:null==i?void 0:i.peerId,senderRole:null==(t=null==i?void 0:i.role)?void 0:t.name,ignored:!1};this.setState((e=>{e.messages.byID[n.id]=n,e.messages.allIDs.push(n.id)}),"newMessage")}setMessageRead(e,t){this.setState((i=>{t?i.messages.byID[t]?i.messages.byID[t].read=e:this.logPossibleInconsistency("no message with id is found"):i.messages.allIDs.forEach((t=>{i.messages.byID[t].read=e}))}),"setMessageRead")}attachVideo(e,t){return Zt(this,null,(function*(){if(this.localAndVideoUnmuting(e))return new Promise((i=>{let n=this.store.subscribe((r=>Zt(this,null,(function*(){r&&(yield this.attachVideoInternal(e,t),n(),i())}))),Ns)}));yield this.attachVideoInternal(e,t)}))}detachVideo(e,t){return Zt(this,null,(function*(){let i=this.getTrackById(e);"video"===(null==i?void 0:i.type)?yield this.sdk.detachVideo(i,t):(t&&(t.srcObject=null),mo.d("possible inconsistency detected - no video track found to remove sink"))}))}addPluginToVideoTrack(e,t){return Zt(this,null,(function*(){return this.addRemoveVideoPlugin(e,"add",t)}))}addPluginsToVideoStream(e){return Zt(this,null,(function*(){return this.addRemoveMediaStreamVideoPlugins(e,"add")}))}removePluginsFromVideoStream(e){return Zt(this,null,(function*(){return this.addRemoveMediaStreamVideoPlugins(e,"remove")}))}addPluginToAudioTrack(e){return Zt(this,null,(function*(){return this.addRemoveAudioPlugin(e,"add")}))}validateVideoPluginSupport(e){let t={isSupported:!1};if(!e)return mo.w("no plugin passed in for checking support"),t.errMsg="no plugin passed in for checking support",t;let i=this.store.getState(Ds);if(!i)return mo.w("video Track not added to local peer yet"),t.errMsg="call this function only after local peer has video track",t;let n=this.getTrackById(i);return n?t=n.validatePlugin(e):(mo.w(`track ${i} not present, unable to validate plugin`),t.errMsg=`track ${i} not present, unable to validate plugin`),t}validateAudioPluginSupport(e){let t={isSupported:!1};if(!e)return mo.w('no plugin passed in for checking support"'),t.errMsg='no plugin passed in for checking support"',t;let i=this.store.getState(Ls);if(!i)return mo.w("audio track not added to local peer yet"),t.errMsg="call this function only after local peer has audio track",t;let n=this.getTrackById(i);return n?t=n.validatePlugin(e):(mo.w(`track ${i} not present, unable to validate plugin`),t.errMsg=`track ${i} not present, unable to validate plugin`),t}removePluginFromVideoTrack(e){return Zt(this,null,(function*(){return this.addRemoveVideoPlugin(e,"remove")}))}removePluginFromAudioTrack(e){return Zt(this,null,(function*(){return this.addRemoveAudioPlugin(e,"remove")}))}changeRole(e,t,i=!1){return Zt(this,null,(function*(){yield this.sdk.changeRoleOfPeer(e,t,i)}))}changeRoleOfPeer(e,t,i=!1){return Zt(this,null,(function*(){yield this.sdk.changeRoleOfPeer(e,t,i)}))}changeRoleOfPeersWithRoles(e,t){return Zt(this,null,(function*(){let i=this.sdk.getRoles().filter((t=>e.includes(t.name)));yield this.sdk.changeRoleOfPeersWithRoles(i,t)}))}acceptChangeRole(e){return Zt(this,null,(function*(){let t=e.requestedBy?this.getSDKHMSPeer(e.requestedBy.id):void 0;t||mo.w(`peer for which role change is requested no longer available - ${e.requestedBy}`);let i={requestedBy:t,role:e.role,token:e.token};yield this.sdk.acceptChangeRole(i),this.removeRoleChangeRequest(e)}))}raiseLocalPeerHand(){return Zt(this,null,(function*(){yield this.sdk.raiseLocalPeerHand()}))}lowerLocalPeerHand(){return Zt(this,null,(function*(){yield this.sdk.lowerLocalPeerHand()}))}raiseRemotePeerHand(e){return Zt(this,null,(function*(){yield this.sdk.raiseRemotePeerHand(e)}))}lowerRemotePeerHand(e){return Zt(this,null,(function*(){yield this.sdk.lowerRemotePeerHand(e)}))}getPeer(e){return Zt(this,null,(function*(){let t=yield this.sdk.getPeer(e);if(t)return wa.convertPeer(t)}))}findPeerByName(e){return Zt(this,null,(function*(){let{offset:t,peers:i,eof:n}=yield this.sdk.findPeerByName(e);return{offset:t,eof:n,peers:i.map((e=>wa.convertPeer(e)))}}))}getPeerListIterator(e){let t=this.sdk.getPeerListIterator(e);return{hasNext:()=>t.hasNext(),next:()=>Zt(this,null,(function*(){return(yield t.next()).map((e=>wa.convertPeer(e)))})),findPeers:()=>Zt(this,null,(function*(){return(yield t.findPeers()).map((e=>wa.convertPeer(e)))})),getTotal:()=>t.getTotal()}}initAppData(e){this.setState((t=>{t.appData=e}),"initAppData")}setAppData(e,t,i){let n="Object"===(null==t?void 0:t.constructor.name);this.setState((r=>{if(r.appData)i&&n?Object.assign(r.appData[e],t):r.appData[e]=t;else{let i={[e]:t};r.appData=i}}),`setAppData-${e}`)}rejectChangeRole(e){this.removeRoleChangeRequest(e)}endRoom(e,t){return Zt(this,null,(function*(){let i=this.store.getState(Ys);if(null==i||!i.endRoom)return void mo.w("You are not allowed to perform this action - endRoom");let n=this.store.getState(Ws);this.setState((e=>{e.room.roomState="Disconnecting"}),"endingRoom");try{yield this.sdk.endRoom(e,t),this.resetState("endRoom")}catch(We){mo.e("error in ending room - ",We),this.setState((e=>{e.room.roomState=n}),"revertEndRoom")}}))}removePeer(e,t){return Zt(this,null,(function*(){var i;let n=null==(i=this.sdk.getLocalPeer())?void 0:i.peerId;e!==n&&(yield this.sdk.removePeer(e,t))}))}startRTMPOrRecording(e){return Zt(this,null,(function*(){yield this.sdk.startRTMPOrRecording(e)}))}stopRTMPAndRecording(){return Zt(this,null,(function*(){yield this.sdk.stopRTMPAndRecording()}))}startHLSStreaming(e){return Zt(this,null,(function*(){yield this.sdk.startHLSStreaming(e)}))}stopHLSStreaming(e){return Zt(this,null,(function*(){yield this.sdk.stopHLSStreaming(e)}))}startTranscription(e){return Zt(this,null,(function*(){yield this.sdk.startTranscription(e)}))}stopTranscription(e){return Zt(this,null,(function*(){yield this.sdk.stopTranscription(e)}))}sendHLSTimedMetadata(e){return Zt(this,null,(function*(){yield this.sdk.sendHLSTimedMetadata(e)}))}changeName(e){return Zt(this,null,(function*(){yield this.sdk.changeName(e)}))}changeMetadata(e){return Zt(this,null,(function*(){"string"!=typeof e&&(e=JSON.stringify(e)),yield this.sdk.changeMetadata(e)}))}setSessionMetadata(e){return Zt(this,null,(function*(){yield this.sdk.setSessionMetadata(e),this.setState((t=>{t.sessionMetadata=e}),"setSessionMetadata"),this.setSessionStoreValueLocally({key:"default",value:e},"setSessionMetadata")}))}populateSessionMetadata(){return Zt(this,null,(function*(){let e=yield this.sdk.getSessionMetadata();this.setState((t=>{t.sessionMetadata=e}),"populateSessionMetadata"),this.setSessionStoreValueLocally({key:"default",value:e},"populateSessionmetadata")}))}setRemoteTrackEnabled(e,t){return Zt(this,null,(function*(){if("string"==typeof e){let i=this.getTrackById(e);i&&ca(i)?yield this.sdk.changeTrackState(i,t):this.logPossibleInconsistency(`No remote track with ID ${e} found for change track state`)}else Array.isArray(e)&&e.forEach((e=>this.setRemoteTrackEnabled(e,t)))}))}setRemoteTracksEnabled(e){return Zt(this,null,(function*(){let t={enabled:e.enabled,type:e.type,source:e.source};if(e.roles){let i=this.store.getState(qs);t.roles=e.roles.map((e=>i[e]))}yield this.sdk.changeMultiTrackState(t)}))}setLogLevel(e){mo.level=e,this.sdk.setLogLevel(e)}setFrameworkInfo(e){this.sdk.setFrameworkInfo(e)}ignoreMessageTypes(e,t=!1){if(t)this.ignoredMessageTypes=e;else for(let i of e)this.ignoredMessageTypes.includes(i)||this.ignoredMessageTypes.push(i)}enableBeamSpeakerLabelsLogging(){return Zt(this,null,(function*(){this.beamSpeakerLabelsLogger||(mo.i("enabling beam speaker labels logging"),this.beamSpeakerLabelsLogger=new Ca(this.store,this),yield this.beamSpeakerLabelsLogger.start())}))}initDiagnostics(){let e=new Ba(this.sdk,{onJoin:this.onJoin.bind(this),onPreview:this.onPreview.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this),onSessionStoreUpdate:this.onSessionStoreUpdate.bind(this),onPollsUpdate:this.onPollsUpdate.bind(this),onWhiteboardUpdate:this.onWhiteboardUpdate.bind(this)});return this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)}),e}resetState(e="resetState"){this.isRoomJoinCalled=!1,mo.cleanup(),this.setState((e=>{Object.assign(e,ti())}),e)}getDebugInfo(){return this.sdk.getDebugInfo()}sdkJoinWithListeners(e){return Zt(this,null,(function*(){yield this.sdk.join(e,{onJoin:this.onJoin.bind(this),onPreview:this.onPreview.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this),onSessionStoreUpdate:this.onSessionStoreUpdate.bind(this),onPollsUpdate:this.onPollsUpdate.bind(this),onWhiteboardUpdate:this.onWhiteboardUpdate.bind(this),onSFUMigration:this.onSFUMigration.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)})}))}onSFUMigration(){this.syncRoomState("SFUMigration")}onRemovedFromRoom(e){var t;let i=this.store.getState(Ro(null==(t=e.requestedBy)?void 0:t.peerId));this.hmsNotifications.sendLeaveRoom(Kt(zt({},e),{requestedBy:i||void 0}));let n=e.roomEnded||!i?"roomEnded":"removedFromRoom";mo.i(`resetting state after peer removed ${n}`,e),this.resetState(n)}onDeviceChange(e){let t=e.devices;if(!t)return;let i=this.store.getState(Is);if(this.setState((e=>{Ta(e.devices.audioInput,t.audioInput)||(e.devices.audioInput=t.audioInput),Ta(e.devices.videoInput,t.videoInput)||(e.devices.videoInput=t.videoInput),Ta(e.devices.audioOutput,t.audioOutput)||(e.devices.audioOutput=t.audioOutput);let n=this.sdk.getLocalPeer();null!=i&&i.id&&n&&Object.assign(e.settings,this.getMediaSettings(n))}),"deviceChange"),e.selection){let t=wa.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(t)}}sdkPreviewWithListeners(e){return Zt(this,null,(function*(){yield this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})}))}onNetworkQuality(e){this.setState((t=>{var i;let n=t.room.localPeer||(null==(i=this.sdk.getLocalPeer())?void 0:i.peerId);n&&(t.connectionQualities[n]={peerID:n,downlinkQuality:e})}),"ConnectionQuality")}onSessionStoreUpdate(e){this.setSessionStoreValueLocally(e,"sessionStoreUpdate")}onPollsUpdate(e,t){let i=ra[e];this.setState((e=>{let i=t.reduce(((e,t)=>{var i;return e[t.id]=Kt(zt({},t),{questions:null==(i=t.questions)?void 0:i.map((e=>{var t,i;return Kt(zt({},e),{answer:e.answer?zt({},e.answer):void 0,options:null==(t=e.options)?void 0:t.map((e=>zt({},e))),responses:null==(i=e.responses)?void 0:i.map((e=>zt({},e)))})}))}),e}),{});fa(e.polls,i)}),i),t.forEach((t=>this.hmsNotifications.sendPollUpdate(e,t.id)))}onWhiteboardUpdate(e){this.setState((t=>{t.whiteboards[e.id]=e}),"whiteboardUpdate")}startScreenShare(e){return Zt(this,null,(function*(){this.store.getState(Fs)?this.logPossibleInconsistency("start screenshare is called while it's on"):(yield this.sdk.startScreenShare((()=>this.syncRoomState("screenshareStopped")),e),this.syncRoomState("startScreenShare"))}))}stopScreenShare(){return Zt(this,null,(function*(){this.store.getState(Fs)?(yield this.sdk.stopScreenShare(),this.syncRoomState("stopScreenShare")):this.logPossibleInconsistency("stop screenshare is called while it's not on")}))}attachVideoInternal(e,t){return Zt(this,null,(function*(){let i=this.getTrackById(e);i||(i=this.getLocalTrack(e)),i&&"video"===i.type?yield this.sdk.attachVideo(i,t):this.logPossibleInconsistency("no video track found to add sink")}))}syncRoomState(e){e=`${e}_fullSync`,mo.time(`store-sync-${e}`);let t,i={},n=[],r={},s={},o={},a=this.sdk.getPeers();for(let h of a){let e=wa.convertPeer(h);i[e.id]=e,n.push(e.id),o[e.id]={peerID:e.id,downlinkQuality:h.networkQuality||-1};let a=[h.audioTrack,h.videoTrack,...h.auxiliaryTracks];for(let t of a){if(!t)continue;let e=wa.convertTrack(t);r[e.id]=e}if(h.isLocal){let e=h;t=this.getPreviewFields(e),Object.assign(s,this.getMediaSettings(e))}}let l=this.sdk.getRecordingState(),c=this.sdk.getRTMPState(),u=this.sdk.getHLSState(),d=this.sdk.getTranscriptionState();this.setState((e=>{var a;e.room.peers=n;let h=e.peers,p=e.tracks;ha(h,i),pa(p,r),Object.assign(e.settings,s),e.room.isConnected&&Object.assign(e.connectionQualities,o),null!=(a=e.preview)&&a.localPeer&&null!=t&&t.localPeer?Object.assign(e.preview,t):e.preview=t,Object.assign(e.roles,wa.convertRoles(this.sdk.getRoles())),Object.assign(e.playlist,wa.convertPlaylist(this.sdk.getPlaylistManager())),Object.assign(e.room,wa.convertRecordingStreamingState(l,c,u,d)),Object.assign(e.templateAppData,this.sdk.getTemplateAppData())}),e),mo.timeEnd(`store-sync-${e}`)}onPreview(e){this.setState((t=>{var i;Object.assign(t.room,wa.convertRoom(e,null==(i=this.sdk.getLocalPeer())?void 0:i.peerId)),t.room.roomState="Preview"}),"previewStart"),this.syncRoomState("previewSync")}onJoin(e){let t=this.sdk.getPlaylistManager();this.audioPlaylist=new Ea(t,"audio",this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new Ea(t,"video",this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState((t=>{var i;Object.assign(t.room,wa.convertRoom(e,null==(i=this.sdk.getLocalPeer())?void 0:i.peerId)),t.room.isConnected=!0,t.room.roomState="Connected"}),"joined"),t.onProgress(this.setProgress),t.onNewTrackStart((e=>{this.syncPlaylistState(`${e.type}PlaylistUpdate`)})),t.onPlaylistEnded((e=>{this.syncPlaylistState(`${e}PlaylistEnded`)})),t.onCurrentTrackEnded((e=>{this.hmsNotifications.sendPlaylistTrackEnded(wa.convertPlaylistItem(t,e)),this.syncPlaylistState(`${e.type}PlaylistItemEnded`)}))}onRoomUpdate(e,t){this.setState((e=>{var i;Object.assign(e.room,wa.convertRoom(t,null==(i=this.sdk.getLocalPeer())?void 0:i.peerId))}),e),"TRANSCRIPTION_STATE_UPDATED"===e&&this.hmsNotifications.sendTranscriptionUpdate(t.transcriptions)}onPeerUpdate(e,t){if(![4,5].includes(e)){if(Array.isArray(t)){let e=this.store.getState(ms),i=t.filter((t=>!e[t.peerId]));if(this.syncRoomState("peersJoined"),this.store.getState(Ps)){let e=[];for(let i of t){let t=this.store.getState(Ro(i.peerId));t&&e.push(t)}this.hmsNotifications.sendPeerList(e)}else i.forEach((e=>{let t=this.store.getState(Ro(e.peerId));t&&this.hmsNotifications.sendPeerUpdate(0,t)}));return}this.sendPeerUpdateNotification(e,t)}}onTrackUpdate(e,t,i){if(1===e)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,i);else if([0,1].includes(e)){let i=na[e];this.syncRoomState(i),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}else{let i=na[e]||"trackUpdate",n=wa.convertTrack(t);this.setState((e=>{let t=e.tracks[n.id];ya(t,n)&&(ma(t,n),Object.assign(t,n))}),i),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}onMessageReceived(e){let t=wa.convertMessage(e,this.store.getState(Rs));t.read=!1,t.ignored=this.ignoredMessageTypes.includes(t.type),"hms_transcript"===t.type&&(t.ignored=!0),this.putMessageInStore(t),this.hmsNotifications.sendMessageReceived(t)}putMessageInStore(e){e.ignored||this.actionBatcher.setState((t=>{t.messages.byID[e.id]=e,t.messages.allIDs.push(e.id)}),"newMessage",150)}onAudioLevelUpdate(e){this.setState((t=>{let i={};e.forEach((e=>{if(!e.track||!e.peer)return;let n=e.track.trackId;i[n]=e.audioLevel,t.speakers[n]||(t.speakers[n]={audioLevel:e.audioLevel,peerID:e.peer.peerId,trackID:n})}));let n=Object.entries(t.speakers);for(let[e,r]of n)r.audioLevel=i[e]||0,0===r.audioLevel&&delete t.speakers[e]}),"audioLevel")}onConnectionQualityUpdate(e){this.setState((t=>{e.forEach((e=>{let i=e.peerID;i&&(t.connectionQualities[i]?Object.assign(t.connectionQualities[i],e):t.connectionQualities[i]=e)}))}),"connectionQuality")}onChangeTrackStateRequest(e){var t;let i=this.store.getState(Ro(null==(t=e.requestedBy)?void 0:t.peerId)),n=this.getStoreLocalTrackIDfromSDKTrack(e.track),r=this.store.getState(Do(n));if(!r)return this.logPossibleInconsistency(`Not found track for which track state change was requested, ${e.track}`);e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:i||void 0,track:r,enabled:e.enabled})}onChangeMultiTrackStateRequest(e){var t;let i=this.store.getState(Ro(null==(t=e.requestedBy)?void 0:t.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");let n=[],r=this.store.getState(ks);for(let s of e.tracks){let e=this.getStoreLocalTrackIDfromSDKTrack(s);e&&r[e]&&n.push(r[e])}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:i||void 0,tracks:n,enabled:e.enabled,type:e.type,source:e.source})}onReconnected(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState((e=>{e.room.roomState=e.room.isConnected?"Connected":"Preview"}),"reconnected")}onReconnecting(e){let t=wa.convertException(e);mo.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState((e=>{e.room.roomState="Reconnecting",e.errors.push(t)}),"reconnecting")}onError(e){let t=wa.convertException(e);t.isTerminal?(this.leave().then((()=>mo.e("error from SDK, left room."))),this.setState((e=>{e.room.roomState="Failed",e.errors.push(t)}),"errorTerminal")):this.store.getState().errors.length<50&&this.setState((e=>{e.errors.push(t)}),"error"),this.syncRoomState("errorSync"),this.hmsNotifications.sendError(t),mo.e("received error from sdk",t instanceof ji?`${t}`:t)}handleTrackRemove(e,t){this.setState((i=>{let n=i.peers[t.peerId],r=i.tracks,s=e.trackId;if(n)if(s===n.audioTrack)delete n.audioTrack;else if(s===n.videoTrack)delete n.videoTrack;else{let e=n.auxiliaryTracks.indexOf(s);e>-1&&n.auxiliaryTracks.splice(e,1)}delete r[s]}),"trackRemoved")}setEnabledSDKTrack(e,t){return Zt(this,null,(function*(){let i=this.getLocalTrack(e);i?yield i.setEnabled(t):this.logPossibleInconsistency(`track ${e} not present, unable to enabled/disable`)}))}setSDKLocalVideoTrackSettings(e,t){return Zt(this,null,(function*(){let i=this.getLocalTrack(e);i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)}))}setSDKLocalAudioTrackSettings(e,t){return Zt(this,null,(function*(){let i=this.getLocalTrack(e);i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)}))}getMediaSettings(e){var t;let i=this.store.getState(Ts),n=e.audioTrack,r=e.videoTrack;return{audioInputDeviceId:(null==n?void 0:n.settings.deviceId)||i.audioInputDeviceId,videoInputDeviceId:(null==r?void 0:r.settings.deviceId)||i.videoInputDeviceId,audioOutputDeviceId:null==(t=this.sdk.getAudioOutput().getDevice())?void 0:t.deviceId,audioMode:(null==n?void 0:n.settings.audioMode)||"voice"}}getPreviewFields(e){var t,i;if(!e.isInPreview())return;let n=wa.convertPeer(e);return{localPeer:n.id,audioTrack:n.audioTrack,videoTrack:n.videoTrack,asRole:(null==(t=e.asRole)?void 0:t.name)||(null==(i=e.role)?void 0:i.name)}}setTrackVolume(e,t){return Zt(this,null,(function*(){let i=this.getTrackById(t);i?i instanceof cn?(yield i.setVolume(e),this.setState((i=>{let n=i.tracks[t];n&&"audio"===n.type&&(n.volume=e)}),"trackVolume")):mo.w(`track ${t} is not an audio track`):this.logPossibleInconsistency(`track ${t} not present, unable to set volume`)}))}localAndVideoUnmuting(e){let t=this.store.getState(Is);if((null==t?void 0:t.videoTrack)!==e)return!1;let i=this.store.getState(Us),n=this.store.getState(Ns);return i&&!n}logPossibleInconsistency(e){mo.w("possible inconsistency detected - ",e)}addRemoveVideoPlugin(e,t,i){return Zt(this,null,(function*(){if(!e)return void mo.w("Invalid plugin received in store");let n=this.store.getState(Ds);if(n){let r=this.getLocalTrack(n);r?("add"===t?yield r.addPlugin(e,i):"remove"===t&&(yield r.removePlugin(e)),this.syncRoomState(`${t}VideoPlugin`)):this.logPossibleInconsistency(`track ${n} not present, unable to ${t} plugin`)}}))}addRemoveMediaStreamVideoPlugins(e,t){return Zt(this,null,(function*(){if(0===e.length)return void mo.w("Invalid plugin received in store");let i=this.store.getState(Ds);if(i){let n=this.getLocalTrack(i);n?("add"===t?yield n.addStreamPlugins(e):"remove"===t&&(yield n.removeStreamPlugins(e)),this.syncRoomState(`${t}MediaStreamPlugin`)):this.logPossibleInconsistency(`track ${i} not present, unable to ${t} plugin`)}}))}addRemoveAudioPlugin(e,t){return Zt(this,null,(function*(){try{if(!e)return void mo.w("Invalid plugin received in store");let i=this.store.getState(Ls);if(i){let n=this.getLocalTrack(i);n?("add"===t?yield n.addPlugin(e):"remove"===t&&(yield n.removePlugin(e)),this.syncRoomState(`${t}AudioPlugin`)):this.logPossibleInconsistency(`track ${i} not present, unable to ${t} plugin`)}}catch(T){console.error(T)}}))}onRoleChangeRequest(e){this.setState((t=>{0===t.roleChangeRequests.length&&t.roleChangeRequests.push(wa.convertRoleChangeRequest(e))}),"roleChangeRequest")}removeRoleChangeRequest(e){this.setState((t=>{let i=t.roleChangeRequests.findIndex((t=>t.token===e.token));-1!==i&&t.roleChangeRequests.splice(i,1)}),"removeRoleChangeRequest")}onRoleUpdate(){this.syncRoomState("roleUpdate")}getStoreLocalTrackIDfromSDKTrack(e){return this.store.getState(Ms).find((t=>{var i;return(null==(i=this.getTrackById(t))?void 0:i.trackId)===e.trackId}))}updateMidCallPreviewRoomState(e,t){t.isLocal&&8===e&&this.store.getState(Hs)&&this.setState((e=>{e.room.roomState="Connected"}),"midCallPreviewCompleted")}setSessionStoreValueLocally(e,t="setSessionStore"){let i=Array.isArray(e)?e:[e];this.setState((e=>{i.forEach((t=>{e.sessionStore[t.key]=t.value}))}),t)}hasActiveElements(e){let t=Object.keys(this.store.getState().whiteboards).length>0,i=Object.keys(this.store.getState().polls).length>0,n=Object.keys(this.store.getState().peers).length>0,r=e.getState().remoteTrackStats;return n&&(t||i||Object.values(r).some((e=>e&&"number"==typeof e.bitrate&&e.bitrate>0)))}},$a=e=>_i?`${e} ${document.title}`:e,Va=class{constructor(e,t){this.eventBus=e,this.listener=t,this.TAG="[NetworkTestManager]",this.controller=new AbortController,this.start=e=>Zt(this,null,(function*(){var t;if(!e)return;let{url:i,timeout:n,scoreMap:r}=e,s=this.controller.signal,o=Date.now(),a=0,l=Hn(n).then((()=>{this.controller.abort()}));try{let e=null==(t=(yield fetch(`${i}?${Date.now()}`,{signal:s})).body)?void 0:t.getReader();if(!e)throw Error("unable to process request");let n=()=>Zt(this,null,(function*(){if(e)try{let t=!1;for(;!t;){let{value:i,done:n}=yield e.read();t=n,i&&(a+=i.byteLength,this.sendScore({scoreMap:r,downloadedSize:a,startTime:o}))}}catch(et){"AbortError"!==et.name&&bi.d(this.TAG,et)}}));return Promise.race([n(),l]).then((()=>{this.sendScore({scoreMap:r,downloadedSize:a,startTime:o,finished:!0})})).catch((e=>{bi.d(this.TAG,e),this.updateScoreToListener(0),this.eventBus.analytics.publish(on.previewNetworkQuality({error:e.message}))}))}catch(qe){"AbortError"!==qe.name?(bi.d(this.TAG,qe),this.updateScoreToListener(0),this.eventBus.analytics.publish(on.previewNetworkQuality({error:qe.message}))):bi.d(this.TAG,qe)}})),this.stop=()=>{this.controller.signal.aborted||this.controller.abort()},this.sendScore=({scoreMap:e,downloadedSize:t,startTime:i,finished:n=!1})=>{let r=(Date.now()-i)/1e3,s=t/1024/r*8,o=-1;for(let a in e){let t=e[a];s>=t.low&&(!t.high||s<=t.high)&&(o=Number(a))}this.updateScoreToListener(o),n&&this.eventBus.analytics.publish(on.previewNetworkQuality({score:o,downLink:s.toFixed(2)}))}}updateScoreToListener(e){var t,i;e!==this.score&&(this.score=e,null==(i=null==(t=this.listener)?void 0:t.onNetworkQuality)||i.call(t,e))}},Wa=class{constructor(e,t,i,n,r,s){this.store=e,this.transport=t,this.deviceManager=i,this.publish=n,this.removeAuxiliaryTrack=r,this.listener=s,this.handleLocalPeerRoleUpdate=e=>Zt(this,[e],(function*({oldRole:e,newRole:t}){var i;let n=this.store.getLocalPeer();n&&(yield this.diffRolesAndPublishTracks({oldRole:e,newRole:t}),null==(i=this.listener)||i.onPeerUpdate(8,n))})),this.diffRolesAndPublishTracks=e=>Zt(this,[e],(function*({oldRole:e,newRole:t}){var i,n,r,s,o,a;let l=new Set(e.publishParams.allowed),c=new Set(t.publishParams.allowed),u=this.removeTrack(l,c,"video"),d=this.removeTrack(l,c,"audio"),h=this.removeTrack(l,c,"screen"),p=this.hasSimulcastDifference(null==(i=e.publishParams.simulcast)?void 0:i.video,null==(n=t.publishParams.simulcast)?void 0:n.video),f=this.hasSimulcastDifference(null==(r=e.publishParams.simulcast)?void 0:r.screen,null==(s=t.publishParams.simulcast)?void 0:s.screen),v=null==(a=null==(o=this.store.getLocalPeer())?void 0:o.videoTrack)?void 0:a.enabled;yield this.removeAudioTrack(d),yield this.removeVideoTracks(u||p),yield this.removeScreenTracks(h||f);let g=this.getSettings();p&&(g.isVideoMuted=!v),yield this.publish(g),yield this.syncDevices(g,t)}))}syncDevices(e,t){return Zt(this,null,(function*(){(!e.isAudioMuted||!e.isVideoMuted)&&t.publishParams.allowed.length>0&&(yield this.deviceManager.init(!0))}))}removeVideoTracks(e){return Zt(this,null,(function*(){var t;if(!e)return;let i=this.store.getLocalPeer();null!=i&&i.videoTrack&&(i.videoTrack.isPublished?yield this.transport.unpublish([i.videoTrack]):yield i.videoTrack.cleanup(),null==(t=this.listener)||t.onTrackUpdate(1,i.videoTrack,i),i.videoTrack=void 0),yield this.removeAuxTracks((e=>"screen"!==e.source&&"video"===e.type))}))}removeAudioTrack(e){return Zt(this,null,(function*(){var t;if(!e)return;let i=this.store.getLocalPeer();null!=i&&i.audioTrack&&(i.audioTrack.isPublished?yield this.transport.unpublish([i.audioTrack]):yield i.audioTrack.cleanup(),null==(t=this.listener)||t.onTrackUpdate(1,i.audioTrack,i),i.audioTrack=void 0),yield this.removeAuxTracks((e=>"screen"!==e.source&&"audio"===e.type))}))}removeScreenTracks(e){return Zt(this,null,(function*(){e&&(yield this.removeAuxTracks((e=>"screen"===e.source)))}))}removeAuxTracks(e){return Zt(this,null,(function*(){let t=this.store.getLocalPeer();if(null!=t&&t.auxiliaryTracks){let i=[...t.auxiliaryTracks];for(let t of i)e(t)&&(yield this.removeAuxiliaryTrack(t.trackId))}}))}removeTrack(e,t,i){return e.has(i)&&!t.has(i)}hasSimulcastDifference(e,t){var i,n,r;return!(!e&&!t)&&((null==(i=null==e?void 0:e.layers)?void 0:i.length)!==(null==(n=null==t?void 0:t.layers)?void 0:n.length)||!(null==(r=null==e?void 0:e.layers)||!r.some((e=>{var i;let n=null==(i=null==t?void 0:t.layers)?void 0:i.find((t=>t.rid===e.rid));return(null==n?void 0:n.maxBitrate)!==e.maxBitrate||(null==n?void 0:n.maxFramerate)!==e.maxFramerate}))))}getSettings(){let{isAudioMuted:e,isVideoMuted:t}=this.getMutedStatus(),{audioInputDeviceId:i,audioOutputDeviceId:n}=this.getAudioDeviceSettings(),r=this.getVideoInputDeviceId();return{isAudioMuted:e,isVideoMuted:t,audioInputDeviceId:i,audioOutputDeviceId:n,videoDeviceId:r}}getMutedStatus(){var e,t,i;let n=null==(e=this.store.getConfig())?void 0:e.settings;return{isAudioMuted:null==(t=null==n?void 0:n.isAudioMuted)||t,isVideoMuted:null==(i=null==n?void 0:n.isVideoMuted)||i}}getAudioDeviceSettings(){var e,t,i;let n=null==(e=this.store.getConfig())?void 0:e.settings,r=(null==(t=this.deviceManager.currentSelection.audioInput)?void 0:t.deviceId)||(null==n?void 0:n.audioInputDeviceId)||"default",s=(null==(i=this.deviceManager.currentSelection.audioOutput)?void 0:i.deviceId)||(null==n?void 0:n.audioOutputDeviceId)||"default";return{audioInputDeviceId:r,audioOutputDeviceId:s}}getVideoInputDeviceId(){var e,t;let i=null==(e=this.store.getConfig())?void 0:e.settings;return(null==(t=this.deviceManager.currentSelection.videoInput)?void 0:t.deviceId)||(null==i?void 0:i.videoDeviceId)||"default"}},Ha=class{constructor(){this.TAG="[HTTPAnalyticsTransport]",this.failedEvents=new zi("client-events"),this.isConnected=!0,this.env=null,this.websocketURL=""}setEnv(e){this.env=e,this.flushFailedEvents()}setWebsocketEndpoint(e){this.websocketURL=e}sendEvent(e){if(!this.env)return void this.addEventToStorage(e);let t={event:e.name,payload:e.properties,event_id:String(e.timestamp),peer:e.metadata.peer,timestamp:e.timestamp,device_id:e.device_id,cluster:{websocket_url:this.websocketURL}},i="prod"===this.env?Rr:Lr;fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.metadata.token}`,user_agent_v2:e.metadata.userAgent},body:JSON.stringify(t)}).then((t=>{if(401!==t.status){if(200!==t.status)throw Error(t.statusText);this.removeFromStorage(e)}else this.removeFromStorage(e)})).catch((t=>{bi.v(this.TAG,"Failed to send event",t,e),this.addEventToStorage(e)}))}flushFailedEvents(){let e=this.failedEvents.get();null==e||e.forEach((e=>this.sendEvent(e)))}addEventToStorage(e){let t=this.failedEvents.get()||[];t.find((t=>t.timestamp===e.timestamp))||(100===t.length&&t.shift(),t.push(e),this.failedEvents.set(t))}removeFromStorage(e){let t=this.failedEvents.get()||[],i=t.findIndex((t=>t.timestamp===e.timestamp));i>-1&&(t.splice(i,1),this.failedEvents.set(t))}},qa=new Ha,za=class{constructor(e){this.type=e.type,this.source=e.source||"regular",this.description="",e instanceof ln?(this.mute=!e.enabled,this.track_id=e.publishedTrackId,this.stream_id=e.stream.id):(this.mute=e.mute,this.track_id=e.track_id,this.stream_id=e.stream_id)}},Ka=class{constructor(){this.TAG="[Store]:",this.knownRoles={},this.peers={},this.tracks=new Map,this.peerTrackStates={},this.speakers=[],this.roleDetailsArrived=!1,this.env="prod",this.simulcastEnabled=!1,this.userAgent=tn(this.env),this.polls=new Map,this.whiteboards=new Map,this.addPermissionToRole=(e,t,i,n)=>{var r;if(!this.knownRoles[e])return void bi.d(this.TAG,`role ${e} is not present in given roles`,this.knownRoles);let s=this.knownRoles[e].permissions;"transcriptions"===t&&n?s[t]=Kt(zt({},s[t]),{[n]:[i]}):"whiteboard"===t&&(s[t]||(s[t]=[]),null==(r=s[t])||r.push(i))},this.addWhiteboardPluginToRole=e=>{var t,i,n;let r=null==e?void 0:e.permissions;null==(t=null==r?void 0:r.admin)||t.forEach((e=>this.addPermissionToRole(e,"whiteboard","admin"))),null==(i=null==r?void 0:r.reader)||i.forEach((e=>this.addPermissionToRole(e,"whiteboard","read"))),null==(n=null==r?void 0:r.writer)||n.forEach((e=>this.addPermissionToRole(e,"whiteboard","write")))},this.addTranscriptionsPluginToRole=(e=[])=>{var t,i;for(let n of e)null==(i=null==(t=n.permissions)?void 0:t.admin)||i.forEach((e=>this.addPermissionToRole(e,"transcriptions","admin",n.mode)))},this.handleNoiseCancellationPlugin=e=>{this.room&&(this.room.isNoiseCancellationEnabled=!(null==e||!e.enabled)&&!!this.room.isNoiseCancellationEnabled)}}getConfig(){return this.config}setSimulcastEnabled(e){this.simulcastEnabled=e}removeRemoteTracks(){this.tracks.forEach((e=>{(e instanceof ir||e instanceof Gr)&&(this.removeTrack(e),delete this.peerTrackStates[e.trackId])}))}getEnv(){return this.env}getPublishParams(){let e=this.getLocalPeer(),t=(null==e?void 0:e.asRole)||(null==e?void 0:e.role);return null==t?void 0:t.publishParams}getRoom(){return this.room}getPolicyForRole(e){return this.knownRoles[e]}getKnownRoles(){return this.knownRoles}getTemplateAppData(){return this.templateAppData}getLocalPeer(){if(this.localPeerId&&this.peers[this.localPeerId])return this.peers[this.localPeerId]}getRemotePeers(){return Object.values(this.peers).filter((e=>!e.isLocal))}getPeers(){return Object.values(this.peers)}getPeerMap(){return this.peers}getPeerById(e){if(this.peers[e])return this.peers[e]}getTracksMap(){return this.tracks}getTracks(){return Array.from(this.tracks.values())}getVideoTracks(){return this.getTracks().filter((e=>"video"===e.type))}getRemoteVideoTracks(){return this.getTracks().filter((e=>e instanceof Gr))}getAudioTracks(){return this.getTracks().filter((e=>"audio"===e.type))}getPeerTracks(e){let t=e?this.peers[e]:void 0,i=[];return null!=t&&t.videoTrack&&i.push(t.videoTrack),null!=t&&t.audioTrack&&i.push(t.audioTrack),i.concat((null==t?void 0:t.auxiliaryTracks)||[])}getLocalPeerTracks(){return this.getPeerTracks(this.localPeerId)}hasTrack(e){return this.tracks.has(e)}getTrackById(e){var t,i;let n=Array.from(this.tracks.values()).find((t=>t.trackId===e));if(n)return n;let r=this.getLocalPeer();if(r){if(null!=(t=r.audioTrack)&&t.isPublishedTrackId(e))return r.audioTrack;if(null!=(i=r.videoTrack)&&i.isPublishedTrackId(e))return r.videoTrack}}getPeerByTrackId(e){let t=Array.from(this.tracks.values()).find((t=>t.trackId===e));return null!=t&&t.peerId?this.peers[t.peerId]:void 0}getSpeakers(){return this.speakers}getSpeakerPeers(){return this.speakers.map((e=>e.peer))}getUserAgent(){return this.userAgent}createAndSetUserAgent(e){this.userAgent=tn(this.env,e)}setRoom(e){this.room=e}setKnownRoles(e){var t,i;if(this.knownRoles=e.known_roles,this.addPluginsToRoles(e.plugins),this.roleDetailsArrived=!0,this.templateAppData=e.app_data,!this.simulcastEnabled)return;let n=null==(t=this.knownRoles[e.name])?void 0:t.publishParams;this.videoLayers=this.convertSimulcastLayers(null==(i=n.simulcast)?void 0:i.video),this.updatePeersPolicy()}hasRoleDetailsArrived(){return this.roleDetailsArrived}setConfig(e){var t,i,n;if(dn.rememberDevices(!!e.rememberDeviceSelection),e.rememberDeviceSelection){let r=dn.getSelection();r&&(e.settings||(e.settings={}),null!=(t=r.audioInput)&&t.deviceId&&(e.settings.audioInputDeviceId=e.settings.audioInputDeviceId||r.audioInput.deviceId),null!=(i=r.audioOutput)&&i.deviceId&&(e.settings.audioOutputDeviceId=e.settings.audioOutputDeviceId||r.audioOutput.deviceId),null!=(n=r.videoInput)&&n.deviceId&&(e.settings.videoDeviceId=e.settings.videoDeviceId||r.videoInput.deviceId))}e.autoManageVideo=!1!==e.autoManageVideo,e.autoManageWakeLock=!1!==e.autoManageWakeLock,this.config=e,this.setEnv()}addPeer(e){this.peers[e.peerId]=e,e.isLocal&&(this.localPeerId=e.peerId)}addTrack(e){this.tracks.set(e,e)}getTrackState(e){return this.peerTrackStates[e]}setTrackState(e){this.peerTrackStates[e.trackInfo.track_id]=e}removeTrackState(e){delete this.peerTrackStates[e]}removePeer(e){this.localPeerId===e&&(this.localPeerId=void 0),delete this.peers[e]}removeTrack(e){this.tracks.delete(e)}updateSpeakers(e){this.speakers=e}updateAudioOutputVolume(e){return Zt(this,null,(function*(){for(let t of this.getAudioTracks())yield t.setVolume(e)}))}updateAudioOutputDevice(e){return Zt(this,null,(function*(){let t=[];this.getAudioTracks().forEach((i=>{i instanceof ir&&t.push(i.setOutputDevice(e))})),yield Promise.all(t)}))}getSimulcastLayers(e){var t;return this.simulcastEnabled&&["screen","regular"].includes(e)?"screen"===e?[]:(null==(t=this.videoLayers)?void 0:t.layers)||[]:[]}convertSimulcastLayers(e){if(e)return Kt(zt({},e),{layers:(e.layers||[]).map((e=>Kt(zt({},e),{maxBitrate:1e3*e.maxBitrate})))})}getSimulcastDefinitionsForPeer(e,t){var i,n,r;if([!e||!e.role,"screen"===t,!this.simulcastEnabled].some((e=>!!e)))return[];let s,o,a,l=this.getPolicyForRole(e.role.name).publishParams;return"regular"===t?(s=null==(i=l.simulcast)?void 0:i.video,o=l.video.width,a=l.video.height):"screen"===t&&(s=null==(n=l.simulcast)?void 0:n.screen,o=l.screen.width,a=l.screen.height),(null==(r=null==s?void 0:s.layers)?void 0:r.map((e=>{let t=wn[e.rid],i={width:Math.floor(o/e.scaleResolutionDownBy),height:Math.floor(a/e.scaleResolutionDownBy)};return{layer:t,resolution:i}})))||[]}setPoll(e){this.polls.set(e.id,e)}getPoll(e){return this.polls.get(e)}setWhiteboard(e){this.whiteboards.set(e.id,e)}getWhiteboards(){return this.whiteboards}getWhiteboard(e){return e?this.whiteboards.get(e):this.whiteboards.values().next().value}getErrorListener(){return this.errorListener}cleanup(){let e=this.getTracks();for(let t of e)t.cleanup();this.room=void 0,this.config=void 0,this.localPeerId=void 0,this.roleDetailsArrived=!1}setErrorListener(e){this.errorListener=e}updatePeersPolicy(){this.getPeers().forEach((e=>{var t;e.role?e.role=this.getPolicyForRole(e.role.name):null==(t=this.errorListener)||t.onError(Wi.GenericErrors.InvalidRole("VALIDATION",""))}))}addPluginsToRoles(e){e&&Object.keys(e).forEach((t=>{let i=t;switch(i){case"whiteboard":this.addWhiteboardPluginToRole(e[i]);break;case"transcriptions":this.addTranscriptionsPluginToRole(e[i]);break;case"noiseCancellation":this.handleNoiseCancellationPlugin(e[i]);break;default:break}}))}setEnv(){var e;let t=(null==(e=this.config)?void 0:e.initEndpoint).split("https://")[1],i="prod";t.startsWith("prod")?i="prod":t.startsWith("qa")?i="qa":t.startsWith("dev")&&(i="dev"),this.env=i,qa.setEnv(i)}},Ja=class{constructor(){this.TAG="[WakeLockManager]",this.wakeLock=null,this.acquireLock=()=>Zt(this,null,(function*(){yield this.requestWakeLock(),null==document||document.addEventListener("visibilitychange",this.visibilityHandler)})),this.cleanup=()=>Zt(this,null,(function*(){if(this.wakeLock&&!this.wakeLock.released)try{yield this.wakeLock.release(),bi.d(this.TAG,"Wake lock released")}catch(e){let t=e;bi.w(this.TAG,"Error while releasing wake lock",`name=${t.name}, message=${t.message}`)}null==document||document.removeEventListener("visibilitychange",this.visibilityHandler),this.wakeLock=null})),this.visibilityHandler=()=>Zt(this,null,(function*(){"visible"===(null==document?void 0:document.visibilityState)&&(!this.wakeLock||this.wakeLock.released)&&(bi.d(this.TAG,"Re-acquiring wake lock due to visibility change"),yield this.requestWakeLock())})),this.requestWakeLock=()=>Zt(this,null,(function*(){try{if(!("wakeLock"in navigator))return void bi.d(this.TAG,"Wake lock feature not supported");this.wakeLock=yield navigator.wakeLock.request("screen"),bi.d(this.TAG,"Wake lock acquired")}catch(e){let t=e;bi.w(this.TAG,"Error acquiring wake lock",`name=${t.name}, message=${t.message}`)}}))}},Qa=class{constructor(e){this.store=e,this.bufferSize=100,this.TAG="[AnalyticsEventsService]",this.transport=null,this.pendingEvents=[],this.level=1}setTransport(e){this.transport=e}reset(){this.transport=null,this.pendingEvents=[]}queue(e){if(e.level>=this.level&&(this.pendingEvents.push(e),this.pendingEvents.length>this.bufferSize)){let e=this.pendingEvents.shift();bi.d(this.TAG,"Max buffer size reached","Removed event to accommodate new events",e)}return this}flushFailedClientEvents(){qa.flushFailedEvents()}flush(){var e;try{for(;this.pendingEvents.length>0;){let t=this.pendingEvents.shift();t&&(t.metadata.peer.peer_id=null==(e=this.store.getLocalPeer())?void 0:e.peerId,t.metadata.userAgent=this.store.getUserAgent(),this.transport&&this.transport.transportProvider.isConnected?this.transport.sendEvent(t):this.sendClientEventOnHTTP(t))}}catch(Ue){bi.w(this.TAG,"Flush Failed",Ue)}}sendClientEventOnHTTP(e){var t,i,n,r;let s=this.store.getRoom(),o=this.store.getLocalPeer();e.metadata.token=null==(t=this.store.getConfig())?void 0:t.authToken,e.metadata.peer={session_id:null==s?void 0:s.sessionId,room_id:null==s?void 0:s.id,room_name:null==s?void 0:s.name,template_id:null==s?void 0:s.templateId,joined_at:null==(i=null==s?void 0:s.joinedAt)?void 0:i.getTime(),session_started_at:null==(n=null==s?void 0:s.startedAt)?void 0:n.getTime(),role:null==(r=null==o?void 0:o.role)?void 0:r.name,user_name:null==o?void 0:o.name,user_data:null==o?void 0:o.metadata,peer_id:null==o?void 0:o.peerId},qa.sendEvent(e)}},Ya={autoplayFailed:void 0,initialized:!1,autoplayCheckPromise:void 0},Za=class{constructor(e,t,i){this.store=e,this.deviceManager=t,this.eventBus=i,this.autoPausedTracks=new Set,this.TAG="[AudioSinkManager]:",this.volume=100,this.state=zt({},Ya),this.handleAudioPaused=e=>Zt(this,null,(function*(){bi.d(this.TAG,"Audio Paused",e.target.id);let t=this.store.getTrackById(e.target.id);t&&this.autoPausedTracks.add(t)})),this.handleTrackUpdate=({track:e})=>{bi.d(this.TAG,"Track updated",`${e}`)},this.handleTrackAdd=e=>Zt(this,[e],(function*({track:e,peer:t,callListener:i=!0}){var n,r;let s=document.createElement("audio");s.style.display="none",s.id=e.trackId,s.addEventListener("pause",this.handleAudioPaused),s.onerror=()=>Zt(this,null,(function*(){var i,n;bi.e(this.TAG,"error on audio element",s.error);let r=Wi.TracksErrors.AudioPlaybackError(`Audio playback error for track - ${e.trackId} code - ${null==(i=null==s?void 0:s.error)?void 0:i.code}`);this.eventBus.analytics.publish(on.audioPlaybackError(r)),(null==(n=null==s?void 0:s.error)?void 0:n.code)===MediaError.MEDIA_ERR_DECODE&&(this.removeAudioElement(s,e),yield Hn(500),yield this.handleTrackAdd({track:e,peer:t,callListener:!1}),this.state.autoplayFailed||this.eventBus.analytics.publish(on.audioRecovered("Audio recovered after media decode error")))})),e.setAudioElement(s),yield e.setVolume(this.volume),bi.d(this.TAG,"Audio track added",`${e}`),this.init(),null==(n=this.audioSink)||n.append(s),this.outputDevice&&(yield e.setOutputDevice(this.outputDevice)),s.srcObject=new MediaStream([e.nativeTrack]),i&&(null==(r=this.listener)||r.onTrackUpdate(0,e,t)),yield this.handleAutoplayError(e)})),this.handleAutoplayError=e=>Zt(this,null,(function*(){void 0===this.state.autoplayFailed&&(this.state.autoplayCheckPromise||(this.state.autoplayCheckPromise=new Promise((t=>{this.playAudioFor(e).then(t)}))),yield this.state.autoplayCheckPromise),this.state.autoplayFailed?this.autoPausedTracks.add(e):yield this.playAudioFor(e)})),this.handleAudioDeviceChange=e=>Zt(this,null,(function*(){e.isUserSelection||e.error||!e.selection||"video"===e.type||(yield this.unpauseAudioTracks())})),this.handleTrackRemove=e=>{this.autoPausedTracks.delete(e);let t=document.getElementById(e.trackId);t&&this.removeAudioElement(t,e),this.audioSink&&0===this.audioSink.childElementCount&&(this.state.autoplayCheckPromise=void 0,this.state.autoplayFailed=void 0),bi.d(this.TAG,"Audio track removed",`${e}`)},this.unpauseAudioTracks=()=>Zt(this,null,(function*(){let e=[];this.autoPausedTracks.forEach((t=>{e.push(this.playAudioFor(t))})),yield Promise.all(e)})),this.removeAudioElement=(e,t)=>{e&&(bi.d(this.TAG,"removing audio element",`${t}`),e.removeEventListener("pause",this.handleAudioPaused),e.srcObject=null,e.remove(),t.setAudioElement(null))},this.eventBus.audioTrackAdded.subscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.subscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.subscribe(this.handleTrackUpdate),this.eventBus.deviceChange.subscribe(this.handleAudioDeviceChange),this.eventBus.localVideoUnmutedNatively.subscribe(this.unpauseAudioTracks),this.eventBus.localAudioUnmutedNatively.subscribe(this.unpauseAudioTracks)}setListener(e){this.listener=e}get outputDevice(){return this.deviceManager.outputDevice}getVolume(){return this.volume}setVolume(e){return Zt(this,null,(function*(){yield this.store.updateAudioOutputVolume(e),this.volume=e}))}unblockAutoplay(){return Zt(this,null,(function*(){this.autoPausedTracks.size>0&&(yield this.unpauseAudioTracks()),yield Bn.resumeContext()}))}init(e){if(this.state.initialized||this.audioSink)return;this.state.initialized=!0;let t=document.createElement("div");t.id=`HMS-SDK-audio-sink-${P()}`,(e&&document.getElementById(e)||document.body).append(t),this.audioSink=t,bi.d(this.TAG,"audio sink created",this.audioSink)}cleanup(){var e;null==(e=this.audioSink)||e.remove(),this.audioSink=void 0,this.eventBus.audioTrackAdded.unsubscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.unsubscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.unsubscribe(this.handleTrackUpdate),this.eventBus.deviceChange.unsubscribe(this.handleAudioDeviceChange),this.eventBus.localVideoUnmutedNatively.unsubscribe(this.unpauseAudioTracks),this.eventBus.localAudioUnmutedNatively.unsubscribe(this.unpauseAudioTracks),this.autoPausedTracks=new Set,this.state=zt({},Ya)}playAudioFor(e){return Zt(this,null,(function*(){let t=e.getAudioElement();if(t)try{yield t.play(),this.state.autoplayFailed=!1,this.autoPausedTracks.delete(e),bi.d(this.TAG,"Played track",`${e}`)}catch(T){this.autoPausedTracks.add(e),bi.w(this.TAG,"Failed to play track",`${e}`,T);let i=T;if(!this.state.autoplayFailed&&"NotAllowedError"===i.name){this.state.autoplayFailed=!0;let e=Wi.TracksErrors.AutoplayBlocked("AUTOPLAY","");e.addNativeError(i),this.eventBus.analytics.publish(on.autoplayError()),this.eventBus.autoplayError.publish(e)}}else bi.w(this.TAG,"No audio element found on track",e.trackId)}))}},Xa=class{constructor(e){this.eventBus=e,this.pluginUsage=new Map,this.pluginLastAddedAt=new Map,this.getPluginUsage=e=>{if(this.pluginUsage.has(e)||this.pluginUsage.set(e,0),this.pluginLastAddedAt.has(e)){let t=this.pluginLastAddedAt.get(e)||0,i=t?Date.now()-t:0;this.pluginUsage.set(e,(this.pluginUsage.get(e)||0)+i),this.pluginLastAddedAt.delete(e)}return this.pluginUsage.get(e)},this.updatePluginUsageData=e=>{var t;let i=(null==(t=e.properties)?void 0:t.plugin_name)||"";switch(e.name){case"mediaPlugin.toggled.on":case"mediaPlugin.added":{let t=e.properties.added_at||Date.now();this.pluginLastAddedAt.set(i,t);break}case"mediaPlugin.toggled.off":case"mediaPlugin.stats":if(this.pluginLastAddedAt.has(i)){let t=e.properties.duration||(Date.now()-(this.pluginLastAddedAt.get(i)||0))/1e3;this.pluginUsage.set(i,(this.pluginUsage.get(i)||0)+1e3*Math.max(t,0)),this.pluginLastAddedAt.delete(i)}break;default:}},this.cleanup=()=>{this.pluginLastAddedAt.clear(),this.pluginUsage.clear()},this.eventBus.analytics.subscribe((e=>this.updatePluginUsageData(e)))}},el=class{constructor(e,t){this.store=e,this.eventBus=t,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.hasWebcamPermission=!1,this.hasMicrophonePermission=!1,this.currentSelection={audioInput:void 0,videoInput:void 0,audioOutput:void 0},this.TAG="[Device Manager]:",this.initialized=!1,this.videoInputChanged=!1,this.audioInputChanged=!1,this.earpieceSelected=!1,this.timer=null,this.updateOutputDevice=(e,t)=>Zt(this,null,(function*(){let i=this.audioOutput.find((t=>t.deviceId===e));return i&&(this.outputDevice=i,yield this.store.updateAudioOutputDevice(i),this.eventBus.analytics.publish(on.deviceChange({isUserSelection:t,selection:{audioOutput:i},devices:this.getDevices(),type:"audioOutput"})),dn.updateSelection("audioOutput",{deviceId:i.deviceId,groupId:i.groupId})),i})),this.getCurrentSelection=()=>{var e,t;let i=this.store.getLocalPeer(),n=this.createIdentifier(null==(e=null==i?void 0:i.audioTrack)?void 0:e.getMediaTrackSettings()),r=this.createIdentifier(null==(t=null==i?void 0:i.videoTrack)?void 0:t.getMediaTrackSettings()),s=this.audioInput.find((e=>this.createIdentifier(e)===n)),o=this.videoInput.find((e=>this.createIdentifier(e)===r));return{audioInput:s,videoInput:o,audioOutput:this.outputDevice}},this.computeChange=(e,t)=>e.length!==t.length||t.some((t=>!e.includes(this.createIdentifier(t)))),this.enumerateDevices=()=>Zt(this,null,(function*(){try{let e=yield navigator.mediaDevices.enumerateDevices(),t=this.videoInput.map(this.createIdentifier),i=this.audioInput.map(this.createIdentifier);this.audioInput=[],this.audioOutput=[],this.videoInput=[],e.forEach((e=>{"audioinput"===e.kind&&e.label?(this.hasMicrophonePermission=!0,this.audioInput.push(e)):"audiooutput"===e.kind?this.audioOutput.push(e):"videoinput"===e.kind&&e.label&&(this.hasWebcamPermission=!0,this.videoInput.push(e))})),this.videoInputChanged=this.computeChange(t,this.videoInput),this.audioInputChanged=this.computeChange(i,this.audioInput),dn.setDevices({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput]}),this.logDevices("Enumerate Devices")}catch(e){bi.e(this.TAG,"Failed enumerating devices",e)}})),this.updateToActualDefaultDevice=()=>Zt(this,null,(function*(){var e,t,i,n,r;let s=this.store.getLocalPeer();if(!(null==(t=null==(e=this.store.getConfig())?void 0:e.settings)?void 0:t.videoDeviceId)&&null!=s&&s.videoTrack&&(yield s.videoTrack.setSettings({deviceId:null==(i=this.videoInput[0])?void 0:i.deviceId},!0)),!(null==(r=null==(n=this.store.getConfig())?void 0:n.settings)?void 0:r.audioInputDeviceId)&&null!=s&&s.audioTrack){let e=()=>{var e;let t=this.audioInput.find((e=>!e.label.toLowerCase().includes("iphone")));return Di()&&t?null==t?void 0:t.deviceId:null==(e=this.getNewAudioInputDevice())?void 0:e.deviceId};e()&&(yield s.audioTrack.setSettings({deviceId:e()},!0))}})),this.handleDeviceChange=Kn((()=>Zt(this,null,(function*(){yield this.enumerateDevices(),this.logDevices("After Device Change");let e=this.store.getLocalPeer();yield this.setOutputDevice(!0),yield this.handleAudioInputDeviceChange(null==e?void 0:e.audioTrack),yield this.handleVideoInputDeviceChange(null==e?void 0:e.videoTrack),this.eventBus.analytics.publish(on.deviceChange({selection:this.getCurrentSelection(),type:"change",devices:this.getDevices()}))}))),500).bind(this),this.handleAudioInputDeviceChange=e=>Zt(this,null,(function*(){if(!e)return void bi.d(this.TAG,"No Audio track on local peer");if(!this.audioInputChanged)return void bi.d(this.TAG,"No Change in AudioInput Device");let t=this.getNewAudioInputDevice();if(!t||!t.deviceId)return this.eventBus.analytics.publish(on.deviceChange({selection:{audioInput:t},error:Wi.TracksErrors.SelectedDeviceMissing("audio"),devices:this.getDevices(),type:"audioInput"})),void bi.e(this.TAG,"Audio device not found");let{settings:i}=e,n=(new Cn).codec(i.codec).maxBitrate(i.maxBitrate).deviceId(t.deviceId).audioMode(i.audioMode).build();try{yield e.setSettings(n,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:t,type:"audioInput"}),this.logDevices("Audio Device Change Success")}catch(We){bi.e(this.TAG,"[Audio Device Change]",We),this.eventBus.analytics.publish(on.deviceChange({selection:{audioInput:t},devices:this.getDevices(),type:"audioInput",error:We})),this.eventBus.deviceChange.publish({error:We,selection:t,type:"audioInput",devices:this.getDevices()})}})),this.handleVideoInputDeviceChange=e=>Zt(this,null,(function*(){if(!e)return void bi.d(this.TAG,"No video track on local peer");if(!this.videoInputChanged)return void bi.d(this.TAG,"No Change in VideoInput Device");let t=this.videoInput[0];if(!t||!t.deviceId)return this.eventBus.analytics.publish(on.deviceChange({selection:{videoInput:t},error:Wi.TracksErrors.SelectedDeviceMissing("video"),devices:this.getDevices(),type:"video"})),void bi.e(this.TAG,"Video device not found");let{settings:i}=e,n=(new An).codec(i.codec).maxBitrate(i.maxBitrate).maxFramerate(i.maxFramerate).setWidth(i.width).setHeight(i.height).deviceId(t.deviceId).build();try{yield e.setSettings(n,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:t,type:"video"}),this.logDevices("Video Device Change Success")}catch(We){bi.e(this.TAG,"[Video Device Change]",We),this.eventBus.analytics.publish(on.deviceChange({selection:{videoInput:t},devices:this.getDevices(),type:"video",error:We})),this.eventBus.deviceChange.publish({error:We,type:"video",selection:t,devices:this.getDevices()})}})),this.startPollingForDevices=()=>{"ondevicechange"in navigator.mediaDevices||(this.timer=setTimeout((()=>{Zt(this,null,(function*(){yield this.enumerateDevices(),yield this.autoSelectAudioOutput(),this.startPollingForDevices()}))}),5e3))},this.autoSelectAudioOutput=()=>Zt(this,null,(function*(){var e,t;if("ondevicechange"in navigator.mediaDevices||null==(e=this.store.getLocalPeer())||!e.joinedAt)return;let{bluetoothDevice:i,earpiece:n,speakerPhone:r,wired:s}=this.categorizeAudioInputDevices(),o=null==(t=this.store.getLocalPeer())?void 0:t.audioTrack;if(!o||!n)return;let a=this.getManuallySelectedAudioDevice(),l=(null==a?void 0:a.deviceId)||(null==i?void 0:i.deviceId)||(null==s?void 0:s.deviceId)||(null==r?void 0:r.deviceId);if(bi.d(this.TAG,"externalDeviceID",l),o.settings.deviceId!==l||!this.earpieceSelected)try{if(!this.earpieceSelected){if((null==i?void 0:i.deviceId)===l)return void(this.earpieceSelected=!0);yield o.setSettings({deviceId:null==n?void 0:n.deviceId},!0),this.earpieceSelected=!0}yield o.setSettings({deviceId:l},!0)}catch(qe){this.eventBus.error.publish(qe)}}));let i=({enabled:e,track:t})=>e&&"regular"===t.source;this.eventBus.localVideoEnabled.waitFor(i).then((()=>Zt(this,null,(function*(){yield this.enumerateDevices(),this.videoInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()})})))),this.eventBus.localAudioEnabled.waitFor(i).then((()=>Zt(this,null,(function*(){yield this.enumerateDevices(),this.audioInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()})})))),this.eventBus.deviceChange.subscribe((({type:e,isUserSelection:t,selection:i})=>{if(t){let n="video"===e?"videoInput":e,r=this[n].find((e=>this.createIdentifier(e)===this.createIdentifier(i)));this.eventBus.analytics.publish(on.deviceChange({selection:{[n]:r},devices:this.getDevices(),type:e,isUserSelection:t}))}}))}init(e=!1,t=!0){return Zt(this,null,(function*(){this.initialized&&!e||(!this.initialized&&navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),this.initialized=!0,yield this.enumerateDevices(),e||(yield this.updateToActualDefaultDevice(),this.startPollingForDevices()),this.logDevices("Init"),yield this.setOutputDevice(),this.eventBus.deviceChange.publish({devices:this.getDevices()}),t&&this.eventBus.analytics.publish(on.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()})))}))}getDevices(){return{audioInput:this.audioInput,audioOutput:this.audioOutput,videoInput:this.videoInput}}cleanup(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.initialized=!1,this.earpieceSelected=!1,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.outputDevice=void 0,navigator.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange)}createIdentifier(e){return e?`${e.deviceId}${e.groupId}`:""}getNewAudioInputDevice(){var e,t;let i=this.getManuallySelectedAudioDevice();if(i)return i;null==(t=null==(e=this.store.getLocalPeer())?void 0:e.audioTrack)||t.resetManuallySelectedDeviceId();let n=this.audioInput.find((e=>"default"===e.deviceId));return n?this.audioInput.find((e=>"default"!==e.deviceId&&n.label.includes(e.label))):this.audioInput[0]}setOutputDevice(e=!1){return Zt(this,null,(function*(){let t=this.getNewAudioInputDevice(),i=this.createIdentifier(this.outputDevice);this.outputDevice=this.getAudioOutputDeviceMatchingInput(t),this.outputDevice||(this.outputDevice=this.audioOutput.find((e=>this.createIdentifier(e)===i)),this.outputDevice||(this.outputDevice=this.audioOutput.find((e=>"default"===e.deviceId))||this.audioOutput[0])),yield this.store.updateAudioOutputDevice(this.outputDevice),e&&i!==this.createIdentifier(this.outputDevice)&&(this.eventBus.analytics.publish(on.deviceChange({selection:{audioOutput:this.outputDevice},devices:this.getDevices(),type:"audioOutput"})),this.eventBus.deviceChange.publish({selection:this.outputDevice,type:"audioOutput",devices:this.getDevices()}))}))}getManuallySelectedAudioDevice(){let e=this.store.getLocalPeer(),t=null==e?void 0:e.audioTrack;return this.audioInput.find((e=>e.deviceId===(null==t?void 0:t.getManuallySelectedDeviceId())))}categorizeAudioInputDevices(){let e=null,t=null,i=null,n=null;for(let r of this.audioInput){let s=$n(r.label);"SPEAKERPHONE"===s?t=r:"WIRED"===s?i=r:"BLUETOOTH"===s?e=r:"EARPIECE"===s&&(n=r)}return{bluetoothDevice:e,speakerPhone:t,wired:i,earpiece:n}}getAudioOutputDeviceMatchingInput(e){var t,i;let n=(null==(i=null==(t=this.store.getConfig())?void 0:t.settings)?void 0:i.speakerAutoSelectionBlacklist)||[];if("all"===n||!e)return;let r=e.label.toLowerCase()||"";if(n.some((e=>r.includes(e.toLowerCase()))))return;let s=this.audioOutput.find((t=>"default"!==e.deviceId&&t.label===e.label));if(s)return s;let o=this.audioOutput.find((t=>t.groupId===e.groupId));return o&&"default"===this.audioOutput[0].deviceId&&o.groupId===this.audioOutput[0].groupId?o:void 0}logDevices(e=""){bi.d(this.TAG,e,JSON.stringify({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput],selected:this.getCurrentSelection()},null,4))}},tl=class{constructor(e,t){this.deviceManager=e,this.audioSinkManager=t}getVolume(){return this.audioSinkManager.getVolume()}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.audioSinkManager.setVolume(e)}getDevice(){return this.deviceManager.outputDevice}setDevice(e){return this.deviceManager.updateOutputDevice(e,!0)}unblockAutoplay(){return Zt(this,null,(function*(){yield this.audioSinkManager.unblockAutoplay(),yield Bn.resumeContext()}))}},il=class{static handleError(e){if(404===e.status)throw Wi.APIErrors.EndpointUnreachable("FEEDBACK",e.statusText);if(e.status>=400)throw Wi.APIErrors.ServerErrors(e.status,"FEEDBACK",null==e?void 0:e.statusText)}static sendFeedback(e){return Zt(this,arguments,(function*({token:e,eventEndpoint:t="https://event.100ms.live",info:i,feedback:n}){bi.d(this.TAG,`sendFeedback: feedbackEndpoint=${t} peerId=${i.peer.peer_id} session=${i.peer.session_id} `);let r=new URL("v2/client/feedback",t),s=Kt(zt({},i),{payload:n});try{let t=yield fetch(r,{headers:{Authorization:`Bearer ${e}`},body:JSON.stringify(s),method:"POST"});try{return void this.handleError(t)}catch(Be){throw bi.e(this.TAG,"error",Be.message,t.status),Be instanceof ji?Be:Wi.APIErrors.ServerErrors(t.status,"FEEDBACK",Be.message)}}catch(Ke){let t=Ke;throw["Failed to fetch","NetworkError","ECONNRESET"].some((e=>t.message.includes(e)))?Wi.APIErrors.EndpointUnreachable("FEEDBACK",t.message):t}}))}};il.TAG="[FeedbackService]";var nl=class{constructor(e,t){this.eventName=e,this.eventEmitter=t,this.publish=e=>{this.eventEmitter.emit(this.eventName,e)},this.subscribe=e=>{this.eventEmitter.on(this.eventName,e)},this.subscribeOnce=e=>{this.eventEmitter.once(this.eventName,e)},this.unsubscribe=e=>{this.eventEmitter.off(this.eventName,e)},this.waitFor=e=>this.eventEmitter.waitFor(this.eventName,{filter:e}),this.removeAllListeners=()=>{this.eventEmitter.removeAllListeners(this.eventName)}}},rl=class{constructor(){this.eventEmitter=new Oe.EventEmitter2,this.analytics=new nl(Or.ANALYTICS,this.eventEmitter),this.deviceChange=new nl(Or.DEVICE_CHANGE,this.eventEmitter),this.localAudioEnabled=new nl(Or.LOCAL_AUDIO_ENABLED,this.eventEmitter),this.localVideoEnabled=new nl(Or.LOCAL_VIDEO_ENABLED,this.eventEmitter),this.localVideoUnmutedNatively=new nl(Or.LOCAL_VIDEO_UNMUTED_NATIVELY,this.eventEmitter),this.localAudioUnmutedNatively=new nl(Or.LOCAL_AUDIO_UNMUTED_NATIVELY,this.eventEmitter),this.statsUpdate=new nl(Or.STATS_UPDATE,this.eventEmitter),this.trackDegraded=new nl(Or.TRACK_DEGRADED,this.eventEmitter),this.trackRestored=new nl(Or.TRACK_RESTORED,this.eventEmitter),this.trackAudioLevelUpdate=new nl(Or.TRACK_AUDIO_LEVEL_UPDATE,this.eventEmitter),this.audioPluginFailed=new nl(Or.AUDIO_PLUGIN_FAILED,this.eventEmitter),this.localAudioSilence=new nl(Or.LOCAL_AUDIO_SILENCE,this.eventEmitter),this.policyChange=new nl(Or.POLICY_CHANGE,this.eventEmitter),this.localRoleUpdate=new nl(Or.LOCAL_ROLE_UPDATE,this.eventEmitter),this.audioTrackUpdate=new nl(Or.AUDIO_TRACK_UPDATE,this.eventEmitter),this.audioTrackAdded=new nl(Or.AUDIO_TRACK_ADDED,this.eventEmitter),this.audioTrackRemoved=new nl(Or.AUDIO_TRACK_REMOVED,this.eventEmitter),this.autoplayError=new nl(Or.AUTOPLAY_ERROR,this.eventEmitter),this.leave=new nl(Or.LEAVE,this.eventEmitter),this.error=new nl(Or.ERROR,this.eventEmitter)}},sl=class{constructor(e,t,i){this.store=e,this.listener=t,this.audioListener=i}handleActiveSpeakers(e){var t,i,n;let r=e["speaker-list"],s=r.map((e=>({audioLevel:e.level,peer:this.store.getPeerById(e.peer_id),track:this.store.getTrackById(e.track_id)})));null==(t=this.audioListener)||t.onAudioLevelUpdate(s),this.store.updateSpeakers(s);let o=r[0];if(o){let e=this.store.getPeerById(o.peer_id);null==(i=this.listener)||i.onPeerUpdate(4,e)}else null==(n=this.listener)||n.onPeerUpdate(5,null)}},ol=class{constructor(e){this.listener=e,this.TAG="[BroadcastManager]"}handleNotification(e,t){"on-broadcast"===e&&this.handleBroadcast(t)}handleBroadcast(e){var t,i;bi.d(this.TAG,`Received Message from sender=${null==(t=null==e?void 0:e.peer)?void 0:t.peer_id}: ${e}`),null==(i=this.listener)||i.onMessageReceived(e)}},al=class{constructor(e,t){this.store=e,this.listener=t}handleQualityUpdate(e){var t;let i=e.peers.map((e=>{let t=this.store.getPeerById(e.peer_id);return t&&t.updateNetworkQuality(e.downlink_score),{peerID:e.peer_id,downlinkQuality:e.downlink_score}}));null==(t=this.listener)||t.onConnectionQualityUpdate(i)}},ll=class{constructor(e,t,i){this.store=e,this.eventBus=t,this.listener=i,this.TAG="[TrackManager]",this.tracksToProcess=new Map,this.handleTrackAdd=e=>{bi.d(this.TAG,"ONTRACKADD",`${e}`),this.tracksToProcess.set(e.trackId,e),this.processPendingTracks()},this.handleTrackRemovedPermanently=e=>{bi.d(this.TAG,"ONTRACKREMOVE permanently",e),Object.keys(e.tracks).forEach((e=>{var t;let i=this.store.getTrackState(e);if(!i)return;let n=this.store.getTrackById(e);if(!n)return void bi.d(this.TAG,"Track not found in store");"audio"===n.type&&this.eventBus.audioTrackRemoved.publish(n),this.store.removeTrack(n);let r=this.store.getPeerById(i.peerId);r&&(this.removePeerTracks(r,n),null==(t=this.listener)||t.onTrackUpdate(1,n,r))}))},this.handleTrackLayerUpdate=e=>{for(let t in e.tracks){let i=e.tracks[t],n=this.store.getTrackById(t);!n||!this.store.getPeerByTrackId(t)||n instanceof Gr&&this.setLayer(n,i)}},this.handleTrackUpdate=(e,t=!0)=>{var i,n;let r=this.store.getPeerById(e.peer.peer_id),s=e.peer;if(r||s){r||(r=as(s,this.store),this.store.addPeer(r));for(let s in e.tracks){let o=Object.assign({},null==(i=this.store.getTrackState(s))?void 0:i.trackInfo),a=e.tracks[s],l=this.store.getTrackById(s);if(this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:zt(zt({},o),a)}),!l||this.tracksToProcess.has(s))this.processTrackInfo(a,e.peer.peer_id,t),this.processPendingTracks();else{l.setEnabled(!a.mute);let e=this.processTrackUpdate(l,o,a);e&&(null==(n=this.listener)||n.onTrackUpdate(e,l,r))}}}else bi.d(this.TAG,"Track Update ignored - Peer not added to store")},this.processTrackInfo=(e,t,i)=>{},this.processPendingTracks=()=>{new Map(this.tracksToProcess).forEach((e=>{var t;let i=this.store.getTrackState(e.trackId);if(!i)return void bi.d(this.TAG,"TrackState not added to store",`peerId - ${e.peerId}`,`trackId -${e.trackId}`);let n=this.store.getPeerById(i.peerId);n?(e.source=i.trackInfo.source,e.peerId=n.peerId,e.logIdentifier=n.name,e.setEnabled(!i.trackInfo.mute),this.addAudioTrack(n,e),this.addVideoTrack(n,e),"audio"===e.type?this.eventBus.audioTrackAdded.publish({track:e,peer:n}):null==(t=this.listener)||t.onTrackUpdate(0,e,n),this.tracksToProcess.delete(e.trackId)):bi.d(this.TAG,"Peer not added to store, peerId",i.peerId)}))}}handleTrackMetadataAdd(e){bi.d(this.TAG,"TRACK_METADATA_ADD",JSON.stringify(e,null,2));for(let t in e.tracks){let i=e.tracks[t];this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:i})}this.processPendingTracks()}handleTrackRemove(e,t=!0){var i;bi.d(this.TAG,"ONTRACKREMOVE",`${e}`);let n=this.store.getTrackState(e.trackId);if(n)if(this.store.hasTrack(e)){if(t){this.store.removeTrack(e);let t=this.store.getPeerById(n.peerId);if(!t)return;this.removePeerTracks(t,e),null==(i=this.listener)||i.onTrackUpdate(1,e,t),"audio"===e.type&&this.eventBus.audioTrackRemoved.publish(e)}}else bi.d(this.TAG,"Track not found in store")}setLayer(e,t){var i,n;let r=this.store.getPeerByTrackId(e.trackId);r&&(e.setLayerFromServer(t)?null==(i=this.listener)||i.onTrackUpdate(5,e,r):null==(n=this.listener)||n.onTrackUpdate(6,e,r))}removePeerTracks(e,t){let i=e.auxiliaryTracks.indexOf(t);i>-1?(e.auxiliaryTracks.splice(i,1),bi.d(this.TAG,"auxiliary track removed",`${t}`)):"audio"===t.type&&e.audioTrack===t?(e.audioTrack=void 0,bi.d(this.TAG,"audio track removed",`${t}`)):"video"===t.type&&e.videoTrack===t&&(e.videoTrack=void 0,bi.d(this.TAG,"video track removed",`${t}`))}addAudioTrack(e,t){var i;"audio"===t.type&&("regular"!==t.source||e.audioTrack&&(null==(i=e.audioTrack)?void 0:i.trackId)!==t.trackId?e.auxiliaryTracks.push(t):e.audioTrack=t,this.store.addTrack(t),bi.d(this.TAG,"audio track added",`${t}`))}addVideoTrack(e,t){if("video"!==t.type)return;let i=t,n=this.store.getSimulcastDefinitionsForPeer(e,i.source);if(i.setSimulcastDefinitons(n),this.addAsPrimaryVideoTrack(e,i))e.videoTrack?e.videoTrack.replaceTrack(i):e.videoTrack=i,this.store.addTrack(e.videoTrack);else{let t=e.auxiliaryTracks.findIndex((e=>e.trackId===i.trackId));-1===t?(e.auxiliaryTracks.push(i),this.store.addTrack(i)):(e.auxiliaryTracks[t].replaceTrack(i),this.store.addTrack(e.auxiliaryTracks[t]))}bi.d(this.TAG,"video track added",`${t}`)}addAsPrimaryVideoTrack(e,t){var i;return"regular"===t.source&&(!e.videoTrack||(null==(i=e.videoTrack)?void 0:i.trackId)===t.trackId)}processTrackUpdate(e,t,i){let n;return t.mute!==i.mute?(n=i.mute?2:3,"audio"===e.type&&this.eventBus.audioTrackUpdate.publish({track:e,enabled:!i.mute})):t.description!==i.description&&(n=4),n}},cl=class extends ll{constructor(e,t,i,n){super(e,t,n),this.transport=i,this.TAG="[OnDemandTrackManager]",this.processTrackInfo=(e,t,i=!0)=>{var n,r;if("video"!==e.type)return;let s=this.store.getPeerById(t);if(!s||!this.isPeerRoleSubscribed(t))return void bi.d(this.TAG,`no peer in store for peerId: ${t}`);let o=new Wr(new MediaStream,this.transport.getSubscribeConnection()),a=Er.getEmptyVideoTrack();a.enabled=!e.mute;let l=new Gr(o,a,e.source,null==(n=this.store.getRoom())?void 0:n.disableNoneLayerRequest);l.setTrackId(e.track_id),l.peerId=s.peerId,l.logIdentifier=s.name,this.addVideoTrack(s,l),i&&(null==(r=this.listener)||r.onTrackUpdate(0,s.videoTrack,s))}}handleTrackMetadataAdd(e){super.handleTrackMetadataAdd(e);for(let t in e.tracks)"video"===e.tracks[t].type&&this.processTrackInfo(e.tracks[t],e.peer.peer_id)}handleTrackRemove(e){let t="video"===e.type&&"regular"===e.source;super.handleTrackRemove(e,!t),t&&this.processTrackInfo({track_id:e.trackId,mute:!e.enabled,type:e.type,source:e.source,stream_id:e.stream.id},e.peerId,!1)}addAsPrimaryVideoTrack(e,t){return"regular"===t.source&&(!e.videoTrack||e.videoTrack.trackId===t.trackId||e.videoTrack.enabled&&Fn(e.videoTrack.nativeTrack))}isPeerRoleSubscribed(e){var t,i,n,r;if(!e)return!0;let s=this.store.getLocalPeer(),o=this.store.getPeerById(e);return o&&(null==(r=null==(i=null==(t=null==s?void 0:s.role)?void 0:t.subscribeParams)?void 0:i.subscribeToRoles)?void 0:r.includes(null==(n=o.role)?void 0:n.name))}},ul=class{constructor(e,t,i,n){this.store=e,this.peerManager=t,this.trackManager=i,this.listener=n,this.TAG="[PeerListManager]",this.handleInitialPeerList=e=>{let t=Object.values(e.peers);this.peerManager.handlePeerList(t)},this.handleReconnectPeerList=e=>{this.handleRepeatedPeerList(e.peers)},this.handlePreviewRoomState=e=>{if(!this.store.hasRoleDetailsArrived())return;let t=e.peers;null!=t?(Object.keys(t).forEach((e=>{t[e].tracks={},t[e].is_from_room_state=!0})),this.handleRepeatedPeerList(t)):0===e.peer_count&&this.handleRepeatedPeerList({})},this.handleRepeatedPeerList=e=>{let t=this.store.getRemotePeers(),i=Object.values(e),n=t.filter((t=>!e[t.peerId]));n.length>0&&bi.d(this.TAG,`${n}`),n.forEach((e=>{var t;let i={peer_id:e.peerId,role:(null==(t=e.role)?void 0:t.name)||"",info:{name:e.name,data:e.metadata||"",user_id:e.customerUserId||"",type:e.type},tracks:{},groups:[],realtime:e.realtime};this.peerManager.handlePeerLeave(i)}));let r=[];i.forEach((e=>{let t=this.store.getPeerById(e.peer_id),i=Object.values(e.tracks);t&&(this.store.getPeerTracks(t.peerId).forEach((i=>{var n;e.tracks[i.trackId]||(this.removePeerTrack(t,i.trackId),null==(n=this.listener)||n.onTrackUpdate(1,i,t))})),i.forEach((e=>{this.store.getTrackById(e.track_id)||this.store.setTrackState({peerId:t.peerId,trackInfo:e})})),this.trackManager.handleTrackUpdate({peer:e,tracks:e.tracks},!1),this.peerManager.handlePeerUpdate(e)),r.push(e)})),r.length>0&&this.peerManager.handlePeerList(r)}}handleNotification(e,t,i){if("peer-list"===e){let e=t;i?(bi.d(this.TAG,"RECONNECT_PEER_LIST event",JSON.stringify(e,null,2)),this.handleReconnectPeerList(e)):(bi.d(this.TAG,"PEER_LIST event",JSON.stringify(e,null,2)),this.handleInitialPeerList(e))}else if("room-state"===e){let e=t;this.handlePreviewRoomState(e)}}removePeerTrack(e,t){var i,n;if(bi.d(this.TAG,`removing track - ${t} from ${e}`),(null==(i=e.audioTrack)?void 0:i.trackId)===t)e.audioTrack=void 0;else if((null==(n=e.videoTrack)?void 0:n.trackId)===t)e.videoTrack=void 0;else{let i=e.auxiliaryTracks.findIndex((e=>e.trackId===t));i>=0&&e.auxiliaryTracks.splice(i,1)}}},dl=e=>e?new Date(e):void 0,hl=class{constructor(e,t,i){this.store=e,this.trackManager=t,this.listener=i,this.TAG="[PeerManager]",this.handlePeerList=e=>{var t,i;if(0===e.length)return void(null==(t=this.listener)||t.onPeerUpdate(9,[]));let n=[],r=new Set(e.map((e=>e.peer_id)));this.store.getRemotePeers().forEach((({peerId:e,fromRoomState:t})=>{!r.has(e)&&t&&this.store.removePeer(e)}));for(let s of e)n.push(this.makePeer(s));null==(i=this.listener)||i.onPeerUpdate(9,n),this.trackManager.processPendingTracks()},this.handlePeerJoin=e=>{var t;let i=this.makePeer(e);null==(t=this.listener)||t.onPeerUpdate(0,i),this.trackManager.processPendingTracks()},this.handlePeerLeave=e=>{var t,i,n,r;let s=this.store.getPeerById(e.peer_id);this.store.removePeer(e.peer_id),bi.d(this.TAG,"PEER_LEAVE",e.peer_id,`remainingPeers=${this.store.getPeers().length}`),s&&(s.audioTrack&&(null==(t=this.listener)||t.onTrackUpdate(1,s.audioTrack,s)),s.videoTrack&&(null==(i=this.listener)||i.onTrackUpdate(1,s.videoTrack,s)),null==(n=s.auxiliaryTracks)||n.forEach((e=>{var t;null==(t=this.listener)||t.onTrackUpdate(1,e,s)})),null==(r=this.listener)||r.onPeerUpdate(1,s))}}handleNotification(e,t){switch(e){case"on-peer-join":{let e=t;this.handlePeerJoin(e);break}case"on-peer-leave":{let e=t;this.handlePeerLeave(e);break}case"on-peer-update":this.handlePeerUpdate(t);break;default:break}}handlePeerUpdate(e){var t,i,n,r,s;let o=this.store.getPeerById(e.peer_id);if(!o&&e.realtime)return o=this.makePeer(e),void(null==(t=this.listener)||t.onPeerUpdate(o.isHandRaised?12:14,o));if(o&&!o.isLocal&&!e.realtime)return this.store.removePeer(o.peerId),void(null==(i=this.listener)||i.onPeerUpdate(13,o));if(!o)return void bi.d(this.TAG,`peer ${e.peer_id} not found`);if(o.role&&o.role.name!==e.role){let t=this.store.getPolicyForRole(e.role);o.updateRole(t),this.updateSimulcastLayersForPeer(o),null==(n=this.listener)||n.onPeerUpdate(8,o)}let a=o.isHandRaised;o.updateGroups(e.groups);let l=null==(r=e.groups)?void 0:r.includes(Nr);a!==l&&(null==(s=this.listener)||s.onPeerUpdate(12,o)),this.handlePeerInfoUpdate(zt({peer:o},e.info))}handlePeerInfoUpdate({peer:e,name:t,data:i}){var n,r;e&&(t&&e.name!==t&&(e.updateName(t),null==(n=this.listener)||n.onPeerUpdate(10,e)),i&&e.metadata!==i&&(e.updateMetadata(i),null==(r=this.listener)||r.onPeerUpdate(11,e)))}makePeer(e){let t=this.store.getPeerById(e.peer_id);t||(t=as(e,this.store),t.realtime=e.realtime,t.joinedAt=dl(e.joined_at),t.fromRoomState=!!e.is_from_room_state,this.store.addPeer(t),bi.d(this.TAG,"adding to the peerList",`${t}`));for(let i in e.tracks){let t=e.tracks[i];this.store.setTrackState({peerId:e.peer_id,trackInfo:t}),"video"===t.type&&this.trackManager.processTrackInfo(t,e.peer_id,!1)}return t}updateSimulcastLayersForPeer(e){this.store.getPeerTracks(e.peerId).forEach((t=>{if("video"===t.type&&["regular","screen"].includes(t.source)){let i=t,n=this.store.getSimulcastDefinitionsForPeer(e,i.source);i.setSimulcastDefinitons(n)}}))}},pl=class{constructor(e,t){this.store=e,this.eventBus=t}handlePolicyChange(e){let t=this.store.getLocalPeer();if(t&&!t.role){let i=e.known_roles[e.name];t.updateRole(i)}this.store.setKnownRoles(e);let i=this.store.getRoom();i?i.templateId=e.template_id:bi.w("[PolicyChangeManager]","on policy change - room not present"),this.updateLocalPeerRole(e),this.eventBus.policyChange.publish(e)}updateLocalPeerRole(e){var t;let i=this.store.getLocalPeer();if(null!=i&&i.role&&i.role.name!==e.name){let n=this.store.getPolicyForRole(e.name),r=i.role;i.updateRole(n),n.name===(null==(t=i.asRole)?void 0:t.name)&&delete i.asRole,this.eventBus.localRoleUpdate.publish({oldRole:r,newRole:n})}}},fl=(e=>(e.FLAG_SERVER_SUB_DEGRADATION="subscribeDegradation",e.FLAG_SERVER_SIMULCAST="simulcast",e.FLAG_NON_WEBRTC_DISABLE_OFFER="nonWebRTCDisableOffer",e.FLAG_PUBLISH_STATS="publishStats",e.FLAG_SUBSCRIBE_STATS="subscribeStats",e.FLAG_ON_DEMAND_TRACKS="onDemandTracks",e.FLAG_DISABLE_VIDEO_TRACK_AUTO_UNSUBSCRIBE="disableVideoTrackAutoUnsubscribe",e.FLAG_WHITEBOARD_ENABLED="whiteboardEnabled",e.FLAG_EFFECTS_SDK_ENABLED="effectsSDKEnabled",e.FLAG_VB_ENABLED="vb",e.FLAG_HIPAA_ENABLED="hipaa",e.FLAG_NOISE_CANCELLATION="noiseCancellation",e.FLAG_SCALE_SCREENSHARE_BASED_ON_PIXELS="scaleScreenshareBasedOnPixels",e.FLAG_DISABLE_NONE_LAYER_REQUEST="disableNoneLayerRequest",e))(fl||{}),vl=(e,t,i)=>{let n="qa"===i?Br:jr,r=new URL(n);return r.searchParams.set("endpoint",`https://${t}`),r.searchParams.set("token",e),r.toString()},gl=class{constructor(e,t,i){this.transport=e,this.store=t,this.listener=i,this.TAG="[HMSWhiteboardInteractivityCenter]"}get isEnabled(){return this.transport.isFlagEnabled("whiteboardEnabled")}open(e){return Zt(this,null,(function*(){var t;if(!this.isEnabled)return bi.w(this.TAG,"Whiteboard is not enabled for customer");let i=this.store.getWhiteboard(null==e?void 0:e.id),n=null==i?void 0:i.id;if(i||(n=(yield this.transport.signal.createWhiteboard(this.getCreateOptionsWithDefaults(e))).id),!n)throw new Error(`Whiteboard ID: ${n} not found`);let r=yield this.transport.signal.getWhiteboard({id:n}),s=Kt(zt({},i),{title:null==e?void 0:e.title,attributes:null==e?void 0:e.attributes,id:r.id,url:vl(r.token,r.addr,this.store.getEnv()),token:r.token,addr:r.addr,owner:r.owner,permissions:r.permissions||[],open:!0});this.store.setWhiteboard(s),null==(t=this.listener)||t.onWhiteboardUpdate(s)}))}close(e){return Zt(this,null,(function*(){var t;if(!this.isEnabled)return bi.w(this.TAG,"Whiteboard is not enabled for customer");let i=this.store.getWhiteboard(e);if(!i)throw new Error(`Whiteboard ID: ${e} not found`);let n={id:i.id,title:i.title,open:!1};this.store.setWhiteboard(n),null==(t=this.listener)||t.onWhiteboardUpdate(n)}))}setListener(e){this.listener=e}handleLocalRoleUpdate(){return Zt(this,null,(function*(){var e,t,i;let n=this.store.getWhiteboards();for(let r of n.values())if(r.url){let n=yield this.transport.signal.getWhiteboard({id:r.id}),s=this.store.getLocalPeer(),o=(null==s?void 0:s.customerUserId)===n.owner?null==(t=null==(e=s.role)?void 0:e.permissions.whiteboard)?void 0:t.includes("admin"):n.permissions.length>0,a=Kt(zt({},r),{id:n.id,url:vl(n.token,n.addr,this.store.getEnv()),token:n.token,addr:n.addr,owner:n.owner,permissions:n.permissions,open:o});this.store.setWhiteboard(a),null==(i=this.listener)||i.onWhiteboardUpdate(a)}}))}getCreateOptionsWithDefaults(e){var t;let i=Object.values(this.store.getKnownRoles()),n=[],r=[],s=[];return i.forEach((e=>{var t,i,o;null!=(t=e.permissions.whiteboard)&&t.includes("read")&&n.push(e.name),null!=(i=e.permissions.whiteboard)&&i.includes("write")&&r.push(e.name),null!=(o=e.permissions.whiteboard)&&o.includes("admin")&&s.push(e.name)})),{title:(null==e?void 0:e.title)||`${null==(t=this.store.getRoom())?void 0:t.id} Whiteboard`,reader:(null==e?void 0:e.reader)||n,writer:(null==e?void 0:e.writer)||r,admin:(null==e?void 0:e.admin)||s}}},ml=class{constructor(e,t,i){this.transport=e,this.store=t,this.listener=i,this.whiteboard=new gl(e,t,i)}setListener(e){this.listener=e,this.whiteboard.setListener(e)}createPoll(e){return Zt(this,null,(function*(){var t,i;let n={customerID:"userid",peerID:"peerid",userName:"username"},{poll_id:r}=yield this.transport.signal.setPollInfo(Kt(zt({},e),{mode:e.mode?n[e.mode]:void 0,poll_id:e.id,vote:e.rolesThatCanVote,responses:e.rolesThatCanViewResponses}));e.id||(e.id=r),Array.isArray(e.questions)&&(yield this.addQuestionsToPoll(e.id,e.questions));let s=yield this.transport.signal.getPollQuestions({poll_id:e.id,index:0,count:50}),o=yl(Kt(zt({},e),{poll_id:e.id,state:"created",created_by:null==(t=this.store.getLocalPeer())?void 0:t.peerId}));o.questions=s.questions.map((({question:e,options:t,answer:i})=>Kt(zt({},e),{options:t,answer:i}))),null==(i=this.listener)||i.onPollsUpdate(0,[o])}))}startPoll(e){return Zt(this,null,(function*(){"string"==typeof e?yield this.transport.signal.startPoll({poll_id:e}):(yield this.createPoll(e),yield this.transport.signal.startPoll({poll_id:e.id}))}))}addQuestionsToPoll(e,t){return Zt(this,null,(function*(){t.length>0&&(yield this.transport.signal.setPollQuestions({poll_id:e,questions:t.map(((e,t)=>this.createQuestionSetParams(e,t)))}))}))}stopPoll(e){return Zt(this,null,(function*(){yield this.transport.signal.stopPoll({poll_id:e})}))}addResponsesToPoll(e,t){return Zt(this,null,(function*(){let i=this.store.getPoll(e);if(!i)throw new Error("Invalid poll ID - Poll not found");let n=t.map((e=>{var t,n;let r=this.getQuestionInPoll(i,e.questionIndex);return"single-choice"===r.type?(e.option=e.option||(null==(t=e.options)?void 0:t[0])||-1,delete e.text,delete e.options):"multiple-choice"===r.type?(null==(n=e.options)||n.sort(),delete e.text,delete e.option):(delete e.option,delete e.options),e.skipped&&(delete e.option,delete e.options,delete e.text),zt({duration:0,type:r.type,question:e.questionIndex},e)}));yield this.transport.signal.setPollResponses({poll_id:e,responses:n})}))}fetchLeaderboard(e,t,i){return Zt(this,null,(function*(){var n,r;let s=this.store.getPoll(e);if(!s)throw new Error("Invalid poll ID - Poll not found");let o=null==(r=null==(n=this.store.getLocalPeer())?void 0:n.role)?void 0:r.permissions,a=!!(null!=o&&o.pollRead||null!=o&&o.pollWrite);if(s.anonymous||"stopped"!==s.state||!a)return{entries:[],hasNext:!1};let l=yield this.transport.signal.fetchPollLeaderboard({poll_id:s.id,count:i,offset:t}),c={avgScore:l.avg_score,avgTime:l.avg_time,votedUsers:l.voted_users,totalUsers:l.total_users,correctUsers:l.correct_users};return{entries:l.questions.map((e=>({position:e.position,totalResponses:e.total_responses,correctResponses:e.correct_responses,duration:e.duration,peer:e.peer,score:e.score}))),hasNext:!l.last,summary:c}}))}getPollResponses(e,t){return Zt(this,null,(function*(){var i,n;let r=yield this.transport.signal.getPollResponses({poll_id:e.id,index:0,count:50,self:t}),s=JSON.parse(JSON.stringify(e));null==(i=r.responses)||i.forEach((({response:i,peer:n,final:r})=>{var o,a;let l=null==(o=null==e?void 0:e.questions)?void 0:o.find((e=>e.index===i.question));if(l){let e={id:i.response_id,questionIndex:i.question,option:i.option,options:i.options,text:i.text,responseFinal:r,peer:{peerid:n.peerid,userHash:n.hash,userid:n.userid,username:n.username},skipped:i.skipped,type:i.type,update:i.update},o=l.responses&&!t?[...l.responses]:[];null!=(a=s.questions)&&a[i.question-1]&&(s.questions[i.question-1].responses=[...o,e])}})),this.store.setPoll(s),null==(n=this.listener)||n.onPollsUpdate(4,[s])}))}getPolls(){return Zt(this,null,(function*(){var e,t,i;let n=yield this.transport.signal.getPollsList({count:50,state:"started"}),r=[],s=null==(t=null==(e=this.store.getLocalPeer())?void 0:e.role)?void 0:t.permissions.pollWrite,o=[...n.polls];if(s){let e=yield this.transport.signal.getPollsList({count:50,state:"created"}),t=yield this.transport.signal.getPollsList({count:50,state:"stopped"});o=[...e.polls,...o,...t.polls]}for(let a of o){let e=yield this.transport.signal.getPollQuestions({poll_id:a.poll_id,index:0,count:50}),t=yl(a),i=this.store.getPoll(a.poll_id);t.questions=e.questions.map((({question:e,options:t,answer:n},r)=>{var s,o;return Kt(zt({},e),{options:t,answer:n,responses:null==(o=null==(s=null==i?void 0:i.questions)?void 0:s[r])?void 0:o.responses})})),r.push(t),this.store.setPoll(t)}return null==(i=this.listener)||i.onPollsUpdate(3,r),r}))}createQuestionSetParams(e,t){var i,n;if(e.index){let n=null==(i=e.options)?void 0:i.map(((e,t)=>Kt(zt({},e),{index:t+1})));return{question:Kt(zt({},e),{index:t+1}),options:n,answer:e.answer}}let r,s=Kt(zt({},e),{index:t+1}),o=e.answer||{hidden:!1};return Array.isArray(e.options)&&["single-choice","multiple-choice"].includes(e.type)?(r=null==(n=e.options)?void 0:n.map(((e,t)=>({index:t+1,text:e.text,weight:e.weight}))),"single-choice"===e.type?o.option=e.options.findIndex((e=>e.isCorrectAnswer))+1||void 0:o.options=e.options.map(((e,t)=>e.isCorrectAnswer?t+1:void 0)).filter((e=>!!e))):(null==o||delete o.options,null==o||delete o.option),{question:s,options:r,answer:o}}getQuestionInPoll(e,t){var i;let n=null==(i=null==e?void 0:e.questions)?void 0:i.find((e=>e.index===t));if(!n)throw new Error("Invalid question index - Question not found in poll");return n}},yl=e=>{let t={userid:"customerID",peerid:"peerID",username:"userName"};return{id:e.poll_id,title:e.title,startedBy:e.started_by,createdBy:e.created_by,anonymous:e.anonymous,type:e.type,duration:e.duration,locked:e.locked,mode:e.mode?t[e.mode]:void 0,visibility:e.visibility,rolesThatCanVote:e.vote||[],rolesThatCanViewResponses:e.responses||[],state:e.state,stoppedBy:e.stopped_by,startedAt:dl(e.started_at),stoppedAt:dl(e.stopped_at),createdAt:dl(e.created_at)}},bl=class{constructor(e,t,i){this.store=e,this.transport=t,this.listener=i}handleNotification(e,t){switch(e){case"on-poll-start":this.handlePollStart(t);break;case"on-poll-stop":this.handlePollStop(t);break;case"on-poll-stats":this.handlePollStats(t);break;default:break}}handlePollStart(e){return Zt(this,null,(function*(){var t,i;let n=[];for(let r of e.polls){let e=this.store.getPoll(r.poll_id);if(e&&"started"===e.state)return void(null==(t=this.listener)||t.onPollsUpdate(1,[e]));let i=yield this.transport.signal.getPollQuestions({poll_id:r.poll_id,index:0,count:50}),s=yl(r);s.questions=i.questions.map((({question:e,options:t,answer:i})=>Kt(zt({},e),{options:t,answer:i}))),yield this.updatePollResponses(s,!0),n.push(s),this.store.setPoll(s)}null==(i=this.listener)||i.onPollsUpdate(1,n)}))}handlePollStop(e){return Zt(this,null,(function*(){var t;let i=[];for(let n of e.polls){let e=this.store.getPoll(n.poll_id);if(e){e.state="stopped",e.stoppedAt=dl(n.stopped_at),e.stoppedBy=n.stopped_by;let t=yield this.transport.signal.getPollResult({poll_id:n.poll_id});this.updatePollResult(e,t),i.push(e)}}i.length>0&&(null==(t=this.listener)||t.onPollsUpdate(2,i))}))}handlePollStats(e){return Zt(this,null,(function*(){var t;let i=[];for(let n of e.polls){let e=this.store.getPoll(n.poll_id);if(!e)return;this.updatePollResult(e,n),i.push(e)}i.length>0&&(null==(t=this.listener)||t.onPollsUpdate(4,i))}))}updatePollResult(e,t){var i;e.result=zt({},e.result),e.result.totalUsers=t.user_count,e.result.maxUsers=t.max_user,e.result.totalResponses=t.total_response,null==(i=t.questions)||i.forEach((t=>{var i,n;let r=null==(i=e.questions)?void 0:i.find((e=>e.index===t.question));r&&(r.result=zt({},r.result),r.result.correctResponses=t.correct,r.result.skippedCount=t.skipped,r.result.totalResponses=t.total,null==(n=t.options)||n.forEach(((e,t)=>{var i;let n=null==(i=r.options)?void 0:i[t];n&&n.voteCount!==e&&(n.voteCount=e)})))}))}updatePollResponses(e,t){return Zt(this,null,(function*(){var i;null==(i=(yield this.transport.signal.getPollResponses({poll_id:e.id,index:0,count:50,self:t})).responses)||i.forEach((({response:t,peer:i,final:n})=>{var r;let s=null==(r=null==e?void 0:e.questions)?void 0:r.find((e=>e.index===t.question));if(!s)return;let o={id:t.response_id,questionIndex:t.question,option:t.option,options:t.options,text:t.text,responseFinal:n,peer:{peerid:i.peerid,userHash:i.hash,userid:i.userid,username:i.username},skipped:t.skipped,type:t.type,update:t.update};Array.isArray(s.responses)&&s.responses.length>0?s.responses.find((({id:e})=>e===o.id))||s.responses.push(o):s.responses=[o]}))}))}},kl=class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){switch(e){case"on-role-change-request":this.handleRoleChangeRequest(t);break;case"on-track-update-request":this.handleTrackUpdateRequest(t);break;case"on-change-track-mute-state-request":this.handleChangeTrackStateRequest(t);break;default:return}}handleRoleChangeRequest(e){var t;let i={requestedBy:e.requested_by?this.store.getPeerById(e.requested_by):void 0,role:this.store.getPolicyForRole(e.role),token:e.token};null==(t=this.listener)||t.onRoleChangeRequest(i)}handleTrackUpdateRequest(e){let{requested_by:t,track_id:i,mute:n}=e,r=t?this.store.getPeerById(t):void 0,s=this.store.getLocalPeerTracks().find((e=>e.publishedTrackId===i));if(!s)return;let o=()=>{var e;null==(e=this.listener)||e.onChangeTrackStateRequest({requestedBy:r,track:s,enabled:!n})};if(n){if(s.enabled===!n)return;s.setEnabled(!n).then(o)}else o()}handleChangeTrackStateRequest(e){var t;let{type:i,source:n,value:r,requested_by:s}=e,o=s?this.store.getPeerById(s):void 0,a=!r,l=this.getTracksToBeUpdated({type:i,source:n,enabled:a});if(0!==l.length)if(a)null==(t=this.listener)||t.onChangeMultiTrackStateRequest({requestedBy:o,tracks:l,type:i,source:n,enabled:!0});else{let e=[];for(let t of l)e.push(t.setEnabled(!1));Promise.all(e).then((()=>{var e;null==(e=this.listener)||e.onChangeMultiTrackStateRequest({requestedBy:o,tracks:l,enabled:!1})}))}}getTracksToBeUpdated({type:e,source:t,enabled:i}){let n=this.store.getLocalPeerTracks();return e&&(n=n.filter((t=>t.type===e))),t&&(n=n.filter((e=>e.source===t))),n.filter((e=>e.enabled!==i))}},Tl=class{constructor(e,t){this.store=e,this.listener=t,this.TAG="[RoomUpdateManager]"}handleNotification(e,t){switch(e){case"peer-list":this.onRoomState(t.room);break;case"on-rtmp-update":this.updateRTMPStatus(t);break;case"on-record-update":this.updateRecordingStatus(t);break;case"room-state":this.handlePreviewRoomState(t);break;case"room-info":this.handleRoomInfo(t);break;case"session-info":this.handleSessionInfo(t);break;case"on-hls-update":this.updateHLSStatus(t);break;case"on-transcription-update":this.handleTranscriptionStatus([t]);break;default:break}}handleRoomInfo(e){let t=this.store.getRoom();t?(t.description=e.description,t.large_room_optimization=e.large_room_optimization,t.max_size=e.max_size,t.name=e.name):bi.w(this.TAG,"on session info - room not present")}handleSessionInfo(e){var t;let i=this.store.getRoom();i?(i.sessionId=e.session_id,i.peerCount!==e.peer_count&&(i.peerCount=e.peer_count,null==(t=this.listener)||t.onRoomUpdate("ROOM_PEER_COUNT_UPDATED",i))):bi.w(this.TAG,"on session info - room not present")}handlePreviewRoomState(e){let{room:t}=e;this.onRoomState(t)}onRoomState(e){var t,i,n,r;let{recording:s,streaming:o,transcriptions:a,session_id:l,started_at:c,name:u}=e,d=this.store.getRoom();d?(d.name=u,d.rtmp.running=this.isStreamingRunning(null==(t=null==o?void 0:o.rtmp)?void 0:t.state),d.rtmp.startedAt=dl(null==(i=null==o?void 0:o.rtmp)?void 0:i.started_at),d.rtmp.state=null==(n=null==o?void 0:o.rtmp)?void 0:n.state,d.recording.server=this.getPeerListSFURecording(s),d.recording.browser=this.getPeerListBrowserRecording(s),d.recording.hls=this.getPeerListHLSRecording(s),d.hls=this.convertHls(null==o?void 0:o.hls),d.transcriptions=this.addTranscriptionDetail(a),d.sessionId=l,d.startedAt=dl(c),null==(r=this.listener)||r.onRoomUpdate("RECORDING_STATE_UPDATED",d)):bi.w(this.TAG,"on room state - room not present")}addTranscriptionDetail(e){return e?e.map((e=>({state:e.state,mode:e.mode,initialised_at:dl(e.initialised_at),started_at:dl(e.started_at),stopped_at:dl(e.stopped_at),updated_at:dl(e.updated_at),error:this.toSdkError(null==e?void 0:e.error)}))):[]}isRecordingRunning(e){return!!e&&!["none","paused","stopped","failed"].includes(e)}isStreamingRunning(e){return!!e&&!["none","stopped","failed"].includes(e)}initHLS(e){let t=this.store.getRoom(),i={running:!0,variants:[]};return t?(null!=e&&e.variants&&e.variants.forEach(((t,n)=>{var r,s,o;"initialised"!==t.state?i.variants.push({meetingURL:null==t?void 0:t.meetingURL,url:null==t?void 0:t.url,metadata:null==t?void 0:t.metadata,playlist_type:null==t?void 0:t.playlist_type,startedAt:dl(null==(r=null==e?void 0:e.variants)?void 0:r[n].started_at),initialisedAt:dl(null==(s=null==e?void 0:e.variants)?void 0:s[n].initialised_at),state:t.state,stream_type:null==t?void 0:t.stream_type}):i.variants.push({initialisedAt:dl(null==(o=null==e?void 0:e.variants)?void 0:o[n].initialised_at),url:""})})),i):(bi.w(this.TAG,"on hls - room not present"),i)}updateHLSStatus(e){var t;let i=this.store.getRoom(),n=!!(e.variants&&e.variants.length>0)&&e.variants.some((e=>this.isStreamingRunning(e.state)));i?(e.enabled=n,i.hls=this.convertHls(e),null==(t=this.listener)||t.onRoomUpdate("HLS_STREAMING_STATE_UPDATED",i)):bi.w(this.TAG,"on hls - room not present")}handleTranscriptionStatus(e){var t;let i=this.store.getRoom();i?(i.transcriptions=this.addTranscriptionDetail(e)||[],null==(t=this.listener)||t.onRoomUpdate("TRANSCRIPTION_STATE_UPDATED",i)):bi.w(this.TAG,"on transcription - room not present")}convertHls(e){var t;if(null!=e&&e.variants&&e.variants.length>0&&e.variants.some((e=>"initialised"===e.state)))return this.initHLS(e);let i={running:!(null==e||!e.enabled),variants:[],error:this.toSdkError(null==e?void 0:e.error)};return null==(t=null==e?void 0:e.variants)||t.forEach((e=>{i.variants.push({meetingURL:null==e?void 0:e.meeting_url,url:null==e?void 0:e.url,metadata:null==e?void 0:e.metadata,playlist_type:null==e?void 0:e.playlist_type,startedAt:dl(null==e?void 0:e.started_at),initialisedAt:dl(null==e?void 0:e.initialised_at),state:e.state,stream_type:null==e?void 0:e.stream_type})})),i}getHLSRecording(e){var t,i;let n={running:!1},r=this.isRecordingRunning(null==e?void 0:e.state);return(r||"paused"===(null==e?void 0:e.state))&&(n={running:r,singleFilePerLayer:!(null==(t=null==e?void 0:e.hls_recording)||!t.single_file_per_layer),hlsVod:!(null==(i=null==e?void 0:e.hls_recording)||!i.hls_vod),startedAt:dl(null==e?void 0:e.started_at),initialisedAt:dl(null==e?void 0:e.initialised_at),state:null==e?void 0:e.state,error:this.toSdkError(null==e?void 0:e.error)}),n}getPeerListHLSRecording(e){var t,i;let n=null==e?void 0:e.hls;return{running:this.isRecordingRunning(null==n?void 0:n.state),startedAt:dl(null==n?void 0:n.started_at),initialisedAt:dl(null==n?void 0:n.initialised_at),state:null==n?void 0:n.state,singleFilePerLayer:null==(t=null==n?void 0:n.config)?void 0:t.single_file_per_layer,hlsVod:null==(i=null==n?void 0:n.config)?void 0:i.hls_vod}}getPeerListBrowserRecording(e){let t=null==e?void 0:e.browser;return{running:this.isRecordingRunning(null==t?void 0:t.state),startedAt:dl(null==t?void 0:t.started_at),state:null==t?void 0:t.state}}getPeerListSFURecording(e){let t=null==e?void 0:e.sfu;return{running:this.isRecordingRunning(null==t?void 0:t.state),startedAt:dl(null==t?void 0:t.started_at),state:null==t?void 0:t.state}}updateRecordingStatus(e){var t;let i,n=this.store.getRoom(),r=this.isRecordingRunning(e.state);n?("sfu"===e.type?(n.recording.server={running:r,startedAt:r?dl(e.started_at):void 0,error:this.toSdkError(e.error),state:e.state},i="SERVER_RECORDING_STATE_UPDATED"):"HLS"===e.type?(n.recording.hls=this.getHLSRecording(e),i="RECORDING_STATE_UPDATED"):(n.recording.browser={running:r,startedAt:r?dl(e.started_at):void 0,error:this.toSdkError(e.error),state:null==e?void 0:e.state},i="BROWSER_RECORDING_STATE_UPDATED"),null==(t=this.listener)||t.onRoomUpdate(i,n)):bi.w(this.TAG,`set recording status running=${r} - room not present`)}updateRTMPStatus(e){var t,i;let n=this.store.getRoom(),r=this.isStreamingRunning(e.state);if(n)return r?(n.rtmp={running:r,startedAt:r?dl(e.started_at):void 0,state:e.state,error:this.toSdkError(e.error)},void(null==(i=this.listener)||i.onRoomUpdate("RTMP_STREAMING_STATE_UPDATED",n))):(n.rtmp={running:r,state:e.state,error:this.toSdkError(e.error)},void(null==(t=this.listener)||t.onRoomUpdate("RTMP_STREAMING_STATE_UPDATED",n)));bi.w(this.TAG,"on policy change - room not present")}toSdkError(e){if(null==e||!e.code)return;let t=e.message||"error in streaming/recording",i=new ji(e.code,"ServerErrors","NONE",t,t);return bi.e(this.TAG,"error in streaming/recording",i),i}},Sl=class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){"on-metadata-change"===e&&this.handleMetadataChange(t)}handleMetadataChange(e){var t;let i=e.values.map((e=>({key:e.key,value:e.data,updatedAt:dl(e.updated_at),updatedBy:e.updated_by?this.store.getPeerById(e.updated_by):void 0})));null==(t=this.listener)||t.onSessionStoreUpdate(i)}},wl=class{constructor(e,t,i){this.store=e,this.transport=t,this.listener=i}handleNotification(e,t){switch(e){case"on-whiteboard-update":this.handleWhiteboardUpdate(t);break;default:break}}handleWhiteboardUpdate(e){return Zt(this,null,(function*(){var t;let i=this.store.getLocalPeer(),n=this.store.getWhiteboard(e.id),r=e.owner===(null==i?void 0:i.peerId)||e.owner===(null==i?void 0:i.customerUserId),s="open"===e.state,o={id:e.id,title:e.title,attributes:e.attributes};if(o.open=r?null==n?void 0:n.open:s,o.owner=o.open?e.owner:void 0,o.open)if(r)o.url=null==n?void 0:n.url,o.token=null==n?void 0:n.token,o.addr=null==n?void 0:n.addr,o.permissions=null==n?void 0:n.permissions;else{let t=yield this.transport.signal.getWhiteboard({id:e.id});o.url=vl(t.token,t.addr,this.store.getEnv()),o.token=t.token,o.addr=t.addr,o.permissions=t.permissions,o.open=t.permissions.length>0}this.store.setWhiteboard(o),null==(t=this.listener)||t.onWhiteboardUpdate(o)}))}},El=class{constructor(e,t,i,n,r,s){this.store=e,this.transport=i,this.listener=n,this.audioListener=r,this.connectionQualityListener=s,this.TAG="[HMSNotificationManager]",this.hasConsistentRoomStateArrived=!1,this.ignoreNotification=e=>{if("peer-list"===e)this.hasConsistentRoomStateArrived=!0;else if("room-state"===e)return this.hasConsistentRoomStateArrived;return!1},this.handleTrackAdd=e=>{this.trackManager.handleTrackAdd(e)},this.handleTrackRemove=e=>{this.trackManager.handleTrackRemove(e)},this.updateLocalPeer=({name:e,metadata:t})=>{let i=this.store.getLocalPeer();this.peerManager.handlePeerInfoUpdate({peer:i,name:e,data:t})};let o=this.transport.isFlagEnabled("onDemandTracks");this.trackManager=o?new cl(this.store,t,this.transport,this.listener):new ll(this.store,t,this.listener),this.peerManager=new hl(this.store,this.trackManager,this.listener),this.peerListManager=new ul(this.store,this.peerManager,this.trackManager,this.listener),this.broadcastManager=new ol(this.listener),this.policyChangeManager=new pl(this.store,t),this.requestManager=new kl(this.store,this.listener),this.activeSpeakerManager=new sl(this.store,this.listener,this.audioListener),this.connectionQualityManager=new al(this.store,this.connectionQualityListener),this.roomUpdateManager=new Tl(this.store,this.listener),this.sessionMetadataManager=new Sl(this.store,this.listener),this.pollsManager=new bl(this.store,this.transport,this.listener),this.whiteboardManager=new wl(this.store,this.transport,this.listener)}setListener(e){this.listener=e,this.trackManager.listener=e,this.peerManager.listener=e,this.peerListManager.listener=e,this.broadcastManager.listener=e,this.requestManager.listener=e,this.activeSpeakerManager.listener=e,this.roomUpdateManager.listener=e,this.sessionMetadataManager.listener=e,this.pollsManager.listener=e,this.whiteboardManager.listener=e}setAudioListener(e){this.audioListener=e,this.activeSpeakerManager.audioListener=e}setConnectionQualityListener(e){this.connectionQualityListener=e,this.connectionQualityManager.listener=e}handleNotification(e,t=!1){var i,n;let r=e.method,s=e.params;["active-speakers","sfu-stats","on-connection-quality-update",void 0].includes(r)||bi.d(this.TAG,`Received notification - ${r}`,{notification:s}),"sfu-stats"===r&&null!=(i=window.HMS)&&i.ON_SFU_STATS&&"function"==typeof(null==(n=window.HMS)?void 0:n.ON_SFU_STATS)&&window.HMS.ON_SFU_STATS(e.params),!this.ignoreNotification(r)&&(this.roomUpdateManager.handleNotification(r,s),this.peerManager.handleNotification(r,s),this.requestManager.handleNotification(r,s),this.peerListManager.handleNotification(r,s,t),this.broadcastManager.handleNotification(r,s),this.sessionMetadataManager.handleNotification(r,s),this.pollsManager.handleNotification(r,s),this.whiteboardManager.handleNotification(r,s),this.handleIsolatedMethods(r,s))}handleIsolatedMethods(e,t){switch(e){case"on-track-add":this.trackManager.handleTrackMetadataAdd(t);break;case"on-track-update":this.trackManager.handleTrackUpdate(t);break;case"on-track-remove":if(!t.peer)return void bi.d(this.TAG,`Ignoring sfu notification - ${e}`,{notification:t});this.trackManager.handleTrackRemovedPermanently(t);break;case"on-track-layer-update":this.trackManager.handleTrackLayerUpdate(t);break;case"active-speakers":this.activeSpeakerManager.handleActiveSpeakers(t);break;case"on-connection-quality-update":this.connectionQualityManager.handleQualityUpdate(t);break;case"on-policy-change":this.policyChangeManager.handlePolicyChange(t);break;case"node-info":this.transport.setSFUNodeId(t.sfu_node_id);break;default:break}}},Pl=class{constructor(e){this.transport=e,this.observedKeys=new Set}get(e){return Zt(this,null,(function*(){let{data:t,updated_at:i}=yield this.transport.signal.getSessionMetadata(e);return{value:t,updatedAt:dl(i)}}))}set(e,t){return Zt(this,null,(function*(){let{data:i,updated_at:n}=yield this.transport.signal.setSessionMetadata({key:e,data:t}),r=dl(n);return{value:i,updatedAt:r}}))}observe(e){return Zt(this,null,(function*(){let t=new Set(this.observedKeys);if(e.forEach((e=>this.observedKeys.add(e))),this.observedKeys.size!==t.size)try{yield this.transport.signal.listenMetadataChange(Array.from(this.observedKeys))}catch(T){throw this.observedKeys=t,T}}))}unobserve(e){return Zt(this,null,(function*(){let t=new Set(this.observedKeys);if(this.observedKeys=new Set([...this.observedKeys].filter((t=>!e.includes(t)))),this.observedKeys.size!==t.size)try{yield this.transport.signal.listenMetadataChange(Array.from(this.observedKeys))}catch(T){throw this.observedKeys=t,T}}))}},Cl=class{constructor(e,t,i="",n="",r="https://prod-init.100ms.live/init",s=!1,o){this.authToken=e,this.peerId=t,this.peerName=i,this.data=n,this.endpoint=r,this.autoSubscribeVideo=s,this.iceServers=o}},_l=(e=>(e[e.ConnectFailed=0]="ConnectFailed",e[e.SignalDisconnect=1]="SignalDisconnect",e[e.JoinWSMessageFailed=2]="JoinWSMessageFailed",e[e.PublishIceConnectionFailed=3]="PublishIceConnectionFailed",e[e.SubscribeIceConnectionFailed=4]="SubscribeIceConnectionFailed",e))(_l||{}),Al={0:[],1:[],2:[1],3:[1],4:[1]},Il=(e=>(e.Disconnected="Disconnected",e.Connecting="Connecting",e.Joined="Joined",e.Preview="Preview",e.Failed="Failed",e.Reconnecting="Reconnecting",e.Leaving="Leaving",e))(Il||{}),Rl=class{constructor(e){this.promise=new Promise(((t,i)=>{this.resolve=t,this.reject=i,e(t,i)}))}},Ll=class{constructor(e,t){this.onStateChange=e,this.sendEvent=t,this.TAG="[RetryScheduler]",this.inProgress=new Map,this.retryTaskIds=[]}schedule(e){return Zt(this,arguments,(function*({category:e,error:t,task:i,originalState:n,maxRetryTime:r=6e4,changeState:s=!0}){yield this.scheduleTask({category:e,error:t,changeState:s,task:i,originalState:n,maxRetryTime:r,failedAt:Date.now()})}))}reset(){this.retryTaskIds.forEach((e=>clearTimeout(e))),this.retryTaskIds=[],this.inProgress.clear()}isTaskInProgress(e){return!!this.inProgress.get(e)}scheduleTask(e){return Zt(this,arguments,(function*({category:e,error:t,changeState:i,task:n,originalState:r,failedAt:s,maxRetryTime:o=6e4,failedRetryCount:a=0}){if(bi.d(this.TAG,"schedule: ",{category:_l[e],error:t}),0===a){let i=this.inProgress.get(e);if(i)return bi.d(this.TAG,`schedule: Already a task for ${_l[e]} scheduled, waiting for its completion`),void(yield i.promise);let n=new Rl(((e,t)=>{}));this.inProgress.set(e,n),this.sendEvent(t,e)}let l=!1,c=Al[e];for(let v in c){let t=c[parseInt(v)];try{let i=this.inProgress.get(t);i&&(bi.d(this.TAG,`schedule: Suspending retry task of ${_l[e]}, waiting for ${_l[t]} to recover`),yield i.promise,bi.d(this.TAG,`schedule: Resuming retry task ${_l[e]} as it's dependency ${_l[t]} is recovered`))}catch(f){bi.d(this.TAG,`schedule: Stopping retry task of ${_l[e]} as it's dependency ${_l[t]} failed to recover`),l=!0;break}}let u=t=>{if(this.inProgress.delete(e),this.sendEvent(t,e),this.reset(),!i)throw t;this.onStateChange("Failed",t)},d=Date.now()-s;if(d>=o||l)return t.description+=`. [${_l[e]}] Could not recover after ${d} milliseconds`,l&&(t.description+=` Could not recover all of it's required dependencies - [${c.map((e=>_l[e])).toString()}]`),t.isTerminal=!0,u(t);i&&this.onStateChange("Reconnecting",t);let h,p=this.getDelayForRetryCount(e);bi.d(this.TAG,`schedule: [${_l[e]}] [failedRetryCount=${a}] Scheduling retry task in ${p}ms`);try{h=yield this.setTimeoutPromise(n,p)}catch(He){h=!1;let i=He;if(i.isTerminal)return bi.e(this.TAG,`[${_l[e]}] Un-caught terminal exception ${i.name} in retry-task`,He),u(i);bi.w(this.TAG,`[${_l[e]}] Un-caught exception ${i.name} in retry-task, initiating retry`,He)}if(h){let t=this.inProgress.get(e);this.inProgress.delete(e),null==t||t.resolve(a),i&&0===this.inProgress.size&&this.onStateChange(r),bi.d(this.TAG,`schedule: [${_l[e]}] [failedRetryCount=${a}] Recovered  after ${d}ms`)}else yield this.scheduleTask({category:e,error:t,changeState:i,task:n,originalState:r,maxRetryTime:o,failedAt:s,failedRetryCount:a+1})}))}getDelayForRetryCount(e){let t=2===e?2*Math.random():Math.random(),i=0;return 2===e?i=2+t:1===e&&(i=1),1e3*i}setTimeoutPromise(e,t){return Zt(this,null,(function*(){return new Promise(((i,n)=>{let r=window.setTimeout((()=>Zt(this,null,(function*(){try{let t=yield e();t&&this.retryTaskIds.splice(this.retryTaskIds.indexOf(r),1),i(t)}catch(je){n(je)}}))),t);this.retryTaskIds.push(r)}))}))}},Dl=class extends Vn{constructor(){super(100),this.localStorage=new zi("hms-analytics"),this.localStorage.clear(),this.initLocalStorageQueue()}enqueue(e){super.enqueue(e),this.localStorage.set(this.storage)}dequeue(){let e=super.dequeue();return this.localStorage.set(this.storage),e}initLocalStorageQueue(){var e;null==(e=this.localStorage.get())||e.forEach((e=>{let t=new sn(e);super.enqueue(t)}))}},Ol=class{constructor(){this.TAG="[AnalyticsTransport]",this.eventCount=0,this.lastResetTime=Date.now(),this.MAX_EVENTS_PER_MINUTE=200,this.RESET_INTERVAL_MS=6e4}checkRateLimit(){let e=Date.now();if(e-this.lastResetTime>=this.RESET_INTERVAL_MS&&(this.eventCount=0,this.lastResetTime=e),this.eventCount>=this.MAX_EVENTS_PER_MINUTE)throw new Error("Too many events being sent, please check the implementation.");this.eventCount++}sendEvent(e){try{this.checkRateLimit()}catch(Ue){throw bi.w(this.TAG,"Rate limit exceeded",Ue),Ue}try{this.sendSingleEvent(e),this.flushFailedEvents()}catch(Ue){bi.w(this.TAG,"sendEvent failed",Ue)}}flushFailedEvents(e){var t;try{for(bi.d(this.TAG,"Flushing failed events",this.failedEvents);this.failedEvents.size()>0;){let i=this.failedEvents.dequeue();i&&((null==(t=i.metadata)?void 0:t.peer.peer_id)!==e&&i.metadata.peer.peer_id?qa.sendEvent(i):this.sendSingleEvent(i))}}catch(T){bi.w(this.TAG,"flushFailedEvents failed",T)}}sendSingleEvent(e){try{this.transportProvider.sendEvent(e),bi.d(this.TAG,"Sent event",e.name,e)}catch(Ue){throw bi.w(this.TAG,`${this.transportProvider.TAG}.sendEvent failed, adding to local storage events`,{event:e,error:Ue}),this.failedEvents.enqueue(e),Ue}}},Ml=class extends Ol{constructor(e){super(),this.transportProvider=e,this.failedEvents=new Dl}},xl=class{constructor(e,t,i,n){this.store=e,this.eventBus=t,this.sampleWindowSize=i,this.pushInterval=n,this.shouldSendEvent=!1,this.sequenceNum=1,this.stop=()=>{this.shouldSendEvent&&this.sendEvent(),this.eventBus.statsUpdate.unsubscribe(this.handleStatsUpdate.bind(this)),this.shouldSendEvent=!1},this.start()}start(){this.shouldSendEvent||(this.stop(),this.shouldSendEvent=!0,this.eventBus.statsUpdate.subscribe(this.handleStatsUpdate.bind(this)),this.startLoop().catch((e=>bi.e("[StatsAnalytics]",e.message))))}startLoop(){return Zt(this,null,(function*(){for(;this.shouldSendEvent;)yield Hn(1e3*this.pushInterval),this.sendEvent()}))}sendEvent(){this.trackAnalytics.forEach((e=>{e.clearSamples()}))}cleanTrackAnalyticsAndCreateSample(e){this.trackAnalytics.forEach((e=>{!this.store.hasTrack(e.track)&&!(e.samples.length>0)&&this.trackAnalytics.delete(e.track_id)})),e&&this.trackAnalytics.forEach((e=>{e.createSample()}))}},Nl=class{constructor({track:e,ssrc:t,rid:i,kind:n,sampleWindowSize:r}){this.samples=[],this.tempStats=[],this.track=e,this.ssrc=t,this.rid=i,this.kind=n,this.track_id=this.track.trackId,this.source=this.track.source,this.sampleWindowSize=r}pushTempStat(e){this.tempStats.push(e)}createSample(){0!==this.tempStats.length&&(this.samples.push(this.collateSample()),this.prevLatestStat=this.getLatestStat(),this.tempStats.length=0)}clearSamples(){this.samples.length=0}getLatestStat(){return this.tempStats[this.tempStats.length-1]}getFirstStat(){return this.tempStats[0]}calculateSum(e){if("number"==typeof this.getLatestStat()[e])return this.tempStats.reduce(((t,i)=>t+(i[e]||0)),0)}calculateAverage(e,t=!0){let i=this.calculateSum(e),n=void 0!==i?i/this.tempStats.length:void 0;return n?t?Math.round(n):n:void 0}calculateDifferenceForSample(e){var t;let i=Number(null==(t=this.prevLatestStat)?void 0:t[e])||0;return(Number(this.getLatestStat()[e])||0)-i}calculateDifferenceAverage(e,t=!0){let i=this.calculateDifferenceForSample(e)/this.tempStats.length;return t?Math.round(i):i}calculateInstancesOfHigh(e,t){if("number"==typeof this.getLatestStat()[e])return this.tempStats.reduce(((i,n)=>i+((n[e]||0)>t?1:0)),0)}},Ul=(e,t)=>e&&t&&(e.frameWidth!==t.frameWidth||e.frameHeight!==t.frameHeight),Fl=(e,t)=>e&&t&&e.enabled!==t.enabled,jl=e=>Object.entries(e).filter((([,e])=>void 0!==e)).reduce(((e,[t,i])=>(e[t]=i,e)),{}),Bl=class extends xl{constructor(){super(...arguments),this.trackAnalytics=new Map}toAnalytics(){var e,t;let i=[],n=[];return this.trackAnalytics.forEach((e=>{"audio"===e.track.type?i.push(e.toAnalytics()):"video"===e.track.type&&n.push(e.toAnalytics())})),{audio:i,video:n,joined_at:null==(t=null==(e=this.store.getRoom())?void 0:e.joinedAt)?void 0:t.getTime(),sequence_num:this.sequenceNum++,max_window_sec:30}}sendEvent(){this.eventBus.analytics.publish(on.publishStats(this.toAnalytics())),super.sendEvent()}handleStatsUpdate(e){let t=!1,i=e.getLocalTrackStats();Object.keys(i).forEach((n=>{let r=i[n],s=this.store.getLocalPeerTracks().find((e=>e.getTrackIDBeingSent()===n));Object.keys(r).forEach((i=>{var n,o,a;let l=r[i];if(!s)return;let c=this.getTrackIdentifier(s.trackId,l),u=Kt(zt({},l),{availableOutgoingBitrate:null==(o=null==(n=e.getLocalPeerStats())?void 0:n.publish)?void 0:o.availableOutgoingBitrate});if(c&&this.trackAnalytics.has(c))null==(a=this.trackAnalytics.get(c))||a.pushTempStat(u);else if(s){let e=new Gl({track:s,sampleWindowSize:this.sampleWindowSize,rid:l.rid,ssrc:l.ssrc.toString(),kind:l.kind});e.pushTempStat(u),this.trackAnalytics.set(this.getTrackIdentifier(s.trackId,l),e)}let d=this.trackAnalytics.get(c);null!=d&&d.shouldCreateSample()&&(t=!0)}))})),this.cleanTrackAnalyticsAndCreateSample(t)}getTrackIdentifier(e,t){return t.rid?`${e}:${t.rid}`:e}},Gl=class extends Nl{constructor(){super(...arguments),this.samples=[],this.collateSample=()=>{let e=this.getLatestStat(),t=e.qualityLimitationDurations,i=t&&{bandwidth_sec:t.bandwidth,cpu_sec:t.cpu,other_sec:t.other},n=e.frameHeight?{height_px:this.getLatestStat().frameHeight,width_px:this.getLatestStat().frameWidth}:void 0,r=this.calculateAverage("jitter",!1),s=r?Math.round(1e3*r):void 0,o=this.calculateAverage("roundTripTime",!1),a=o?Math.round(1e3*o):void 0;return jl({timestamp:Date.now(),avg_available_outgoing_bitrate_bps:this.calculateAverage("availableOutgoingBitrate"),avg_bitrate_bps:this.calculateAverage("bitrate"),avg_fps:this.calculateAverage("framesPerSecond"),total_packets_lost:this.getLatestStat().packetsLost,total_packets_sent:this.getLatestStat().packetsSent,total_packet_sent_delay_sec:parseFloat(this.calculateDifferenceForSample("totalPacketSendDelay").toFixed(4)),total_fir_count:this.calculateDifferenceForSample("firCount"),total_pli_count:this.calculateDifferenceForSample("pliCount"),total_nack_count:this.calculateDifferenceForSample("nackCount"),avg_jitter_ms:s,avg_round_trip_time_ms:a,total_quality_limitation:i,resolution:n})},this.shouldCreateSample=()=>{let e=this.tempStats.length,t=this.tempStats[e-1],i=this.tempStats[e-2];return 30===e||Fl(t,i)||"video"===t.kind&&Ul(t,i)},this.toAnalytics=()=>({track_id:this.track_id,ssrc:this.ssrc,source:this.source,rid:this.rid,samples:this.samples})}},$l=class extends xl{constructor(){super(...arguments),this.trackAnalytics=new Map}toAnalytics(){var e,t;let i=[],n=[];return this.trackAnalytics.forEach((e=>{"audio"===e.track.type?i.push(e.toAnalytics()):"video"===e.track.type&&n.push(e.toAnalytics())})),{audio:i,video:n,joined_at:null==(t=null==(e=this.store.getRoom())?void 0:e.joinedAt)?void 0:t.getTime(),sequence_num:this.sequenceNum++,max_window_sec:10}}sendEvent(){this.eventBus.analytics.publish(on.subscribeStats(this.toAnalytics())),super.sendEvent()}handleStatsUpdate(e){let t=e.getAllRemoteTracksStats(),i=!1;Object.keys(t).forEach((n=>{var r,s;let o=this.store.getTrackById(n),a=t[n],l=null==(r=this.trackAnalytics.get(n))?void 0:r.getLatestStat(),c=((e,t)=>{let i=(null==t?void 0:t.jitterBufferDelay)||0,n=(null==t?void 0:t.jitterBufferEmittedCount)||0,r=((null==e?void 0:e.jitterBufferDelay)||0)-i,s=((null==e?void 0:e.jitterBufferEmittedCount)||0)-n;return s>0?1e3*r/s:(null==t?void 0:t.calculatedJitterBufferDelay)||0})(a,l),u=this.calculateAvSyncForStat(a,e),d=Kt(zt({},a),{calculatedJitterBufferDelay:c,avSync:u});if("video"===a.kind){let e=o.getPreferredLayerDefinition();d.expectedFrameHeight=null==e?void 0:e.resolution.height,d.expectedFrameWidth=null==e?void 0:e.resolution.width}if(this.trackAnalytics.has(n))null==(s=this.trackAnalytics.get(n))||s.pushTempStat(d);else if(o){let e=new Vl({track:o,sampleWindowSize:this.sampleWindowSize,ssrc:a.ssrc.toString(),kind:a.kind});e.pushTempStat(d),this.trackAnalytics.set(n,e)}let h=this.trackAnalytics.get(n);null!=h&&h.shouldCreateSample()&&(i=!0)})),this.cleanTrackAnalyticsAndCreateSample(i)}calculateAvSyncForStat(e,t){if(!e.peerID||!e.estimatedPlayoutTimestamp||"video"!==e.kind)return;let i=this.store.getPeerById(e.peerID),n=null==i?void 0:i.audioTrack,r=null==i?void 0:i.videoTrack;if(!(n&&r&&n.enabled&&r.enabled))return Dr;let s=t.getRemoteTrackStats(n.trackId);return s?s.estimatedPlayoutTimestamp?s.estimatedPlayoutTimestamp-e.estimatedPlayoutTimestamp:void 0:Dr}},Vl=class extends Nl{constructor(){super(...arguments),this.samples=[],this.collateSample=()=>{let e=this.getLatestStat(),t=this.getFirstStat(),i={timestamp:Date.now(),total_pli_count:this.calculateDifferenceForSample("pliCount"),total_nack_count:this.calculateDifferenceForSample("nackCount"),avg_jitter_buffer_delay:this.calculateAverage("calculatedJitterBufferDelay",!1)};if("video"===e.kind)return jl(Kt(zt({},i),{avg_av_sync_ms:this.calculateAvgAvSyncForSample(),avg_frames_received_per_sec:this.calculateDifferenceAverage("framesReceived"),avg_frames_dropped_per_sec:this.calculateDifferenceAverage("framesDropped"),avg_frames_decoded_per_sec:this.calculateDifferenceAverage("framesDecoded"),frame_width:this.calculateAverage("frameWidth"),frame_height:this.calculateAverage("frameHeight"),expected_frame_width:this.calculateAverage("expectedFrameWidth"),expected_frame_height:this.calculateAverage("expectedFrameHeight"),pause_count:this.calculateDifferenceForSample("pauseCount"),pause_duration_seconds:this.calculateDifferenceForSample("totalPausesDuration"),freeze_count:this.calculateDifferenceForSample("freezeCount"),freeze_duration_seconds:this.calculateDifferenceForSample("totalFreezesDuration")}));{let n=(e.concealedSamples||0)-(e.silentConcealedSamples||0)-((t.concealedSamples||0)-(t.silentConcealedSamples||0));return jl(Kt(zt({},i),{audio_level:this.calculateInstancesOfHigh("audioLevel",.05),audio_concealed_samples:n,audio_total_samples_received:this.calculateDifferenceForSample("totalSamplesReceived"),audio_concealment_events:this.calculateDifferenceForSample("concealmentEvents"),fec_packets_discarded:this.calculateDifferenceForSample("fecPacketsDiscarded"),fec_packets_received:this.calculateDifferenceForSample("fecPacketsReceived"),total_samples_duration:this.calculateDifferenceForSample("totalSamplesDuration"),total_packets_received:this.calculateDifferenceForSample("packetsReceived"),total_packets_lost:this.calculateDifferenceForSample("packetsLost")}))}},this.shouldCreateSample=()=>{let e=this.tempStats.length,t=this.tempStats[e-1],i=this.tempStats[e-2];return 10===e||Fl(t,i)||"video"===t.kind&&Ul(t,i)},this.toAnalytics=()=>({track_id:this.track_id,ssrc:this.ssrc,source:this.source,rid:this.rid,samples:this.samples})}calculateAvgAvSyncForSample(){let e=this.tempStats.map((e=>e.avSync)).filter((e=>void 0!==e&&e!==Dr));return 0===e.length?Dr:e.reduce(((e,t)=>e+t),0)/e.length}},Wl=(e=>(e[e.Publish=0]="Publish",e[e.Subscribe=1]="Subscribe",e))(Wl||{});function Hl(e,t){var i;let n=Ut.qg(e.sdp);if(null==(i=n.origin)||!i.username.startsWith("mozilla"))return e;let r=t?Array.from(t.values()):[];return n.media.forEach((e=>{var t,i,n;let s=null==(t=e.msid)?void 0:t.split(" ")[0],o=null==(i=r.find((t=>t.type===e.type&&t.stream_id===s)))?void 0:i.track_id;o&&(e.msid=null==(n=e.msid)?void 0:n.replace(/\s(.+)/,` ${o}`))})),{type:e.type,sdp:Ut.M9(n)}}function ql(e,t){var i;if(null==e||!e.sdp||!t)return;let n=Ut.qg(e.sdp).media.find((e=>Qi(e.mid)&&parseInt(e.mid)===parseInt(t)));return null==(i=null==n?void 0:n.msid)?void 0:i.split(" ")[1]}function zl(e){return e.sdp.includes("usedtx=1")?e:{type:e.type,sdp:e.sdp.replace("useinbandfec=1","useinbandfec=1;usedtx=1")}}var Kl="[HMSConnection]",Jl=class{constructor(e,t){this.candidates=new Array,this.role=e,this.signal=t}get iceConnectionState(){return this.nativeConnection.iceConnectionState}get connectionState(){return this.nativeConnection.connectionState}get action(){return 0===this.role?"PUBLISH":"SUBSCRIBE"}setSfuNodeId(e){this.sfuNodeId=e}addTransceiver(e,t){return this.nativeConnection.addTransceiver(e,t)}createOffer(e,t){return Zt(this,null,(function*(){try{let i=yield this.nativeConnection.createOffer(t);return bi.d(Kl,`[role=${this.role}] createOffer offer=${JSON.stringify(i,null,1)}`),zl(Hl(i,e))}catch(T){throw Wi.WebrtcErrors.CreateOfferFailed(this.action,T.message)}}))}createAnswer(e=void 0){return Zt(this,null,(function*(){try{let t=yield this.nativeConnection.createAnswer(e);return bi.d(Kl,`[role=${this.role}] createAnswer answer=${JSON.stringify(t,null,1)}`),t}catch(Ue){throw Wi.WebrtcErrors.CreateAnswerFailed(this.action,Ue.message)}}))}setLocalDescription(e){return Zt(this,null,(function*(){try{bi.d(Kl,`[role=${this.role}] setLocalDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setLocalDescription(e)}catch(Ue){throw Wi.WebrtcErrors.SetLocalDescriptionFailed(this.action,Ue.message)}}))}setRemoteDescription(e){return Zt(this,null,(function*(){try{bi.d(Kl,`[role=${this.role}] setRemoteDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setRemoteDescription(e)}catch(Ue){throw Wi.WebrtcErrors.SetRemoteDescriptionFailed(this.action,Ue.message)}}))}addIceCandidate(e){return Zt(this,null,(function*(){"closed"!==this.nativeConnection.signalingState?(bi.d(Kl,`[role=${this.role}] addIceCandidate candidate=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.addIceCandidate(e)):bi.d(Kl,`[role=${this.role}] addIceCandidate signalling state closed`)}))}get remoteDescription(){return this.nativeConnection.remoteDescription}getSenders(){return this.nativeConnection.getSenders()}handleSelectedIceCandidatePairs(){try{(0===this.role?this.getSenders():this.getReceivers()).forEach((e=>{var t;let i=null==(t=e.track)?void 0:t.kind;if(e.transport){let t=e.transport.iceTransport,n=()=>{"function"==typeof t.getSelectedCandidatePair&&(this.selectedCandidatePair=t.getSelectedCandidatePair(),this.selectedCandidatePair&&(this.observer.onSelectedCandidatePairChange(this.selectedCandidatePair),bi.d(Kl,`${Wl[this.role]} connection`,`selected ${i||"unknown"} candidate pair`,JSON.stringify(this.selectedCandidatePair,null,2))))};"function"==typeof t.onselectedcandidatepairchange&&(t.onselectedcandidatepairchange=n),n()}}))}catch(e){bi.w(Kl,`Error in logging selected ice candidate pair for ${Wl[this.role]} connection`,e)}}removeTrack(e){"closed"!==this.nativeConnection.signalingState&&this.nativeConnection.removeTrack(e)}setMaxBitrateAndFramerate(e,t){return Zt(this,null,(function*(){let i=(null==t?void 0:t.maxBitrate)||e.settings.maxBitrate,n=e instanceof Cr&&e.settings.maxFramerate,r=this.getSenders().find((t=>{var i;return(null==(i=null==t?void 0:t.track)?void 0:i.id)===e.getTrackIDBeingSent()}));if(r){let e=r.getParameters();1===e.encodings.length&&(i&&(e.encodings[0].maxBitrate=1e3*i),n&&(e.encodings[0].maxFramerate=n)),yield r.setParameters(e)}else bi.w(Kl,`no sender found to setMaxBitrate for track - ${e.trackId}, sentTrackId - ${e.getTrackIDBeingSent()}`)}))}getStats(){return Zt(this,null,(function*(){return yield this.nativeConnection.getStats()}))}close(){this.nativeConnection.close()}getReceivers(){return this.nativeConnection.getReceivers()}},Ql=class extends Jl{constructor(e,t,i){super(0,e),this.TAG="[HMSPublishConnection]",this.observer=i,this.nativeConnection=new RTCPeerConnection(t),this.channel=this.nativeConnection.createDataChannel(Ar,{protocol:"SCTP"}),this.channel.onerror=e=>bi.e(this.TAG,`publish data channel onerror ${e}`,e),this.nativeConnection.onicecandidate=({candidate:t})=>{t&&(this.observer.onIceCandidate(t),e.trickle(this.role,t))},this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState),this.nativeConnection.sctp&&(this.nativeConnection.sctp.transport.onstatechange=()=>{var e;this.observer.onDTLSTransportStateChange(null==(e=this.nativeConnection.sctp)?void 0:e.transport.state)},this.nativeConnection.sctp.transport.onerror=e=>{var t;this.observer.onDTLSTransportError(new Error(null==(t=null==e?void 0:e.error)?void 0:t.errorDetail)||"DTLS Transport failed")})}}close(){super.close(),this.channel.close()}initAfterJoin(){this.nativeConnection.onnegotiationneeded=()=>Zt(this,null,(function*(){bi.d(this.TAG,"onnegotiationneeded"),yield this.observer.onRenegotiationNeeded()}))}},Yl=class{constructor(e,t,i=""){this.TAG="[HMSDataChannel]",this.nativeChannel=e,this.observer=t,this.metadata=i,e.onmessage=e=>{this.observer.onMessage(e.data)}}get id(){return this.nativeChannel.id}get label(){return this.nativeChannel.label}get readyState(){return this.nativeChannel.readyState}send(e){bi.d(this.TAG,`[${this.metadata}] Sending [size=${e.length}] message=${e}`),this.nativeChannel.send(e)}close(){this.nativeChannel.close()}},Zl=class extends Jl{constructor(e,t,i,n){super(1,e),this.isFlagEnabled=i,this.TAG="[HMSSubscribeConnection]",this.remoteStreams=new Map,this.MAX_RETRIES=3,this.pendingMessageQueue=[],this.eventEmitter=new(Me())({maxListeners:60}),this.handlePendingApiMessages=()=>{this.eventEmitter.emit("open",!0),this.pendingMessageQueue.length>0&&(bi.d(this.TAG,"Found pending message queue, sending messages"),this.pendingMessageQueue.forEach((e=>this.sendOverApiDataChannel(e))),this.pendingMessageQueue.length=0)},this.sendMessage=(e,t)=>Zt(this,null,(function*(){var i;let n;"open"!==(null==(i=this.apiChannel)?void 0:i.readyState)&&(yield this.eventEmitter.waitFor("open"));for(let r=0;r<this.MAX_RETRIES;r++){this.apiChannel.send(e),n=yield this.waitForResponse(t);let i=n.error;if(!i)break;{if(404===i.code){bi.d(this.TAG,`Track not found ${t}`,{request:e,try:r+1,error:i});break}if(bi.d(this.TAG,`Failed sending ${t}`,{request:e,try:r+1,error:i}),i.code/100!==5&&429!==i.code)throw Error(`code=${i.code}, message=${i.message}`);let n=1e3*(2+2*Math.random());yield qn(n)}}return n})),this.waitForResponse=e=>Zt(this,null,(function*(){let t=yield this.eventEmitter.waitFor("message",(function(t){return t.includes(e)})),i=JSON.parse(t[0]);return bi.d(this.TAG,`response for ${e} -`,JSON.stringify(i,null,2)),i})),this.observer=n,this.nativeConnection=new RTCPeerConnection(t),this.initNativeConnectionCallbacks()}initNativeConnectionCallbacks(){this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)},this.nativeConnection.ondatachannel=e=>{e.channel.label===Ar&&(this.apiChannel=new Yl(e.channel,{onMessage:e=>{this.eventEmitter.emit("message",e),this.observer.onApiChannelMessage(e)}},`role=${this.role}`),e.channel.onopen=this.handlePendingApiMessages)},this.nativeConnection.onicecandidate=e=>{null!==e.candidate&&(this.observer.onIceCandidate(e.candidate),this.signal.trickle(this.role,e.candidate))},this.nativeConnection.ontrack=e=>{var t;let i=e.streams[0],n=i.id;if(!this.remoteStreams.has(n)){let e=new Wr(i,this);this.remoteStreams.set(n,e)}i.addEventListener("removetrack",(t=>{if(t.track.id!==e.track.id)return;let i=r.tracks.findIndex((i=>{var n;return i.nativeTrack.id===t.track.id&&e.transceiver.mid===(null==(n=i.transceiver)?void 0:n.mid)}));if(i>=0){let e=r.tracks[i];this.observer.onTrackRemove(e),r.tracks.splice(i,1),0===r.tracks.length&&this.remoteStreams.delete(n)}}));let r=this.remoteStreams.get(n),s="audio"===e.track.kind,o=s?ir:Gr,a=s?new o(r,e.track):new o(r,e.track,void 0,this.isFlagEnabled("disableNoneLayerRequest"));"video"===e.track.kind&&r.setVideoLayerLocally("none","addTrack","subscribeConnection"),a.transceiver=e.transceiver;let l=ql(this.remoteDescription,null==(t=e.transceiver)?void 0:t.mid);l&&a.setSdpTrackId(l),r.tracks.push(a),this.observer.onTrackAdd(a)}}sendOverApiDataChannel(e){this.apiChannel&&"open"===this.apiChannel.readyState?this.apiChannel.send(e):(bi.w(this.TAG,`API Data channel not ${this.apiChannel?"open":"present"}, queueing`,e),this.pendingMessageQueue.push(e))}sendOverApiDataChannelWithResponse(e,t){return Zt(this,null,(function*(){let i=P();if("prefer-video-track-state"===e.method&&this.isFlagEnabled("disableVideoTrackAutoUnsubscribe")&&"none"===e.params.max_spatial_layer)return bi.d(this.TAG,"video auto unsubscribe is disabled, request is ignored"),{id:i};let n=JSON.stringify(zt({id:t||i,jsonrpc:"2.0"},e));return this.sendMessage(n,i)}))}close(){var e;super.close(),null==(e=this.apiChannel)||e.close()}},Xl=(e,t)=>t&&0!==t.length?t.map((e=>({urls:e.urls,credentialType:"password",credential:e.password,username:e.userName}))):e,ec="[InitService]",tc=class{static handleError(e,t){switch(e.status){case 404:throw Wi.APIErrors.EndpointUnreachable("INIT",t.message||e.statusText);case 200:break;default:throw Wi.APIErrors.ServerErrors(t.code||e.status,"INIT",t.message||(null==e?void 0:e.statusText))}}static fetchInitConfig(e){return Zt(this,arguments,(function*({token:e,peerId:t,userAgent:i,initEndpoint:n="https://prod-init.100ms.live",region:r="",iceServers:s}){bi.d(ec,`fetchInitConfig: initEndpoint=${n} token=${e} peerId=${t} region=${r} `);let o=ic(n,t,i,r);try{let t=yield fetch(o,{headers:{Authorization:`Bearer ${e}`}});try{let e=yield t.clone().json();return this.handleError(t,e),bi.d(ec,`config is ${JSON.stringify(e,null,2)}`),nc(e,s)}catch(qe){let i=yield t.text();throw bi.e(ec,"json error",qe.message,i),qe instanceof ji?qe:Wi.APIErrors.ServerErrors(t.status,"INIT",qe.message)}}catch(Be){let t=Be;throw["Failed to fetch","NetworkError","ECONNRESET"].some((e=>t.message.includes(e)))?Wi.APIErrors.EndpointUnreachable("INIT",t.message):t}}))}};function ic(e,t,i,n){try{let r=new URL("/init",e);return n&&n.trim().length>0&&r.searchParams.set("region",n.trim()),r.searchParams.set("peer_id",t),r.searchParams.set("user_agent_v2",i),r.toString()}catch(Ne){let t=Ne;throw bi.e(ec,t.name,t.message),t}}function nc(e,t){var i;return Kt(zt({},e),{rtcConfiguration:Kt(zt({},e.rtcConfiguration),{iceServers:Xl(null==(i=e.rtcConfiguration)?void 0:i.ice_servers,t)})})}var rc=class{constructor(e){this.TAG="[SIGNAL]: ",this.pongResponseTimes=new Vn(5),this.isJoinCompleted=!1,this.pendingTrickle=[],this.socket=null,this.callbacks=new Map,this._isConnected=!1,this.id=0,this.onCloseHandler=()=>{},this.resolvePingOnAnyResponse=()=>{this.callbacks.forEach(((e,t)=>{var i;"ping"===(null==(i=e.metadata)?void 0:i.method)&&(e.resolve({timestamp:Date.now()}),this.callbacks.delete(t))}))},this.offlineListener=()=>{bi.d(this.TAG,"Window network offline"),this.setIsConnected(!1,"Window network offline")},this.onlineListener=()=>{bi.d(this.TAG,"Window network online"),this.observer.onNetworkOnline()},this.observer=e,window.addEventListener("offline",this.offlineListener),window.addEventListener("online",this.onlineListener),this.onMessageHandler=this.onMessageHandler.bind(this)}get isConnected(){return this._isConnected}setSfuNodeId(e){this.sfuNodeId=e}setIsConnected(e,t=""){bi.d(this.TAG,`isConnected set id: ${this.id}, oldValue: ${this._isConnected}, newValue: ${e}`),this._isConnected!==e&&(this._isConnected&&!e?(this._isConnected=e,this.rejectPendingCalls(t),this.observer.onOffline(t)):!this._isConnected&&e&&(this._isConnected=e,this.observer.onOnline()))}getPongResponseTimes(){return this.pongResponseTimes.toList()}internalCall(e,t){return Zt(this,null,(function*(){var i;let n=P(),r={method:e,params:t,id:n,jsonrpc:"2.0"};null==(i=this.socket)||i.send(JSON.stringify(r));try{return yield new Promise(((t,i)=>{this.callbacks.set(n,{resolve:t,reject:i,metadata:{method:e}})}))}catch(je){if(je instanceof ji)throw je;let i=je;throw Wi.WebsocketMethodErrors.ServerErrors(Number(i.code),$i(e),i.message)}}))}notify(e,t){var i,n;let r={method:e,params:t};(null==(i=this.socket)?void 0:i.readyState)===WebSocket.OPEN&&(null==(n=this.socket)||n.send(JSON.stringify(r)))}open(e){return new Promise(((t,i)=>{let n=!1;this.socket&&(this.socket.close(),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)),this.socket=new WebSocket(e);let r=()=>{bi.e(this.TAG,"Error from websocket"),n=!0,i(Wi.WebSocketConnectionErrors.FailedToConnect("JOIN","Error opening websocket connection"))};this.onCloseHandler=e=>{bi.w(`Websocket closed code=${e.code}`),n?this.setIsConnected(!1,`code: ${e.code}${1e3!==e.code?", unexpected websocket close":""}`):(n=!0,i(Wi.WebSocketConnectionErrors.AbnormalClose("JOIN",`Error opening websocket connection - websocket closed unexpectedly with code=${e.code}`)))},this.socket.addEventListener("error",r);let s=()=>{var e,i;n=!0,t(),this.setIsConnected(!0),this.id++,null==(e=this.socket)||e.removeEventListener("open",s),null==(i=this.socket)||i.removeEventListener("error",r),this.pingPongLoop(this.id)};this.socket.addEventListener("open",s),this.socket.addEventListener("close",this.onCloseHandler),this.socket.addEventListener("message",this.onMessageHandler)}))}close(){return Zt(this,null,(function*(){window.removeEventListener("offline",this.offlineListener),window.removeEventListener("online",this.onlineListener),this.socket?(this.socket.close(1e3,"Normal Close"),this.setIsConnected(!1,"code: 1000, normal websocket close"),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)):this.setIsConnected(!1,"websocket not connected yet")}))}join(e,t,i,n,r,s,o){return Zt(this,null,(function*(){if(!this.isConnected)throw Wi.WebSocketConnectionErrors.WebSocketConnectionLost("JOIN","Failed to send join over WS connection");let a={name:e,disableVidAutoSub:i,data:t,offer:o,server_sub_degrade:n,simulcast:r,onDemandTracks:s},l=yield this.internalCall("join",a);return this.isJoinCompleted=!0,this.pendingTrickle.forEach((({target:e,candidate:t})=>this.trickle(e,t))),this.pendingTrickle.length=0,bi.d(this.TAG,`join: response=${JSON.stringify(l,null,1)}`),l}))}trickle(e,t){this.isJoinCompleted?this.notify("trickle",{target:e,candidate:t,sfu_node_id:this.sfuNodeId}):this.pendingTrickle.push({target:e,candidate:t})}offer(e,t){return Zt(this,null,(function*(){return yield this.call("offer",{desc:e,tracks:Object.fromEntries(t),sfu_node_id:this.sfuNodeId})}))}answer(e){this.notify("answer",{desc:e,sfu_node_id:this.sfuNodeId})}trackUpdate(e){this.notify("track-update",{tracks:Object.fromEntries(e)})}broadcast(e){return Zt(this,null,(function*(){return yield this.call("broadcast",e)}))}leave(e){this.notify("leave",{client_reason:e})}endRoom(e,t){return Zt(this,null,(function*(){yield this.call("end-room",{lock:e,reason:t})}))}sendEvent(e){if(!this.isConnected)throw Error(`${this.TAG} not connected. Could not send event ${e}`);this.notify("analytics",e.toSignalParams())}ping(e){let t=Date.now(),i=new Promise((i=>{setTimeout((()=>{i(Date.now()-t)}),e+1)})),n=this.internalCall("ping",{timestamp:t}).then((()=>Date.now()-t)).catch((()=>Date.now()-t));return Promise.race([i,n])}requestRoleChange(e){return Zt(this,null,(function*(){yield this.call("role-change-request",e)}))}requestBulkRoleChange(e){return Zt(this,null,(function*(){yield this.call("role-change-request",e)}))}acceptRoleChangeRequest(e){return Zt(this,null,(function*(){yield this.call("role-change",e)}))}requestTrackStateChange(e){return Zt(this,null,(function*(){yield this.call("track-update-request",e)}))}requestMultiTrackStateChange(e){return Zt(this,null,(function*(){yield this.call("change-track-mute-state-request",e)}))}removePeer(e){return Zt(this,null,(function*(){yield this.call("peer-leave-request",e)}))}startRTMPOrRecording(e){return Zt(this,null,(function*(){yield this.call("rtmp-start",zt({},e))}))}stopRTMPAndRecording(){return Zt(this,null,(function*(){yield this.call("rtmp-stop",{})}))}startHLSStreaming(e){return Zt(this,null,(function*(){yield this.call("hls-start",zt({},e))}))}stopHLSStreaming(e){return Zt(this,null,(function*(){yield this.call("hls-stop",zt({},e))}))}startTranscription(e){return Zt(this,null,(function*(){yield this.call("transcription-start",zt({},e))}))}stopTranscription(e){return Zt(this,null,(function*(){yield this.call("transcription-stop",zt({},e))}))}sendHLSTimedMetadata(e){return Zt(this,null,(function*(){yield this.call("hls-timed-metadata",zt({},e))}))}updatePeer(e){return Zt(this,null,(function*(){yield this.call("peer-update",zt({},e))}))}getPeer(e){return Zt(this,null,(function*(){return yield this.call("get-peer",zt({},e))}))}joinGroup(e){return Zt(this,null,(function*(){return yield this.call("group-join",{name:e})}))}leaveGroup(e){return Zt(this,null,(function*(){return yield this.call("group-leave",{name:e})}))}addToGroup(e,t){return Zt(this,null,(function*(){yield this.call("group-add",{name:t,peer_id:e})}))}removeFromGroup(e,t){return Zt(this,null,(function*(){yield this.call("group-remove",{name:t,peer_id:e})}))}peerIterNext(e){return Zt(this,null,(function*(){return yield this.call("peer-iter-next",e)}))}findPeers(e){return Zt(this,null,(function*(){return yield this.call("find-peer",e)}))}findPeerByName(e){return Zt(this,null,(function*(){return yield this.call("peer-name-search",e)}))}setSessionMetadata(e){if(!this.isConnected)throw Wi.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to set session store value due to network disconnection");return this.call("set-metadata",zt({},e))}listenMetadataChange(e){if(!this.isConnected)throw Wi.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to observe session store key due to network disconnection");return this.call("listen-metadata-change",{keys:e})}getSessionMetadata(e){if(!this.isConnected)throw Wi.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to set session store value due to network disconnection");return this.call("get-metadata",{key:e})}setPollInfo(e){return this.call("poll-info-set",zt({},e))}getPollInfo(e){return this.call("poll-info-get",zt({},e))}setPollQuestions(e){return this.call("poll-questions-set",zt({},e))}startPoll(e){return this.call("poll-start",zt({},e))}stopPoll(e){return this.call("poll-stop",zt({},e))}getPollQuestions(e){return this.call("poll-questions-get",zt({},e))}setPollResponses(e){return this.call("poll-response",zt({},e))}getPollResponses(e){return this.call("poll-responses",zt({},e))}getPollsList(e){return this.call("poll-list",zt({},e))}getPollResult(e){return this.call("poll-result",zt({},e))}createWhiteboard(e){return this.validateConnection(),this.call("whiteboard-create",zt({},e))}getWhiteboard(e){return this.validateConnection(),this.call("whiteboard-get",zt({},e))}fetchPollLeaderboard(e){return this.call("poll-leaderboard",zt({},e))}validateConnection(){if(!this.isConnected)throw Wi.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to send message due to network disconnection")}onMessageHandler(e){let t=e.data,i=JSON.parse(t);if(this.resolvePingOnAnyResponse(),i.id)this.handleResponseWithId(i);else{if(!i.method)throw Error(`WebSocket message has no 'method' or 'id' field, message=${i}`);this.handleResponseWithMethod(i)}}handleResponseWithId(e){let t=e,i=t.id;if(this.callbacks.has(i)){let e=this.callbacks.get(i);this.callbacks.delete(i),t.result?e.resolve(t.result):e.reject(t.error)}else this.observer.onNotification(t)}handleResponseWithMethod(e){switch(e.method){case"offer":this.observer.onOffer(e.params);break;case"trickle":this.observer.onTrickle(e.params);break;case"on-error":this.observer.onServerError(Wi.WebsocketMethodErrors.ServerErrors(Number(e.params.code),"on-error",e.params.message));break;case"on-warning":bi.w(this.TAG,e.params);break;default:this.observer.onNotification(e);break}}rejectPendingCalls(e=""){this.callbacks.forEach(((t,i)=>{var n,r,s,o;"ping"!==(null==(n=t.metadata)?void 0:n.method)&&(bi.e(this.TAG,`rejecting pending callback ${null==(r=t.metadata)?void 0:r.method}, id=${i}`),t.reject(Wi.WebSocketConnectionErrors.WebSocketConnectionLost(null!=(s=t.metadata)&&s.method?$i(null==(o=t.metadata)?void 0:o.method):"RECONNECT_SIGNAL",e)),this.callbacks.delete(i))}))}pingPongLoop(e){return Zt(this,null,(function*(){var t,i;let n=(null==(t=window.HMS)?void 0:t.PING_TIMEOUT)||12e3;if(this.isConnected){let t=yield this.ping(n);this.pongResponseTimes.enqueue(t),t>n?(bi.d(this.TAG,`Pong timeout ${e}, pageHidden=${Li()}`),this.id===e&&this.setIsConnected(!1,"ping pong failure")):setTimeout((()=>this.pingPongLoop(e)),(null==(i=window.HMS)?void 0:i.PING_INTERVAL)||3e3)}}))}call(e,t){return Zt(this,null,(function*(){let i,n=Wi.WebsocketMethodErrors.ServerErrors(500,e,`Default ${e} error`);for(i=1;i<=3;i++)try{return this.validateConnection(),bi.d(this.TAG,`Try number ${i} sending ${e}`,t),yield this.internalCall(e,t)}catch(je){if(n=je,bi.e(this.TAG,`Failed sending ${e} try: ${i}`,{method:e,params:t,error:n}),5!==parseInt(""+n.code/100)&&429!==n.code&&1003!==n.code)break;let s=1e3*(2+2*Math.random());yield qn(s)}throw bi.e(`Sending ${e} over WS failed after ${Math.min(i,3)} retries`,{method:e,params:t,error:n}),n}))}},sc=()=>{if(!_i||"undefined"==typeof navigator.connection)return;let e=navigator.connection;return{downlink:e.downlink,downlinkMax:e.downlinkMax,effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,type:e.type}},oc="[HMSTransport]:",ac=class{constructor(e,t,i,n,r,s,o){this.observer=e,this.deviceManager=t,this.store=i,this.eventBus=n,this.analyticsEventsService=r,this.analyticsTimer=s,this.pluginUsageTracker=o,this.state="Disconnected",this.trackStates=new Map,this.publishConnection=null,this.subscribeConnection=null,this.maxSubscribeBitrate=0,this.joinRetryCount=0,this.publishDisconnectTimer=0,this.onScreenshareStop=()=>{},this.screenStream=new Set,this.callbacks=new Map,this.setListener=e=>{this.listener=e},this.setOnScreenshareStop=e=>{this.onScreenshareStop=e},this.signalObserver={onOffer:e=>Zt(this,null,(function*(){try{if(!this.subscribeConnection)return;if(e.sfu_node_id&&this.subscribeConnection.sfuNodeId&&this.subscribeConnection.sfuNodeId!==e.sfu_node_id)return void bi.d(oc,"ignoring old offer");yield this.subscribeConnection.setRemoteDescription(e),bi.d(oc,`[SUBSCRIBE] Adding ${this.subscribeConnection.candidates.length} ice-candidates`,this.subscribeConnection.candidates);for(let e of this.subscribeConnection.candidates)yield this.subscribeConnection.addIceCandidate(e);this.subscribeConnection.candidates.length=0;let t=yield this.subscribeConnection.createAnswer();yield this.subscribeConnection.setLocalDescription(t),this.signal.answer(t),bi.d(oc,"[role=SUBSCRIBE] onOffer renegotiation DONE ")}catch(t){let i;bi.d(oc,"[role=SUBSCRIBE] onOffer renegotiation FAILED ",t),this.state="Failed",i=t instanceof ji?t:Wi.GenericErrors.Unknown("SUBSCRIBE",t.message),this.observer.onFailure(i),this.eventBus.analytics.publish(on.subscribeFail(i))}})),onTrickle:e=>Zt(this,null,(function*(){let t=0===e.target?this.publishConnection:this.subscribeConnection;null!=t&&t.remoteDescription?yield t.addIceCandidate(e.candidate):null==t||t.candidates.push(e.candidate)})),onNotification:e=>this.observer.onNotification(e),onServerError:e=>Zt(this,null,(function*(){yield this.observer.onStateChange("Failed",e)})),onFailure:e=>{this.joinParameters&&this.retryScheduler.schedule({category:1,error:e,task:this.retrySignalDisconnectTask,originalState:this.state})},onOffline:e=>Zt(this,null,(function*(){bi.d(oc,"socket offline",Il[this.state]);try{"Leaving"!==this.state&&this.joinParameters&&this.retryScheduler.schedule({category:1,error:Wi.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL",e),task:this.retrySignalDisconnectTask,originalState:this.state})}catch(t){console.error(t)}})),onOnline:()=>{var e;bi.d(oc,"socket online",Il[this.state]),this.analyticsSignalTransport.flushFailedEvents(null==(e=this.store.getLocalPeer())?void 0:e.peerId)},onNetworkOnline:()=>{this.analyticsEventsService.flushFailedClientEvents()}},this.signal=new rc(this.signalObserver),this.analyticsSignalTransport=new Ml(this.signal),this.publishDtlsStateTimer=0,this.lastPublishDtlsState="new",this.handleLocalRoleUpdate=e=>Zt(this,[e],(function*({oldRole:e,newRole:t}){!this.doesRoleNeedWebRTC(e)&&this.doesRoleNeedWebRTC(t)&&(bi.d(oc,"Local peer role updated to webrtc role, creating PeerConnections and performing inital publish negotiation "),this.createPeerConnections(),yield this.negotiateOnFirstPublish())})),this.retryPublishIceFailedTask=()=>Zt(this,null,(function*(){if(this.publishConnection){let e=new Promise(((e,t)=>{this.callbacks.set(_r,{promise:{resolve:e,reject:t},action:"RESTART_ICE",extra:{}})}));yield this.performPublishRenegotiation({iceRestart:"connected"!==this.publishConnection.connectionState}),yield e}return!0})),this.retrySubscribeIceFailedTask=()=>Zt(this,null,(function*(){if(this.subscribeConnection&&"connected"!==this.subscribeConnection.connectionState){let e=new Promise(((e,t)=>{this.callbacks.set(Ir,{promise:{resolve:e,reject:t},action:"RESTART_ICE",extra:{}})})),t=new Promise((e=>{setTimeout(e,6e4,!1)}));return Promise.race([e,t])}return!0})),this.retrySignalDisconnectTask=()=>Zt(this,null,(function*(){var e;bi.d(oc,"retrySignalDisconnectTask",{signalConnected:this.signal.isConnected}),this.signal.isConnected||(yield this.internalConnect(this.joinParameters.authToken,this.joinParameters.endpoint,this.joinParameters.peerId,this.joinParameters.iceServers));let t=null!=(e=this.store.getRoom())&&e.joinedAt?this.signal.isConnected&&(yield this.retryPublishIceFailedTask()):this.signal.isConnected;return this.signal.trackUpdate(this.trackStates),t})),this.webrtcInternals=new is(this.store,this.eventBus);let a=(e,t)=>Zt(this,null,(function*(){e!==this.state&&(this.state=e,yield this.observer.onStateChange(this.state,t))}));this.retryScheduler=new Ll(a,this.sendErrorAnalyticsEvent.bind(this)),this.eventBus.statsUpdate.subscribe((e=>{var t,i;let n=(null==(i=null==(t=e.getLocalPeerStats())?void 0:t.subscribe)?void 0:i.bitrate)||0;this.maxSubscribeBitrate=Math.max(this.maxSubscribeBitrate,n)})),this.eventBus.localAudioEnabled.subscribe((({track:e,enabled:t})=>this.trackUpdate(e,t))),this.eventBus.localVideoEnabled.subscribe((({track:e,enabled:t})=>this.trackUpdate(e,t)))}getWebsocketEndpoint(){if(this.initConfig)return this.initConfig.endpoint}getWebrtcInternals(){return this.webrtcInternals}isFlagEnabled(e){var t;let i=null==(t=this.initConfig)?void 0:t.config;return((null==i?void 0:i.enabledFlags)||[]).includes(e)}setConnectivityListener(e){this.connectivityListener=e}preview(e,t,i,n,r=!1,s){return Zt(this,null,(function*(){let o=yield this.connect(e,t,i,n,r,s);return this.state="Preview",this.observer.onStateChange(this.state),o}))}join(e,t,i,n,r=!1,s){return Zt(this,null,(function*(){bi.d(oc,"join: started ");try{(!this.signal.isConnected||!this.initConfig)&&(yield this.connect(e,n,t,i,r,s)),this.validateNotDisconnected("connect"),this.initConfig&&(yield this.waitForLocalRoleAvailability(),yield this.createConnectionsAndNegotiateJoin(i,r),this.initStatsAnalytics(),bi.d(oc," join: Negotiated over PUBLISH connection"))}catch(xe){bi.e(oc,`join: failed  [token=${e}]`,xe),this.state="Failed";let i=xe;throw i.isTerminal=i.isTerminal||500===i.code,yield this.observer.onStateChange(this.state,i),i}bi.d(oc," join: successful"),this.state="Joined",this.observer.onStateChange(this.state)}))}connect(e,t,i,n,r=!1,s){return Zt(this,null,(function*(){this.setTransportStateForConnect(),this.joinParameters=new Cl(e,i,n.name,n.metaData,t,r,s);try{return yield this.internalConnect(e,t,i,s)}catch(xe){if(!(xe instanceof ji&&([Fi.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,Fi.WebSocketConnectionErrors.FAILED_TO_CONNECT,Fi.WebSocketConnectionErrors.ABNORMAL_CLOSE,Fi.APIErrors.ENDPOINT_UNREACHABLE].includes(xe.code)||xe.code.toString().startsWith("5")||xe.code.toString().startsWith("429"))))throw xe;{let r=()=>Zt(this,null,(function*(){return yield this.internalConnect(e,t,i,s),!(!this.initConfig||!this.initConfig.endpoint)}));yield this.retryScheduler.schedule({category:0,error:xe,task:r,originalState:this.state,changeState:!1})}}}))}leave(e){return Zt(this,arguments,(function*(e,t="user request"){var i,n,r;this.retryScheduler.reset(),this.joinParameters=void 0,bi.d(oc,"leaving in transport");try{let s=this.pluginUsageTracker.getPluginUsage("HMSKrispPlugin");if(s&&this.eventBus.analytics.publish(on.getKrispUsage(s)),this.state="Leaving",null==(i=this.publishStatsAnalytics)||i.stop(),null==(n=this.subscribeStatsAnalytics)||n.stop(),null==(r=this.webrtcInternals)||r.cleanup(),this.clearPeerConnections(),e)try{this.signal.leave(t),bi.d(oc,"signal leave done")}catch(Ke){bi.w(oc,"failed to send leave on websocket to server",Ke)}this.analyticsEventsService.flushFailedClientEvents(),this.analyticsEventsService.reset(),yield this.signal.close()}catch(xe){this.eventBus.analytics.publish(on.disconnect(xe)),bi.e(oc,"leave: FAILED ",xe)}finally{this.state="Disconnected",this.observer.onStateChange(this.state)}}))}publish(e){return Zt(this,null,(function*(){var t;for(let i of e)try{yield this.publishTrack(i),null==(t=this.connectivityListener)||t.onMediaPublished(i)}catch(Ne){this.eventBus.analytics.publish(on.publish({devices:this.deviceManager.getDevices(),error:Ne}))}}))}unpublish(e){return Zt(this,null,(function*(){for(let t of e)yield this.unpublishTrack(t)}))}setSFUNodeId(e){var t,i;this.signal.setSfuNodeId(e),this.sfuNodeId?e&&this.sfuNodeId!==e&&(this.sfuNodeId=e,this.handleSFUMigration()):(this.sfuNodeId=e,null==(t=this.publishConnection)||t.setSfuNodeId(e),null==(i=this.subscribeConnection)||i.setSfuNodeId(e))}handleSFUMigration(){return Zt(this,null,(function*(){var e,t;bi.time("sfu migration"),this.clearPeerConnections();let i=this.store.getPeerMap();this.store.removeRemoteTracks();for(let o in i){let e=i[o];e.isLocal||(e.audioTrack=void 0,e.videoTrack=void 0,e.auxiliaryTracks=[])}let n=this.store.getLocalPeer();if(!n)return;this.createPeerConnections(),this.trackStates.clear(),yield this.negotiateOnFirstPublish();let r=new Map;if(n.audioTrack){let e=n.audioTrack.stream;r.get(e.id)||r.set(e.id,new Vr(new MediaStream));let t=n.audioTrack.clone(r.get(e.id));this.store.removeTrack(n.audioTrack),n.audioTrack.cleanup(),yield this.publishTrack(t),n.audioTrack=t}if(n.videoTrack){let e=n.videoTrack.stream;r.get(e.id)||r.set(e.id,new Vr(new MediaStream)),this.store.removeTrack(n.videoTrack);let t=n.videoTrack.clone(r.get(e.id));n.videoTrack.cleanup(),yield this.publishTrack(t),n.videoTrack=t}let s=[];for(;n.auxiliaryTracks.length>0;){let e=n.auxiliaryTracks.shift();if(e){let t=e.stream;r.get(t.id)||r.set(t.id,new Vr("screen"===e.source?t.nativeStream.clone():new MediaStream)),this.store.removeTrack(e);let i=e.clone(r.get(t.id));"video"===i.type&&"screen"===i.source&&(this.screenStream.add(t.nativeStream),this.screenStream.add(i.stream.nativeStream),i.nativeTrack.addEventListener("ended",this.onScreenshareStop)),e.cleanup(),yield this.publishTrack(i),s.push(i)}}n.auxiliaryTracks=s,r.clear(),null==(t=null==(e=this.listener)?void 0:e.onSFUMigration)||t.call(e),bi.timeEnd("sfu migration")}))}trackUpdate(e,t){var i;let n=Array.from(this.trackStates.values()).find((t=>e.type===t.type&&e.source===t.source));if(n){let r=new za(Kt(zt({},n),{mute:!t}));this.trackStates.set(n.track_id,r),bi.d(oc,"Track Update",this.trackStates,e),this.signal.trackUpdate(new Map([[n.track_id,r]]));let s=this.store.getLocalPeer();s&&t===e.enabled&&(null==(i=this.listener)||i.onTrackUpdate(t?3:2,e,s))}}publishTrack(e){return Zt(this,null,(function*(){e.publishedTrackId=e.getTrackIDBeingSent(),bi.d(oc,` publishTrack: trackId=${e.trackId}, toPublishTrackId=${e.publishedTrackId}`,`${e}`),this.trackStates.set(e.publishedTrackId,new za(e));let t=new Promise(((e,t)=>{this.callbacks.set(_r,{promise:{resolve:e,reject:t},action:"PUBLISH",extra:{}})})),i=e.stream;i.setConnection(this.publishConnection);let n=this.store.getSimulcastLayers(e.source);i.addTransceiver(e,n),bi.time(`publish-${e.trackId}-${e.type}`),yield t,bi.timeEnd(`publish-${e.trackId}-${e.type}`),this.store.addTrack(e),yield i.setMaxBitrateAndFramerate(e).then((()=>{bi.d(oc,`Setting maxBitrate=${e.settings.maxBitrate} kpbs${e instanceof Cr?` and maxFramerate=${e.settings.maxFramerate}`:""} for ${e.source} ${e.type} ${e.trackId}`)})).catch((e=>bi.w(oc,"Failed setting maxBitrate and maxFramerate",e))),e.isPublished=!0,bi.d(oc,` publishTrack: trackId=${e.trackId}`,`${e}`,this.callbacks)}))}unpublishTrack(e){return Zt(this,null,(function*(){if(bi.d(oc,` unpublishTrack: trackId=${e.trackId}`,`${e}`),e.publishedTrackId&&this.trackStates.has(e.publishedTrackId))this.trackStates.delete(e.publishedTrackId);else{let t=Array.from(this.trackStates.values()).find((t=>e.type===t.type&&e.source===t.source));t&&this.trackStates.delete(t.track_id)}let t=new Promise(((e,t)=>{this.callbacks.set(_r,{promise:{resolve:e,reject:t},action:"UNPUBLISH",extra:{}})}));e.stream.removeSender(e),yield t,yield e.cleanup(),"screen"===e.source&&this.screenStream&&this.screenStream.forEach((e=>{e.getTracks().forEach((e=>{e.stop()})),this.screenStream.delete(e)})),this.store.removeTrack(e),bi.d(oc,` unpublishTrack: trackId=${e.trackId}`,this.callbacks)}))}clearPeerConnections(){return Zt(this,null,(function*(){var e,t;clearTimeout(this.publishDtlsStateTimer),this.publishDtlsStateTimer=0,clearTimeout(this.publishDisconnectTimer),this.publishDisconnectTimer=0,this.lastPublishDtlsState="new",null==(e=this.publishConnection)||e.close(),null==(t=this.subscribeConnection)||t.close(),this.publishConnection=null,this.subscribeConnection=null}))}waitForLocalRoleAvailability(){if(!this.store.hasRoleDetailsArrived())return new Promise((e=>{this.eventBus.policyChange.subscribeOnce((()=>e()))}))}createConnectionsAndNegotiateJoin(e,t=!1){return Zt(this,null,(function*(){let i=this.doesLocalPeerNeedWebRTC();i&&this.createPeerConnections(),this.analyticsTimer.start("join_response_time"),yield this.negotiateJoinWithRetry({name:e.name,data:e.metaData,autoSubscribeVideo:t,isWebRTC:i}),this.analyticsTimer.end("join_response_time")}))}createPeerConnections(){var e,t,i;let n=(e,t,i=!1)=>{(["disconnected","failed"].includes(t)?bi.w.bind(bi):bi.d.bind(bi))(oc,`${Wl[e]} ${i?"ice":""} connection state change: ${t}`)};if(this.initConfig){let e={onRenegotiationNeeded:()=>Zt(this,null,(function*(){yield this.performPublishRenegotiation()})),onDTLSTransportStateChange:e=>{var t,i,n;if(("failed"===e?bi.w.bind(bi):bi.d.bind(bi))(oc,`Publisher on dtls transport state change: ${e}`),!e||this.lastPublishDtlsState===e||(this.lastPublishDtlsState=e,0!==this.publishDtlsStateTimer&&(clearTimeout(this.publishDtlsStateTimer),this.publishDtlsStateTimer=0),"connecting"!==e&&"failed"!==e))return;let r=null==(n=null==(i=null==(t=this.initConfig)?void 0:t.config)?void 0:i.dtlsStateTimeouts)?void 0:n[e];!r||r<=0||(this.publishDtlsStateTimer=window.setTimeout((()=>{var t;let i=null==(t=this.publishConnection)?void 0:t.nativeConnection.connectionState;if(i&&e&&i===e){let t=Wi.WebrtcErrors.ICEFailure("PUBLISH",`DTLS transport state ${e} timeout:${r}ms`,!0);this.eventBus.analytics.publish(on.disconnect(t)),this.observer.onFailure(t)}}),r))},onDTLSTransportError:e=>{bi.e(oc,`onDTLSTransportError ${e.name} ${e.message}`,e),this.eventBus.analytics.publish(on.disconnect(e))},onIceConnectionChange:e=>Zt(this,null,(function*(){n(0,e,!0)})),onConnectionStateChange:e=>Zt(this,null,(function*(){var t,i,r,s,o,a,l,c;n(0,e,!1),"new"!==e&&("connected"===e?(null==(t=this.connectivityListener)||t.onICESuccess(!0),null==(i=this.publishConnection)||i.handleSelectedIceCandidatePairs()):"failed"===e?yield this.handleIceConnectionFailure(0,Wi.WebrtcErrors.ICEFailure("PUBLISH",`local candidate - ${null==(o=null==(s=null==(r=this.publishConnection)?void 0:r.selectedCandidatePair)?void 0:s.local)?void 0:o.candidate}; remote candidate - ${null==(c=null==(l=null==(a=this.publishConnection)?void 0:a.selectedCandidatePair)?void 0:l.remote)?void 0:c.candidate}`)):this.publishDisconnectTimer=window.setTimeout((()=>{var e,t,i,n,r,s,o;"connected"!==(null==(e=this.publishConnection)?void 0:e.connectionState)&&this.handleIceConnectionFailure(0,Wi.WebrtcErrors.ICEDisconnected("PUBLISH",`local candidate - ${null==(n=null==(i=null==(t=this.publishConnection)?void 0:t.selectedCandidatePair)?void 0:i.local)?void 0:n.candidate}; remote candidate - ${null==(o=null==(s=null==(r=this.publishConnection)?void 0:r.selectedCandidatePair)?void 0:s.remote)?void 0:o.candidate}`))}),5e3))})),onIceCandidate:e=>{var t;null==(t=this.connectivityListener)||t.onICECandidate(e,!0)},onSelectedCandidatePairChange:e=>{var t;null==(t=this.connectivityListener)||t.onSelectedICECandidatePairChange(e,!0)}},t={onApiChannelMessage:e=>{this.observer.onNotification(JSON.parse(e))},onTrackAdd:e=>{bi.d(oc,"[Subscribe] onTrackAdd",`${e}`),this.observer.onTrackAdd(e)},onTrackRemove:e=>{bi.d(oc,"[Subscribe] onTrackRemove",`${e}`),this.observer.onTrackRemove(e)},onIceConnectionChange:e=>Zt(this,null,(function*(){var t;if(n(1,e,!0),"connected"===e){let e=this.callbacks.get(Ir);this.callbacks.delete(Ir),null==(t=this.connectivityListener)||t.onICESuccess(!1),e&&e.promise.resolve(!0)}})),onConnectionStateChange:e=>Zt(this,null,(function*(){var t,i,r,s,o,a,l;if(n(1,e,!1),"failed"===e)yield this.handleIceConnectionFailure(1,Wi.WebrtcErrors.ICEFailure("SUBSCRIBE",`local candidate - ${null==(r=null==(i=null==(t=this.subscribeConnection)?void 0:t.selectedCandidatePair)?void 0:i.local)?void 0:r.candidate}; remote candidate - ${null==(a=null==(o=null==(s=this.subscribeConnection)?void 0:s.selectedCandidatePair)?void 0:o.remote)?void 0:a.candidate}`));else if("disconnected"===e)setTimeout((()=>{var e,t,i,n,r,s,o;"disconnected"===(null==(e=this.subscribeConnection)?void 0:e.connectionState)&&this.handleIceConnectionFailure(1,Wi.WebrtcErrors.ICEDisconnected("SUBSCRIBE",`local candidate - ${null==(n=null==(i=null==(t=this.subscribeConnection)?void 0:t.selectedCandidatePair)?void 0:i.local)?void 0:n.candidate}; remote candidate - ${null==(o=null==(s=null==(r=this.subscribeConnection)?void 0:r.selectedCandidatePair)?void 0:s.remote)?void 0:o.candidate}`))}),5e3);else if("connected"===e){null==(l=this.subscribeConnection)||l.handleSelectedIceCandidatePairs();let e=this.callbacks.get(Ir);this.callbacks.delete(Ir),e&&e.promise.resolve(!0)}})),onIceCandidate:e=>{var t;null==(t=this.connectivityListener)||t.onICECandidate(e,!1)},onSelectedCandidatePairChange:e=>{var t;null==(t=this.connectivityListener)||t.onSelectedICECandidatePairChange(e,!1)}};this.publishConnection||(this.publishConnection=new Ql(this.signal,this.initConfig.rtcConfiguration,e)),this.subscribeConnection||(this.subscribeConnection=new Zl(this.signal,this.initConfig.rtcConfiguration,this.isFlagEnabled.bind(this),t))}null==(i=this.webrtcInternals)||i.setPeerConnections({publish:null==(e=this.publishConnection)?void 0:e.nativeConnection,subscribe:null==(t=this.subscribeConnection)?void 0:t.nativeConnection})}negotiateJoinWithRetry(e){return Zt(this,arguments,(function*({name:e,data:t,autoSubscribeVideo:i,isWebRTC:n=!0}){try{yield this.negotiateJoin({name:e,data:t,autoSubscribeVideo:i,isWebRTC:n})}catch(je){bi.e(oc,"Join negotiation failed ",je);let s=je instanceof ji?je:Wi.WebsocketMethodErrors.ServerErrors(500,"JOIN",`Websocket join error - ${je.message}`),o=5===parseInt(""+s.code/100)||[Fi.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,429].includes(s.code);if(410===s.code&&(s.isTerminal=!0),!o)throw je;{this.joinRetryCount=0,s.isTerminal=!1;let r=()=>Zt(this,null,(function*(){return this.joinRetryCount++,yield this.negotiateJoin({name:e,data:t,autoSubscribeVideo:i,isWebRTC:n})}));yield this.retryScheduler.schedule({category:2,error:s,task:r,originalState:"Joined",changeState:!1})}}}))}negotiateJoin(e){return Zt(this,arguments,(function*({name:e,data:t,autoSubscribeVideo:i,isWebRTC:n=!0}){return n?yield this.negotiateJoinWebRTC({name:e,data:t,autoSubscribeVideo:i}):yield this.negotiateJoinNonWebRTC({name:e,data:t,autoSubscribeVideo:i})}))}negotiateJoinWebRTC(e){return Zt(this,arguments,(function*({name:e,data:t,autoSubscribeVideo:i}){if(bi.d(oc," join: Negotiating over PUBLISH connection"),!this.publishConnection)return bi.e(oc,"Publish peer connection not found, cannot negotiate"),!1;let n=yield this.publishConnection.createOffer();yield this.publishConnection.setLocalDescription(n);let r=this.isFlagEnabled("subscribeDegradation"),s=this.isFlagEnabled("simulcast"),o=this.isFlagEnabled("onDemandTracks"),a=yield this.signal.join(e,t,!i,r,s,o,n);this.setSFUNodeId(null==a?void 0:a.sfu_node_id),yield this.publishConnection.setRemoteDescription(a);for(let l of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(l);return this.publishConnection.initAfterJoin(),!!a}))}negotiateJoinNonWebRTC(e){return Zt(this,arguments,(function*({name:e,data:t,autoSubscribeVideo:i}){bi.d(oc," join: Negotiating Non-WebRTC");let n=this.isFlagEnabled("subscribeDegradation"),r=this.isFlagEnabled("simulcast"),s=this.isFlagEnabled("onDemandTracks"),o=yield this.signal.join(e,t,!i,n,r,s);return this.setSFUNodeId(null==o?void 0:o.sfu_node_id),!!o}))}negotiateOnFirstPublish(){return Zt(this,null,(function*(){if(bi.d(oc," Negotiating offer over PUBLISH connection"),!this.publishConnection)return bi.e(oc,"Publish peer connection not found, cannot negotiate"),!1;try{let e=yield this.publishConnection.createOffer(this.trackStates);yield this.publishConnection.setLocalDescription(e);let t=yield this.signal.offer(e,this.trackStates);yield this.publishConnection.setRemoteDescription(t);for(let i of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(i);return this.publishConnection.initAfterJoin(),!!t}catch(e){if(e instanceof ji&&421===e.code)return!0;throw e}}))}performPublishRenegotiation(e){return Zt(this,null,(function*(){bi.d(oc," [role=PUBLISH] onRenegotiationNeeded START",this.trackStates);let t=this.callbacks.get(_r);if(t)if(this.publishConnection)try{let i=yield this.publishConnection.createOffer(this.trackStates,e);yield this.publishConnection.setLocalDescription(i),bi.time("renegotiation-offer-exchange");let n=yield this.signal.offer(i,this.trackStates);this.callbacks.delete(_r),bi.timeEnd("renegotiation-offer-exchange"),yield this.publishConnection.setRemoteDescription(n),t.promise.resolve(!0),bi.d(oc,"[role=PUBLISH] onRenegotiationNeeded DONE ")}catch(T){let i;i=T instanceof ji?T:Wi.GenericErrors.Unknown("PUBLISH",T.message),421===i.code?t.promise.resolve(!0):t.promise.reject(i),bi.d(oc,"[role=PUBLISH] onRenegotiationNeeded FAILED ")}else bi.e(oc,"Publish peer connection not found, cannot renegotiate");else bi.w(oc,"no callback found for renegotiation")}))}handleIceConnectionFailure(e,t){return Zt(this,null,(function*(){this.retryScheduler.isTaskInProgress(4)||(0===e?this.retryScheduler.schedule({category:3,error:t,task:this.retryPublishIceFailedTask,originalState:"Joined"}):this.retryScheduler.schedule({category:4,error:t,task:this.retrySubscribeIceFailedTask,originalState:"Joined"}))}))}internalConnect(e,t,i,n){return Zt(this,null,(function*(){var r,s,o;bi.d(oc,"connect: started ");let a=new Date;try{this.analyticsTimer.start("init_response_time"),this.initConfig=yield tc.fetchInitConfig({token:e,peerId:i,userAgent:this.store.getUserAgent(),initEndpoint:t,iceServers:n}),null==(r=this.connectivityListener)||r.onInitSuccess(this.initConfig.endpoint);let a=this.store.getRoom();return a&&(a.effectsKey=null==(s=this.initConfig.config.vb)?void 0:s.effectsKey,a.isEffectsEnabled=this.isFlagEnabled("effectsSDKEnabled"),a.disableNoneLayerRequest=this.isFlagEnabled("disableNoneLayerRequest"),a.isVBEnabled=this.isFlagEnabled("vb"),a.isHipaaEnabled=this.isFlagEnabled("hipaa"),a.isNoiseCancellationEnabled=this.isFlagEnabled("noiseCancellation")),this.analyticsTimer.end("init_response_time"),qa.setWebsocketEndpoint(this.initConfig.endpoint),this.validateNotDisconnected("post init"),yield this.openSignal(e,i),this.observer.onConnected(),null==(o=this.connectivityListener)||o.onSignallingSuccess(),this.store.setSimulcastEnabled(this.isFlagEnabled("simulcast")),bi.d(oc,"Adding Analytics Transport: JsonRpcSignal"),this.analyticsEventsService.setTransport(this.analyticsSignalTransport),this.analyticsEventsService.flush(),this.initConfig}catch(Be){throw"Reconnecting"!==this.state&&this.eventBus.analytics.publish(on.connect(Be,this.getAdditionalAnalyticsProperties(),a,new Date,t)),bi.e(oc," internal connect: failed",Be),Be}}))}validateNotDisconnected(e){if("Disconnected"===this.state)throw bi.w(oc,"aborting join as transport state is disconnected"),Wi.GenericErrors.ValidationFailed(`leave called before join could complete - stage=${e}`)}openSignal(e,t){return Zt(this,null,(function*(){if(!this.initConfig)throw Wi.APIErrors.InitConfigNotAvailable("INIT","Init Config not found");bi.d(oc," internal connect: connecting to ws endpoint",this.initConfig.endpoint);let i=new URL(this.initConfig.endpoint);i.searchParams.set("peer",t),i.searchParams.set("token",e),i.searchParams.set("user_agent_v2",this.store.getUserAgent()),i.searchParams.set("protocol_version",Mr),i.searchParams.set("protocol_spec",xr),this.endpoint=i.toString(),this.analyticsTimer.start("ws_connect_time"),yield this.signal.open(this.endpoint),this.analyticsTimer.end("ws_connect_time"),this.analyticsTimer.start("on_policy_change_time"),this.analyticsTimer.start("room_state_time"),bi.d(oc," internal connect: connected to ws endpoint")}))}initStatsAnalytics(){var e,t;this.isFlagEnabled("publishStats")&&(this.publishStatsAnalytics=new Bl(this.store,this.eventBus,this.getValueFromInitConfig("publishStats","maxSampleWindowSize",30),this.getValueFromInitConfig("publishStats","maxSamplePushInterval",300)),null==(e=this.getWebrtcInternals())||e.start()),this.isFlagEnabled("subscribeStats")&&(this.subscribeStatsAnalytics=new $l(this.store,this.eventBus,this.getValueFromInitConfig("subscribeStats","maxSampleWindowSize",10),this.getValueFromInitConfig("subscribeStats","maxSamplePushInterval",60)),null==(t=this.getWebrtcInternals())||t.start())}getValueFromInitConfig(e,t,i){var n,r;return(null==(r=null==(n=this.initConfig)?void 0:n.config[e])?void 0:r[t])||i}doesRoleNeedWebRTC(e){var t,i;if(!this.isFlagEnabled("nonWebRTCDisableOffer"))return!0;let n=!!(e.publishParams.allowed&&(null==(t=e.publishParams.allowed)?void 0:t.length)>0),r=!!(e.subscribeParams.subscribeToRoles&&(null==(i=e.subscribeParams.subscribeToRoles)?void 0:i.length)>0);return n||r}doesLocalPeerNeedWebRTC(){var e;let t=null==(e=this.store.getLocalPeer())?void 0:e.role;return!t||this.doesRoleNeedWebRTC(t)}setTransportStateForConnect(){if("Failed"===this.state&&(this.state="Disconnected"),"Disconnected"!==this.state&&"Reconnecting"!==this.state)throw Wi.WebsocketMethodErrors.AlreadyJoined("JOIN",`Cannot join a meeting in ${this.state} state`);"Disconnected"===this.state&&(this.state="Connecting",this.observer.onStateChange(this.state))}sendErrorAnalyticsEvent(e,t){let i,n=this.getAdditionalAnalyticsProperties();switch(t){case 0:i=on.connect(e,n);break;case 1:i=on.disconnect(e,n);break;case 2:i=on.join({error:e,time:this.analyticsTimer.getTimeTaken("join_time"),init_response_time:this.analyticsTimer.getTimeTaken("init_response_time"),ws_connect_time:this.analyticsTimer.getTimeTaken("ws_connect_time"),on_policy_change_time:this.analyticsTimer.getTimeTaken("on_policy_change_time"),local_audio_track_time:this.analyticsTimer.getTimeTaken("local_audio_track_time"),local_video_track_time:this.analyticsTimer.getTimeTaken("local_video_track_time"),retries_join:this.joinRetryCount});break;case 3:i=on.publish({error:e});break;case 4:i=on.subscribeFail(e);break}this.eventBus.analytics.publish(i)}getSubscribeConnection(){return this.subscribeConnection}getAdditionalAnalyticsProperties(){var e,t,i,n,r,s,o,a;let l=sc(),c="undefined"!=typeof document&&document.hidden,u=this.store.getRemoteVideoTracks().filter((e=>e.degraded)).length,d=null==(n=null==(i=null==(t=null==(e=this.getWebrtcInternals())?void 0:e.getCurrentStats())?void 0:t.getLocalPeerStats())?void 0:i.publish)?void 0:n.bitrate,h=null==(a=null==(o=null==(s=null==(r=this.getWebrtcInternals())?void 0:r.getCurrentStats())?void 0:s.getLocalPeerStats())?void 0:o.subscribe)?void 0:a.bitrate;return{network_info:l,document_hidden:c,num_degraded_tracks:u,bitrate:{publish:d,subscribe:h},max_sub_bitrate:this.maxSubscribeBitrate,recent_pong_response_times:this.signal.getPongResponseTimes(),transport_state:this.state}}};function lc(e){if(!e||0===e.length)throw Wi.APIErrors.InvalidTokenFormat("INIT","Token cannot be an empty string or undefined or null");let t=e.split(".");if(3!==t.length)throw Wi.APIErrors.InvalidTokenFormat("INIT","Expected 3 '.' separate fields - header, payload and signature respectively");let i=atob(t[1]);try{let e=JSON.parse(i);return{roomId:e.room_id,userId:e.user_id,role:e.role}}catch(T){throw Wi.APIErrors.InvalidTokenFormat("INIT",`couldn't parse to json - ${T.message}`)}}var cc={published:!1,isInitialised:!1,isReconnecting:!1,isPreviewInProgress:!1,isPreviewCalled:!1,isJoinInProgress:!1,deviceManagersInitialised:!1},uc=class{constructor(){this.TAG="[HMSSdk]:",this.transportState="Disconnected",this.analyticsTimer=new Sr,this.sdkState=zt({},cc),this.isDiagnostics=!1,this.playlistSettings={video:{bitrate:Ur},audio:{bitrate:Fr}},this.handleAutoplayError=e=>{var t,i;null==(i=null==(t=this.errorListener)?void 0:t.onError)||i.call(t,e)},this.observer={onNotification:e=>{var t;if("on-peer-leave-request"!==e.method){switch(e.method){case"on-policy-change":this.analyticsTimer.end("on_policy_change_time");break;case"peer-list":this.analyticsTimer.end("peer_list_time"),this.sendJoinAnalyticsEvent(this.sdkState.isPreviewCalled);break;case"room-state":this.analyticsTimer.end("room_state_time");break;default:}null==(t=this.notificationManager)||t.handleNotification(e,this.sdkState.isReconnecting)}else this.handlePeerLeaveRequest(e.params)},onConnected:()=>{this.initNotificationManager()},onTrackAdd:e=>{var t;null==(t=this.notificationManager)||t.handleTrackAdd(e)},onTrackRemove:e=>{var t;null==(t=this.notificationManager)||t.handleTrackRemove(e)},onFailure:e=>{var t;null==(t=this.errorListener)||t.onError(e)},onStateChange:(e,t)=>Zt(this,null,(function*(){var i,n;let r=e=>Zt(this,null,(function*(){var t,i;yield this.internalLeave(!0,e),!this.sdkState.isPreviewInProgress&&!this.sdkState.isJoinInProgress&&(null==(i=null==(t=this.errorListener)?void 0:t.onError)||i.call(t,e)),this.sdkState.isReconnecting=!1}));switch(e){case"Preview":case"Joined":this.initNotificationManager(),"Reconnecting"===this.transportState&&(null==(i=this.listener)||i.onReconnected());break;case"Failed":yield r(t);break;case"Reconnecting":this.sdkState.isReconnecting=!0,null==(n=this.listener)||n.onReconnecting(t);break}this.transportState=e,bi.d(this.TAG,"Transport State Change",this.transportState)}))},this.handlePeerLeaveRequest=e=>{var t;let i=e.requested_by?this.store.getPeerById(e.requested_by):void 0,n={roomEnded:e.room_end,reason:e.reason,requestedBy:i};null==(t=this.listener)||t.onRemovedFromRoom(n),this.internalLeave(!1)},this.handlePreviewError=e=>{var t;this.analyticsTimer.end("preview_time"),e&&(null==(t=this.errorListener)||t.onError(e)),this.sendPreviewAnalyticsEvent(e),this.sdkState.isPreviewInProgress=!1},this.handleDeviceChange=e=>{var t,i;e.isUserSelection||(bi.d(this.TAG,"Device Change event",e),null==(i=null==(t=this.deviceChangeListener)?void 0:t.onDeviceChange)||i.call(t,e),(()=>{var t,i,n,r;if(e.error&&e.type){let s=e.type.includes("audio")?null==(t=this.localPeer)?void 0:t.audioTrack:null==(i=this.localPeer)?void 0:i.videoTrack;null==(n=this.errorListener)||n.onError(e.error),[Fi.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,Fi.TracksErrors.DEVICE_IN_USE,Fi.TracksErrors.DEVICE_NOT_AVAILABLE].includes(e.error.code)&&s&&(s.setEnabled(!1),null==(r=this.listener)||r.onTrackUpdate(2,s,this.localPeer))}})())},this.handleAudioPluginError=e=>{var t;bi.e(this.TAG,"Audio Plugin Error event",e),null==(t=this.errorListener)||t.onError(e)},this.handleError=e=>{var t;bi.e(this.TAG,e),null==(t=this.errorListener)||t.onError(e)},this.handleLocalRoleUpdate=e=>Zt(this,[e],(function*({oldRole:e,newRole:t}){var i;this.deviceManager.currentSelection=this.deviceManager.getCurrentSelection(),yield this.transport.handleLocalRoleUpdate({oldRole:e,newRole:t}),yield null==(i=this.roleChangeManager)?void 0:i.handleLocalPeerRoleUpdate({oldRole:e,newRole:t}),yield this.interactivityCenter.whiteboard.handleLocalRoleUpdate()})),this.unpauseRemoteVideoTracks=()=>{this.store.getRemoteVideoTracks().forEach((e=>e.handleTrackUnmute()))},this.sendAudioPresenceFailed=()=>{var e;let t=Wi.TracksErrors.NoAudioDetected("PREVIEW");bi.w(this.TAG,"Audio Presence Failure",this.transportState,t),this.isDiagnostics&&(null==(e=this.listener)||e.onError(t))},this.sendJoinAnalyticsEvent=(e=!1,t)=>{this.eventBus.analytics.publish(on.join(Kt(zt({error:t},this.analyticsTimer.getTimes()),{time:this.analyticsTimer.getTimeTaken("join_time"),is_preview_called:e,retries_join:this.transport.joinRetryCount})))},this.sendPreviewAnalyticsEvent=e=>{this.eventBus.analytics.publish(on.preview(Kt(zt({error:e},this.analyticsTimer.getTimes()),{time:this.analyticsTimer.getTimeTaken("preview_time")})))},this.sendAnalyticsEvent=e=>{this.isDiagnostics||this.analyticsEventsService.queue(e).flush()}}setSessionPeerInfo(e,t){var i,n,r,s;let o=this.store.getRoom();t&&o?this.sessionPeerInfo={peer:{peer_id:t.peerId,role:null==(i=t.role)?void 0:i.name,joined_at:(null==(n=t.joinedAt)?void 0:n.valueOf())||0,room_name:o.name,session_started_at:(null==(r=o.startedAt)?void 0:r.valueOf())||0,user_data:t.customerUserId,user_name:t.name,template_id:o.templateId,session_id:o.sessionId,token:null==(s=this.store.getConfig())?void 0:s.authToken},agent:this.store.getUserAgent(),device_id:Ki(),cluster:{websocket_url:e},timestamp:Date.now()}:bi.e(this.TAG,"setSessionPeerInfo> Local peer or room is undefined")}initNotificationManager(){this.notificationManager||(this.notificationManager=new El(this.store,this.eventBus,this.transport,this.listener,this.audioListener))}initStoreAndManagers(e){var t,i;if(this.listener=e,this.errorListener=e,this.deviceChangeListener=e,null==(t=this.store)||t.setErrorListener(this.errorListener),this.sdkState.isInitialised)return null==(i=this.notificationManager)||i.setListener(this.listener),this.audioSinkManager.setListener(this.listener),this.interactivityCenter.setListener(this.listener),void this.transport.setListener(this.listener);this.sdkState.isInitialised=!0,this.store=new Ka,this.store.setErrorListener(this.errorListener),this.eventBus=new rl,this.pluginUsageTracker=new Xa(this.eventBus),this.wakeLockManager=new Ja,this.networkTestManager=new Va(this.eventBus,this.listener),this.playlistManager=new fs(this,this.eventBus),this.deviceManager=new el(this.store,this.eventBus),this.audioSinkManager=new Za(this.store,this.deviceManager,this.eventBus),this.audioOutput=new tl(this.deviceManager,this.audioSinkManager),this.audioSinkManager.setListener(this.listener),this.eventBus.autoplayError.subscribe(this.handleAutoplayError),this.localTrackManager=new Er(this.store,this.observer,this.deviceManager,this.eventBus,this.analyticsTimer),this.analyticsEventsService=new Qa(this.store),this.transport=new ac(this.observer,this.deviceManager,this.store,this.eventBus,this.analyticsEventsService,this.analyticsTimer,this.pluginUsageTracker),"onInitSuccess"in e&&this.transport.setConnectivityListener(e),this.sessionStore=new Pl(this.transport),this.interactivityCenter=new ml(this.transport,this.store,this.listener),this.eventBus.analytics.subscribe(this.sendAnalyticsEvent),this.eventBus.deviceChange.subscribe(this.handleDeviceChange),this.eventBus.localVideoUnmutedNatively.subscribe(this.unpauseRemoteVideoTracks),this.eventBus.localAudioUnmutedNatively.subscribe(this.unpauseRemoteVideoTracks),this.eventBus.audioPluginFailed.subscribe(this.handleAudioPluginError),this.eventBus.error.subscribe(this.handleError)}validateJoined(e){if(!this.localPeer)throw Wi.GenericErrors.NotConnected("VALIDATION",`Not connected - ${e}`)}sendHLSAnalytics(e){this.sendAnalyticsEvent(on.hlsPlayerError(e))}refreshDevices(){return Zt(this,null,(function*(){this.validateJoined("refreshDevices"),yield this.deviceManager.init(!0)}))}getWebrtcInternals(){var e;return null==(e=this.transport)?void 0:e.getWebrtcInternals()}getDebugInfo(){var e;if(!this.transport)throw bi.e(this.TAG,"Transport is not defined"),new Error("getDebugInfo can only be called after join");let t=this.transport.getWebsocketEndpoint(),i=Object.values(fl).filter((e=>this.transport.isFlagEnabled(e))),n=null==(e=this.store.getConfig())?void 0:e.initEndpoint;return{websocketURL:t,enabledFlags:i,initEndpoint:n}}getSessionStore(){return this.sessionStore}getPlaylistManager(){return this.playlistManager}getRecordingState(){var e;return null==(e=this.store.getRoom())?void 0:e.recording}getRTMPState(){var e;return null==(e=this.store.getRoom())?void 0:e.rtmp}getHLSState(){var e;return null==(e=this.store.getRoom())?void 0:e.hls}getTranscriptionState(){var e;return null==(e=this.store.getRoom())?void 0:e.transcriptions}getTemplateAppData(){return this.store.getTemplateAppData()}getInteractivityCenter(){return this.interactivityCenter}getPeerListIterator(e){return new ls(this.transport,this.store,e)}updatePlaylistSettings(e){e.video&&Object.assign(this.playlistSettings.video,e.video),e.audio&&Object.assign(this.playlistSettings.audio,e.audio)}get localPeer(){var e;return null==(e=this.store)?void 0:e.getLocalPeer()}preview(e,t){return Zt(this,null,(function*(){if(Zi(),Yi(),this.sdkState.isPreviewInProgress)return Promise.reject(Wi.GenericErrors.PreviewAlreadyInProgress("PREVIEW","Preview already called"));if(["Joined","Reconnecting"].includes(this.transportState))return this.midCallPreview(e.asRole,e.settings);this.analyticsTimer.start("preview_time"),this.setUpPreview(e,t);let i=!1,n=!1,r=setTimeout((()=>{var e,t;(!i||!n)&&(null==(t=null==(e=this.listener)?void 0:e.onNetworkQuality)||t.call(e,-1))}),3e3);return new Promise(((s,o)=>{let a=()=>Zt(this,null,(function*(){var i;if(this.localPeer){let t=e.asRole&&this.store.getPolicyForRole(e.asRole);this.localPeer.asRole=t||this.localPeer.role}let n=yield this.localTrackManager.getTracksToPublish(e.settings);n.forEach((e=>{var t;if(this.setLocalPeerTrack(e),e.isTrackNotPublishing()){let i=Wi.TracksErrors.NoDataInTrack(`${e.type} track has no data. muted: ${e.nativeTrack.muted}, readyState: ${e.nativeTrack.readyState}`);bi.e(this.TAG,i),this.sendAnalyticsEvent(on.publish({devices:this.deviceManager.getDevices(),error:i})),null==(t=this.listener)||t.onError(i)}})),null!=(i=this.localPeer)&&i.audioTrack&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),this.sdkState.isPreviewInProgress=!1,this.analyticsTimer.end("preview_time");let r=this.store.getRoom();r&&t.onPreview(r,n),this.sendPreviewAnalyticsEvent(),s()}));this.eventBus.policyChange.subscribeOnce(a),this.eventBus.leave.subscribeOnce(this.handlePreviewError),this.eventBus.leave.subscribeOnce((e=>o(e))),this.transport.preview(e.authToken,e.initEndpoint,this.localPeer.peerId,{name:e.userName,metaData:e.metaData||""},e.autoVideoSubscribe,e.iceServers).then((t=>{var s;i=!0,clearTimeout(r),t&&e.captureNetworkQualityInPreview&&this.networkTestManager.start(null==(s=t.config)?void 0:s.networkHealth).then((()=>{n=!0}))})).catch((e=>{this.handlePreviewError(e),o(e)}))}))}))}midCallPreview(e,t){return Zt(this,null,(function*(){var i,n;if(!this.localPeer||"Joined"!==this.transportState)throw Wi.GenericErrors.NotConnected("VALIDATION","Not connected - midCallPreview");let r=e&&this.store.getPolicyForRole(e);if(!r)throw Wi.GenericErrors.InvalidRole("PREVIEW",`role ${e} does not exist in policy`);this.localPeer.asRole=r;let s=yield this.localTrackManager.getTracksToPublish(t);s.forEach((e=>this.setLocalPeerTrack(e))),null!=(i=this.localPeer)&&i.audioTrack&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),null==(n=this.listener)||n.onPreview(this.store.getRoom(),s)}))}cancelMidCallPreview(){return Zt(this,null,(function*(){var e,t,i;if((!this.localPeer||!this.localPeer.isInPreview())&&bi.w(this.TAG,"Cannot cancel mid call preview as preview is not in progress"),null!=(e=this.localPeer)&&e.asRole&&this.localPeer.role){let e=this.localPeer.asRole,n=this.localPeer.role;delete this.localPeer.asRole,yield null==(t=this.roleChangeManager)?void 0:t.diffRolesAndPublishTracks({oldRole:e,newRole:n}),null==(i=this.listener)||i.onPeerUpdate(8,this.localPeer)}}))}join(e,t){return Zt(this,null,(function*(){var i,n,r,s,o,a,l,c,u;if(Zi(),Yi(),this.sdkState.isPreviewInProgress)throw Wi.GenericErrors.NotReady("JOIN","Preview is in progress, can't join");null==(n=null==(i=this.eventBus)?void 0:i.leave)||n.unsubscribe(this.handlePreviewError),this.analyticsTimer.start("join_time"),this.sdkState.isJoinInProgress=!0;let{roomId:d,userId:h,role:p}=lc(e.authToken),f=(null==(s=null==(r=this.localPeer)?void 0:r.asRole)?void 0:s.name)||(null==(a=null==(o=this.localPeer)?void 0:o.role)?void 0:a.name);null==(l=this.networkTestManager)||l.stop(),this.commonSetup(e,d,t),this.removeDevicesFromConfig(e),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),Bn.resumeContext();let v=this.store.getConfig();null!=v&&v.autoManageWakeLock&&this.wakeLockManager.acquireLock(),this.localPeer?(this.localPeer.name=e.userName,this.localPeer.role=this.store.getPolicyForRole(p),this.localPeer.customerUserId=h,this.localPeer.metadata=e.metaData,delete this.localPeer.asRole):this.createAndAddLocalPeerToStore(e,p,h),this.roleChangeManager=new Wa(this.store,this.transport,this.deviceManager,this.getAndPublishTracks.bind(this),this.removeTrack.bind(this),this.listener),this.eventBus.localRoleUpdate.subscribe(this.handleLocalRoleUpdate),bi.d(this.TAG,` Joining room ${d}`),bi.time(`join-room-${d}`);try{yield this.transport.join(e.authToken,this.localPeer.peerId,{name:e.userName,metaData:e.metaData},e.initEndpoint,e.autoVideoSubscribe,e.iceServers),bi.d(this.TAG,` Joined room ${d}`),this.analyticsTimer.start("peer_list_time"),yield this.notifyJoin(),this.sdkState.isJoinInProgress=!1,yield this.publish(e.settings,f),yield this.deviceManager.autoSelectAudioOutput(),"suspended"===Bn.getAudioContext().state&&(null==(c=this.listener)||c.onError(Wi.TracksErrors.AutoplayBlocked("JOIN")))}catch(ct){throw this.analyticsTimer.end("join_time"),this.sdkState.isJoinInProgress=!1,null==(u=this.listener)||u.onError(ct),this.sendJoinAnalyticsEvent(this.sdkState.isPreviewCalled,ct),bi.e(this.TAG,"Unable to join room",ct),ct}bi.timeEnd(`join-room-${d}`)}))}stringifyMetadata(e){e.metaData&&"string"!=typeof e.metaData?e.metaData=JSON.stringify(e.metaData):e.metaData||(e.metaData="")}cleanup(){var e,t,i;this.cleanDeviceManagers(),this.eventBus.analytics.unsubscribe(this.sendAnalyticsEvent),this.eventBus.localVideoUnmutedNatively.unsubscribe(this.unpauseRemoteVideoTracks),this.eventBus.localAudioUnmutedNatively.unsubscribe(this.unpauseRemoteVideoTracks),this.eventBus.error.unsubscribe(this.handleError),this.analyticsTimer.cleanup(),dn.cleanup(),this.playlistManager.cleanup(),null==(e=this.wakeLockManager)||e.cleanup(),Er.cleanup(),this.notificationManager=void 0,bi.cleanup(),this.sdkState=zt({},cc),this.localPeer&&(null==(t=this.localPeer.audioTrack)||t.cleanup(),this.localPeer.audioTrack=void 0,null==(i=this.localPeer.videoTrack)||i.cleanup(),this.localPeer.videoTrack=void 0),this.store.cleanup(),this.listener=void 0,this.roleChangeManager&&this.eventBus.localRoleUpdate.unsubscribe(this.handleLocalRoleUpdate)}leave(e){return this.internalLeave(e)}internalLeave(e=!0,t){return Zt(this,null,(function*(){var i,n,r,s;let o=null==(i=this.store)?void 0:i.getRoom();if(o){for(;(this.sdkState.isPreviewInProgress||this.sdkState.isJoinInProgress)&&(null==t||!t.isTerminal);)yield qn(100);let i=o.id;this.setSessionPeerInfo(this.transport.getWebsocketEndpoint()||"",this.localPeer),null==(n=this.networkTestManager)||n.stop(),this.eventBus.leave.publish(t);let a=null==(r=this.localPeer)?void 0:r.peerId;bi.d(this.TAG,` Leaving room ${i}, peerId=${a}`),yield null==(s=this.transport)?void 0:s.leave(e,t?"sdk request":"user request"),this.cleanup(),bi.d(this.TAG,` Left room ${i}, peerId=${a}`)}}))}getAuthTokenByRoomCode(e,t){return Zt(this,null,(function*(){let i=(t||{}).endpoint||"https://auth.100ms.live/v2/token";this.analyticsTimer.start("GET_TOKEN");let n=yield ja(i,{method:"POST",body:JSON.stringify({code:e.roomCode,user_id:e.userId})},[429,500,501,502,503,504,505,506,507,508,509,510,511]),r=yield n.json();if(this.analyticsTimer.end("GET_TOKEN"),!n.ok)throw Wi.APIErrors.ServerErrors(r.code,"GET_TOKEN",r.message,!1);let{token:s}=r;if(!s)throw Error(r.message);return s}))}getLocalPeer(){return this.store.getLocalPeer()}getPeers(){return this.store.getPeers()}getPeerMap(){return this.store.getPeerMap()}getAudioOutput(){return this.audioOutput}sendMessage(e,t){this.sendMessageInternal({message:t,type:e})}sendBroadcastMessage(e,t){return Zt(this,null,(function*(){return yield this.sendMessageInternal({message:e,type:t})}))}sendGroupMessage(e,t,i){return Zt(this,null,(function*(){let n=this.store.getKnownRoles();if(0===(t.filter((e=>n[e.name]))||[]).length)throw Wi.GenericErrors.ValidationFailed("No valid role is present",t);return yield this.sendMessageInternal({message:e,recipientRoles:t,type:i})}))}sendDirectMessage(e,t,i){return Zt(this,null,(function*(){var n,r;if((null==(n=this.localPeer)?void 0:n.peerId)===t)throw Wi.GenericErrors.ValidationFailed("Cannot send message to self");let s=!(null==(r=this.store.getRoom())||!r.large_room_optimization),o=this.store.getPeerById(t);if(!o){if(!s)throw Wi.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);{let e=yield this.transport.signal.getPeer({peer_id:t});if(!e)throw Wi.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);o=as(e,this.store)}}return yield this.sendMessageInternal({message:e,recipientPeer:o,type:i})}))}submitSessionFeedback(e,t){return Zt(this,null,(function*(){if(!this.sessionPeerInfo)throw bi.e(this.TAG,"submitSessionFeedback> session is undefined"),new Error("session is undefined");let i=this.sessionPeerInfo.peer.token;if(!i)throw bi.e(this.TAG,"submitSessionFeedback> token is undefined"),new Error("Internal error, token is not present");try{yield il.sendFeedback({token:i,info:this.sessionPeerInfo,feedback:e,eventEndpoint:t}),bi.i(this.TAG,"submitSessionFeedback> submitted feedback"),this.sessionPeerInfo=void 0}catch(Ne){throw bi.e(this.TAG,"submitSessionFeedback> error occured ",Ne),new Error("Unable to submit feedback")}}))}getPeer(e){return Zt(this,null,(function*(){let t=yield this.transport.signal.getPeer({peer_id:e});if(t)return as(t,this.store)}))}findPeerByName(e){return Zt(this,arguments,(function*({query:e,limit:t=10,offset:i}){let{peers:n,offset:r,eof:s}=yield this.transport.signal.findPeerByName({query:null==e?void 0:e.toLowerCase(),limit:t,offset:i});return n.length>0?{offset:r,eof:s,peers:n.map((e=>as({peer_id:e.peer_id,role:e.role,groups:[],info:{name:e.name,data:"",user_id:"",type:e.type}},this.store)))}:{offset:r,peers:[]}}))}sendMessageInternal(e){return Zt(this,arguments,(function*({recipientRoles:e,recipientPeer:t,type:i="chat",message:n}){if(""===n.replace(/\u200b/g," ").trim())throw bi.w(this.TAG,"sendMessage","Ignoring empty message send"),Wi.GenericErrors.ValidationFailed("Empty message not allowed");let r={info:{message:n,type:i}};return null!=e&&e.length&&(r.roles=e.map((e=>e.name))),null!=t&&t.peerId&&(r.peer_id=t.peerId),bi.d(this.TAG,"Sending Message: ",r),yield this.transport.signal.broadcast(r)}))}startScreenShare(e,t){return Zt(this,null,(function*(){var i,n,r;let s=this.store.getPublishParams();if(!s)return;let{allowed:o}=s;if(!o||!o.includes("screen"))return void bi.e(this.TAG,`Role ${null==(i=this.localPeer)?void 0:i.role} cannot share screen`);if(null!=(r=null==(n=this.localPeer)?void 0:n.auxiliaryTracks)&&r.find((e=>"screen"===e.source)))throw Error("Cannot share multiple screens");let a=yield this.getScreenshareTracks(e,t);if(!this.localPeer)return bi.d(this.TAG,"Screenshared when not connected"),void a.forEach((e=>{e.cleanup()}));this.transport.setOnScreenshareStop((()=>{this.stopEndedScreenshare(e)})),yield this.transport.publish(a),a.forEach((e=>{var t,i,n;e.peerId=null==(t=this.localPeer)?void 0:t.peerId,null==(i=this.localPeer)||i.auxiliaryTracks.push(e),null==(n=this.listener)||n.onTrackUpdate(0,e,this.localPeer)}))}))}stopEndedScreenshare(e){return Zt(this,null,(function*(){bi.d(this.TAG," Screenshare ended natively"),yield this.stopScreenShare(),e()}))}stopScreenShare(){return Zt(this,null,(function*(){var e;bi.d(this.TAG," Screenshare ended from app");let t=null==(e=this.localPeer)?void 0:e.auxiliaryTracks.filter((e=>"screen"===e.source));if(t)for(let i of t)yield this.removeTrack(i.trackId)}))}addTrack(e,t="regular"){return Zt(this,null,(function*(){var i,n,r,s;if(!e)return void bi.w(this.TAG,"Please pass a valid MediaStreamTrack");if(!this.localPeer)throw Wi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot addTrack");if(this.localPeer.auxiliaryTracks.find((t=>t.trackId===e.id)))return;let o=e.kind,a=new MediaStream([e]),l=new Vr(a),c="audio"===o?tr:Cr,u=new c(l,e,t,this.eventBus);yield this.applySettings(u),yield this.setPlaylistSettings({track:e,hmsTrack:u,source:t}),yield null==(i=this.transport)?void 0:i.publish([u]),u.peerId=null==(n=this.localPeer)?void 0:n.peerId,null==(r=this.localPeer)||r.auxiliaryTracks.push(u),null==(s=this.listener)||s.onTrackUpdate(0,u,this.localPeer)}))}removeTrack(e,t=!1){return Zt(this,null,(function*(){var i;if(!this.localPeer)throw Wi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot removeTrack");let n=this.localPeer.auxiliaryTracks.findIndex((t=>t.trackId===e));if(n>-1){let e=this.localPeer.auxiliaryTracks[n];e.isPublished?yield this.transport.unpublish([e]):yield e.cleanup(),t||this.stopPlaylist(e),this.localPeer.auxiliaryTracks.splice(n,1),null==(i=this.listener)||i.onTrackUpdate(1,e,this.localPeer)}else bi.w(this.TAG,`No track found for ${e}`)}))}setAnalyticsLevel(e){this.analyticsEventsService.level=e}setLogLevel(e){bi.level=e}addAudioListener(e){var t;this.audioListener=e,null==(t=this.notificationManager)||t.setAudioListener(e)}addConnectionQualityListener(e){var t;null==(t=this.notificationManager)||t.setConnectionQualityListener(e)}setIsDiagnostics(e){this.isDiagnostics=e}changeRole(e,t,i=!1){return Zt(this,null,(function*(){var n;yield null==(n=this.transport)?void 0:n.signal.requestRoleChange({requested_for:e,role:t,force:i})}))}changeRoleOfPeer(e,t,i=!1){return Zt(this,null,(function*(){var n;yield null==(n=this.transport)?void 0:n.signal.requestRoleChange({requested_for:e,role:t,force:i})}))}changeRoleOfPeersWithRoles(e,t){return Zt(this,null,(function*(){var i;e.length<=0||!t||(yield null==(i=this.transport)?void 0:i.signal.requestBulkRoleChange({roles:e.map((e=>e.name)),role:t,force:!0}))}))}acceptChangeRole(e){return Zt(this,null,(function*(){var t,i;yield null==(i=this.transport)?void 0:i.signal.acceptRoleChangeRequest({requested_by:null==(t=e.requestedBy)?void 0:t.peerId,role:e.role.name,token:e.token})}))}endRoom(e,t){return Zt(this,null,(function*(){var i;if(!this.localPeer)throw Wi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot end room");yield null==(i=this.transport)?void 0:i.signal.endRoom(e,t),yield this.leave()}))}removePeer(e,t){return Zt(this,null,(function*(){var i;if(!this.localPeer)throw Wi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot remove peer");yield null==(i=this.transport)?void 0:i.signal.removePeer({requested_for:e,reason:t})}))}startRTMPOrRecording(e){return Zt(this,null,(function*(){var t,i;if(!this.localPeer)throw Wi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot start streaming or recording");let n={meeting_url:e.meetingURL,record:e.record};null!=(t=e.rtmpURLs)&&t.length&&(n.rtmp_urls=e.rtmpURLs),e.resolution&&(n.resolution=e.resolution),yield null==(i=this.transport)?void 0:i.signal.startRTMPOrRecording(n)}))}stopRTMPAndRecording(){return Zt(this,null,(function*(){var e;if(!this.localPeer)throw Wi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot stop streaming or recording");yield null==(e=this.transport)?void 0:e.signal.stopRTMPAndRecording()}))}startHLSStreaming(e){return Zt(this,null,(function*(){var t;if(!this.localPeer)throw Wi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot start HLS streaming");let i={};e&&e.variants&&e.variants.length>0&&(i.variants=e.variants.map((e=>{let t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t}))),null!=e&&e.recording&&(i.hls_recording={single_file_per_layer:e.recording.singleFilePerLayer,hls_vod:e.recording.hlsVod}),yield null==(t=this.transport)?void 0:t.signal.startHLSStreaming(i)}))}stopHLSStreaming(e){return Zt(this,null,(function*(){var t,i,n;if(!this.localPeer)throw Wi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot stop HLS streaming");if(e){let n={variants:null==(t=null==e?void 0:e.variants)?void 0:t.map((e=>{let t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t}))};yield null==(i=this.transport)?void 0:i.signal.stopHLSStreaming(n)}yield null==(n=this.transport)?void 0:n.signal.stopHLSStreaming()}))}startTranscription(e){return Zt(this,null,(function*(){var t;if(!this.localPeer)throw Wi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot start transcriptions");let i={mode:e.mode};yield null==(t=this.transport)?void 0:t.signal.startTranscription(i)}))}stopTranscription(e){return Zt(this,null,(function*(){var t;if(!this.localPeer)throw Wi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot stop transcriptions");if(!e)throw Wi.GenericErrors.Signalling("VALIDATION","No mode is passed to stop the transcription");let i={mode:e.mode};yield null==(t=this.transport)?void 0:t.signal.stopTranscription(i)}))}sendHLSTimedMetadata(e){return Zt(this,null,(function*(){var t;if(this.validateJoined("sendHLSTimedMetadata"),e.length>0){let i={metadata_objs:e};yield null==(t=this.transport)?void 0:t.signal.sendHLSTimedMetadata(i)}}))}changeName(e){return Zt(this,null,(function*(){var t,i;this.validateJoined("changeName");let n=this.store.getLocalPeer();n&&n.name!==e&&(yield null==(t=this.transport)?void 0:t.signal.updatePeer({name:e}),null==(i=this.notificationManager)||i.updateLocalPeer({name:e}))}))}changeMetadata(e){return Zt(this,null,(function*(){var t,i;this.validateJoined("changeMetadata"),yield null==(t=this.transport)?void 0:t.signal.updatePeer({data:e}),null==(i=this.notificationManager)||i.updateLocalPeer({metadata:e})}))}setSessionMetadata(e){return Zt(this,null,(function*(){var t;yield null==(t=this.transport)?void 0:t.signal.setSessionMetadata({key:"default",data:e})}))}getSessionMetadata(){return Zt(this,null,(function*(){var e;return(yield null==(e=this.transport)?void 0:e.signal.getSessionMetadata("default")).data}))}getRoles(){return Object.values(this.store.getKnownRoles())}changeTrackState(e,t){return Zt(this,null,(function*(){var i;if("video"===e.type&&"regular"!==e.source)return void bi.w(this.TAG,"Muting non-regular video tracks is currently not supported");if(e.enabled===t)return void bi.w(this.TAG,`Aborting change track state, track already has enabled - ${t}`,e);if(!this.store.getTrackById(e.trackId))throw Wi.GenericErrors.ValidationFailed("No track found for change track state",e);let n=this.store.getPeerByTrackId(e.trackId);if(!n)throw Wi.GenericErrors.ValidationFailed("No peer found for change track state",e);yield null==(i=this.transport)?void 0:i.signal.requestTrackStateChange({requested_for:n.peerId,track_id:e.trackId,stream_id:e.stream.id,mute:!t})}))}changeMultiTrackState(e){return Zt(this,null,(function*(){var t;if("boolean"!=typeof e.enabled)throw Wi.GenericErrors.ValidationFailed("Pass a boolean for enabled");let{enabled:i,roles:n,type:r,source:s}=e;yield null==(t=this.transport)?void 0:t.signal.requestMultiTrackStateChange({value:!i,type:r,source:s,roles:null==n?void 0:n.map((e=>null==e?void 0:e.name))})}))}raiseLocalPeerHand(){return Zt(this,null,(function*(){var e;this.validateJoined("raiseLocalPeerHand"),yield null==(e=this.transport)?void 0:e.signal.joinGroup(Nr)}))}lowerLocalPeerHand(){return Zt(this,null,(function*(){var e;this.validateJoined("lowerLocalPeerHand"),yield null==(e=this.transport)?void 0:e.signal.leaveGroup(Nr)}))}raiseRemotePeerHand(e){return Zt(this,null,(function*(){var t;yield null==(t=this.transport)?void 0:t.signal.addToGroup(e,Nr)}))}lowerRemotePeerHand(e){return Zt(this,null,(function*(){var t;yield null==(t=this.transport)?void 0:t.signal.removeFromGroup(e,Nr)}))}setFrameworkInfo(e){this.frameworkInfo=zt(zt({},this.frameworkInfo),e)}attachVideo(e,t){return Zt(this,null,(function*(){let i=this.store.getConfig();null!=i&&i.autoManageVideo?e.attach(t):yield e.addSink(t)}))}detachVideo(e,t){return Zt(this,null,(function*(){let i=this.store.getConfig();null!=i&&i.autoManageVideo?e.detach(t):yield e.removeSink(t)}))}publish(e,t){return Zt(this,null,(function*(){var i,n,r;if([this.store.getPublishParams(),!this.sdkState.published,!Ai].every((e=>!!e))){let s=t&&t!==(null==(n=null==(i=this.localPeer)?void 0:i.role)?void 0:n.name)?()=>{var e;return null==(e=this.roleChangeManager)?void 0:e.diffRolesAndPublishTracks({oldRole:this.store.getPolicyForRole(t),newRole:this.localPeer.role})}:()=>this.getAndPublishTracks(e);yield null==(r=null==s?void 0:s())?void 0:r.catch((e=>{var t;bi.e(this.TAG,"Error in publish",e),null==(t=this.listener)||t.onError(e)}))}}))}getAndPublishTracks(e){return Zt(this,null,(function*(){var t,i;let n=yield this.localTrackManager.getTracksToPublish(e);yield this.setAndPublishTracks(n),null==(i=null==(t=this.localPeer)?void 0:t.audioTrack)||i.initAudioLevelMonitor(),this.sdkState.published=!0}))}setAndPublishTracks(e){return Zt(this,null,(function*(){var t,i;for(let n of e){if(yield this.transport.publish([n]),n.isTrackNotPublishing()){let e=Wi.TracksErrors.NoDataInTrack(`${n.type} track has no data. muted: ${n.nativeTrack.muted}, readyState: ${n.nativeTrack.readyState}`);bi.e(this.TAG,e),this.sendAnalyticsEvent(on.publish({devices:this.deviceManager.getDevices(),error:e})),null==(t=this.listener)||t.onError(e)}this.setLocalPeerTrack(n),null==(i=this.listener)||i.onTrackUpdate(0,n,this.localPeer)}yield this.initDeviceManagers()}))}setLocalPeerTrack(e){var t;switch(e.peerId=null==(t=this.localPeer)?void 0:t.peerId,e.type){case"audio":this.localPeer.audioTrack=e;break;case"video":this.localPeer.videoTrack=e;break}}initDeviceManagers(){return Zt(this,null,(function*(){var e,t,i,n,r;this.sdkState.deviceManagersInitialised||(this.sdkState.deviceManagersInitialised=!0,yield this.deviceManager.init(),(yield this.deviceManager.updateOutputDevice(null==(t=null==(e=this.store.getConfig())?void 0:e.settings)?void 0:t.audioOutputDeviceId))||(yield this.deviceManager.updateOutputDevice(null==(n=null==(i=dn.getSelection())?void 0:i.audioOutput)?void 0:n.deviceId)),this.audioSinkManager.init(null==(r=this.store.getConfig())?void 0:r.audioSinkElementId))}))}cleanDeviceManagers(){this.eventBus.deviceChange.unsubscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.unsubscribe(this.handleAudioPluginError),this.eventBus.autoplayError.unsubscribe(this.handleAutoplayError),this.deviceManager.cleanup(),this.audioSinkManager.cleanup()}initPreviewTrackAudioLevelMonitor(){var e;let t=null==(e=this.localPeer)?void 0:e.audioTrack;null==t||t.initAudioLevelMonitor(),this.eventBus.trackAudioLevelUpdate.subscribe((e=>{var i;let n=e&&e.track.trackId===(null==t?void 0:t.trackId)?[{audioLevel:e.audioLevel,peer:this.localPeer,track:t}]:[];this.store.updateSpeakers(n),null==(i=this.audioListener)||i.onAudioLevelUpdate(n)})),this.eventBus.localAudioSilence.subscribe(this.sendAudioPresenceFailed)}notifyJoin(){var e;let t=this.store.getLocalPeer(),i=this.store.getRoom();if(i)return i.joinedAt=new Date,t&&(t.joinedAt=i.joinedAt),null!=t&&t.role?(this.analyticsTimer.end("join_time"),void(null==(e=this.listener)||e.onJoin(i))):new Promise(((e,t)=>{this.eventBus.policyChange.subscribeOnce((()=>{var t;this.analyticsTimer.end("join_time"),null==(t=this.listener)||t.onJoin(i),e()})),this.eventBus.leave.subscribeOnce((e=>{t(e)}))}));bi.w(this.TAG,"notify join - room not present")}setUpPreview(e,t){this.sdkState.isPreviewCalled=!0,this.sdkState.isPreviewInProgress=!0;let{roomId:i,userId:n,role:r}=lc(e.authToken);this.commonSetup(e,i,t),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.createAndAddLocalPeerToStore(e,r,n,e.asRole)}setPlaylistSettings(e){return Zt(this,arguments,(function*({track:e,hmsTrack:t,source:i}){var n,r;if("videoplaylist"===i){let i={};if("audio"===e.kind)i.maxBitrate=(null==(n=this.playlistSettings.audio)?void 0:n.bitrate)||Fr;else{i.maxBitrate=(null==(r=this.playlistSettings.video)?void 0:r.bitrate)||Ur;let{width:t,height:n}=e.getSettings();i.width=t,i.height=n}yield t.setSettings(i)}else"audioplaylist"===i&&(yield t.setSettings({maxBitrate:64}))}))}createAndAddLocalPeerToStore(e,t,i,n){let r=this.store.getPolicyForRole(t),s=n?this.store.getPolicyForRole(n):void 0,o=new ss({name:e.userName||"",customerUserId:i,metadata:e.metaData||"",role:r,asRole:s||r,type:"regular"});this.store.addPeer(o)}commonSetup(e,t,i){this.stringifyMetadata(e),e.initEndpoint||(e.initEndpoint="https://prod-init.100ms.live"),this.initStoreAndManagers(i),this.store.getRoom()||this.store.setRoom(new Fa(t))}removeDevicesFromConfig(e){this.store.getConfig()&&e.settings&&(delete e.settings.audioOutputDeviceId,delete e.settings.videoDeviceId,delete e.settings.audioInputDeviceId)}getScreenshareTracks(e,t){return Zt(this,null,(function*(){let i=this.transport.isFlagEnabled("scaleScreenshareBasedOnPixels"),[n,r]=yield this.localTrackManager.getLocalScreen(t,i),s=()=>{this.stopEndedScreenshare(e)},o=[];if(null!=t&&t.audioOnly){if(n.nativeTrack.stop(),!r)throw Wi.TracksErrors.NothingToReturn("TRACK","Select share audio when sharing screen","No audio found");o.push(r),r.nativeTrack.addEventListener("ended",s)}else o.push(n),n.nativeTrack.addEventListener("ended",s),r&&o.push(r);return o}))}stopPlaylist(e){"audioplaylist"===e.source?this.playlistManager.stop("audio"):"videoplaylist"===e.source&&this.playlistManager.stop("video")}applySettings(e){return Zt(this,null,(function*(){Xi(this.store);let t=this.store.getPublishParams();if(t)if(e instanceof Cr){let i="regular"===e.source?"video":"screen"===e.source?"screen":"";if(!i||!t.allowed.includes(i))return;let n=t[i];if(!n)return;let r=(new An).codec(n.codec).maxBitrate(n.bitRate).maxFramerate(n.frameRate).setWidth(n.width).setHeight(n.height).build();yield e.setSettings(r)}else if(e instanceof tr){if(!t.allowed.includes("audio"))return;let i=(new Cn).codec(t.audio.codec).maxBitrate(t.audio.bitRate).build();yield e.setSettings(i)}}))}},dc=class e{constructor(t,i,n){this.getStats=()=>(this.stats||(this.stats=new mc(this.store,this.sdk)),this.stats),this.getDiagnosticsSDK=()=>(this.diagnostics||(this.diagnostics=this.actions.initDiagnostics()),this.diagnostics),this.store=t||e.createNewHMSStore($a("HMSStore"),ti),this.notifications=n||new aa(this.store),i?this.actions=i:(this.sdk=new uc,this.actions=new Ga(this.store,this.sdk,this.notifications)),this.actions.setFrameworkInfo({type:"js",sdkVersion:Xt().version}),this.initialTriggerOnSubscribe=!1,_i&&(window.__hms=this)}triggerOnSubscribe(){this.initialTriggerOnSubscribe||(e.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}getStore(){return this.store}getHMSActions(){return this.actions}getActions(){return this.actions}getNotifications(){return{onNotification:this.notifications.onNotification}}static createNewHMSStore(t,i){let n=Nt((()=>i())),r=n.setState;n.setState=e=>{let t="function"==typeof e?Dt(e):e;r(t)};let s=n.getState;n.getState=e=>e?e(s()):s(),e.compareWithShallowCheckInSubscribe(n);let o=e.setUpDevtools(n,t);return Kt(zt({},n),{namedSetState:o})}static makeStoreTriggerOnSubscribe(e){let t=e.subscribe;e.subscribe=(i,n,r)=>(i(e.getState(n),void 0),t(i,n,r))}static compareWithShallowCheckInSubscribe(e){let t=e.subscribe;e.subscribe=(e,i,n)=>(i||(i=e=>e),n=n||Mt,t(e,i,n))}static setUpDevtools(t,i){let n;try{n=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch(je){}if(!n)return e=>{t.setState(e)};let r=n.connect(e.devtoolsOptions(i));r.prefix=i?`${i} > `:"";let s=t.setState;return t.setState=e=>{s(e),r.send(`${r.prefix}setState`,t.getState())},r.subscribe(e.devtoolsSubscribe(r,t,s)),r.send("setUpStore",t.getState()),(e,i)=>{s(e);let n=i||`${r.prefix}action`;r.send(n,t.getState())}}static devtoolsOptions(e){return{name:e,actionsBlacklist:["audioLevel","playlistProgress","connectionQuality"]}}static devtoolsSubscribe(e,t,i){return n=>{var r,s,o,a;if("DISPATCH"===n.type&&n.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(n.payload.type)?i(JSON.parse(n.state)):t.setState(JSON.parse(n.state));else if("DISPATCH"===n.type&&"COMMIT"===(null==(r=n.payload)?void 0:r.type))e.init(t.getState());else if("DISPATCH"===n.type&&"IMPORT_STATE"===(null==(s=n.payload)?void 0:s.type)){let r=null==(o=n.payload.nextLiftedState)?void 0:o.actionsById;((null==(a=n.payload.nextLiftedState)?void 0:a.computedStates)||[]).forEach((({state:n},s)=>{let o=r[s]||`${e.prefix}setState`;0===s?e.init(n):(i(n),e.send(o,t.getState()))}))}}}},hc=(e,t,i)=>{let n;"Connected"===i.getState(Ws)&&(n=pc(e,t,i)),i.subscribe((r=>{["Connected","Reconnecting"].includes(r)?n||(n=pc(e,t,i)):["Disconnected","Failed"].includes(r)&&n&&(gc(t,r),n(),n=void 0)}),Ws)},pc=(e,t,i)=>{var n,r;let s=fc(i,t);null==(n=e.getWebrtcInternals())||n.start();let o=null==(r=e.getWebrtcInternals())?void 0:r.onStatsChange((n=>vc(t,n,i,e)));return()=>{s(),o&&o()}},fc=(e,t)=>{let i,n,r;return e.getState(Rs)?t.namedSetState((t=>{t.localPeer.id=e.getState(Rs)}),"localpeer-id"):i=e.subscribe((e=>{e&&t.namedSetState((t=>{t.localPeer.id=e}),"localpeer-id")}),Rs),e.getState(Ds)?t.namedSetState((t=>{t.localPeer.videoTrack=e.getState(Ds)}),"localpeer-videotrack-id"):n=e.subscribe((e=>{e&&t.namedSetState((t=>{t.localPeer.videoTrack=e}),"localpeer-videotrack-id")}),Ds),e.getState(Ls)?t.namedSetState((t=>{t.localPeer.audioTrack=e.getState(Ls)}),"localpeer-audiotrack-id"):r=e.subscribe((e=>{e&&t.namedSetState((t=>{t.localPeer.audioTrack=e}),"localpeer-audiotrack-id")}),Ls),()=>{null==i||i(),null==n||n(),null==r||r()}},vc=(e,t,i,n)=>{let r=i.getState(ks);e.namedSetState((e=>{let s=i.getState(Rs),o={},a=Object.keys(r).filter((e=>r[e].peerId!==s));for(let i of a){let e=t.getRemoteTrackStats(i);e&&(o[i]=e)}va(e.remoteTrackStats,o);let l={[s]:t.getLocalPeerStats()};va(e.peerStats,l),ga(e.localTrackStats,t.getLocalTrackStats(),n.store.getLocalPeerTracks())}),"webrtc-stats")},gc=(e,t="resetState")=>{e.namedSetState((e=>{Object.assign(e,ii())}),t)},mc=class{constructor(e,t){this.hmsStore=e,this.sdk=t,this.store=dc.createNewHMSStore($a("HMSStatsStore"),ii),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=()=>new Promise((e=>{var t,i;"Connected"===this.hmsStore.getState(Ws)?e(null==(i=null==(t=this.sdk)?void 0:t.getWebrtcInternals())?void 0:i.getPublishPeerConnection()):this.hmsStore.subscribe((t=>{var i,n;"Connected"===t&&e(null==(n=null==(i=this.sdk)?void 0:i.getWebrtcInternals())?void 0:n.getPublishPeerConnection())}),Ws)})),this.getSubscribePeerConnection=()=>new Promise((e=>{var t,i;"Connected"===this.hmsStore.getState(Ws)?e(null==(i=null==(t=this.sdk)?void 0:t.getWebrtcInternals())?void 0:i.getSubscribePeerConnection()):this.hmsStore.subscribe((t=>{var i,n;"Connected"===t&&e(null==(n=null==(i=this.sdk)?void 0:i.getWebrtcInternals())?void 0:n.getSubscribePeerConnection())}),Ws)})),this.sdk&&hc(this.sdk,this.store,this.hmsStore)}},yc=e=>e.localPeer.id,bc=e=>e.localPeer.audioTrack,kc=e=>e.localPeer.videoTrack,Tc=(e,t)=>t,Sc=(e,t)=>t,wc=e=>e.remoteTrackStats,Ec=e=>e.peerStats,Pc=e=>e.localTrackStats,Cc=h([Ec,yc],((e,t)=>e[t])),_c=(h(Cc,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.packetsLost})),h(Cc,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.jitter})),h(Cc,(e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bitrate})),h(Cc,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bitrate})),h(Cc,(e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.availableOutgoingBitrate})),h(Cc,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.availableIncomingBitrate})),h(Cc,(e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bytesSent})),h(Cc,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bytesReceived})),h([Ec,Tc],((e,t)=>t?e[t]:void 0))),Ac=h([wc,Sc],((e,t)=>t?e[t]:void 0)),Ic=h([Pc,Sc],((e,t)=>t?e[t]:void 0));vo(_c),vo(Ac),h([Pc,bc],((e,t)=>{var i;return t?null==(i=e[t])?void 0:i[0]:void 0})),vo(h(Ic,(e=>null==e?void 0:e[0]))),h([Pc,kc],((e,t)=>{var i;return t?null==(i=e[t])?void 0:i[0]:void 0})),vo(h(Ic,(e=>e)))},144:function(e,t,i){"use strict";i.d(t,{BA:function(){return Ne},C4:function(){return C},EW:function(){return Be},Gc:function(){return be},IG:function(){return _e},IJ:function(){return De},KR:function(){return Le},Kh:function(){return ye},Pr:function(){return Fe},R1:function(){return xe},X2:function(){return d},bl:function(){return _},fE:function(){return Ee},g8:function(){return Se},hZ:function(){return F},i9:function(){return Re},jr:function(){return c},ju:function(){return Pe},lJ:function(){return Ae},o5:function(){return l},qA:function(){return B},u4:function(){return U},uY:function(){return a},ux:function(){return Ce},wB:function(){return He},yC:function(){return o}});i(4114),i(9678),i(7145),i(1658),i(9479),i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698),i(8992),i(4520),i(3949),i(1454),i(7550);var n=i(4232);let r,s;class o{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=r,!e&&r&&(this.index=(r.scopes||(r.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){let e,t;if(this._isPaused=!0,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){let e,t;if(this._isPaused=!1,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=r;try{return r=this,e()}finally{r=t}}else 0}on(){r=this}off(){r=this.parent}stop(e){if(this._active){let t,i;for(this._active=!1,t=0,i=this.effects.length;t<i;t++)this.effects[t].stop();for(this.effects.length=0,t=0,i=this.cleanups.length;t<i;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,i=this.scopes.length;t<i;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0}}}function a(e){return new o(e)}function l(){return r}function c(e,t=!1){r&&r.cleanups.push(e)}const u=new WeakSet;class d{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,r&&r.active&&r.effects.push(this)}pause(){this.flags|=64}resume(){64&this.flags&&(this.flags&=-65,u.has(this)&&(u.delete(this),this.trigger()))}notify(){2&this.flags&&!(32&this.flags)||8&this.flags||v(this)}run(){if(!(1&this.flags))return this.fn();this.flags|=2,A(this),y(this);const e=s,t=E;s=this,E=!0;try{return this.fn()}finally{0,b(this),s=e,E=t,this.flags&=-3}}stop(){if(1&this.flags){for(let e=this.deps;e;e=e.nextDep)S(e);this.deps=this.depsTail=void 0,A(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){64&this.flags?u.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){k(this)&&this.run()}get dirty(){return k(this)}}let h,p,f=0;function v(e,t=!1){if(e.flags|=8,t)return e.next=p,void(p=e);e.next=h,h=e}function g(){f++}function m(){if(--f>0)return;if(p){let e=p;p=void 0;while(e){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let e;while(h){let i=h;h=void 0;while(i){const n=i.next;if(i.next=void 0,i.flags&=-9,1&i.flags)try{i.trigger()}catch(t){e||(e=t)}i=n}}if(e)throw e}function y(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function b(e){let t,i=e.depsTail,n=i;while(n){const e=n.prevDep;-1===n.version?(n===i&&(i=e),S(n),w(n)):t=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=e}e.deps=t,e.depsTail=i}function k(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(T(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function T(e){if(4&e.flags&&!(16&e.flags))return;if(e.flags&=-17,e.globalVersion===I)return;e.globalVersion=I;const t=e.dep;if(e.flags|=2,t.version>0&&!e.isSSR&&e.deps&&!k(e))return void(e.flags&=-3);const i=s,r=E;s=e,E=!0;try{y(e);const i=e.fn(e._value);(0===t.version||(0,n.$H)(i,e._value))&&(e._value=i,t.version++)}catch(o){throw t.version++,o}finally{s=i,E=r,b(e),e.flags&=-3}}function S(e,t=!1){const{dep:i,prevSub:n,nextSub:r}=e;if(n&&(n.nextSub=r,e.prevSub=void 0),r&&(r.prevSub=n,e.nextSub=void 0),i.subs===e&&(i.subs=n,!n&&i.computed)){i.computed.flags&=-5;for(let e=i.computed.deps;e;e=e.nextDep)S(e,!0)}t||--i.sc||!i.map||i.map.delete(i.key)}function w(e){const{prevDep:t,nextDep:i}=e;t&&(t.nextDep=i,e.prevDep=void 0),i&&(i.prevDep=t,e.nextDep=void 0)}let E=!0;const P=[];function C(){P.push(E),E=!1}function _(){const e=P.pop();E=void 0===e||e}function A(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const e=s;s=void 0;try{t()}finally{s=e}}}let I=0;class R{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class L{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!s||!E||s===this.computed)return;let t=this.activeLink;if(void 0===t||t.sub!==s)t=this.activeLink=new R(s,this),s.deps?(t.prevDep=s.depsTail,s.depsTail.nextDep=t,s.depsTail=t):s.deps=s.depsTail=t,D(t);else if(-1===t.version&&(t.version=this.version,t.nextDep)){const e=t.nextDep;e.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=e),t.prevDep=s.depsTail,t.nextDep=void 0,s.depsTail.nextDep=t,s.depsTail=t,s.deps===t&&(s.deps=e)}return t}trigger(e){this.version++,I++,this.notify(e)}notify(e){g();try{0;for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{m()}}}function D(e){if(e.dep.sc++,4&e.sub.flags){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let e=t.deps;e;e=e.nextDep)D(e)}const i=e.dep.subs;i!==e&&(e.prevSub=i,i&&(i.nextSub=e)),e.dep.subs=e}}const O=new WeakMap,M=Symbol(""),x=Symbol(""),N=Symbol("");function U(e,t,i){if(E&&s){let t=O.get(e);t||O.set(e,t=new Map);let n=t.get(i);n||(t.set(i,n=new L),n.map=t,n.key=i),n.track()}}function F(e,t,i,r,s,o){const a=O.get(e);if(!a)return void I++;const l=e=>{e&&e.trigger()};if(g(),"clear"===t)a.forEach(l);else{const s=(0,n.cy)(e),o=s&&(0,n.yI)(i);if(s&&"length"===i){const e=Number(r);a.forEach(((t,i)=>{("length"===i||i===N||!(0,n.Bm)(i)&&i>=e)&&l(t)}))}else switch((void 0!==i||a.has(void 0))&&l(a.get(i)),o&&l(a.get(N)),t){case"add":s?o&&l(a.get("length")):(l(a.get(M)),(0,n.CE)(e)&&l(a.get(x)));break;case"delete":s||(l(a.get(M)),(0,n.CE)(e)&&l(a.get(x)));break;case"set":(0,n.CE)(e)&&l(a.get(M));break}}m()}function j(e){const t=Ce(e);return t===e?t:(U(t,"iterate",N),Ee(e)?t:t.map(Ae))}function B(e){return U(e=Ce(e),"iterate",N),e}const G={__proto__:null,[Symbol.iterator](){return $(this,Symbol.iterator,Ae)},concat(...e){return j(this).concat(...e.map((e=>(0,n.cy)(e)?j(e):e)))},entries(){return $(this,"entries",(e=>(e[1]=Ae(e[1]),e)))},every(e,t){return W(this,"every",e,t,void 0,arguments)},filter(e,t){return W(this,"filter",e,t,(e=>e.map(Ae)),arguments)},find(e,t){return W(this,"find",e,t,Ae,arguments)},findIndex(e,t){return W(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return W(this,"findLast",e,t,Ae,arguments)},findLastIndex(e,t){return W(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return W(this,"forEach",e,t,void 0,arguments)},includes(...e){return q(this,"includes",e)},indexOf(...e){return q(this,"indexOf",e)},join(e){return j(this).join(e)},lastIndexOf(...e){return q(this,"lastIndexOf",e)},map(e,t){return W(this,"map",e,t,void 0,arguments)},pop(){return z(this,"pop")},push(...e){return z(this,"push",e)},reduce(e,...t){return H(this,"reduce",e,t)},reduceRight(e,...t){return H(this,"reduceRight",e,t)},shift(){return z(this,"shift")},some(e,t){return W(this,"some",e,t,void 0,arguments)},splice(...e){return z(this,"splice",e)},toReversed(){return j(this).toReversed()},toSorted(e){return j(this).toSorted(e)},toSpliced(...e){return j(this).toSpliced(...e)},unshift(...e){return z(this,"unshift",e)},values(){return $(this,"values",Ae)}};function $(e,t,i){const n=B(e),r=n[t]();return n===e||Ee(e)||(r._next=r.next,r.next=()=>{const e=r._next();return e.value&&(e.value=i(e.value)),e}),r}const V=Array.prototype;function W(e,t,i,n,r,s){const o=B(e),a=o!==e&&!Ee(e),l=o[t];if(l!==V[t]){const t=l.apply(e,s);return a?Ae(t):t}let c=i;o!==e&&(a?c=function(t,n){return i.call(this,Ae(t),n,e)}:i.length>2&&(c=function(t,n){return i.call(this,t,n,e)}));const u=l.call(o,c,n);return a&&r?r(u):u}function H(e,t,i,n){const r=B(e);let s=i;return r!==e&&(Ee(e)?i.length>3&&(s=function(t,n,r){return i.call(this,t,n,r,e)}):s=function(t,n,r){return i.call(this,t,Ae(n),r,e)}),r[t](s,...n)}function q(e,t,i){const n=Ce(e);U(n,"iterate",N);const r=n[t](...i);return-1!==r&&!1!==r||!Pe(i[0])?r:(i[0]=Ce(i[0]),n[t](...i))}function z(e,t,i=[]){C(),g();const n=Ce(e)[t].apply(e,i);return m(),_(),n}const K=(0,n.pD)("__proto__,__v_isRef,__isVue"),J=new Set(Object.getOwnPropertyNames(Symbol).filter((e=>"arguments"!==e&&"caller"!==e)).map((e=>Symbol[e])).filter(n.Bm));function Q(e){(0,n.Bm)(e)||(e=String(e));const t=Ce(this);return U(t,"has",e),t.hasOwnProperty(e)}class Y{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,i){if("__v_skip"===t)return e["__v_skip"];const r=this._isReadonly,s=this._isShallow;if("__v_isReactive"===t)return!r;if("__v_isReadonly"===t)return r;if("__v_isShallow"===t)return s;if("__v_raw"===t)return i===(r?s?ve:fe:s?pe:he).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(i)?e:void 0;const o=(0,n.cy)(e);if(!r){let e;if(o&&(e=G[t]))return e;if("hasOwnProperty"===t)return Q}const a=Reflect.get(e,t,Re(e)?e:i);return((0,n.Bm)(t)?J.has(t):K(t))?a:(r||U(e,"get",t),s?a:Re(a)?o&&(0,n.yI)(t)?a:a.value:(0,n.Gv)(a)?r?ke(a):ye(a):a)}}class Z extends Y{constructor(e=!1){super(!1,e)}set(e,t,i,r){let s=e[t];if(!this._isShallow){const t=we(s);if(Ee(i)||we(i)||(s=Ce(s),i=Ce(i)),!(0,n.cy)(e)&&Re(s)&&!Re(i))return!t&&(s.value=i,!0)}const o=(0,n.cy)(e)&&(0,n.yI)(t)?Number(t)<e.length:(0,n.$3)(e,t),a=Reflect.set(e,t,i,Re(e)?e:r);return e===Ce(r)&&(o?(0,n.$H)(i,s)&&F(e,"set",t,i,s):F(e,"add",t,i)),a}deleteProperty(e,t){const i=(0,n.$3)(e,t),r=e[t],s=Reflect.deleteProperty(e,t);return s&&i&&F(e,"delete",t,void 0,r),s}has(e,t){const i=Reflect.has(e,t);return(0,n.Bm)(t)&&J.has(t)||U(e,"has",t),i}ownKeys(e){return U(e,"iterate",(0,n.cy)(e)?"length":M),Reflect.ownKeys(e)}}class X extends Y{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const ee=new Z,te=new X,ie=new Z(!0),ne=e=>e,re=e=>Reflect.getPrototypeOf(e);function se(e,t,i){return function(...r){const s=this["__v_raw"],o=Ce(s),a=(0,n.CE)(o),l="entries"===e||e===Symbol.iterator&&a,c="keys"===e&&a,u=s[e](...r),d=i?ne:t?Ie:Ae;return!t&&U(o,"iterate",c?x:M),{next(){const{value:e,done:t}=u.next();return t?{value:e,done:t}:{value:l?[d(e[0]),d(e[1])]:d(e),done:t}},[Symbol.iterator](){return this}}}}function oe(e){return function(...t){return"delete"!==e&&("clear"===e?void 0:this)}}function ae(e,t){const i={get(i){const r=this["__v_raw"],s=Ce(r),o=Ce(i);e||((0,n.$H)(i,o)&&U(s,"get",i),U(s,"get",o));const{has:a}=re(s),l=t?ne:e?Ie:Ae;return a.call(s,i)?l(r.get(i)):a.call(s,o)?l(r.get(o)):void(r!==s&&r.get(i))},get size(){const t=this["__v_raw"];return!e&&U(Ce(t),"iterate",M),Reflect.get(t,"size",t)},has(t){const i=this["__v_raw"],r=Ce(i),s=Ce(t);return e||((0,n.$H)(t,s)&&U(r,"has",t),U(r,"has",s)),t===s?i.has(t):i.has(t)||i.has(s)},forEach(i,n){const r=this,s=r["__v_raw"],o=Ce(s),a=t?ne:e?Ie:Ae;return!e&&U(o,"iterate",M),s.forEach(((e,t)=>i.call(n,a(e),a(t),r)))}};(0,n.X$)(i,e?{add:oe("add"),set:oe("set"),delete:oe("delete"),clear:oe("clear")}:{add(e){t||Ee(e)||we(e)||(e=Ce(e));const i=Ce(this),n=re(i),r=n.has.call(i,e);return r||(i.add(e),F(i,"add",e,e)),this},set(e,i){t||Ee(i)||we(i)||(i=Ce(i));const r=Ce(this),{has:s,get:o}=re(r);let a=s.call(r,e);a||(e=Ce(e),a=s.call(r,e));const l=o.call(r,e);return r.set(e,i),a?(0,n.$H)(i,l)&&F(r,"set",e,i,l):F(r,"add",e,i),this},delete(e){const t=Ce(this),{has:i,get:n}=re(t);let r=i.call(t,e);r||(e=Ce(e),r=i.call(t,e));const s=n?n.call(t,e):void 0,o=t.delete(e);return r&&F(t,"delete",e,void 0,s),o},clear(){const e=Ce(this),t=0!==e.size,i=void 0,n=e.clear();return t&&F(e,"clear",void 0,void 0,i),n}});const r=["keys","values","entries",Symbol.iterator];return r.forEach((n=>{i[n]=se(n,e,t)})),i}function le(e,t){const i=ae(e,t);return(t,r,s)=>"__v_isReactive"===r?!e:"__v_isReadonly"===r?e:"__v_raw"===r?t:Reflect.get((0,n.$3)(i,r)&&r in t?i:t,r,s)}const ce={get:le(!1,!1)},ue={get:le(!1,!0)},de={get:le(!0,!1)};const he=new WeakMap,pe=new WeakMap,fe=new WeakMap,ve=new WeakMap;function ge(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function me(e){return e["__v_skip"]||!Object.isExtensible(e)?0:ge((0,n.Zf)(e))}function ye(e){return we(e)?e:Te(e,!1,ee,ce,he)}function be(e){return Te(e,!1,ie,ue,pe)}function ke(e){return Te(e,!0,te,de,fe)}function Te(e,t,i,r,s){if(!(0,n.Gv)(e))return e;if(e["__v_raw"]&&(!t||!e["__v_isReactive"]))return e;const o=s.get(e);if(o)return o;const a=me(e);if(0===a)return e;const l=new Proxy(e,2===a?r:i);return s.set(e,l),l}function Se(e){return we(e)?Se(e["__v_raw"]):!(!e||!e["__v_isReactive"])}function we(e){return!(!e||!e["__v_isReadonly"])}function Ee(e){return!(!e||!e["__v_isShallow"])}function Pe(e){return!!e&&!!e["__v_raw"]}function Ce(e){const t=e&&e["__v_raw"];return t?Ce(t):e}function _e(e){return!(0,n.$3)(e,"__v_skip")&&Object.isExtensible(e)&&(0,n.yQ)(e,"__v_skip",!0),e}const Ae=e=>(0,n.Gv)(e)?ye(e):e,Ie=e=>(0,n.Gv)(e)?ke(e):e;function Re(e){return!!e&&!0===e["__v_isRef"]}function Le(e){return Oe(e,!1)}function De(e){return Oe(e,!0)}function Oe(e,t){return Re(e)?e:new Me(e,t)}class Me{constructor(e,t){this.dep=new L,this["__v_isRef"]=!0,this["__v_isShallow"]=!1,this._rawValue=t?e:Ce(e),this._value=t?e:Ae(e),this["__v_isShallow"]=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,i=this["__v_isShallow"]||Ee(e)||we(e);e=i?e:Ce(e),(0,n.$H)(e,t)&&(this._rawValue=e,this._value=i?e:Ae(e),this.dep.trigger())}}function xe(e){return Re(e)?e.value:e}function Ne(e){return(0,n.Tn)(e)?e():xe(e)}const Ue={get:(e,t,i)=>"__v_raw"===t?e:xe(Reflect.get(e,t,i)),set:(e,t,i,n)=>{const r=e[t];return Re(r)&&!Re(i)?(r.value=i,!0):Reflect.set(e,t,i,n)}};function Fe(e){return Se(e)?e:new Proxy(e,Ue)}class je{constructor(e,t,i){this.fn=e,this.setter=t,this._value=void 0,this.dep=new L(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=I-1,this.next=void 0,this.effect=this,this["__v_isReadonly"]=!t,this.isSSR=i}notify(){if(this.flags|=16,!(8&this.flags||s===this))return v(this,!0),!0}get value(){const e=this.dep.track();return T(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Be(e,t,i=!1){let r,s;(0,n.Tn)(e)?r=e:(r=e.get,s=e.set);const o=new je(r,s,i);return o}const Ge={},$e=new WeakMap;let Ve;function We(e,t=!1,i=Ve){if(i){let t=$e.get(i);t||$e.set(i,t=[]),t.push(e)}else 0}function He(e,t,i=n.MZ){const{immediate:r,deep:s,once:o,scheduler:a,augmentJob:c,call:u}=i,h=e=>s?e:Ee(e)||!1===s||0===s?qe(e,1):qe(e);let p,f,v,g,m=!1,y=!1;if(Re(e)?(f=()=>e.value,m=Ee(e)):Se(e)?(f=()=>h(e),m=!0):(0,n.cy)(e)?(y=!0,m=e.some((e=>Se(e)||Ee(e))),f=()=>e.map((e=>Re(e)?e.value:Se(e)?h(e):(0,n.Tn)(e)?u?u(e,2):e():void 0))):f=(0,n.Tn)(e)?t?u?()=>u(e,2):e:()=>{if(v){C();try{v()}finally{_()}}const t=Ve;Ve=p;try{return u?u(e,3,[g]):e(g)}finally{Ve=t}}:n.tE,t&&s){const e=f,t=!0===s?1/0:s;f=()=>qe(e(),t)}const b=l(),k=()=>{p.stop(),b&&b.active&&(0,n.TF)(b.effects,p)};if(o&&t){const e=t;t=(...t)=>{e(...t),k()}}let T=y?new Array(e.length).fill(Ge):Ge;const S=e=>{if(1&p.flags&&(p.dirty||e))if(t){const e=p.run();if(s||m||(y?e.some(((e,t)=>(0,n.$H)(e,T[t]))):(0,n.$H)(e,T))){v&&v();const i=Ve;Ve=p;try{const i=[e,T===Ge?void 0:y&&T[0]===Ge?[]:T,g];u?u(t,3,i):t(...i),T=e}finally{Ve=i}}}else p.run()};return c&&c(S),p=new d(f),p.scheduler=a?()=>a(S,!1):S,g=e=>We(e,!1,p),v=p.onStop=()=>{const e=$e.get(p);if(e){if(u)u(e,4);else for(const t of e)t();$e.delete(p)}},t?r?S(!0):T=p.run():a?a(S.bind(null,!0),!0):p.run(),k.pause=p.pause.bind(p),k.resume=p.resume.bind(p),k.stop=k,k}function qe(e,t=1/0,i){if(t<=0||!(0,n.Gv)(e)||e["__v_skip"])return e;if(i=i||new Set,i.has(e))return e;if(i.add(e),t--,Re(e))qe(e.value,t,i);else if((0,n.cy)(e))for(let n=0;n<e.length;n++)qe(e[n],t,i);else if((0,n.vM)(e)||(0,n.CE)(e))e.forEach((e=>{qe(e,t,i)}));else if((0,n.Qd)(e)){for(const n in e)qe(e[n],t,i);for(const n of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,n)&&qe(e[n],t,i)}return e}},6768:function(e,t,i){"use strict";i.d(t,{$u:function(){return re},CE:function(){return Jt},Df:function(){return B},EW:function(){return xi},FK:function(){return Ft},Gt:function(){return Ge},Gy:function(){return M},K9:function(){return ut},Lk:function(){return ti},MZ:function(){return j},OW:function(){return F},PS:function(){return Ve},Q3:function(){return ai},QP:function(){return N},WQ:function(){return $e},Wv:function(){return Qt},bF:function(){return ii},dY:function(){return g},g2:function(){return he},h:function(){return Ni},nI:function(){return mi},nT:function(){return Tt},pI:function(){return ge},pM:function(){return G},qL:function(){return o},sV:function(){return ie},uX:function(){return Wt},wB:function(){return St}});i(4114),i(9479),i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698),i(8992),i(3215),i(4520),i(3949),i(1454),i(8872),i(7550);var n=i(144),r=i(4232);function s(e,t,i,n){try{return n?e(...n):e()}catch(r){a(r,t,i)}}function o(e,t,i,n){if((0,r.Tn)(e)){const o=s(e,t,i,n);return o&&(0,r.yL)(o)&&o.catch((e=>{a(e,t,i)})),o}if((0,r.cy)(e)){const r=[];for(let s=0;s<e.length;s++)r.push(o(e[s],t,i,n));return r}}function a(e,t,i,o=!0){const a=t?t.vnode:null,{errorHandler:c,throwUnhandledErrorInProduction:u}=t&&t.appContext.config||r.MZ;if(t){let r=t.parent;const o=t.proxy,a=`https://vuejs.org/error-reference/#runtime-${i}`;while(r){const t=r.ec;if(t)for(let i=0;i<t.length;i++)if(!1===t[i](e,o,a))return;r=r.parent}if(c)return(0,n.C4)(),s(c,null,10,[e,o,a]),void(0,n.bl)()}l(e,i,a,o,u)}function l(e,t,i,n=!0,r=!1){if(r)throw e;console.error(e)}const c=[];let u=-1;const d=[];let h=null,p=0;const f=Promise.resolve();let v=null;function g(e){const t=v||f;return e?t.then(this?e.bind(this):e):t}function m(e){let t=u+1,i=c.length;while(t<i){const n=t+i>>>1,r=c[n],s=w(r);s<e||s===e&&2&r.flags?t=n+1:i=n}return t}function y(e){if(!(1&e.flags)){const t=w(e),i=c[c.length-1];!i||!(2&e.flags)&&t>=w(i)?c.push(e):c.splice(m(t),0,e),e.flags|=1,b()}}function b(){v||(v=f.then(E))}function k(e){(0,r.cy)(e)?d.push(...e):h&&-1===e.id?h.splice(p+1,0,e):1&e.flags||(d.push(e),e.flags|=1),b()}function T(e,t,i=u+1){for(0;i<c.length;i++){const t=c[i];if(t&&2&t.flags){if(e&&t.id!==e.uid)continue;0,c.splice(i,1),i--,4&t.flags&&(t.flags&=-2),t(),4&t.flags||(t.flags&=-2)}}}function S(e){if(d.length){const e=[...new Set(d)].sort(((e,t)=>w(e)-w(t)));if(d.length=0,h)return void h.push(...e);for(h=e,p=0;p<h.length;p++){const e=h[p];0,4&e.flags&&(e.flags&=-2),8&e.flags||e(),e.flags&=-2}h=null,p=0}}const w=e=>null==e.id?2&e.flags?-1:1/0:e.id;function E(e){r.tE;try{for(u=0;u<c.length;u++){const e=c[u];!e||8&e.flags||(4&e.flags&&(e.flags&=-2),s(e,e.i,e.i?15:14),4&e.flags||(e.flags&=-2))}}finally{for(;u<c.length;u++){const e=c[u];e&&(e.flags&=-2)}u=-1,c.length=0,S(e),v=null,(c.length||d.length)&&E(e)}}let P=null,C=null;function _(e){const t=P;return P=e,C=e&&e.type.__scopeId||null,t}function A(e,t=P,i){if(!t)return e;if(e._n)return e;const n=(...i)=>{n._d&&zt(-1);const r=_(t);let s;try{s=e(...i)}finally{_(r),n._d&&zt(1)}return s};return n._n=!0,n._c=!0,n._d=!0,n}function I(e,t,i,r){const s=e.dirs,a=t&&t.dirs;for(let l=0;l<s.length;l++){const c=s[l];a&&(c.oldValue=a[l].value);let u=c.dir[r];u&&((0,n.C4)(),o(u,i,8,[e.el,c,e,t]),(0,n.bl)())}}const R=Symbol("_vte"),L=e=>e.__isTeleport;const D=Symbol("_leaveCb"),O=Symbol("_enterCb");function M(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ie((()=>{e.isMounted=!0})),se((()=>{e.isUnmounting=!0})),e}const x=[Function,Array],N={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:x,onEnter:x,onAfterEnter:x,onEnterCancelled:x,onBeforeLeave:x,onLeave:x,onAfterLeave:x,onLeaveCancelled:x,onBeforeAppear:x,onAppear:x,onAfterAppear:x,onAppearCancelled:x};function U(e,t){const{leavingVNodes:i}=e;let n=i.get(t.type);return n||(n=Object.create(null),i.set(t.type,n)),n}function F(e,t,i,n,s){const{appear:a,mode:l,persisted:c=!1,onBeforeEnter:u,onEnter:d,onAfterEnter:h,onEnterCancelled:p,onBeforeLeave:f,onLeave:v,onAfterLeave:g,onLeaveCancelled:m,onBeforeAppear:y,onAppear:b,onAfterAppear:k,onAppearCancelled:T}=t,S=String(e.key),w=U(i,e),E=(e,t)=>{e&&o(e,n,9,t)},P=(e,t)=>{const i=t[1];E(e,t),(0,r.cy)(e)?e.every((e=>e.length<=1))&&i():e.length<=1&&i()},C={mode:l,persisted:c,beforeEnter(t){let n=u;if(!i.isMounted){if(!a)return;n=y||u}t[D]&&t[D](!0);const r=w[S];r&&Zt(e,r)&&r.el[D]&&r.el[D](),E(n,[t])},enter(e){let t=d,n=h,r=p;if(!i.isMounted){if(!a)return;t=b||d,n=k||h,r=T||p}let s=!1;const o=e[O]=t=>{s||(s=!0,E(t?r:n,[e]),C.delayedLeave&&C.delayedLeave(),e[O]=void 0)};t?P(t,[e,o]):o()},leave(t,n){const r=String(e.key);if(t[O]&&t[O](!0),i.isUnmounting)return n();E(f,[t]);let s=!1;const o=t[D]=i=>{s||(s=!0,n(),E(i?m:g,[t]),t[D]=void 0,w[r]===e&&delete w[r])};w[r]=e,v?P(v,[t,o]):o()},clone(e){const r=F(e,t,i,n,s);return s&&s(r),r}};return C}function j(e,t){6&e.shapeFlag&&e.component?(e.transition=t,j(e.component.subTree,t)):128&e.shapeFlag?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function B(e,t=!1,i){let n=[],r=0;for(let s=0;s<e.length;s++){let o=e[s];const a=null==i?o.key:String(i)+String(null!=o.key?o.key:s);o.type===Ft?(128&o.patchFlag&&r++,n=n.concat(B(o.children,t,a))):(t||o.type!==Bt)&&n.push(null!=a?si(o,{key:a}):o)}if(r>1)for(let s=0;s<n.length;s++)n[s].patchFlag=-2;return n}
/*! #__NO_SIDE_EFFECTS__ */function G(e,t){return(0,r.Tn)(e)?(()=>(0,r.X$)({name:e.name},t,{setup:e}))():e}function $(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}function V(e,t,i,o,a=!1){if((0,r.cy)(e))return void e.forEach(((e,n)=>V(e,t&&((0,r.cy)(t)?t[n]:t),i,o,a)));if(W(o)&&!a)return void(512&o.shapeFlag&&o.type.__asyncResolved&&o.component.subTree.component&&V(e,t,i,o.component.subTree));const l=4&o.shapeFlag?Di(o.component):o.el,c=a?null:l,{i:u,r:d}=e;const h=t&&t.r,p=u.refs===r.MZ?u.refs={}:u.refs,f=u.setupState,v=(0,n.ux)(f),g=f===r.MZ?()=>!1:e=>(0,r.$3)(v,e);if(null!=h&&h!==d&&((0,r.Kg)(h)?(p[h]=null,g(h)&&(f[h]=null)):(0,n.i9)(h)&&(h.value=null)),(0,r.Tn)(d))s(d,u,12,[c,p]);else{const t=(0,r.Kg)(d),s=(0,n.i9)(d);if(t||s){const n=()=>{if(e.f){const i=t?g(d)?f[d]:p[d]:d.value;a?(0,r.cy)(i)&&(0,r.TF)(i,l):(0,r.cy)(i)?i.includes(l)||i.push(l):t?(p[d]=[l],g(d)&&(f[d]=p[d])):(d.value=[l],e.k&&(p[e.k]=d.value))}else t?(p[d]=c,g(d)&&(f[d]=c)):s&&(d.value=c,e.k&&(p[e.k]=c))};c?(n.id=-1,ct(n,i)):n()}else 0}}(0,r.We)().requestIdleCallback,(0,r.We)().cancelIdleCallback;const W=e=>!!e.type.__asyncLoader
/*! #__NO_SIDE_EFFECTS__ */;const H=e=>e.type.__isKeepAlive;RegExp,RegExp;function q(e,t){return(0,r.cy)(e)?e.some((e=>q(e,t))):(0,r.Kg)(e)?e.split(",").includes(t):!!(0,r.gd)(e)&&(e.lastIndex=0,e.test(t))}function z(e,t){J(e,"a",t)}function K(e,t){J(e,"da",t)}function J(e,t,i=gi){const n=e.__wdc||(e.__wdc=()=>{let t=i;while(t){if(t.isDeactivated)return;t=t.parent}return e()});if(X(t,n,i),i){let e=i.parent;while(e&&e.parent)H(e.parent.vnode)&&Q(n,t,i,e),e=e.parent}}function Q(e,t,i,n){const s=X(t,e,n,!0);oe((()=>{(0,r.TF)(n[t],s)}),i)}function Y(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function Z(e){return 128&e.shapeFlag?e.ssContent:e}function X(e,t,i=gi,r=!1){if(i){const s=i[e]||(i[e]=[]),a=t.__weh||(t.__weh=(...r)=>{(0,n.C4)();const s=ki(i),a=o(t,i,e,r);return s(),(0,n.bl)(),a});return r?s.unshift(a):s.push(a),a}}const ee=e=>(t,i=gi)=>{Pi&&"sp"!==e||X(e,((...e)=>t(...e)),i)},te=ee("bm"),ie=ee("m"),ne=ee("bu"),re=ee("u"),se=ee("bum"),oe=ee("um"),ae=ee("sp"),le=ee("rtg"),ce=ee("rtc");function ue(e,t=gi){X("ec",e,t)}const de="components";function he(e,t){return fe(de,e,!0,t)||e}const pe=Symbol.for("v-ndc");function fe(e,t,i=!0,n=!1){const s=P||gi;if(s){const i=s.type;if(e===de){const e=Oi(i,!1);if(e&&(e===t||e===(0,r.PT)(t)||e===(0,r.ZH)((0,r.PT)(t))))return i}const o=ve(s[e]||i[e],t)||ve(s.appContext[e],t);return!o&&n?i:o}}function ve(e,t){return e&&(e[t]||e[(0,r.PT)(t)]||e[(0,r.ZH)((0,r.PT)(t))])}function ge(e,t,i,s){let o;const a=i&&i[s],l=(0,r.cy)(e);if(l||(0,r.Kg)(e)){const i=l&&(0,n.g8)(e);let r=!1;i&&(r=!(0,n.fE)(e),e=(0,n.qA)(e)),o=new Array(e.length);for(let s=0,l=e.length;s<l;s++)o[s]=t(r?(0,n.lJ)(e[s]):e[s],s,void 0,a&&a[s])}else if("number"===typeof e){0,o=new Array(e);for(let i=0;i<e;i++)o[i]=t(i+1,i,void 0,a&&a[i])}else if((0,r.Gv)(e))if(e[Symbol.iterator])o=Array.from(e,((e,i)=>t(e,i,void 0,a&&a[i])));else{const i=Object.keys(e);o=new Array(i.length);for(let n=0,r=i.length;n<r;n++){const r=i[n];o[n]=t(e[r],r,n,a&&a[n])}}else o=[];return i&&(i[s]=o),o}const me=e=>e?Si(e)?Di(e):me(e.parent):null,ye=(0,r.X$)(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>me(e.parent),$root:e=>me(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>_e(e),$forceUpdate:e=>e.f||(e.f=()=>{y(e.update)}),$nextTick:e=>e.n||(e.n=g.bind(e.proxy)),$watch:e=>Et.bind(e)}),be=(e,t)=>e!==r.MZ&&!e.__isScriptSetup&&(0,r.$3)(e,t),ke={get({_:e},t){if("__v_skip"===t)return!0;const{ctx:i,setupState:s,data:o,props:a,accessCache:l,type:c,appContext:u}=e;let d;if("$"!==t[0]){const n=l[t];if(void 0!==n)switch(n){case 1:return s[t];case 2:return o[t];case 4:return i[t];case 3:return a[t]}else{if(be(s,t))return l[t]=1,s[t];if(o!==r.MZ&&(0,r.$3)(o,t))return l[t]=2,o[t];if((d=e.propsOptions[0])&&(0,r.$3)(d,t))return l[t]=3,a[t];if(i!==r.MZ&&(0,r.$3)(i,t))return l[t]=4,i[t];Se&&(l[t]=0)}}const h=ye[t];let p,f;return h?("$attrs"===t&&(0,n.u4)(e.attrs,"get",""),h(e)):(p=c.__cssModules)&&(p=p[t])?p:i!==r.MZ&&(0,r.$3)(i,t)?(l[t]=4,i[t]):(f=u.config.globalProperties,(0,r.$3)(f,t)?f[t]:void 0)},set({_:e},t,i){const{data:n,setupState:s,ctx:o}=e;return be(s,t)?(s[t]=i,!0):n!==r.MZ&&(0,r.$3)(n,t)?(n[t]=i,!0):!(0,r.$3)(e.props,t)&&(("$"!==t[0]||!(t.slice(1)in e))&&(o[t]=i,!0))},has({_:{data:e,setupState:t,accessCache:i,ctx:n,appContext:s,propsOptions:o}},a){let l;return!!i[a]||e!==r.MZ&&(0,r.$3)(e,a)||be(t,a)||(l=o[0])&&(0,r.$3)(l,a)||(0,r.$3)(n,a)||(0,r.$3)(ye,a)||(0,r.$3)(s.config.globalProperties,a)},defineProperty(e,t,i){return null!=i.get?e._.accessCache[t]=0:(0,r.$3)(i,"value")&&this.set(e,t,i.value,null),Reflect.defineProperty(e,t,i)}};function Te(e){return(0,r.cy)(e)?e.reduce(((e,t)=>(e[t]=null,e)),{}):e}let Se=!0;function we(e){const t=_e(e),i=e.proxy,s=e.ctx;Se=!1,t.beforeCreate&&Pe(t.beforeCreate,e,"bc");const{data:o,computed:a,methods:l,watch:c,provide:u,inject:d,created:h,beforeMount:p,mounted:f,beforeUpdate:v,updated:g,activated:m,deactivated:y,beforeDestroy:b,beforeUnmount:k,destroyed:T,unmounted:S,render:w,renderTracked:E,renderTriggered:P,errorCaptured:C,serverPrefetch:_,expose:A,inheritAttrs:I,components:R,directives:L,filters:D}=t,O=null;if(d&&Ee(d,s,O),l)for(const n in l){const e=l[n];(0,r.Tn)(e)&&(s[n]=e.bind(i))}if(o){0;const t=o.call(i,i);0,(0,r.Gv)(t)&&(e.data=(0,n.Kh)(t))}if(Se=!0,a)for(const n in a){const e=a[n],t=(0,r.Tn)(e)?e.bind(i,i):(0,r.Tn)(e.get)?e.get.bind(i,i):r.tE;0;const o=!(0,r.Tn)(e)&&(0,r.Tn)(e.set)?e.set.bind(i):r.tE,l=xi({get:t,set:o});Object.defineProperty(s,n,{enumerable:!0,configurable:!0,get:()=>l.value,set:e=>l.value=e})}if(c)for(const n in c)Ce(c[n],s,i,n);if(u){const e=(0,r.Tn)(u)?u.call(i):u;Reflect.ownKeys(e).forEach((t=>{Ge(t,e[t])}))}function M(e,t){(0,r.cy)(t)?t.forEach((t=>e(t.bind(i)))):t&&e(t.bind(i))}if(h&&Pe(h,e,"c"),M(te,p),M(ie,f),M(ne,v),M(re,g),M(z,m),M(K,y),M(ue,C),M(ce,E),M(le,P),M(se,k),M(oe,S),M(ae,_),(0,r.cy)(A))if(A.length){const t=e.exposed||(e.exposed={});A.forEach((e=>{Object.defineProperty(t,e,{get:()=>i[e],set:t=>i[e]=t})}))}else e.exposed||(e.exposed={});w&&e.render===r.tE&&(e.render=w),null!=I&&(e.inheritAttrs=I),R&&(e.components=R),L&&(e.directives=L),_&&$(e)}function Ee(e,t,i=r.tE){(0,r.cy)(e)&&(e=De(e));for(const s in e){const i=e[s];let o;o=(0,r.Gv)(i)?"default"in i?$e(i.from||s,i.default,!0):$e(i.from||s):$e(i),(0,n.i9)(o)?Object.defineProperty(t,s,{enumerable:!0,configurable:!0,get:()=>o.value,set:e=>o.value=e}):t[s]=o}}function Pe(e,t,i){o((0,r.cy)(e)?e.map((e=>e.bind(t.proxy))):e.bind(t.proxy),t,i)}function Ce(e,t,i,n){let s=n.includes(".")?Pt(i,n):()=>i[n];if((0,r.Kg)(e)){const i=t[e];(0,r.Tn)(i)&&St(s,i)}else if((0,r.Tn)(e))St(s,e.bind(i));else if((0,r.Gv)(e))if((0,r.cy)(e))e.forEach((e=>Ce(e,t,i,n)));else{const n=(0,r.Tn)(e.handler)?e.handler.bind(i):t[e.handler];(0,r.Tn)(n)&&St(s,n,e)}else 0}function _e(e){const t=e.type,{mixins:i,extends:n}=t,{mixins:s,optionsCache:o,config:{optionMergeStrategies:a}}=e.appContext,l=o.get(t);let c;return l?c=l:s.length||i||n?(c={},s.length&&s.forEach((e=>Ae(c,e,a,!0))),Ae(c,t,a)):c=t,(0,r.Gv)(t)&&o.set(t,c),c}function Ae(e,t,i,n=!1){const{mixins:r,extends:s}=t;s&&Ae(e,s,i,!0),r&&r.forEach((t=>Ae(e,t,i,!0)));for(const o in t)if(n&&"expose"===o);else{const n=Ie[o]||i&&i[o];e[o]=n?n(e[o],t[o]):t[o]}return e}const Ie={data:Re,props:xe,emits:xe,methods:Me,computed:Me,beforeCreate:Oe,created:Oe,beforeMount:Oe,mounted:Oe,beforeUpdate:Oe,updated:Oe,beforeDestroy:Oe,beforeUnmount:Oe,destroyed:Oe,unmounted:Oe,activated:Oe,deactivated:Oe,errorCaptured:Oe,serverPrefetch:Oe,components:Me,directives:Me,watch:Ne,provide:Re,inject:Le};function Re(e,t){return t?e?function(){return(0,r.X$)((0,r.Tn)(e)?e.call(this,this):e,(0,r.Tn)(t)?t.call(this,this):t)}:t:e}function Le(e,t){return Me(De(e),De(t))}function De(e){if((0,r.cy)(e)){const t={};for(let i=0;i<e.length;i++)t[e[i]]=e[i];return t}return e}function Oe(e,t){return e?[...new Set([].concat(e,t))]:t}function Me(e,t){return e?(0,r.X$)(Object.create(null),e,t):t}function xe(e,t){return e?(0,r.cy)(e)&&(0,r.cy)(t)?[...new Set([...e,...t])]:(0,r.X$)(Object.create(null),Te(e),Te(null!=t?t:{})):t}function Ne(e,t){if(!e)return t;if(!t)return e;const i=(0,r.X$)(Object.create(null),e);for(const n in t)i[n]=Oe(e[n],t[n]);return i}function Ue(){return{app:null,config:{isNativeTag:r.NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Fe=0;function je(e,t){return function(i,n=null){(0,r.Tn)(i)||(i=(0,r.X$)({},i)),null==n||(0,r.Gv)(n)||(n=null);const s=Ue(),a=new WeakSet,l=[];let c=!1;const u=s.app={_uid:Fe++,_component:i,_props:n,_container:null,_context:s,_instance:null,version:Ui,get config(){return s.config},set config(e){0},use(e,...t){return a.has(e)||(e&&(0,r.Tn)(e.install)?(a.add(e),e.install(u,...t)):(0,r.Tn)(e)&&(a.add(e),e(u,...t))),u},mixin(e){return s.mixins.includes(e)||s.mixins.push(e),u},component(e,t){return t?(s.components[e]=t,u):s.components[e]},directive(e,t){return t?(s.directives[e]=t,u):s.directives[e]},mount(r,o,a){if(!c){0;const l=u._ceVNode||ii(i,n);return l.appContext=s,!0===a?a="svg":!1===a&&(a=void 0),o&&t?t(l,r):e(l,r,a),c=!0,u._container=r,r.__vue_app__=u,Di(l.component)}},onUnmount(e){l.push(e)},unmount(){c&&(o(l,u._instance,16),e(null,u._container),delete u._container.__vue_app__)},provide(e,t){return s.provides[e]=t,u},runWithContext(e){const t=Be;Be=u;try{return e()}finally{Be=t}}};return u}}let Be=null;function Ge(e,t){if(gi){let i=gi.provides;const n=gi.parent&&gi.parent.provides;n===i&&(i=gi.provides=Object.create(n)),i[e]=t}else 0}function $e(e,t,i=!1){const n=gi||P;if(n||Be){const s=Be?Be._context.provides:n?null==n.parent?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(s&&e in s)return s[e];if(arguments.length>1)return i&&(0,r.Tn)(t)?t.call(n&&n.proxy):t}else 0}function Ve(){return!!(gi||P||Be)}const We={},He=()=>Object.create(We),qe=e=>Object.getPrototypeOf(e)===We;function ze(e,t,i,r=!1){const s={},o=He();e.propsDefaults=Object.create(null),Je(e,t,s,o);for(const n in e.propsOptions[0])n in s||(s[n]=void 0);i?e.props=r?s:(0,n.Gc)(s):e.type.props?e.props=s:e.props=o,e.attrs=o}function Ke(e,t,i,s){const{props:o,attrs:a,vnode:{patchFlag:l}}=e,c=(0,n.ux)(o),[u]=e.propsOptions;let d=!1;if(!(s||l>0)||16&l){let n;Je(e,t,o,a)&&(d=!0);for(const s in c)t&&((0,r.$3)(t,s)||(n=(0,r.Tg)(s))!==s&&(0,r.$3)(t,n))||(u?!i||void 0===i[s]&&void 0===i[n]||(o[s]=Qe(u,c,s,void 0,e,!0)):delete o[s]);if(a!==c)for(const e in a)t&&(0,r.$3)(t,e)||(delete a[e],d=!0)}else if(8&l){const i=e.vnode.dynamicProps;for(let n=0;n<i.length;n++){let s=i[n];if(It(e.emitsOptions,s))continue;const l=t[s];if(u)if((0,r.$3)(a,s))l!==a[s]&&(a[s]=l,d=!0);else{const t=(0,r.PT)(s);o[t]=Qe(u,c,t,l,e,!1)}else l!==a[s]&&(a[s]=l,d=!0)}}d&&(0,n.hZ)(e.attrs,"set","")}function Je(e,t,i,s){const[o,a]=e.propsOptions;let l,c=!1;if(t)for(let n in t){if((0,r.SU)(n))continue;const u=t[n];let d;o&&(0,r.$3)(o,d=(0,r.PT)(n))?a&&a.includes(d)?(l||(l={}))[d]=u:i[d]=u:It(e.emitsOptions,n)||n in s&&u===s[n]||(s[n]=u,c=!0)}if(a){const t=(0,n.ux)(i),s=l||r.MZ;for(let n=0;n<a.length;n++){const l=a[n];i[l]=Qe(o,t,l,s[l],e,!(0,r.$3)(s,l))}}return c}function Qe(e,t,i,n,s,o){const a=e[i];if(null!=a){const e=(0,r.$3)(a,"default");if(e&&void 0===n){const e=a.default;if(a.type!==Function&&!a.skipFactory&&(0,r.Tn)(e)){const{propsDefaults:r}=s;if(i in r)n=r[i];else{const o=ki(s);n=r[i]=e.call(null,t),o()}}else n=e;s.ce&&s.ce._setProp(i,n)}a[0]&&(o&&!e?n=!1:!a[1]||""!==n&&n!==(0,r.Tg)(i)||(n=!0))}return n}const Ye=new WeakMap;function Ze(e,t,i=!1){const n=i?Ye:t.propsCache,s=n.get(e);if(s)return s;const o=e.props,a={},l=[];let c=!1;if(!(0,r.Tn)(e)){const n=e=>{c=!0;const[i,n]=Ze(e,t,!0);(0,r.X$)(a,i),n&&l.push(...n)};!i&&t.mixins.length&&t.mixins.forEach(n),e.extends&&n(e.extends),e.mixins&&e.mixins.forEach(n)}if(!o&&!c)return(0,r.Gv)(e)&&n.set(e,r.Oj),r.Oj;if((0,r.cy)(o))for(let d=0;d<o.length;d++){0;const e=(0,r.PT)(o[d]);Xe(e)&&(a[e]=r.MZ)}else if(o){0;for(const e in o){const t=(0,r.PT)(e);if(Xe(t)){const i=o[e],n=a[t]=(0,r.cy)(i)||(0,r.Tn)(i)?{type:i}:(0,r.X$)({},i),s=n.type;let c=!1,u=!0;if((0,r.cy)(s))for(let e=0;e<s.length;++e){const t=s[e],i=(0,r.Tn)(t)&&t.name;if("Boolean"===i){c=!0;break}"String"===i&&(u=!1)}else c=(0,r.Tn)(s)&&"Boolean"===s.name;n[0]=c,n[1]=u,(c||(0,r.$3)(n,"default"))&&l.push(t)}}}const u=[a,l];return(0,r.Gv)(e)&&n.set(e,u),u}function Xe(e){return"$"!==e[0]&&!(0,r.SU)(e)}const et=e=>"_"===e[0]||"$stable"===e,tt=e=>(0,r.cy)(e)?e.map(li):[li(e)],it=(e,t,i)=>{if(t._n)return t;const n=A(((...e)=>tt(t(...e))),i);return n._c=!1,n},nt=(e,t,i)=>{const n=e._ctx;for(const s in e){if(et(s))continue;const i=e[s];if((0,r.Tn)(i))t[s]=it(s,i,n);else if(null!=i){0;const e=tt(i);t[s]=()=>e}}},rt=(e,t)=>{const i=tt(t);e.slots.default=()=>i},st=(e,t,i)=>{for(const n in t)(i||"_"!==n)&&(e[n]=t[n])},ot=(e,t,i)=>{const n=e.slots=He();if(32&e.vnode.shapeFlag){const e=t._;e?(st(n,t,i),i&&(0,r.yQ)(n,"_",e,!0)):nt(t,n)}else t&&rt(e,t)},at=(e,t,i)=>{const{vnode:n,slots:s}=e;let o=!0,a=r.MZ;if(32&n.shapeFlag){const e=t._;e?i&&1===e?o=!1:st(s,t,i):(o=!t.$stable,nt(t,s)),a=t}else t&&(rt(e,t),a={default:1});if(o)for(const r in s)et(r)||null!=a[r]||delete s[r]};function lt(){"boolean"!==typeof __VUE_PROD_HYDRATION_MISMATCH_DETAILS__&&((0,r.We)().__VUE_PROD_HYDRATION_MISMATCH_DETAILS__=!1)}const ct=Ut;function ut(e){return dt(e)}function dt(e,t){lt();const i=(0,r.We)();i.__VUE__=!0;const{insert:s,remove:o,patchProp:a,createElement:l,createText:c,createComment:u,setText:d,setElementText:h,parentNode:p,nextSibling:f,setScopeId:v=r.tE,insertStaticContent:g}=e,m=(e,t,i,n=null,r=null,s=null,o=void 0,a=null,l=!!t.dynamicChildren)=>{if(e===t)return;e&&!Zt(e,t)&&(n=X(e),K(e,r,s,!0),e=null),-2===t.patchFlag&&(l=!1,t.dynamicChildren=null);const{type:c,ref:u,shapeFlag:d}=t;switch(c){case jt:b(e,t,i,n);break;case Bt:k(e,t,i,n);break;case Gt:null==e&&w(t,i,n,o);break;case Ft:x(e,t,i,n,r,s,o,a,l);break;default:1&d?C(e,t,i,n,r,s,o,a,l):6&d?N(e,t,i,n,r,s,o,a,l):(64&d||128&d)&&c.process(e,t,i,n,r,s,o,a,l,ie)}null!=u&&r&&V(u,e&&e.ref,s,t||e,!t)},b=(e,t,i,n)=>{if(null==e)s(t.el=c(t.children),i,n);else{const i=t.el=e.el;t.children!==e.children&&d(i,t.children)}},k=(e,t,i,n)=>{null==e?s(t.el=u(t.children||""),i,n):t.el=e.el},w=(e,t,i,n)=>{[e.el,e.anchor]=g(e.children,t,i,n,e.el,e.anchor)},E=({el:e,anchor:t},i,n)=>{let r;while(e&&e!==t)r=f(e),s(e,i,n),e=r;s(t,i,n)},P=({el:e,anchor:t})=>{let i;while(e&&e!==t)i=f(e),o(e),e=i;o(t)},C=(e,t,i,n,r,s,o,a,l)=>{"svg"===t.type?o="svg":"math"===t.type&&(o="mathml"),null==e?_(t,i,n,r,s,o,a,l):D(e,t,r,s,o,a,l)},_=(e,t,i,n,o,c,u,d)=>{let p,f;const{props:v,shapeFlag:g,transition:m,dirs:y}=e;if(p=e.el=l(e.type,c,v&&v.is,v),8&g?h(p,e.children):16&g&&L(e.children,p,null,n,o,ht(e,c),u,d),y&&I(e,null,n,"created"),A(p,e,e.scopeId,u,n),v){for(const e in v)"value"===e||(0,r.SU)(e)||a(p,e,null,v[e],c,n);"value"in v&&a(p,"value",null,v.value,c),(f=v.onVnodeBeforeMount)&&hi(f,n,e)}y&&I(e,null,n,"beforeMount");const b=ft(o,m);b&&m.beforeEnter(p),s(p,t,i),((f=v&&v.onVnodeMounted)||b||y)&&ct((()=>{f&&hi(f,n,e),b&&m.enter(p),y&&I(e,null,n,"mounted")}),o)},A=(e,t,i,n,r)=>{if(i&&v(e,i),n)for(let s=0;s<n.length;s++)v(e,n[s]);if(r){let i=r.subTree;if(t===i||Nt(i.type)&&(i.ssContent===t||i.ssFallback===t)){const t=r.vnode;A(e,t,t.scopeId,t.slotScopeIds,r.parent)}}},L=(e,t,i,n,r,s,o,a,l=0)=>{for(let c=l;c<e.length;c++){const l=e[c]=a?ci(e[c]):li(e[c]);m(null,l,t,i,n,r,s,o,a)}},D=(e,t,i,n,s,o,l)=>{const c=t.el=e.el;let{patchFlag:u,dynamicChildren:d,dirs:p}=t;u|=16&e.patchFlag;const f=e.props||r.MZ,v=t.props||r.MZ;let g;if(i&&pt(i,!1),(g=v.onVnodeBeforeUpdate)&&hi(g,i,t,e),p&&I(t,e,i,"beforeUpdate"),i&&pt(i,!0),(f.innerHTML&&null==v.innerHTML||f.textContent&&null==v.textContent)&&h(c,""),d?O(e.dynamicChildren,d,c,i,n,ht(t,s),o):l||G(e,t,c,null,i,n,ht(t,s),o,!1),u>0){if(16&u)M(c,f,v,i,s);else if(2&u&&f.class!==v.class&&a(c,"class",null,v.class,s),4&u&&a(c,"style",f.style,v.style,s),8&u){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const n=e[t],r=f[n],o=v[n];o===r&&"value"!==n||a(c,n,r,o,s,i)}}1&u&&e.children!==t.children&&h(c,t.children)}else l||null!=d||M(c,f,v,i,s);((g=v.onVnodeUpdated)||p)&&ct((()=>{g&&hi(g,i,t,e),p&&I(t,e,i,"updated")}),n)},O=(e,t,i,n,r,s,o)=>{for(let a=0;a<t.length;a++){const l=e[a],c=t[a],u=l.el&&(l.type===Ft||!Zt(l,c)||70&l.shapeFlag)?p(l.el):i;m(l,c,u,null,n,r,s,o,!0)}},M=(e,t,i,n,s)=>{if(t!==i){if(t!==r.MZ)for(const o in t)(0,r.SU)(o)||o in i||a(e,o,t[o],null,s,n);for(const o in i){if((0,r.SU)(o))continue;const l=i[o],c=t[o];l!==c&&"value"!==o&&a(e,o,c,l,s,n)}"value"in i&&a(e,"value",t.value,i.value,s)}},x=(e,t,i,n,r,o,a,l,u)=>{const d=t.el=e?e.el:c(""),h=t.anchor=e?e.anchor:c("");let{patchFlag:p,dynamicChildren:f,slotScopeIds:v}=t;v&&(l=l?l.concat(v):v),null==e?(s(d,i,n),s(h,i,n),L(t.children||[],i,h,r,o,a,l,u)):p>0&&64&p&&f&&e.dynamicChildren?(O(e.dynamicChildren,f,i,r,o,a,l),(null!=t.key||r&&t===r.subTree)&&vt(e,t,!0)):G(e,t,i,h,r,o,a,l,u)},N=(e,t,i,n,r,s,o,a,l)=>{t.slotScopeIds=a,null==e?512&t.shapeFlag?r.ctx.activate(t,i,n,o,l):U(t,i,n,r,s,o,l):F(e,t,l)},U=(e,t,i,n,r,s,o)=>{const a=e.component=vi(e,n,r);if(H(e)&&(a.ctx.renderer=ie),Ci(a,!1,o),a.asyncDep){if(r&&r.registerDep(a,j,o),!e.el){const e=a.subTree=ii(Bt);k(null,e,t,i)}}else j(a,e,t,i,r,s,o)},F=(e,t,i)=>{const n=t.component=e.component;if(Ot(e,t,i)){if(n.asyncDep&&!n.asyncResolved)return void B(n,t,i);n.next=t,n.update()}else t.el=e.el,n.vnode=t},j=(e,t,i,s,o,a,l)=>{const c=()=>{if(e.isMounted){let{next:t,bu:i,u:n,parent:s,vnode:u}=e;{const i=mt(e);if(i)return t&&(t.el=u.el,B(e,t,l)),void i.asyncDep.then((()=>{e.isUnmounted||c()}))}let d,h=t;0,pt(e,!1),t?(t.el=u.el,B(e,t,l)):t=u,i&&(0,r.DY)(i),(d=t.props&&t.props.onVnodeBeforeUpdate)&&hi(d,s,t,u),pt(e,!0);const f=Rt(e);0;const v=e.subTree;e.subTree=f,m(v,f,p(v.el),X(v),e,o,a),t.el=f.el,null===h&&xt(e,f.el),n&&ct(n,o),(d=t.props&&t.props.onVnodeUpdated)&&ct((()=>hi(d,s,t,u)),o)}else{let n;const{el:l,props:c}=t,{bm:u,m:d,parent:h,root:p,type:f}=e,v=W(t);if(pt(e,!1),u&&(0,r.DY)(u),!v&&(n=c&&c.onVnodeBeforeMount)&&hi(n,h,t),pt(e,!0),l&&re){const t=()=>{e.subTree=Rt(e),re(l,e.subTree,e,o,null)};v&&f.__asyncHydrate?f.__asyncHydrate(l,e,t):t()}else{p.ce&&p.ce._injectChildStyle(f);const n=e.subTree=Rt(e);0,m(null,n,i,s,e,o,a),t.el=n.el}if(d&&ct(d,o),!v&&(n=c&&c.onVnodeMounted)){const e=t;ct((()=>hi(n,h,e)),o)}(256&t.shapeFlag||h&&W(h.vnode)&&256&h.vnode.shapeFlag)&&e.a&&ct(e.a,o),e.isMounted=!0,t=i=s=null}};e.scope.on();const u=e.effect=new n.X2(c);e.scope.off();const d=e.update=u.run.bind(u),h=e.job=u.runIfDirty.bind(u);h.i=e,h.id=e.uid,u.scheduler=()=>y(h),pt(e,!0),d()},B=(e,t,i)=>{t.component=e;const r=e.vnode.props;e.vnode=t,e.next=null,Ke(e,t.props,r,i),at(e,t.children,i),(0,n.C4)(),T(e),(0,n.bl)()},G=(e,t,i,n,r,s,o,a,l=!1)=>{const c=e&&e.children,u=e?e.shapeFlag:0,d=t.children,{patchFlag:p,shapeFlag:f}=t;if(p>0){if(128&p)return void q(c,d,i,n,r,s,o,a,l);if(256&p)return void $(c,d,i,n,r,s,o,a,l)}8&f?(16&u&&Z(c,r,s),d!==c&&h(i,d)):16&u?16&f?q(c,d,i,n,r,s,o,a,l):Z(c,r,s,!0):(8&u&&h(i,""),16&f&&L(d,i,n,r,s,o,a,l))},$=(e,t,i,n,s,o,a,l,c)=>{e=e||r.Oj,t=t||r.Oj;const u=e.length,d=t.length,h=Math.min(u,d);let p;for(p=0;p<h;p++){const n=t[p]=c?ci(t[p]):li(t[p]);m(e[p],n,i,null,s,o,a,l,c)}u>d?Z(e,s,o,!0,!1,h):L(t,i,n,s,o,a,l,c,h)},q=(e,t,i,n,s,o,a,l,c)=>{let u=0;const d=t.length;let h=e.length-1,p=d-1;while(u<=h&&u<=p){const n=e[u],r=t[u]=c?ci(t[u]):li(t[u]);if(!Zt(n,r))break;m(n,r,i,null,s,o,a,l,c),u++}while(u<=h&&u<=p){const n=e[h],r=t[p]=c?ci(t[p]):li(t[p]);if(!Zt(n,r))break;m(n,r,i,null,s,o,a,l,c),h--,p--}if(u>h){if(u<=p){const e=p+1,r=e<d?t[e].el:n;while(u<=p)m(null,t[u]=c?ci(t[u]):li(t[u]),i,r,s,o,a,l,c),u++}}else if(u>p)while(u<=h)K(e[u],s,o,!0),u++;else{const f=u,v=u,g=new Map;for(u=v;u<=p;u++){const e=t[u]=c?ci(t[u]):li(t[u]);null!=e.key&&g.set(e.key,u)}let y,b=0;const k=p-v+1;let T=!1,S=0;const w=new Array(k);for(u=0;u<k;u++)w[u]=0;for(u=f;u<=h;u++){const n=e[u];if(b>=k){K(n,s,o,!0);continue}let r;if(null!=n.key)r=g.get(n.key);else for(y=v;y<=p;y++)if(0===w[y-v]&&Zt(n,t[y])){r=y;break}void 0===r?K(n,s,o,!0):(w[r-v]=u+1,r>=S?S=r:T=!0,m(n,t[r],i,null,s,o,a,l,c),b++)}const E=T?gt(w):r.Oj;for(y=E.length-1,u=k-1;u>=0;u--){const e=v+u,r=t[e],h=e+1<d?t[e+1].el:n;0===w[u]?m(null,r,i,h,s,o,a,l,c):T&&(y<0||u!==E[y]?z(r,i,h,2):y--)}}},z=(e,t,i,n,r=null)=>{const{el:o,type:a,transition:l,children:c,shapeFlag:u}=e;if(6&u)return void z(e.component.subTree,t,i,n);if(128&u)return void e.suspense.move(t,i,n);if(64&u)return void a.move(e,t,i,ie);if(a===Ft){s(o,t,i);for(let e=0;e<c.length;e++)z(c[e],t,i,n);return void s(e.anchor,t,i)}if(a===Gt)return void E(e,t,i);const d=2!==n&&1&u&&l;if(d)if(0===n)l.beforeEnter(o),s(o,t,i),ct((()=>l.enter(o)),r);else{const{leave:e,delayLeave:n,afterLeave:r}=l,a=()=>s(o,t,i),c=()=>{e(o,(()=>{a(),r&&r()}))};n?n(o,a,c):c()}else s(o,t,i)},K=(e,t,i,n=!1,r=!1)=>{const{type:s,props:o,ref:a,children:l,dynamicChildren:c,shapeFlag:u,patchFlag:d,dirs:h,cacheIndex:p}=e;if(-2===d&&(r=!1),null!=a&&V(a,null,i,e,!0),null!=p&&(t.renderCache[p]=void 0),256&u)return void t.ctx.deactivate(e);const f=1&u&&h,v=!W(e);let g;if(v&&(g=o&&o.onVnodeBeforeUnmount)&&hi(g,t,e),6&u)Y(e.component,i,n);else{if(128&u)return void e.suspense.unmount(i,n);f&&I(e,null,t,"beforeUnmount"),64&u?e.type.remove(e,t,i,ie,n):c&&!c.hasOnce&&(s!==Ft||d>0&&64&d)?Z(c,t,i,!1,!0):(s===Ft&&384&d||!r&&16&u)&&Z(l,t,i),n&&J(e)}(v&&(g=o&&o.onVnodeUnmounted)||f)&&ct((()=>{g&&hi(g,t,e),f&&I(e,null,t,"unmounted")}),i)},J=e=>{const{type:t,el:i,anchor:n,transition:r}=e;if(t===Ft)return void Q(i,n);if(t===Gt)return void P(e);const s=()=>{o(i),r&&!r.persisted&&r.afterLeave&&r.afterLeave()};if(1&e.shapeFlag&&r&&!r.persisted){const{leave:t,delayLeave:n}=r,o=()=>t(i,s);n?n(e.el,s,o):o()}else s()},Q=(e,t)=>{let i;while(e!==t)i=f(e),o(e),e=i;o(t)},Y=(e,t,i)=>{const{bum:n,scope:s,job:o,subTree:a,um:l,m:c,a:u}=e;yt(c),yt(u),n&&(0,r.DY)(n),s.stop(),o&&(o.flags|=8,K(a,e,t,i)),l&&ct(l,t),ct((()=>{e.isUnmounted=!0}),t),t&&t.pendingBranch&&!t.isUnmounted&&e.asyncDep&&!e.asyncResolved&&e.suspenseId===t.pendingId&&(t.deps--,0===t.deps&&t.resolve())},Z=(e,t,i,n=!1,r=!1,s=0)=>{for(let o=s;o<e.length;o++)K(e[o],t,i,n,r)},X=e=>{if(6&e.shapeFlag)return X(e.component.subTree);if(128&e.shapeFlag)return e.suspense.next();const t=f(e.anchor||e.el),i=t&&t[R];return i?f(i):t};let ee=!1;const te=(e,t,i)=>{null==e?t._vnode&&K(t._vnode,null,null,!0):m(t._vnode||null,e,t,null,null,null,i),t._vnode=e,ee||(ee=!0,T(),S(),ee=!1)},ie={p:m,um:K,m:z,r:J,mt:U,mc:L,pc:G,pbc:O,n:X,o:e};let ne,re;return t&&([ne,re]=t(ie)),{render:te,hydrate:ne,createApp:je(te,ne)}}function ht({type:e,props:t},i){return"svg"===i&&"foreignObject"===e||"mathml"===i&&"annotation-xml"===e&&t&&t.encoding&&t.encoding.includes("html")?void 0:i}function pt({effect:e,job:t},i){i?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function ft(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function vt(e,t,i=!1){const n=e.children,s=t.children;if((0,r.cy)(n)&&(0,r.cy)(s))for(let r=0;r<n.length;r++){const e=n[r];let t=s[r];1&t.shapeFlag&&!t.dynamicChildren&&((t.patchFlag<=0||32===t.patchFlag)&&(t=s[r]=ci(s[r]),t.el=e.el),i||-2===t.patchFlag||vt(e,t)),t.type===jt&&(t.el=e.el)}}function gt(e){const t=e.slice(),i=[0];let n,r,s,o,a;const l=e.length;for(n=0;n<l;n++){const l=e[n];if(0!==l){if(r=i[i.length-1],e[r]<l){t[n]=r,i.push(n);continue}s=0,o=i.length-1;while(s<o)a=s+o>>1,e[i[a]]<l?s=a+1:o=a;l<e[i[s]]&&(s>0&&(t[n]=i[s-1]),i[s]=n)}}s=i.length,o=i[s-1];while(s-- >0)i[s]=o,o=t[o];return i}function mt(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:mt(t)}function yt(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}const bt=Symbol.for("v-scx"),kt=()=>{{const e=$e(bt);return e}};function Tt(e,t){return wt(e,null,t)}function St(e,t,i){return wt(e,t,i)}function wt(e,t,i=r.MZ){const{immediate:s,deep:a,flush:l,once:c}=i;const u=(0,r.X$)({},i);const d=t&&s||!t&&"post"!==l;let h;if(Pi)if("sync"===l){const e=kt();h=e.__watcherHandles||(e.__watcherHandles=[])}else if(!d){const e=()=>{};return e.stop=r.tE,e.resume=r.tE,e.pause=r.tE,e}const p=gi;u.call=(e,t,i)=>o(e,p,t,i);let f=!1;"post"===l?u.scheduler=e=>{ct(e,p&&p.suspense)}:"sync"!==l&&(f=!0,u.scheduler=(e,t)=>{t?e():y(e)}),u.augmentJob=e=>{t&&(e.flags|=4),f&&(e.flags|=2,p&&(e.id=p.uid,e.i=p))};const v=(0,n.wB)(e,t,u);return Pi&&(h?h.push(v):d&&v()),v}function Et(e,t,i){const n=this.proxy,s=(0,r.Kg)(e)?e.includes(".")?Pt(n,e):()=>n[e]:e.bind(n,n);let o;(0,r.Tn)(t)?o=t:(o=t.handler,i=t);const a=ki(this),l=wt(s,o.bind(n),i);return a(),l}function Pt(e,t){const i=t.split(".");return()=>{let t=e;for(let e=0;e<i.length&&t;e++)t=t[i[e]];return t}}const Ct=(e,t)=>"modelValue"===t||"model-value"===t?e.modelModifiers:e[`${t}Modifiers`]||e[`${(0,r.PT)(t)}Modifiers`]||e[`${(0,r.Tg)(t)}Modifiers`];function _t(e,t,...i){if(e.isUnmounted)return;const n=e.vnode.props||r.MZ;let s=i;const a=t.startsWith("update:"),l=a&&Ct(n,t.slice(7));let c;l&&(l.trim&&(s=i.map((e=>(0,r.Kg)(e)?e.trim():e))),l.number&&(s=i.map(r.bB)));let u=n[c=(0,r.rU)(t)]||n[c=(0,r.rU)((0,r.PT)(t))];!u&&a&&(u=n[c=(0,r.rU)((0,r.Tg)(t))]),u&&o(u,e,6,s);const d=n[c+"Once"];if(d){if(e.emitted){if(e.emitted[c])return}else e.emitted={};e.emitted[c]=!0,o(d,e,6,s)}}function At(e,t,i=!1){const n=t.emitsCache,s=n.get(e);if(void 0!==s)return s;const o=e.emits;let a={},l=!1;if(!(0,r.Tn)(e)){const n=e=>{const i=At(e,t,!0);i&&(l=!0,(0,r.X$)(a,i))};!i&&t.mixins.length&&t.mixins.forEach(n),e.extends&&n(e.extends),e.mixins&&e.mixins.forEach(n)}return o||l?((0,r.cy)(o)?o.forEach((e=>a[e]=null)):(0,r.X$)(a,o),(0,r.Gv)(e)&&n.set(e,a),a):((0,r.Gv)(e)&&n.set(e,null),null)}function It(e,t){return!(!e||!(0,r.Mp)(t))&&(t=t.slice(2).replace(/Once$/,""),(0,r.$3)(e,t[0].toLowerCase()+t.slice(1))||(0,r.$3)(e,(0,r.Tg)(t))||(0,r.$3)(e,t))}function Rt(e){const{type:t,vnode:i,proxy:n,withProxy:s,propsOptions:[o],slots:l,attrs:c,emit:u,render:d,renderCache:h,props:p,data:f,setupState:v,ctx:g,inheritAttrs:m}=e,y=_(e);let b,k;try{if(4&i.shapeFlag){const e=s||n,t=e;b=li(d.call(t,e,h,p,v,f,g)),k=c}else{const e=t;0,b=li(e.length>1?e(p,{attrs:c,slots:l,emit:u}):e(p,null)),k=t.props?c:Lt(c)}}catch(S){$t.length=0,a(S,e,1),b=ii(Bt)}let T=b;if(k&&!1!==m){const e=Object.keys(k),{shapeFlag:t}=T;e.length&&7&t&&(o&&e.some(r.CP)&&(k=Dt(k,o)),T=si(T,k,!1,!0))}return i.dirs&&(T=si(T,null,!1,!0),T.dirs=T.dirs?T.dirs.concat(i.dirs):i.dirs),i.transition&&j(T,i.transition),b=T,_(y),b}const Lt=e=>{let t;for(const i in e)("class"===i||"style"===i||(0,r.Mp)(i))&&((t||(t={}))[i]=e[i]);return t},Dt=(e,t)=>{const i={};for(const n in e)(0,r.CP)(n)&&n.slice(9)in t||(i[n]=e[n]);return i};function Ot(e,t,i){const{props:n,children:r,component:s}=e,{props:o,children:a,patchFlag:l}=t,c=s.emitsOptions;if(t.dirs||t.transition)return!0;if(!(i&&l>=0))return!(!r&&!a||a&&a.$stable)||n!==o&&(n?!o||Mt(n,o,c):!!o);if(1024&l)return!0;if(16&l)return n?Mt(n,o,c):!!o;if(8&l){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const i=e[t];if(o[i]!==n[i]&&!It(c,i))return!0}}return!1}function Mt(e,t,i){const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(let r=0;r<n.length;r++){const s=n[r];if(t[s]!==e[s]&&!It(i,s))return!0}return!1}function xt({vnode:e,parent:t},i){while(t){const n=t.subTree;if(n.suspense&&n.suspense.activeBranch===e&&(n.el=e.el),n!==e)break;(e=t.vnode).el=i,t=t.parent}}const Nt=e=>e.__isSuspense;function Ut(e,t){t&&t.pendingBranch?(0,r.cy)(e)?t.effects.push(...e):t.effects.push(e):k(e)}const Ft=Symbol.for("v-fgt"),jt=Symbol.for("v-txt"),Bt=Symbol.for("v-cmt"),Gt=Symbol.for("v-stc"),$t=[];let Vt=null;function Wt(e=!1){$t.push(Vt=e?null:[])}function Ht(){$t.pop(),Vt=$t[$t.length-1]||null}let qt=1;function zt(e,t=!1){qt+=e,e<0&&Vt&&t&&(Vt.hasOnce=!0)}function Kt(e){return e.dynamicChildren=qt>0?Vt||r.Oj:null,Ht(),qt>0&&Vt&&Vt.push(e),e}function Jt(e,t,i,n,r,s){return Kt(ti(e,t,i,n,r,s,!0))}function Qt(e,t,i,n,r){return Kt(ii(e,t,i,n,r,!0))}function Yt(e){return!!e&&!0===e.__v_isVNode}function Zt(e,t){return e.type===t.type&&e.key===t.key}const Xt=({key:e})=>null!=e?e:null,ei=({ref:e,ref_key:t,ref_for:i})=>("number"===typeof e&&(e=""+e),null!=e?(0,r.Kg)(e)||(0,n.i9)(e)||(0,r.Tn)(e)?{i:P,r:e,k:t,f:!!i}:e:null);function ti(e,t=null,i=null,n=0,s=null,o=(e===Ft?0:1),a=!1,l=!1){const c={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Xt(t),ref:t&&ei(t),scopeId:C,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:n,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:P};return l?(ui(c,i),128&o&&e.normalize(c)):i&&(c.shapeFlag|=(0,r.Kg)(i)?8:16),qt>0&&!a&&Vt&&(c.patchFlag>0||6&o)&&32!==c.patchFlag&&Vt.push(c),c}const ii=ni;function ni(e,t=null,i=null,s=0,o=null,a=!1){if(e&&e!==pe||(e=Bt),Yt(e)){const n=si(e,t,!0);return i&&ui(n,i),qt>0&&!a&&Vt&&(6&n.shapeFlag?Vt[Vt.indexOf(e)]=n:Vt.push(n)),n.patchFlag=-2,n}if(Mi(e)&&(e=e.__vccOpts),t){t=ri(t);let{class:e,style:i}=t;e&&!(0,r.Kg)(e)&&(t.class=(0,r.C4)(e)),(0,r.Gv)(i)&&((0,n.ju)(i)&&!(0,r.cy)(i)&&(i=(0,r.X$)({},i)),t.style=(0,r.Tr)(i))}const l=(0,r.Kg)(e)?1:Nt(e)?128:L(e)?64:(0,r.Gv)(e)?4:(0,r.Tn)(e)?2:0;return ti(e,t,i,s,o,l,a,!0)}function ri(e){return e?(0,n.ju)(e)||qe(e)?(0,r.X$)({},e):e:null}function si(e,t,i=!1,n=!1){const{props:s,ref:o,patchFlag:a,children:l,transition:c}=e,u=t?di(s||{},t):s,d={__v_isVNode:!0,__v_skip:!0,type:e.type,props:u,key:u&&Xt(u),ref:t&&t.ref?i&&o?(0,r.cy)(o)?o.concat(ei(t)):[o,ei(t)]:ei(t):o,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:l,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Ft?-1===a?16:16|a:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:c,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&si(e.ssContent),ssFallback:e.ssFallback&&si(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return c&&n&&j(d,c.clone(d)),d}function oi(e=" ",t=0){return ii(jt,null,e,t)}function ai(e="",t=!1){return t?(Wt(),Qt(Bt,null,e)):ii(Bt,null,e)}function li(e){return null==e||"boolean"===typeof e?ii(Bt):(0,r.cy)(e)?ii(Ft,null,e.slice()):Yt(e)?ci(e):ii(jt,null,String(e))}function ci(e){return null===e.el&&-1!==e.patchFlag||e.memo?e:si(e)}function ui(e,t){let i=0;const{shapeFlag:n}=e;if(null==t)t=null;else if((0,r.cy)(t))i=16;else if("object"===typeof t){if(65&n){const i=t.default;return void(i&&(i._c&&(i._d=!1),ui(e,i()),i._c&&(i._d=!0)))}{i=32;const n=t._;n||qe(t)?3===n&&P&&(1===P.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=P}}else(0,r.Tn)(t)?(t={default:t,_ctx:P},i=32):(t=String(t),64&n?(i=16,t=[oi(t)]):i=8);e.children=t,e.shapeFlag|=i}function di(...e){const t={};for(let i=0;i<e.length;i++){const n=e[i];for(const e in n)if("class"===e)t.class!==n.class&&(t.class=(0,r.C4)([t.class,n.class]));else if("style"===e)t.style=(0,r.Tr)([t.style,n.style]);else if((0,r.Mp)(e)){const i=t[e],s=n[e];!s||i===s||(0,r.cy)(i)&&i.includes(s)||(t[e]=i?[].concat(i,s):s)}else""!==e&&(t[e]=n[e])}return t}function hi(e,t,i,n=null){o(e,t,7,[i,n])}const pi=Ue();let fi=0;function vi(e,t,i){const s=e.type,o=(t?t.appContext:e.appContext)||pi,a={uid:fi++,vnode:e,type:s,parent:t,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new n.yC(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(o.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Ze(s,o),emitsOptions:At(s,o),emit:null,emitted:null,propsDefaults:r.MZ,inheritAttrs:s.inheritAttrs,ctx:r.MZ,data:r.MZ,props:r.MZ,attrs:r.MZ,slots:r.MZ,refs:r.MZ,setupState:r.MZ,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=t?t.root:a,a.emit=_t.bind(null,a),e.ce&&e.ce(a),a}let gi=null;const mi=()=>gi||P;let yi,bi;{const e=(0,r.We)(),t=(t,i)=>{let n;return(n=e[t])||(n=e[t]=[]),n.push(i),e=>{n.length>1?n.forEach((t=>t(e))):n[0](e)}};yi=t("__VUE_INSTANCE_SETTERS__",(e=>gi=e)),bi=t("__VUE_SSR_SETTERS__",(e=>Pi=e))}const ki=e=>{const t=gi;return yi(e),e.scope.on(),()=>{e.scope.off(),yi(t)}},Ti=()=>{gi&&gi.scope.off(),yi(null)};function Si(e){return 4&e.vnode.shapeFlag}let wi,Ei,Pi=!1;function Ci(e,t=!1,i=!1){t&&bi(t);const{props:n,children:r}=e.vnode,s=Si(e);ze(e,n,s,t),ot(e,r,i);const o=s?_i(e,t):void 0;return t&&bi(!1),o}function _i(e,t){const i=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,ke);const{setup:o}=i;if(o){(0,n.C4)();const i=e.setupContext=o.length>1?Li(e):null,l=ki(e),c=s(o,e,0,[e.props,i]),u=(0,r.yL)(c);if((0,n.bl)(),l(),!u&&!e.sp||W(e)||$(e),u){if(c.then(Ti,Ti),t)return c.then((i=>{Ai(e,i,t)})).catch((t=>{a(t,e,0)}));e.asyncDep=c}else Ai(e,c,t)}else Ii(e,t)}function Ai(e,t,i){(0,r.Tn)(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:(0,r.Gv)(t)&&(e.setupState=(0,n.Pr)(t)),Ii(e,i)}function Ii(e,t,i){const s=e.type;if(!e.render){if(!t&&wi&&!s.render){const t=s.template||_e(e).template;if(t){0;const{isCustomElement:i,compilerOptions:n}=e.appContext.config,{delimiters:o,compilerOptions:a}=s,l=(0,r.X$)((0,r.X$)({isCustomElement:i,delimiters:o},n),a);s.render=wi(t,l)}}e.render=s.render||r.tE,Ei&&Ei(e)}{const t=ki(e);(0,n.C4)();try{we(e)}finally{(0,n.bl)(),t()}}}const Ri={get(e,t){return(0,n.u4)(e,"get",""),e[t]}};function Li(e){const t=t=>{e.exposed=t||{}};return{attrs:new Proxy(e.attrs,Ri),slots:e.slots,emit:e.emit,expose:t}}function Di(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy((0,n.Pr)((0,n.IG)(e.exposed)),{get(t,i){return i in t?t[i]:i in ye?ye[i](e):void 0},has(e,t){return t in e||t in ye}})):e.proxy}function Oi(e,t=!0){return(0,r.Tn)(e)?e.displayName||e.name:e.name||t&&e.__name}function Mi(e){return(0,r.Tn)(e)&&"__vccOpts"in e}const xi=(e,t)=>{const i=(0,n.EW)(e,t,Pi);return i};function Ni(e,t,i){const n=arguments.length;return 2===n?(0,r.Gv)(t)&&!(0,r.cy)(t)?Yt(t)?ii(e,null,[t]):ii(e,t):ii(e,null,t):(n>3?i=Array.prototype.slice.call(arguments,2):3===n&&Yt(i)&&(i=[i]),ii(e,t,i))}const Ui="3.5.13"},5130:function(e,t,i){"use strict";i.d(t,{Ef:function(){return q}});i(4114),i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698),i(8992),i(4520),i(3949),i(1454),i(7550);var n=i(6768),r=i(4232);i(144);
/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
let s;const o="undefined"!==typeof window&&window.trustedTypes;if(o)try{s=o.createPolicy("vue",{createHTML:e=>e})}catch(J){}const a=s?e=>s.createHTML(e):e=>e,l="http://www.w3.org/2000/svg",c="http://www.w3.org/1998/Math/MathML",u="undefined"!==typeof document?document:null,d=u&&u.createElement("template"),h={insert:(e,t,i)=>{t.insertBefore(e,i||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,i,n)=>{const r="svg"===t?u.createElementNS(l,e):"mathml"===t?u.createElementNS(c,e):i?u.createElement(e,{is:i}):u.createElement(e);return"select"===e&&n&&null!=n.multiple&&r.setAttribute("multiple",n.multiple),r},createText:e=>u.createTextNode(e),createComment:e=>u.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>u.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,i,n,r,s){const o=i?i.previousSibling:t.lastChild;if(r&&(r===s||r.nextSibling)){while(1)if(t.insertBefore(r.cloneNode(!0),i),r===s||!(r=r.nextSibling))break}else{d.innerHTML=a("svg"===n?`<svg>${e}</svg>`:"mathml"===n?`<math>${e}</math>`:e);const r=d.content;if("svg"===n||"mathml"===n){const e=r.firstChild;while(e.firstChild)r.appendChild(e.firstChild);r.removeChild(e)}t.insertBefore(r,i)}return[o?o.nextSibling:t.firstChild,i?i.previousSibling:t.lastChild]}},p=Symbol("_vtc"),f={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};n.QP;function v(e,t,i){const n=e[p];n&&(t=(t?[t,...n]:[...n]).join(" ")),null==t?e.removeAttribute("class"):i?e.setAttribute("class",t):e.className=t}const g=Symbol("_vod"),m=Symbol("_vsh");const y=Symbol("");const b=/(^|;)\s*display\s*:/;function k(e,t,i){const n=e.style,s=(0,r.Kg)(i);let o=!1;if(i&&!s){if(t)if((0,r.Kg)(t))for(const e of t.split(";")){const t=e.slice(0,e.indexOf(":")).trim();null==i[t]&&S(n,t,"")}else for(const e in t)null==i[e]&&S(n,e,"");for(const e in i)"display"===e&&(o=!0),S(n,e,i[e])}else if(s){if(t!==i){const e=n[y];e&&(i+=";"+e),n.cssText=i,o=b.test(i)}}else t&&e.removeAttribute("style");g in e&&(e[g]=o?n.display:"",e[m]&&(n.display="none"))}const T=/\s*!important$/;function S(e,t,i){if((0,r.cy)(i))i.forEach((i=>S(e,t,i)));else if(null==i&&(i=""),t.startsWith("--"))e.setProperty(t,i);else{const n=P(e,t);T.test(i)?e.setProperty((0,r.Tg)(n),i.replace(T,""),"important"):e[n]=i}}const w=["Webkit","Moz","ms"],E={};function P(e,t){const i=E[t];if(i)return i;let n=(0,r.PT)(t);if("filter"!==n&&n in e)return E[t]=n;n=(0,r.ZH)(n);for(let r=0;r<w.length;r++){const i=w[r]+n;if(i in e)return E[t]=i}return t}const C="http://www.w3.org/1999/xlink";function _(e,t,i,n,s,o=(0,r.J$)(t)){n&&t.startsWith("xlink:")?null==i?e.removeAttributeNS(C,t.slice(6,t.length)):e.setAttributeNS(C,t,i):null==i||o&&!(0,r.Y2)(i)?e.removeAttribute(t):e.setAttribute(t,o?"":(0,r.Bm)(i)?String(i):i)}function A(e,t,i,n,s){if("innerHTML"===t||"textContent"===t)return void(null!=i&&(e[t]="innerHTML"===t?a(i):i));const o=e.tagName;if("value"===t&&"PROGRESS"!==o&&!o.includes("-")){const n="OPTION"===o?e.getAttribute("value")||"":e.value,r=null==i?"checkbox"===e.type?"on":"":String(i);return n===r&&"_value"in e||(e.value=r),null==i&&e.removeAttribute(t),void(e._value=i)}let l=!1;if(""===i||null==i){const n=typeof e[t];"boolean"===n?i=(0,r.Y2)(i):null==i&&"string"===n?(i="",l=!0):"number"===n&&(i=0,l=!0)}try{e[t]=i}catch(J){0}l&&e.removeAttribute(s||t)}function I(e,t,i,n){e.addEventListener(t,i,n)}function R(e,t,i,n){e.removeEventListener(t,i,n)}const L=Symbol("_vei");function D(e,t,i,n,r=null){const s=e[L]||(e[L]={}),o=s[t];if(n&&o)o.value=n;else{const[i,a]=M(t);if(n){const o=s[t]=F(n,r);I(e,i,o,a)}else o&&(R(e,i,o,a),s[t]=void 0)}}const O=/(?:Once|Passive|Capture)$/;function M(e){let t;if(O.test(e)){let i;t={};while(i=e.match(O))e=e.slice(0,e.length-i[0].length),t[i[0].toLowerCase()]=!0}const i=":"===e[2]?e.slice(3):(0,r.Tg)(e.slice(2));return[i,t]}let x=0;const N=Promise.resolve(),U=()=>x||(N.then((()=>x=0)),x=Date.now());function F(e,t){const i=e=>{if(e._vts){if(e._vts<=i.attached)return}else e._vts=Date.now();(0,n.qL)(j(e,i.value),t,5,[e])};return i.value=e,i.attached=U(),i}function j(e,t){if((0,r.cy)(t)){const i=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{i.call(e),e._stopped=!0},t.map((e=>t=>!t._stopped&&e&&e(t)))}return t}const B=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,G=(e,t,i,n,s,o)=>{const a="svg"===s;"class"===t?v(e,n,a):"style"===t?k(e,i,n):(0,r.Mp)(t)?(0,r.CP)(t)||D(e,t,i,n,o):("."===t[0]?(t=t.slice(1),1):"^"===t[0]?(t=t.slice(1),0):$(e,t,n,a))?(A(e,t,n),e.tagName.includes("-")||"value"!==t&&"checked"!==t&&"selected"!==t||_(e,t,n,a,o,"value"!==t)):!e._isVueCE||!/[A-Z]/.test(t)&&(0,r.Kg)(n)?("true-value"===t?e._trueValue=n:"false-value"===t&&(e._falseValue=n),_(e,t,n,a)):A(e,(0,r.PT)(t),n,o,t)};function $(e,t,i,n){if(n)return"innerHTML"===t||"textContent"===t||!!(t in e&&B(t)&&(0,r.Tn)(i));if("spellcheck"===t||"draggable"===t||"translate"===t)return!1;if("form"===t)return!1;if("list"===t&&"INPUT"===e.tagName)return!1;if("type"===t&&"TEXTAREA"===e.tagName)return!1;if("width"===t||"height"===t){const t=e.tagName;if("IMG"===t||"VIDEO"===t||"CANVAS"===t||"SOURCE"===t)return!1}return(!B(t)||!(0,r.Kg)(i))&&t in e}
/*! #__NO_SIDE_EFFECTS__ */
"undefined"!==typeof HTMLElement&&HTMLElement;Symbol("_moveCb"),Symbol("_enterCb");Symbol("_assign");const V=(0,r.X$)({patchProp:G},h);let W;function H(){return W||(W=(0,n.K9)(V))}const q=(...e)=>{const t=H().createApp(...e);const{mount:i}=t;return t.mount=e=>{const n=K(e);if(!n)return;const s=t._component;(0,r.Tn)(s)||s.render||s.template||(s.template=n.innerHTML),1===n.nodeType&&(n.textContent="");const o=i(n,!1,z(n));return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),o},t};function z(e){return e instanceof SVGElement?"svg":"function"===typeof MathMLElement&&e instanceof MathMLElement?"mathml":void 0}function K(e){if((0,r.Kg)(e)){const t=document.querySelector(e);return t}return e}},4232:function(e,t,i){"use strict";i.d(t,{$3:function(){return p},$H:function(){return U},BH:function(){return H},BX:function(){return ie},Bm:function(){return T},C4:function(){return Y},CE:function(){return v},CP:function(){return c},DY:function(){return F},Gv:function(){return S},J$:function(){return X},Kg:function(){return k},MZ:function(){return r},Mp:function(){return l},NO:function(){return a},Oj:function(){return s},PT:function(){return D},Qd:function(){return _},Ro:function(){return G},SU:function(){return I},TF:function(){return d},Tg:function(){return M},Tn:function(){return b},Tr:function(){return q},We:function(){return V},X$:function(){return u},Y2:function(){return ee},ZH:function(){return x},Zf:function(){return C},bB:function(){return B},cy:function(){return f},gd:function(){return y},pD:function(){return n},rU:function(){return N},tE:function(){return o},u3:function(){return ne},vM:function(){return g},v_:function(){return se},yI:function(){return A},yL:function(){return w},yQ:function(){return j}});i(4114),i(8992),i(4520),i(3949),i(1454),i(8872);
/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
/*! #__NO_SIDE_EFFECTS__ */
function n(e){const t=Object.create(null);for(const i of e.split(","))t[i]=1;return e=>e in t}const r={},s=[],o=()=>{},a=()=>!1,l=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),c=e=>e.startsWith("onUpdate:"),u=Object.assign,d=(e,t)=>{const i=e.indexOf(t);i>-1&&e.splice(i,1)},h=Object.prototype.hasOwnProperty,p=(e,t)=>h.call(e,t),f=Array.isArray,v=e=>"[object Map]"===P(e),g=e=>"[object Set]"===P(e),m=e=>"[object Date]"===P(e),y=e=>"[object RegExp]"===P(e),b=e=>"function"===typeof e,k=e=>"string"===typeof e,T=e=>"symbol"===typeof e,S=e=>null!==e&&"object"===typeof e,w=e=>(S(e)||b(e))&&b(e.then)&&b(e.catch),E=Object.prototype.toString,P=e=>E.call(e),C=e=>P(e).slice(8,-1),_=e=>"[object Object]"===P(e),A=e=>k(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,I=n(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),R=e=>{const t=Object.create(null);return i=>{const n=t[i];return n||(t[i]=e(i))}},L=/-(\w)/g,D=R((e=>e.replace(L,((e,t)=>t?t.toUpperCase():"")))),O=/\B([A-Z])/g,M=R((e=>e.replace(O,"-$1").toLowerCase())),x=R((e=>e.charAt(0).toUpperCase()+e.slice(1))),N=R((e=>{const t=e?`on${x(e)}`:"";return t})),U=(e,t)=>!Object.is(e,t),F=(e,...t)=>{for(let i=0;i<e.length;i++)e[i](...t)},j=(e,t,i,n=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:n,value:i})},B=e=>{const t=parseFloat(e);return isNaN(t)?e:t},G=e=>{const t=k(e)?Number(e):NaN;return isNaN(t)?e:t};let $;const V=()=>$||($="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof i.g?i.g:{});const W="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error,Symbol",H=n(W);function q(e){if(f(e)){const t={};for(let i=0;i<e.length;i++){const n=e[i],r=k(n)?Q(n):q(n);if(r)for(const e in r)t[e]=r[e]}return t}if(k(e)||S(e))return e}const z=/;(?![^(]*\))/g,K=/:([^]+)/,J=/\/\*[^]*?\*\//g;function Q(e){const t={};return e.replace(J,"").split(z).forEach((e=>{if(e){const i=e.split(K);i.length>1&&(t[i[0].trim()]=i[1].trim())}})),t}function Y(e){let t="";if(k(e))t=e;else if(f(e))for(let i=0;i<e.length;i++){const n=Y(e[i]);n&&(t+=n+" ")}else if(S(e))for(const i in e)e[i]&&(t+=i+" ");return t.trim()}const Z="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",X=n(Z);function ee(e){return!!e||""===e}function te(e,t){if(e.length!==t.length)return!1;let i=!0;for(let n=0;i&&n<e.length;n++)i=ie(e[n],t[n]);return i}function ie(e,t){if(e===t)return!0;let i=m(e),n=m(t);if(i||n)return!(!i||!n)&&e.getTime()===t.getTime();if(i=T(e),n=T(t),i||n)return e===t;if(i=f(e),n=f(t),i||n)return!(!i||!n)&&te(e,t);if(i=S(e),n=S(t),i||n){if(!i||!n)return!1;const r=Object.keys(e).length,s=Object.keys(t).length;if(r!==s)return!1;for(const i in e){const n=e.hasOwnProperty(i),r=t.hasOwnProperty(i);if(n&&!r||!n&&r||!ie(e[i],t[i]))return!1}}return String(e)===String(t)}function ne(e,t){return e.findIndex((e=>ie(e,t)))}const re=e=>!(!e||!0!==e["__v_isRef"]),se=e=>k(e)?e:null==e?"":f(e)||S(e)&&(e.toString===E||!b(e.toString))?re(e)?se(e.value):JSON.stringify(e,oe,2):String(e),oe=(e,t)=>re(t)?oe(e,t.value):v(t)?{[`Map(${t.size})`]:[...t.entries()].reduce(((e,[t,i],n)=>(e[ae(t,n)+" =>"]=i,e)),{})}:g(t)?{[`Set(${t.size})`]:[...t.values()].map((e=>ae(e)))}:T(t)?ae(t):!S(t)||f(t)||_(t)?t:String(t),ae=(e,t="")=>{var i;return T(e)?`Symbol(${null!=(i=e.description)?i:t})`:e}},8974:function(e,t,i){var n;i(4114),i(8992),i(4520),i(9848),function(r){var s=Object.hasOwnProperty,o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=10,l="object"==typeof process&&"function"==typeof process.nextTick,c="function"===typeof Symbol,u="object"===typeof Reflect,d="function"===typeof setImmediate,h=d?setImmediate:setTimeout,p=c?u&&"function"===typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function f(){this._events={},this._conf&&v.call(this,this._conf)}function v(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==r&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function g(e,t){var i="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(i+=" Event name: "+t+"."),"undefined"!==typeof process&&process.emitWarning){var n=new Error(i);n.name="MaxListenersExceededWarning",n.emitter=this,n.count=e,process.emitWarning(n)}else console.error(i),console.trace&&console.trace()}var m=function(e,t,i){var n=arguments.length;switch(n){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,i];default:var r=new Array(n);while(n--)r[n]=arguments[n];return r}};function y(e,t){for(var i,n={},s=e.length,o=t?t.length:0,a=0;a<s;a++)i=e[a],n[i]=a<o?t[a]:r;return n}function b(e,t,i){var n,r;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(i.on||i.off)&&(n=i.on,r=i.off),t.addEventListener?(n=t.addEventListener,r=t.removeEventListener):t.addListener?(n=t.addListener,r=t.removeListener):t.on&&(n=t.on,r=t.off),!n&&!r)throw Error("target does not implement any known event API");if("function"!==typeof n)throw TypeError("on method must be a function");if("function"!==typeof r)throw TypeError("off method must be a function");this._on=n,this._off=r;var s=e._observers;s?s.push(this):e._observers=[this]}function k(e,t,i,n){var o=Object.assign({},t);if(!e)return o;if("object"!==typeof e)throw TypeError("options must be an object");var a,l,c,u=Object.keys(e),d=u.length;function h(e){throw Error('Invalid "'+a+'" option value'+(e?". Reason: "+e:""))}for(var p=0;p<d;p++){if(a=u[p],!n&&!s.call(t,a))throw Error('Unknown "'+a+'" option');l=e[a],l!==r&&(c=i[a],o[a]=c?c(l,h):l)}return o}function T(e,t){return"function"===typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function S(e){var t="value must be type of "+e.join("|"),i=e.length,n=e[0],r=e[1];return 1===i?function(e,i){if(typeof e===n)return e;i(t)}:2===i?function(e,i){var s=typeof e;if(s===n||s===r)return e;i(t)}:function(n,r){var s=typeof n,o=i;while(o-- >0)if(s===e[o])return n;r(t)}}Object.assign(b.prototype,{subscribe:function(e,t,i){var n=this,r=this._target,s=this._emitter,o=this._listeners,a=function(){var n=m.apply(null,arguments),o={data:n,name:t,original:e};if(i){var a=i.call(r,o);!1!==a&&s.emit.apply(s,[o.name].concat(n))}else s.emit.apply(s,[t].concat(n))};if(o[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,s._newListener&&s._removeListener&&!n._onNewListener?(this._onNewListener=function(i){i===t&&null===o[e]&&(o[e]=a,n._on.call(r,e,a))},s.on("newListener",this._onNewListener),this._onRemoveListener=function(i){i===t&&!s.hasListeners(i)&&o[e]&&(o[e]=null,n._off.call(r,e,a))},o[e]=null,s.on("removeListener",this._onRemoveListener)):(o[e]=a,n._on.call(r,e,a))},unsubscribe:function(e){var t,i,n,r=this,s=this._listeners,o=this._emitter,a=this._off,l=this._target;if(e&&"string"!==typeof e)throw TypeError("event must be a string");function c(){r._onNewListener&&(o.off("newListener",r._onNewListener),o.off("removeListener",r._onRemoveListener),r._onNewListener=null,r._onRemoveListener=null);var e=C.call(o,r);o._observers.splice(e,1)}if(e){if(t=s[e],!t)return;a.call(l,e,t),delete s[e],--this._listenersCount||c()}else{i=p(s),n=i.length;while(n-- >0)e=i[n],a.call(l,e,s[e]);this._listeners={},this._listenersCount=0,c()}}});var w=S(["function"]),E=S(["object","function"]);function P(e,t,i){var n,r,s,o=0,a=new e((function(l,c,u){function d(){r&&(r=null),o&&(clearTimeout(o),o=0)}i=k(i,{timeout:0,overload:!1},{timeout:function(e,t){return e*=1,("number"!==typeof e||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),n=!i.overload&&"function"===typeof e.prototype.cancel&&"function"===typeof u;var h=function(e){d(),l(e)},p=function(e){d(),c(e)};n?t(h,p,u):(r=[function(e){p(e||Error("canceled"))}],t(h,p,(function(e){if(s)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!==typeof e)throw TypeError("onCancel callback must be a function");r.push(e)})),s=!0),i.timeout>0&&(o=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",o=0,a.cancel(e),c(e)}),i.timeout))}));return n||(a.cancel=function(e){if(r){for(var t=r.length,i=1;i<t;i++)r[i](e);r[0](e),r=null}}),a}function C(e){var t=this._observers;if(!t)return-1;for(var i=t.length,n=0;n<i;n++)if(t[n]._target===e)return n;return-1}function _(e,t,i,n,r){if(!i)return null;if(0===n){var s=typeof t;if("string"===s){var o,a,l=0,c=0,u=this.delimiter,d=u.length;if(-1!==(a=t.indexOf(u))){o=new Array(5);do{o[l++]=t.slice(c,a),c=a+d}while(-1!==(a=t.indexOf(u,c)));o[l++]=t.slice(c),t=o,r=l}else t=[t],r=1}else"object"===s?r=t.length:(t=[t],r=1)}var h,f,v,g,m,y,b,k=null,T=t[n],S=t[n+1];if(n===r)i._listeners&&("function"===typeof i._listeners?(e&&e.push(i._listeners),k=[i]):(e&&e.push.apply(e,i._listeners),k=[i]));else{if("*"===T){y=p(i),a=y.length;while(a-- >0)h=y[a],"_listeners"!==h&&(b=_(e,t,i[h],n+1,r),b&&(k?k.push.apply(k,b):k=b));return k}if("**"===T){m=n+1===r||n+2===r&&"*"===S,m&&i._listeners&&(k=_(e,t,i,r,r)),y=p(i),a=y.length;while(a-- >0)h=y[a],"_listeners"!==h&&("*"===h||"**"===h?(i[h]._listeners&&!m&&(b=_(e,t,i[h],r,r),b&&(k?k.push.apply(k,b):k=b)),b=_(e,t,i[h],n,r)):b=_(e,t,i[h],h===S?n+2:n,r),b&&(k?k.push.apply(k,b):k=b));return k}i[T]&&(k=_(e,t,i[T],n+1,r))}if(f=i["*"],f&&_(e,t,f,n+1,r),v=i["**"],v)if(n<r){v._listeners&&_(e,t,v,r,r),y=p(v),a=y.length;while(a-- >0)h=y[a],"_listeners"!==h&&(h===S?_(e,t,v[h],n+2,r):h===T?_(e,t,v[h],n+1,r):(g={},g[h]=v[h],_(e,t,{"**":g},n+1,r)))}else v._listeners?_(e,t,v,r,r):v["*"]&&v["*"]._listeners&&_(e,t,v["*"],r,r);return k}function A(e,t,i){var n,r,s=0,o=0,a=this.delimiter,l=a.length;if("string"===typeof e)if(-1!==(n=e.indexOf(a))){r=new Array(5);do{r[s++]=e.slice(o,n),o=n+l}while(-1!==(n=e.indexOf(a,o)));r[s++]=e.slice(o)}else r=[e],s=1;else r=e,s=e.length;if(s>1)for(n=0;n+1<s;n++)if("**"===r[n]&&"**"===r[n+1])return;var c,u=this.listenerTree;for(n=0;n<s;n++)if(c=r[n],u=u[c]||(u[c]={}),n===s-1)return u._listeners?("function"===typeof u._listeners&&(u._listeners=[u._listeners]),i?u._listeners.unshift(t):u._listeners.push(t),!u._listeners.warned&&this._maxListeners>0&&u._listeners.length>this._maxListeners&&(u._listeners.warned=!0,g.call(this,u._listeners.length,c))):u._listeners=t,!0;return!0}function I(e,t,i,n){var r,s,o,a,l=p(e),c=l.length,u=e["_listeners"];while(c-- >0)s=l[c],r=e[s],o="_listeners"===s?i:i?i.concat(s):[s],a=n||"symbol"===typeof s,u&&t.push(a?o:o.join(this.delimiter)),"object"===typeof r&&I.call(this,r,t,o,a);return t}function R(e){var t,i,n,r=p(e),s=r.length;while(s-- >0)i=r[s],t=e[i],t&&(n=!0,"_listeners"===i||R(t)||delete e[i]);return n}function L(e,t,i){this.emitter=e,this.event=t,this.listener=i}function D(e,t,i){if(!0===i)s=!0;else if(!1===i)n=!0;else{if(!i||"object"!==typeof i)throw TypeError("options should be an object or true");var n=i.async,s=i.promisify,o=i.nextTick,a=i.objectify}if(n||o||s){var c=t,u=t._origin||t;if(o&&!l)throw Error("process.nextTick is not supported");s===r&&(s="AsyncFunction"===t.constructor.name),t=function(){var e=arguments,t=this,i=this.event;return s?o?Promise.resolve():new Promise((function(e){h(e)})).then((function(){return t.event=i,c.apply(t,e)})):(o?process.nextTick:h)((function(){t.event=i,c.apply(t,e)}))},t._async=!0,t._origin=u}return[t,a?new L(this,e,t):this]}function O(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,v.call(this,e)}function M(e,t,i){i=k(i,{Promise:Promise,timeout:0,overload:!1},{Promise:T});var n=i.Promise;return P(n,(function(i,n,r){var s;if("function"===typeof e.addEventListener)return s=function(){i(m.apply(null,arguments))},r((function(){e.removeEventListener(t,s)})),void e.addEventListener(t,s,{once:!0});var o,a=function(){o&&e.removeListener("error",o),i(m.apply(null,arguments))};"error"!==t&&(o=function(i){e.removeListener(t,a),n(i)},e.once("error",o)),r((function(){o&&e.removeListener("error",o),e.removeListener(t,a)})),e.once(t,a)}),{timeout:i.timeout,overload:i.overload})}L.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},O.EventEmitter2=O,O.prototype.listenTo=function(e,t,i){if("object"!==typeof e)throw TypeError("target musts be an object");var n=this;function s(t){if("object"!==typeof t)throw TypeError("events must be an object");var r,s=i.reducers,o=C.call(n,e);r=-1===o?new b(n,e,i):n._observers[o];for(var a,l=p(t),c=l.length,u="function"===typeof s,d=0;d<c;d++)a=l[d],r.subscribe(a,t[a]||a,u?s:s&&s[a])}return i=k(i,{on:r,off:r,reducers:r},{on:w,off:w,reducers:E}),o(t)?s(y(t)):s("string"===typeof t?y(t.split(/\s+/)):t),this},O.prototype.stopListeningTo=function(e,t){var i=this._observers;if(!i)return!1;var n,r=i.length,s=!1;if(e&&"object"!==typeof e)throw TypeError("target should be an object");while(r-- >0)n=i[r],e&&n._target!==e||(n.unsubscribe(t),s=!0);return s},O.prototype.delimiter=".",O.prototype.setMaxListeners=function(e){e!==r&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},O.prototype.getMaxListeners=function(){return this._maxListeners},O.prototype.event="",O.prototype.once=function(e,t,i){return this._once(e,t,!1,i)},O.prototype.prependOnceListener=function(e,t,i){return this._once(e,t,!0,i)},O.prototype._once=function(e,t,i,n){return this._many(e,1,t,i,n)},O.prototype.many=function(e,t,i,n){return this._many(e,t,i,!1,n)},O.prototype.prependMany=function(e,t,i,n){return this._many(e,t,i,!0,n)},O.prototype._many=function(e,t,i,n,r){var s=this;if("function"!==typeof i)throw new Error("many only accepts instances of Function");function o(){return 0===--t&&s.off(e,o),i.apply(this,arguments)}return o._origin=i,this._on(e,o,n,r)},O.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||f.call(this);var e,t,i,n,r,s,o=arguments[0],a=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return!1;if(a&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"===typeof o)){if(i=o.length,c)for(n=0;n<i;n++)if("symbol"===typeof o[n]){s=!0;break}s||(o=o.join(this.delimiter))}var l,u=arguments.length;if(this._all&&this._all.length)for(l=this._all.slice(),n=0,i=l.length;n<i;n++)switch(this.event=o,u){case 1:l[n].call(this,o);break;case 2:l[n].call(this,o,arguments[1]);break;case 3:l[n].call(this,o,arguments[1],arguments[2]);break;default:l[n].apply(this,arguments)}if(a)l=[],_.call(this,l,e,this.listenerTree,0,i);else{if(l=this._events[o],"function"===typeof l){switch(this.event=o,u){case 1:l.call(this);break;case 2:l.call(this,arguments[1]);break;case 3:l.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(u-1),r=1;r<u;r++)t[r-1]=arguments[r];l.apply(this,t)}return!0}l&&(l=l.slice())}if(l&&l.length){if(u>3)for(t=new Array(u-1),r=1;r<u;r++)t[r-1]=arguments[r];for(n=0,i=l.length;n<i;n++)switch(this.event=o,u){case 1:l[n].call(this);break;case 2:l[n].call(this,arguments[1]);break;case 3:l[n].call(this,arguments[1],arguments[2]);break;default:l[n].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===o)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},O.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||f.call(this);var e,t,i,n,r,s,o=arguments[0],a=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(a&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"===typeof o)){if(n=o.length,c)for(r=0;r<n;r++)if("symbol"===typeof o[r]){t=!0;break}t||(o=o.join(this.delimiter))}var l,u=[],d=arguments.length;if(this._all)for(r=0,n=this._all.length;r<n;r++)switch(this.event=o,d){case 1:u.push(this._all[r].call(this,o));break;case 2:u.push(this._all[r].call(this,o,arguments[1]));break;case 3:u.push(this._all[r].call(this,o,arguments[1],arguments[2]));break;default:u.push(this._all[r].apply(this,arguments))}if(a?(l=[],_.call(this,l,e,this.listenerTree,0)):l=this._events[o],"function"===typeof l)switch(this.event=o,d){case 1:u.push(l.call(this));break;case 2:u.push(l.call(this,arguments[1]));break;case 3:u.push(l.call(this,arguments[1],arguments[2]));break;default:for(i=new Array(d-1),s=1;s<d;s++)i[s-1]=arguments[s];u.push(l.apply(this,i))}else if(l&&l.length){if(l=l.slice(),d>3)for(i=new Array(d-1),s=1;s<d;s++)i[s-1]=arguments[s];for(r=0,n=l.length;r<n;r++)switch(this.event=o,d){case 1:u.push(l[r].call(this));break;case 2:u.push(l[r].call(this,arguments[1]));break;case 3:u.push(l[r].call(this,arguments[1],arguments[2]));break;default:u.push(l[r].apply(this,i))}}else if(!this.ignoreErrors&&!this._all&&"error"===o)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(u)},O.prototype.on=function(e,t,i){return this._on(e,t,!1,i)},O.prototype.prependListener=function(e,t,i){return this._on(e,t,!0,i)},O.prototype.onAny=function(e){return this._onAny(e,!1)},O.prototype.prependAny=function(e){return this._onAny(e,!0)},O.prototype.addListener=O.prototype.on,O.prototype._onAny=function(e,t){if("function"!==typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},O.prototype._on=function(e,t,i,n){if("function"===typeof e)return this._onAny(e,t),this;if("function"!==typeof t)throw new Error("on only accepts instances of Function");this._events||f.call(this);var s,o=this;return n!==r&&(s=D.call(this,e,t,n),t=s[0],o=s[1]),this._newListener&&this.emit("newListener",e,t),this.wildcard?(A.call(this,e,t,i),o):(this._events[e]?("function"===typeof this._events[e]&&(this._events[e]=[this._events[e]]),i?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,g.call(this,this._events[e].length,e))):this._events[e]=t,o)},O.prototype.off=function(e,t){if("function"!==typeof t)throw new Error("removeListener only takes instances of Function");var i,n=[];if(this.wildcard){var r="string"===typeof e?e.split(this.delimiter):e.slice();if(n=_.call(this,null,r,this.listenerTree,0),!n)return this}else{if(!this._events[e])return this;i=this._events[e],n.push({_listeners:i})}for(var s=0;s<n.length;s++){var a=n[s];if(i=a._listeners,o(i)){for(var l=-1,c=0,u=i.length;c<u;c++)if(i[c]===t||i[c].listener&&i[c].listener===t||i[c]._origin&&i[c]._origin===t){l=c;break}if(l<0)continue;return this.wildcard?a._listeners.splice(l,1):this._events[e].splice(l,1),0===i.length&&(this.wildcard?delete a._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(i===t||i.listener&&i.listener===t||i._origin&&i._origin===t)&&(this.wildcard?delete a._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&R(this.listenerTree),this},O.prototype.offAny=function(e){var t,i=0,n=0;if(e&&this._all&&this._all.length>0){for(t=this._all,i=0,n=t.length;i<n;i++)if(e===t[i])return t.splice(i,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(i=0,n=t.length;i<n;i++)this.emit("removeListenerAny",t[i]);this._all=[]}return this},O.prototype.removeListener=O.prototype.off,O.prototype.removeAllListeners=function(e){if(e===r)return!this._events||f.call(this),this;if(this.wildcard){var t,i,n=_.call(this,null,e,this.listenerTree,0);if(!n)return this;for(i=0;i<n.length;i++)t=n[i],t._listeners=null;this.listenerTree&&R(this.listenerTree)}else this._events&&(this._events[e]=null);return this},O.prototype.listeners=function(e){var t,i,n,s,o,a=this._events;if(e===r){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!a)return[];t=p(a),s=t.length,n=[];while(s-- >0)i=a[t[s]],"function"===typeof i?n.push(i):n.push.apply(n,i);return n}if(this.wildcard){if(o=this.listenerTree,!o)return[];var l=[],c="string"===typeof e?e.split(this.delimiter):e.slice();return _.call(this,l,c,o,0),l}return a?(i=a[e],i?"function"===typeof i?[i]:i:[]):[]},O.prototype.eventNames=function(e){var t=this._events;return this.wildcard?I.call(this,this.listenerTree,[],null,e):t?p(t):[]},O.prototype.listenerCount=function(e){return this.listeners(e).length},O.prototype.hasListeners=function(e){if(this.wildcard){var t=[],i="string"===typeof e?e.split(this.delimiter):e.slice();return _.call(this,t,i,this.listenerTree,0),t.length>0}var n=this._events,s=this._all;return!!(s&&s.length||n&&(e===r?p(n).length:n[e]))},O.prototype.listenersAny=function(){return this._all?this._all:[]},O.prototype.waitFor=function(e,t){var i=this,n=typeof t;return"number"===n?t={timeout:t}:"function"===n&&(t={filter:t}),t=k(t,{timeout:0,filter:r,handleError:!1,Promise:Promise,overload:!1},{filter:w,Promise:T}),P(t.Promise,(function(n,r,s){function o(){var s=t.filter;if(!s||s.apply(i,arguments))if(i.off(e,o),t.handleError){var a=arguments[0];a?r(a):n(m.apply(null,arguments).slice(1))}else n(m.apply(null,arguments))}s((function(){i.off(e,o)})),i._on(e,o,!1)}),{timeout:t.timeout,overload:t.overload})};var x=O.prototype;Object.defineProperties(O,{defaultMaxListeners:{get:function(){return x._maxListeners},set:function(e){if("number"!==typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");x._maxListeners=e},enumerable:!0},once:{value:M,writable:!0,configurable:!0}}),Object.defineProperties(x,{_maxListeners:{value:a,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),n=function(){return O}.call(t,i,t,e),n===r||(e.exports=n)}()},1029:function(e,t,i){e=i.nmd(e),i(4114),i(6573),i(8100),i(7936),i(8992),i(3949),i(1454);var n=200,r="__lodash_hash_undefined__",s=1,o=2,a=9007199254740991,l="[object Arguments]",c="[object Array]",u="[object AsyncFunction]",d="[object Boolean]",h="[object Date]",p="[object Error]",f="[object Function]",v="[object GeneratorFunction]",g="[object Map]",m="[object Number]",y="[object Null]",b="[object Object]",k="[object Promise]",T="[object Proxy]",S="[object RegExp]",w="[object Set]",E="[object String]",P="[object Symbol]",C="[object Undefined]",_="[object WeakMap]",A="[object ArrayBuffer]",I="[object DataView]",R="[object Float32Array]",L="[object Float64Array]",D="[object Int8Array]",O="[object Int16Array]",M="[object Int32Array]",x="[object Uint8Array]",N="[object Uint8ClampedArray]",U="[object Uint16Array]",F="[object Uint32Array]",j=/[\\^$.*+?()[\]{}|]/g,B=/^\[object .+?Constructor\]$/,G=/^(?:0|[1-9]\d*)$/,$={};$[R]=$[L]=$[D]=$[O]=$[M]=$[x]=$[N]=$[U]=$[F]=!0,$[l]=$[c]=$[A]=$[d]=$[I]=$[h]=$[p]=$[f]=$[g]=$[m]=$[b]=$[S]=$[w]=$[E]=$[_]=!1;var V="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,W="object"==typeof self&&self&&self.Object===Object&&self,H=V||W||Function("return this")(),q=t&&!t.nodeType&&t,z=q&&e&&!e.nodeType&&e,K=z&&z.exports===q,J=K&&V.process,Q=function(){try{return J&&J.binding&&J.binding("util")}catch(e){}}(),Y=Q&&Q.isTypedArray;function Z(e,t){var i=-1,n=null==e?0:e.length,r=0,s=[];while(++i<n){var o=e[i];t(o,i,e)&&(s[r++]=o)}return s}function X(e,t){var i=-1,n=t.length,r=e.length;while(++i<n)e[r+i]=t[i];return e}function ee(e,t){var i=-1,n=null==e?0:e.length;while(++i<n)if(t(e[i],i,e))return!0;return!1}function te(e,t){var i=-1,n=Array(e);while(++i<e)n[i]=t(i);return n}function ie(e){return function(t){return e(t)}}function ne(e,t){return e.has(t)}function re(e,t){return null==e?void 0:e[t]}function se(e){var t=-1,i=Array(e.size);return e.forEach((function(e,n){i[++t]=[n,e]})),i}function oe(e,t){return function(i){return e(t(i))}}function ae(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}var le=Array.prototype,ce=Function.prototype,ue=Object.prototype,de=H["__core-js_shared__"],he=ce.toString,pe=ue.hasOwnProperty,fe=function(){var e=/[^.]+$/.exec(de&&de.keys&&de.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ve=ue.toString,ge=RegExp("^"+he.call(pe).replace(j,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),me=K?H.Buffer:void 0,ye=H.Symbol,be=H.Uint8Array,ke=ue.propertyIsEnumerable,Te=le.splice,Se=ye?ye.toStringTag:void 0,we=Object.getOwnPropertySymbols,Ee=me?me.isBuffer:void 0,Pe=oe(Object.keys,Object),Ce=_t(H,"DataView"),_e=_t(H,"Map"),Ae=_t(H,"Promise"),Ie=_t(H,"Set"),Re=_t(H,"WeakMap"),Le=_t(Object,"create"),De=Nt(Ce),Oe=Nt(_e),Me=Nt(Ae),xe=Nt(Ie),Ne=Nt(Re),Ue=ye?ye.prototype:void 0,Fe=Ue?Ue.valueOf:void 0;function je(e){var t=-1,i=null==e?0:e.length;this.clear();while(++t<i){var n=e[t];this.set(n[0],n[1])}}function Be(){this.__data__=Le?Le(null):{},this.size=0}function Ge(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function $e(e){var t=this.__data__;if(Le){var i=t[e];return i===r?void 0:i}return pe.call(t,e)?t[e]:void 0}function Ve(e){var t=this.__data__;return Le?void 0!==t[e]:pe.call(t,e)}function We(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Le&&void 0===t?r:t,this}function He(e){var t=-1,i=null==e?0:e.length;this.clear();while(++t<i){var n=e[t];this.set(n[0],n[1])}}function qe(){this.__data__=[],this.size=0}function ze(e){var t=this.__data__,i=pt(t,e);if(i<0)return!1;var n=t.length-1;return i==n?t.pop():Te.call(t,i,1),--this.size,!0}function Ke(e){var t=this.__data__,i=pt(t,e);return i<0?void 0:t[i][1]}function Je(e){return pt(this.__data__,e)>-1}function Qe(e,t){var i=this.__data__,n=pt(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this}function Ye(e){var t=-1,i=null==e?0:e.length;this.clear();while(++t<i){var n=e[t];this.set(n[0],n[1])}}function Ze(){this.size=0,this.__data__={hash:new je,map:new(_e||He),string:new je}}function Xe(e){var t=Ct(this,e)["delete"](e);return this.size-=t?1:0,t}function et(e){return Ct(this,e).get(e)}function tt(e){return Ct(this,e).has(e)}function it(e,t){var i=Ct(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this}function nt(e){var t=-1,i=null==e?0:e.length;this.__data__=new Ye;while(++t<i)this.add(e[t])}function rt(e){return this.__data__.set(e,r),this}function st(e){return this.__data__.has(e)}function ot(e){var t=this.__data__=new He(e);this.size=t.size}function at(){this.__data__=new He,this.size=0}function lt(e){var t=this.__data__,i=t["delete"](e);return this.size=t.size,i}function ct(e){return this.__data__.get(e)}function ut(e){return this.__data__.has(e)}function dt(e,t){var i=this.__data__;if(i instanceof He){var r=i.__data__;if(!_e||r.length<n-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new Ye(r)}return i.set(e,t),this.size=i.size,this}function ht(e,t){var i=jt(e),n=!i&&Ft(e),r=!i&&!n&&Gt(e),s=!i&&!n&&!r&&zt(e),o=i||n||r||s,a=o?te(e.length,String):[],l=a.length;for(var c in e)!t&&!pe.call(e,c)||o&&("length"==c||r&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Lt(c,l))||a.push(c);return a}function pt(e,t){var i=e.length;while(i--)if(Ut(e[i][0],t))return i;return-1}function ft(e,t,i){var n=t(e);return jt(e)?n:X(n,i(e))}function vt(e){return null==e?void 0===e?C:y:Se&&Se in Object(e)?At(e):xt(e)}function gt(e){return qt(e)&&vt(e)==l}function mt(e,t,i,n,r){return e===t||(null==e||null==t||!qt(e)&&!qt(t)?e!==e&&t!==t:yt(e,t,i,n,mt,r))}function yt(e,t,i,n,r,o){var a=jt(e),u=jt(t),d=a?c:Rt(e),h=u?c:Rt(t);d=d==l?b:d,h=h==l?b:h;var p=d==b,f=h==b,v=d==h;if(v&&Gt(e)){if(!Gt(t))return!1;a=!0,p=!1}if(v&&!p)return o||(o=new ot),a||zt(e)?St(e,t,i,n,r,o):wt(e,t,d,i,n,r,o);if(!(i&s)){var g=p&&pe.call(e,"__wrapped__"),m=f&&pe.call(t,"__wrapped__");if(g||m){var y=g?e.value():e,k=m?t.value():t;return o||(o=new ot),r(y,k,i,n,o)}}return!!v&&(o||(o=new ot),Et(e,t,i,n,r,o))}function bt(e){if(!Ht(e)||Ot(e))return!1;var t=Vt(e)?ge:B;return t.test(Nt(e))}function kt(e){return qt(e)&&Wt(e.length)&&!!$[vt(e)]}function Tt(e){if(!Mt(e))return Pe(e);var t=[];for(var i in Object(e))pe.call(e,i)&&"constructor"!=i&&t.push(i);return t}function St(e,t,i,n,r,a){var l=i&s,c=e.length,u=t.length;if(c!=u&&!(l&&u>c))return!1;var d=a.get(e);if(d&&a.get(t))return d==t;var h=-1,p=!0,f=i&o?new nt:void 0;a.set(e,t),a.set(t,e);while(++h<c){var v=e[h],g=t[h];if(n)var m=l?n(g,v,h,t,e,a):n(v,g,h,e,t,a);if(void 0!==m){if(m)continue;p=!1;break}if(f){if(!ee(t,(function(e,t){if(!ne(f,t)&&(v===e||r(v,e,i,n,a)))return f.push(t)}))){p=!1;break}}else if(v!==g&&!r(v,g,i,n,a)){p=!1;break}}return a["delete"](e),a["delete"](t),p}function wt(e,t,i,n,r,a,l){switch(i){case I:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case A:return!(e.byteLength!=t.byteLength||!a(new be(e),new be(t)));case d:case h:case m:return Ut(+e,+t);case p:return e.name==t.name&&e.message==t.message;case S:case E:return e==t+"";case g:var c=se;case w:var u=n&s;if(c||(c=ae),e.size!=t.size&&!u)return!1;var f=l.get(e);if(f)return f==t;n|=o,l.set(e,t);var v=St(c(e),c(t),n,r,a,l);return l["delete"](e),v;case P:if(Fe)return Fe.call(e)==Fe.call(t)}return!1}function Et(e,t,i,n,r,o){var a=i&s,l=Pt(e),c=l.length,u=Pt(t),d=u.length;if(c!=d&&!a)return!1;var h=c;while(h--){var p=l[h];if(!(a?p in t:pe.call(t,p)))return!1}var f=o.get(e);if(f&&o.get(t))return f==t;var v=!0;o.set(e,t),o.set(t,e);var g=a;while(++h<c){p=l[h];var m=e[p],y=t[p];if(n)var b=a?n(y,m,p,t,e,o):n(m,y,p,e,t,o);if(!(void 0===b?m===y||r(m,y,i,n,o):b)){v=!1;break}g||(g="constructor"==p)}if(v&&!g){var k=e.constructor,T=t.constructor;k==T||!("constructor"in e)||!("constructor"in t)||"function"==typeof k&&k instanceof k&&"function"==typeof T&&T instanceof T||(v=!1)}return o["delete"](e),o["delete"](t),v}function Pt(e){return ft(e,Kt,It)}function Ct(e,t){var i=e.__data__;return Dt(t)?i["string"==typeof t?"string":"hash"]:i.map}function _t(e,t){var i=re(e,t);return bt(i)?i:void 0}function At(e){var t=pe.call(e,Se),i=e[Se];try{e[Se]=void 0;var n=!0}catch(s){}var r=ve.call(e);return n&&(t?e[Se]=i:delete e[Se]),r}je.prototype.clear=Be,je.prototype["delete"]=Ge,je.prototype.get=$e,je.prototype.has=Ve,je.prototype.set=We,He.prototype.clear=qe,He.prototype["delete"]=ze,He.prototype.get=Ke,He.prototype.has=Je,He.prototype.set=Qe,Ye.prototype.clear=Ze,Ye.prototype["delete"]=Xe,Ye.prototype.get=et,Ye.prototype.has=tt,Ye.prototype.set=it,nt.prototype.add=nt.prototype.push=rt,nt.prototype.has=st,ot.prototype.clear=at,ot.prototype["delete"]=lt,ot.prototype.get=ct,ot.prototype.has=ut,ot.prototype.set=dt;var It=we?function(e){return null==e?[]:(e=Object(e),Z(we(e),(function(t){return ke.call(e,t)})))}:Jt,Rt=vt;function Lt(e,t){return t=null==t?a:t,!!t&&("number"==typeof e||G.test(e))&&e>-1&&e%1==0&&e<t}function Dt(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function Ot(e){return!!fe&&fe in e}function Mt(e){var t=e&&e.constructor,i="function"==typeof t&&t.prototype||ue;return e===i}function xt(e){return ve.call(e)}function Nt(e){if(null!=e){try{return he.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Ut(e,t){return e===t||e!==e&&t!==t}(Ce&&Rt(new Ce(new ArrayBuffer(1)))!=I||_e&&Rt(new _e)!=g||Ae&&Rt(Ae.resolve())!=k||Ie&&Rt(new Ie)!=w||Re&&Rt(new Re)!=_)&&(Rt=function(e){var t=vt(e),i=t==b?e.constructor:void 0,n=i?Nt(i):"";if(n)switch(n){case De:return I;case Oe:return g;case Me:return k;case xe:return w;case Ne:return _}return t});var Ft=gt(function(){return arguments}())?gt:function(e){return qt(e)&&pe.call(e,"callee")&&!ke.call(e,"callee")},jt=Array.isArray;function Bt(e){return null!=e&&Wt(e.length)&&!Vt(e)}var Gt=Ee||Qt;function $t(e,t){return mt(e,t)}function Vt(e){if(!Ht(e))return!1;var t=vt(e);return t==f||t==v||t==u||t==T}function Wt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=a}function Ht(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function qt(e){return null!=e&&"object"==typeof e}var zt=Y?ie(Y):kt;function Kt(e){return Bt(e)?ht(e):Tt(e)}function Jt(){return[]}function Qt(){return!1}e.exports=$t},1675:function(e,t,i){i(8992),i(3949);var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach((function(e){var t=n[e];t.forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},1186:function(e,t,i){var n=i(2411),r=i(7259),s=i(1675);t.M9=r,t.qg=n.parse,n.parseParams,n.parseFmtpConfig,n.parsePayloads,n.parseRemoteCandidates,n.parseImageAttributes,n.parseSimulcastStreamList},2411:function(e,t,i){i(4114),i(8992),i(4520),i(3949),i(1454),i(8872);var n=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,i,r){if(r&&!i)t[r]=n(e[1]);else for(var s=0;s<i.length;s+=1)null!=e[s+1]&&(t[i[s]]=n(e[s+1]))},s=function(e,t,i){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:n?t[e.name]:t;r(i.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},o=i(1675),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},i=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),n=i[i.length-1]);for(var a=0;a<(o[t]||[]).length;a+=1){var l=o[t][a];if(l.reg.test(r))return s(l,n,r)}})),t.media=i,t};var l=function(e,t){var i=t.split(/=(.+)/,2);return 2===i.length?e[i[0]]=n(i[1]):1===i.length&&t.length>1&&(e[i[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(l,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],i=e.split(" ").map(n),r=0;r<i.length;r+=3)t.push({component:i[r],ip:i[r+1],port:i[r+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(l,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,i=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),i=!0),{scid:t,paused:i}}))}))}},7259:function(e,t,i){i(4114),i(8992),i(3949);var n=i(1675),r=/%[sdv%]/g,s=function(e){var t=1,i=arguments,n=i.length;return e.replace(r,(function(e){if(t>=n)return e;var r=i[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}}))},o=function(e,t,i){var n=t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format,r=[e+"="+n];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?r.push(i[t.name][a]):r.push(i[t.names[o]])}else r.push(i[t.name]);return s.apply(null,r)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var i=t.outerOrder||a,r=t.innerOrder||l,s=[];return i.forEach((function(t){n[t].forEach((function(i){i.name in e&&null!=e[i.name]?s.push(o(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach((function(e){s.push(o(t,i,e))}))}))})),e.media.forEach((function(e){s.push(o("m",n.m[0],e)),r.forEach((function(t){n[t].forEach((function(i){i.name in e&&null!=e[i.name]?s.push(o(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach((function(e){s.push(o(t,i,e))}))}))}))})),s.join("\r\n")+"\r\n"}},3298:function(e,t,i){"use strict";i(4114),i(8992),i(4520),i(2577),i(3949),i(1454);const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},n.splitSections=function(e){const t=e.split("\nm=");return t.map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},n.getDescription=function(e){const t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){const t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter((e=>0===e.indexOf(t)))},n.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const i={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let n=8;n<t.length;n+=2)switch(t[n]){case"raddr":i.relatedAddress=t[n+1];break;case"rport":i.relatedPort=parseInt(t[n+1],10);break;case"tcptype":i.tcpType=t[n+1];break;case"ufrag":i.ufrag=t[n+1],i.usernameFragment=t[n+1];break;default:void 0===i[t[n]]&&(i[t[n]]=t[n+1]);break}return i},n.writeCandidate=function(e){const t=[];t.push(e.foundation);const i=e.component;"rtp"===i?t.push(1):"rtcp"===i?t.push(2):t.push(i),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substring(14).split(" ")},n.parseRtpMap=function(e){let t=e.substring(9).split(" ");const i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},n.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},n.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},n.parseFmtp=function(e){const t={};let i;const n=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<n.length;r++)i=n[r].trim().split("="),t[i[0].trim()]=i[1];return t},n.writeFmtp=function(e){let t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){let t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},n.parseSsrcMedia=function(e){const t=e.indexOf(" "),i={ssrc:parseInt(e.substring(7,t),10)},n=e.indexOf(":",t);return n>-1?(i.attribute=e.substring(t+1,n),i.value=e.substring(n+1)):i.attribute=e.substring(t+1),i},n.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},n.getMid=function(e){const t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substring(6)},n.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},n.getDtlsParameters=function(e,t){const i=n.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:i.map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){let i="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),i},n.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},n.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?n.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},n.getCryptoParameters=function(e,t){const i=n.matchPrefix(e+t,"a=crypto:");return i.map(n.parseCryptoLine)},n.getIceParameters=function(e,t){const i=n.matchPrefix(e+t,"a=ice-ufrag:")[0],r=n.matchPrefix(e+t,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},n.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},n.parseRtpParameters=function(e){const t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=n.splitLines(e),r=i[0].split(" ");t.profile=r[2];for(let o=3;o<r.length;o++){const i=r[o],s=n.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){const r=n.parseRtpMap(s),o=n.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=o.length?n.parseFmtp(o[0]):{},r.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(n.parseRtcpFb),t.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(r.name.toUpperCase());break;default:break}}}n.matchPrefix(e,"a=extmap:").forEach((e=>{t.headerExtensions.push(n.parseExtmap(e))}));const s=n.matchPrefix(e,"a=rtcp-fb:* ").map(n.parseRtcpFb);return t.codecs.forEach((e=>{s.forEach((t=>{const i=e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter));i||e.rtcpFeedback.push(t)}))})),t},n.writeRtpDescription=function(e,t){let i="";i+="m="+e+" ",i+=t.codecs.length>0?"9":"0",i+=" "+(t.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=t.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((e=>{i+=n.writeRtpMap(e),i+=n.writeFmtp(e),i+=n.writeRtcpFb(e)}));let r=0;return t.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach((e=>{i+=n.writeExtmap(e)})),i},n.parseRtpEncodingParameters=function(e){const t=[],i=n.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=n.matchPrefix(e,"a=ssrc:").map((e=>n.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=o.length>0&&o[0].ssrc;let l;const c=n.matchPrefix(e,"a=ssrc-group:FID").map((e=>{const t=e.substring(17).split(" ");return t.map((e=>parseInt(e,10)))}));c.length>0&&c[0].length>1&&c[0][0]===a&&(l=c[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let i={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&l&&(i.rtx={ssrc:l}),t.push(i),r&&(i=JSON.parse(JSON.stringify(i)),i.fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},t.push(i))}})),0===t.length&&a&&t.push({ssrc:a});let u=n.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,t.forEach((e=>{e.maxBitrate=u}))),t},n.parseRtcpParameters=function(e){const t={},i=n.matchPrefix(e,"a=ssrc:").map((e=>n.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(t.cname=i.value,t.ssrc=i.ssrc);const r=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=0===r.length;const s=n.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},n.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},n.parseMsid=function(e){let t;const i=n.matchPrefix(e,"a=msid:");if(1===i.length)return t=i[0].substring(7).split(" "),{stream:t[0],track:t[1]};const r=n.matchPrefix(e,"a=ssrc:").map((e=>n.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(t=r[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},n.parseSctpDescription=function(e){const t=n.parseMLine(e),i=n.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const s=n.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:t.fmt,maxMessageSize:r};const o=n.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},n.writeSctpDescription=function(e,t){let i=[];return i="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(e,t,i){let r;const s=void 0!==t?t:2;r=e||n.generateSessionId();const o=i||"thisisadapterortc";return"v=0\r\no="+o+" "+r+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.getDirection=function(e,t){const i=n.splitLines(e);for(let n=0;n<i.length;n++)switch(i[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[n].substring(2);default:}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){const t=n.splitLines(e),i=t[0].split(" ");return i[0].substring(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){const t=n.splitLines(e),i=t[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},n.parseOLine=function(e){const t=n.matchPrefix(e,"o=")[0],i=t.substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},n.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;const t=n.splitLines(e);for(let i=0;i<t.length;i++)if(t[i].length<2||"="!==t[i].charAt(1))return!1;return!0},e.exports=n},5135:function(e,t,i){var n;(function(r,s){"use strict";var o="1.0.40",a="",l="?",c="function",u="undefined",d="object",h="string",p="major",f="model",v="name",g="type",m="vendor",y="version",b="architecture",k="console",T="mobile",S="tablet",w="smarttv",E="wearable",P="embedded",C=500,_="Amazon",A="Apple",I="ASUS",R="BlackBerry",L="Browser",D="Chrome",O="Edge",M="Firefox",x="Google",N="Huawei",U="LG",F="Microsoft",j="Motorola",B="Opera",G="Samsung",$="Sharp",V="Sony",W="Xiaomi",H="Zebra",q="Facebook",z="Chromium OS",K="Mac OS",J=" Browser",Q=function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2===0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i},Y=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},Z=function(e,t){return typeof e===h&&-1!==X(t).indexOf(X(e))},X=function(e){return e.toLowerCase()},ee=function(e){return typeof e===h?e.replace(/[^\d\.]/g,a).split(".")[0]:s},te=function(e,t){if(typeof e===h)return e=e.replace(/^\s\s*/,a),typeof t===u?e:e.substring(0,C)},ie=function(e,t){var i,n,r,o,a,l,u=0;while(u<t.length&&!a){var h=t[u],p=t[u+1];i=n=0;while(i<h.length&&!a){if(!h[i])break;if(a=h[i++].exec(e),a)for(r=0;r<p.length;r++)l=a[++n],o=p[r],typeof o===d&&o.length>0?2===o.length?typeof o[1]==c?this[o[0]]=o[1].call(this,l):this[o[0]]=o[1]:3===o.length?typeof o[1]!==c||o[1].exec&&o[1].test?this[o[0]]=l?l.replace(o[1],o[2]):s:this[o[0]]=l?o[1].call(this,l,o[2]):s:4===o.length&&(this[o[0]]=l?o[3].call(this,l.replace(o[1],o[2])):s):this[o]=l||s}u+=2}},ne=function(e,t){for(var i in t)if(typeof t[i]===d&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(Z(t[i][n],e))return i===l?s:i}else if(Z(t[i],e))return i===l?s:i;return t.hasOwnProperty("*")?t["*"]:e},re={"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},se={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},oe={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,y],[/opios[\/ ]+([\w\.]+)/i],[y,[v,B+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[v,B+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[v,B]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[v,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[y,[v,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[v,y],[/quark(?:pc)?\/([-\w\.]+)/i],[y,[v,"Quark"]],[/\bddg\/([\w\.]+)/i],[y,[v,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[v,"UC"+L]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[v,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[v,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[v,"Smart Lenovo "+L]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+L],y],[/\bfocus\/([\w\.]+)/i],[y,[v,M+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[v,B+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[v,B+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[v,"MIUI"+J]],[/fxios\/([\w\.-]+)/i],[y,[v,M]],[/\bqihoobrowser\/?([\w\.]*)/i],[y,[v,"360"]],[/\b(qq)\/([\w\.]+)/i],[[v,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1"+J],y],[/samsungbrowser\/([\w\.]+)/i],[y,[v,G+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[y,[v,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[v,"Sogou Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[v,y],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[v],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[y,v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,q],y],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[v,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[v,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[v,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[v,D+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,D+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[v,"Android "+L]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[y,ne,re]],[/(webkit|khtml)\/([\w\.]+)/i],[v,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],y],[/(wolvic|librewolf)\/([\w\.]+)/i],[v,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[v,M+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[v,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[v,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[b,"amd64"]],[/(ia32(?=;))/i],[[b,X]],[/((?:i[346]|x)86)[;\)]/i],[[b,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[b,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[b,"armhf"]],[/windows (ce|mobile); ppc;/i],[[b,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[b,/ower/,a,X]],[/(sun4\w)[;\)]/i],[[b,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[b,X]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[m,G],[g,S]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[f,[m,G],[g,T]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[f,[m,A],[g,T]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[m,A],[g,S]],[/(macintosh);/i],[f,[m,A]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[m,$],[g,T]],[/(?:honor)([-\w ]+)[;\)]/i],[f,[m,"Honor"],[g,T]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[m,N],[g,S]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[m,N],[g,T]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[f,/_/g," "],[m,W],[g,T]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[m,W],[g,S]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[m,"OPPO"],[g,T]],[/\b(opd2\d{3}a?) bui/i],[f,[m,"OPPO"],[g,S]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[m,"Vivo"],[g,T]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[f,[m,"Realme"],[g,T]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[m,j],[g,T]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[m,j],[g,S]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[m,U],[g,S]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[m,U],[g,T]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[m,"Lenovo"],[g,S]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[m,"Nokia"],[g,T]],[/(pixel c)\b/i],[f,[m,x],[g,S]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[m,x],[g,T]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[m,V],[g,T]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[m,V],[g,S]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[m,"OnePlus"],[g,T]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[m,_],[g,S]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[m,_],[g,T]],[/(playbook);[-\w\),; ]+(rim)/i],[f,m,[g,S]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[m,R],[g,T]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[m,I],[g,S]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[m,I],[g,T]],[/(nexus 9)/i],[f,[m,"HTC"],[g,S]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[f,/_/g," "],[g,T]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[f,[m,"TCL"],[g,S]],[/(itel) ((\w+))/i],[[m,X],f,[g,ne,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[m,"Acer"],[g,S]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[m,"Meizu"],[g,T]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[f,[m,"Ulefone"],[g,T]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[f,[m,"Energizer"],[g,T]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[f,[m,"Cat"],[g,T]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[f,[m,"Smartfren"],[g,T]],[/droid.+; (a(?:015|06[35]|142p?))/i],[f,[m,"Nothing"],[g,T]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,f,[g,T]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,f,[g,S]],[/(surface duo)/i],[f,[m,F],[g,S]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[m,"Fairphone"],[g,T]],[/(u304aa)/i],[f,[m,"AT&T"],[g,T]],[/\bsie-(\w*)/i],[f,[m,"Siemens"],[g,T]],[/\b(rct\w+) b/i],[f,[m,"RCA"],[g,S]],[/\b(venue[\d ]{2,7}) b/i],[f,[m,"Dell"],[g,S]],[/\b(q(?:mv|ta)\w+) b/i],[f,[m,"Verizon"],[g,S]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[m,"Barnes & Noble"],[g,S]],[/\b(tm\d{3}\w+) b/i],[f,[m,"NuVision"],[g,S]],[/\b(k88) b/i],[f,[m,"ZTE"],[g,S]],[/\b(nx\d{3}j) b/i],[f,[m,"ZTE"],[g,T]],[/\b(gen\d{3}) b.+49h/i],[f,[m,"Swiss"],[g,T]],[/\b(zur\d{3}) b/i],[f,[m,"Swiss"],[g,S]],[/\b((zeki)?tb.*\b) b/i],[f,[m,"Zeki"],[g,S]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],f,[g,S]],[/\b(ns-?\w{0,9}) b/i],[f,[m,"Insignia"],[g,S]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[m,"NextBook"],[g,S]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],f,[g,T]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],f,[g,T]],[/\b(ph-1) /i],[f,[m,"Essential"],[g,T]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[m,"Envizen"],[g,S]],[/\b(trio[-\w\. ]+) b/i],[f,[m,"MachSpeed"],[g,S]],[/\btu_(1491) b/i],[f,[m,"Rotor"],[g,S]],[/(shield[\w ]+) b/i],[f,[m,"Nvidia"],[g,S]],[/(sprint) (\w+)/i],[m,f,[g,T]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[m,F],[g,T]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[m,H],[g,S]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[m,H],[g,T]],[/smart-tv.+(samsung)/i],[m,[g,w]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[m,G],[g,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,U],[g,w]],[/(apple) ?tv/i],[m,[f,A+" TV"],[g,w]],[/crkey/i],[[f,D+"cast"],[m,x],[g,w]],[/droid.+aft(\w+)( bui|\))/i],[f,[m,_],[g,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[m,$],[g,w]],[/(bravia[\w ]+)( bui|\))/i],[f,[m,V],[g,w]],[/(mitv-\w{5}) bui/i],[f,[m,W],[g,w]],[/Hbbtv.*(technisat) (.*);/i],[m,f,[g,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,te],[f,te],[g,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,f,[g,k]],[/droid.+; (shield) bui/i],[f,[m,"Nvidia"],[g,k]],[/(playstation [345portablevi]+)/i],[f,[m,V],[g,k]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[m,F],[g,k]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[f,[m,G],[g,E]],[/((pebble))app/i],[m,f,[g,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[m,A],[g,E]],[/droid.+; (glass) \d/i],[f,[m,x],[g,E]],[/droid.+; (wt63?0{2,3})\)/i],[f,[m,H],[g,E]],[/droid.+; (glass) \d/i],[f,[m,x],[g,E]],[/(pico) (4|neo3(?: link|pro)?)/i],[m,f,[g,E]],[/; (quest( \d| pro)?)/i],[f,[m,q],[g,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[g,P]],[/(aeobc)\b/i],[f,[m,_],[g,P]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[f,[g,T]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[g,S]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,S]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,T]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[v,O+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[v,y],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[v,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,y],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[v,[y,ne,se]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,ne,se],[v,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,K],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,y],[/\(bb(10);/i],[y,[v,R]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[v,M+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[v,D+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,z],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,y],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[v,y]]},ae=function(e,t){if(typeof e===d&&(t=e,e=s),!(this instanceof ae))return new ae(e,t).getResult();var i=typeof r!==u&&r.navigator?r.navigator:s,n=e||(i&&i.userAgent?i.userAgent:a),o=i&&i.userAgentData?i.userAgentData:s,l=t?Q(oe,t):oe,k=i&&i.userAgent==n;return this.getBrowser=function(){var e={};return e[v]=s,e[y]=s,ie.call(e,n,l.browser),e[p]=ee(e[y]),k&&i&&i.brave&&typeof i.brave.isBrave==c&&(e[v]="Brave"),e},this.getCPU=function(){var e={};return e[b]=s,ie.call(e,n,l.cpu),e},this.getDevice=function(){var e={};return e[m]=s,e[f]=s,e[g]=s,ie.call(e,n,l.device),k&&!e[g]&&o&&o.mobile&&(e[g]=T),k&&"Macintosh"==e[f]&&i&&typeof i.standalone!==u&&i.maxTouchPoints&&i.maxTouchPoints>2&&(e[f]="iPad",e[g]=S),e},this.getEngine=function(){var e={};return e[v]=s,e[y]=s,ie.call(e,n,l.engine),e},this.getOS=function(){var e={};return e[v]=s,e[y]=s,ie.call(e,n,l.os),k&&!e[v]&&o&&o.platform&&"Unknown"!=o.platform&&(e[v]=o.platform.replace(/chrome os/i,z).replace(/macos/i,K)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=typeof e===h&&e.length>C?te(e,C):e,this},this.setUA(n),this};ae.VERSION=o,ae.BROWSER=Y([v,y,p]),ae.CPU=Y([b]),ae.DEVICE=Y([f,m,g,k,T,w,S,E,P]),ae.ENGINE=ae.OS=Y([v,y]),typeof t!==u?("object"!==u&&e.exports&&(t=e.exports=ae),t.UAParser=ae):"function"===c&&i.amdO?(n=function(){return ae}.call(t,i,t,e),n===s||(e.exports=n)):typeof r!==u&&(r.UAParser=ae);var le=typeof r!==u&&(r.jQuery||r.Zepto);if(le&&!le.ua){var ce=new ae;le.ua=ce.getResult(),le.ua.get=function(){return ce.getUA()},le.ua.set=function(e){ce.setUA(e);var t=ce.getResult();for(var i in t)le.ua[i]=t[i]}}})("object"===typeof window?window:this)},1241:function(e,t){"use strict";t.A=(e,t)=>{const i=e.__vccOpts||e;for(const[n,r]of t)i[n]=r;return i}},782:function(e,t,i){"use strict";i.d(t,{y$:function(){return ee}});i(4114),i(8992),i(4520),i(3949),i(1454),i(8872);var n=i(6768),r=i(144);function s(){return o().__VUE_DEVTOOLS_GLOBAL_HOOK__}function o(){return"undefined"!==typeof navigator&&"undefined"!==typeof window?window:"undefined"!==typeof globalThis?globalThis:{}}const a="function"===typeof Proxy,l="devtools-plugin:setup",c="plugin:settings:set";let u,d;function h(){var e;return void 0!==u||("undefined"!==typeof window&&window.performance?(u=!0,d=window.performance):"undefined"!==typeof globalThis&&(null===(e=globalThis.perf_hooks)||void 0===e?void 0:e.performance)?(u=!0,d=globalThis.perf_hooks.performance):u=!1),u}function p(){return h()?d.now():Date.now()}class f{constructor(e,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=t;const i={};if(e.settings)for(const o in e.settings){const t=e.settings[o];i[o]=t.defaultValue}const n=`__vue-devtools-plugin-settings__${e.id}`;let r=Object.assign({},i);try{const e=localStorage.getItem(n),t=JSON.parse(e);Object.assign(r,t)}catch(s){}this.fallbacks={getSettings(){return r},setSettings(e){try{localStorage.setItem(n,JSON.stringify(e))}catch(s){}r=e},now(){return p()}},t&&t.on(c,((e,t)=>{e===this.plugin.id&&this.fallbacks.setSettings(t)})),this.proxiedOn=new Proxy({},{get:(e,t)=>this.target?this.target.on[t]:(...e)=>{this.onQueue.push({method:t,args:e})}}),this.proxiedTarget=new Proxy({},{get:(e,t)=>this.target?this.target[t]:"on"===t?this.proxiedOn:Object.keys(this.fallbacks).includes(t)?(...e)=>(this.targetQueue.push({method:t,args:e,resolve:()=>{}}),this.fallbacks[t](...e)):(...e)=>new Promise((i=>{this.targetQueue.push({method:t,args:e,resolve:i})}))})}async setRealTarget(e){this.target=e;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const t of this.targetQueue)t.resolve(await this.target[t.method](...t.args))}}function v(e,t){const i=e,n=o(),r=s(),c=a&&i.enableEarlyProxy;if(!r||!n.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__&&c){const e=c?new f(i,r):null,s=n.__VUE_DEVTOOLS_PLUGINS__=n.__VUE_DEVTOOLS_PLUGINS__||[];s.push({pluginDescriptor:i,setupFn:t,proxy:e}),e&&t(e.proxiedTarget)}else r.emit(l,e,t)}
/*!
 * vuex v4.1.0
 * (c) 2022 Evan You
 * @license MIT
 */
var g="store";function m(e,t){Object.keys(e).forEach((function(i){return t(e[i],i)}))}function y(e){return null!==e&&"object"===typeof e}function b(e){return e&&"function"===typeof e.then}function k(e,t){return function(){return e(t)}}function T(e,t,i){return t.indexOf(e)<0&&(i&&i.prepend?t.unshift(e):t.push(e)),function(){var i=t.indexOf(e);i>-1&&t.splice(i,1)}}function S(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var i=e.state;E(e,i,[],e._modules.root,!0),w(e,i,t)}function w(e,t,i){var s=e._state,o=e._scope;e.getters={},e._makeLocalGettersCache=Object.create(null);var a=e._wrappedGetters,l={},c={},u=(0,r.uY)(!0);u.run((function(){m(a,(function(t,i){l[i]=k(t,e),c[i]=(0,n.EW)((function(){return l[i]()})),Object.defineProperty(e.getters,i,{get:function(){return c[i].value},enumerable:!0})}))})),e._state=(0,r.Kh)({data:t}),e._scope=u,e.strict&&R(e),s&&i&&e._withCommit((function(){s.data=null})),o&&o.stop()}function E(e,t,i,n,r){var s=!i.length,o=e._modules.getNamespace(i);if(n.namespaced&&(e._modulesNamespaceMap[o],e._modulesNamespaceMap[o]=n),!s&&!r){var a=L(t,i.slice(0,-1)),l=i[i.length-1];e._withCommit((function(){a[l]=n.state}))}var c=n.context=P(e,o,i);n.forEachMutation((function(t,i){var n=o+i;_(e,n,t,c)})),n.forEachAction((function(t,i){var n=t.root?i:o+i,r=t.handler||t;A(e,n,r,c)})),n.forEachGetter((function(t,i){var n=o+i;I(e,n,t,c)})),n.forEachChild((function(n,s){E(e,t,i.concat(s),n,r)}))}function P(e,t,i){var n=""===t,r={dispatch:n?e.dispatch:function(i,n,r){var s=D(i,n,r),o=s.payload,a=s.options,l=s.type;return a&&a.root||(l=t+l),e.dispatch(l,o)},commit:n?e.commit:function(i,n,r){var s=D(i,n,r),o=s.payload,a=s.options,l=s.type;a&&a.root||(l=t+l),e.commit(l,o,a)}};return Object.defineProperties(r,{getters:{get:n?function(){return e.getters}:function(){return C(e,t)}},state:{get:function(){return L(e.state,i)}}}),r}function C(e,t){if(!e._makeLocalGettersCache[t]){var i={},n=t.length;Object.keys(e.getters).forEach((function(r){if(r.slice(0,n)===t){var s=r.slice(n);Object.defineProperty(i,s,{get:function(){return e.getters[r]},enumerable:!0})}})),e._makeLocalGettersCache[t]=i}return e._makeLocalGettersCache[t]}function _(e,t,i,n){var r=e._mutations[t]||(e._mutations[t]=[]);r.push((function(t){i.call(e,n.state,t)}))}function A(e,t,i,n){var r=e._actions[t]||(e._actions[t]=[]);r.push((function(t){var r=i.call(e,{dispatch:n.dispatch,commit:n.commit,getters:n.getters,state:n.state,rootGetters:e.getters,rootState:e.state},t);return b(r)||(r=Promise.resolve(r)),e._devtoolHook?r.catch((function(t){throw e._devtoolHook.emit("vuex:error",t),t})):r}))}function I(e,t,i,n){e._wrappedGetters[t]||(e._wrappedGetters[t]=function(e){return i(n.state,n.getters,e.state,e.getters)})}function R(e){(0,n.wB)((function(){return e._state.data}),(function(){0}),{deep:!0,flush:"sync"})}function L(e,t){return t.reduce((function(e,t){return e[t]}),e)}function D(e,t,i){return y(e)&&e.type&&(i=t,t=e,e=e.type),{type:e,payload:t,options:i}}var O="vuex bindings",M="vuex:mutations",x="vuex:actions",N="vuex",U=0;function F(e,t){v({id:"org.vuejs.vuex",app:e,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[O]},(function(i){i.addTimelineLayer({id:M,label:"Vuex Mutations",color:j}),i.addTimelineLayer({id:x,label:"Vuex Actions",color:j}),i.addInspector({id:N,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),i.on.getInspectorTree((function(i){if(i.app===e&&i.inspectorId===N)if(i.filter){var n=[];H(n,t._modules.root,i.filter,""),i.rootNodes=n}else i.rootNodes=[W(t._modules.root,"")]})),i.on.getInspectorState((function(i){if(i.app===e&&i.inspectorId===N){var n=i.nodeId;C(t,n),i.state=q(K(t._modules,n),"root"===n?t.getters:t._makeLocalGettersCache,n)}})),i.on.editInspectorState((function(i){if(i.app===e&&i.inspectorId===N){var n=i.nodeId,r=i.path;"root"!==n&&(r=n.split("/").filter(Boolean).concat(r)),t._withCommit((function(){i.set(t._state.data,r,i.state.value)}))}})),t.subscribe((function(e,t){var n={};e.payload&&(n.payload=e.payload),n.state=t,i.notifyComponentUpdate(),i.sendInspectorTree(N),i.sendInspectorState(N),i.addTimelineEvent({layerId:M,event:{time:Date.now(),title:e.type,data:n}})})),t.subscribeAction({before:function(e,t){var n={};e.payload&&(n.payload=e.payload),e._id=U++,e._time=Date.now(),n.state=t,i.addTimelineEvent({layerId:x,event:{time:e._time,title:e.type,groupId:e._id,subtitle:"start",data:n}})},after:function(e,t){var n={},r=Date.now()-e._time;n.duration={_custom:{type:"duration",display:r+"ms",tooltip:"Action duration",value:r}},e.payload&&(n.payload=e.payload),n.state=t,i.addTimelineEvent({layerId:x,event:{time:Date.now(),title:e.type,groupId:e._id,subtitle:"end",data:n}})}})}))}var j=8702998,B=6710886,G=16777215,$={label:"namespaced",textColor:G,backgroundColor:B};function V(e){return e&&"root"!==e?e.split("/").slice(-2,-1)[0]:"Root"}function W(e,t){return{id:t||"root",label:V(t),tags:e.namespaced?[$]:[],children:Object.keys(e._children).map((function(i){return W(e._children[i],t+i+"/")}))}}function H(e,t,i,n){n.includes(i)&&e.push({id:n||"root",label:n.endsWith("/")?n.slice(0,n.length-1):n||"Root",tags:t.namespaced?[$]:[]}),Object.keys(t._children).forEach((function(r){H(e,t._children[r],i,n+r+"/")}))}function q(e,t,i){t="root"===i?t:t[i];var n=Object.keys(t),r={state:Object.keys(e.state).map((function(t){return{key:t,editable:!0,value:e.state[t]}}))};if(n.length){var s=z(t);r.getters=Object.keys(s).map((function(e){return{key:e.endsWith("/")?V(e):e,editable:!1,value:J((function(){return s[e]}))}}))}return r}function z(e){var t={};return Object.keys(e).forEach((function(i){var n=i.split("/");if(n.length>1){var r=t,s=n.pop();n.forEach((function(e){r[e]||(r[e]={_custom:{value:{},display:e,tooltip:"Module",abstract:!0}}),r=r[e]._custom.value})),r[s]=J((function(){return e[i]}))}else t[i]=J((function(){return e[i]}))})),t}function K(e,t){var i=t.split("/").filter((function(e){return e}));return i.reduce((function(e,n,r){var s=e[n];if(!s)throw new Error('Missing module "'+n+'" for path "'+t+'".');return r===i.length-1?s:s._children}),"root"===t?e:e.root._children)}function J(e){try{return e()}catch(t){return t}}var Q=function(e,t){this.runtime=t,this._children=Object.create(null),this._rawModule=e;var i=e.state;this.state=("function"===typeof i?i():i)||{}},Y={namespaced:{configurable:!0}};Y.namespaced.get=function(){return!!this._rawModule.namespaced},Q.prototype.addChild=function(e,t){this._children[e]=t},Q.prototype.removeChild=function(e){delete this._children[e]},Q.prototype.getChild=function(e){return this._children[e]},Q.prototype.hasChild=function(e){return e in this._children},Q.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)},Q.prototype.forEachChild=function(e){m(this._children,e)},Q.prototype.forEachGetter=function(e){this._rawModule.getters&&m(this._rawModule.getters,e)},Q.prototype.forEachAction=function(e){this._rawModule.actions&&m(this._rawModule.actions,e)},Q.prototype.forEachMutation=function(e){this._rawModule.mutations&&m(this._rawModule.mutations,e)},Object.defineProperties(Q.prototype,Y);var Z=function(e){this.register([],e,!1)};function X(e,t,i){if(t.update(i),i.modules)for(var n in i.modules){if(!t.getChild(n))return void 0;X(e.concat(n),t.getChild(n),i.modules[n])}}Z.prototype.get=function(e){return e.reduce((function(e,t){return e.getChild(t)}),this.root)},Z.prototype.getNamespace=function(e){var t=this.root;return e.reduce((function(e,i){return t=t.getChild(i),e+(t.namespaced?i+"/":"")}),"")},Z.prototype.update=function(e){X([],this.root,e)},Z.prototype.register=function(e,t,i){var n=this;void 0===i&&(i=!0);var r=new Q(t,i);if(0===e.length)this.root=r;else{var s=this.get(e.slice(0,-1));s.addChild(e[e.length-1],r)}t.modules&&m(t.modules,(function(t,r){n.register(e.concat(r),t,i)}))},Z.prototype.unregister=function(e){var t=this.get(e.slice(0,-1)),i=e[e.length-1],n=t.getChild(i);n&&n.runtime&&t.removeChild(i)},Z.prototype.isRegistered=function(e){var t=this.get(e.slice(0,-1)),i=e[e.length-1];return!!t&&t.hasChild(i)};function ee(e){return new te(e)}var te=function(e){var t=this;void 0===e&&(e={});var i=e.plugins;void 0===i&&(i=[]);var n=e.strict;void 0===n&&(n=!1);var r=e.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new Z(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=r;var s=this,o=this,a=o.dispatch,l=o.commit;this.dispatch=function(e,t){return a.call(s,e,t)},this.commit=function(e,t,i){return l.call(s,e,t,i)},this.strict=n;var c=this._modules.root.state;E(this,c,[],this._modules.root),w(this,c),i.forEach((function(e){return e(t)}))},ie={state:{configurable:!0}};te.prototype.install=function(e,t){e.provide(t||g,this),e.config.globalProperties.$store=this;var i=void 0!==this._devtools&&this._devtools;i&&F(e,this)},ie.state.get=function(){return this._state.data},ie.state.set=function(e){0},te.prototype.commit=function(e,t,i){var n=this,r=D(e,t,i),s=r.type,o=r.payload,a=(r.options,{type:s,payload:o}),l=this._mutations[s];l&&(this._withCommit((function(){l.forEach((function(e){e(o)}))})),this._subscribers.slice().forEach((function(e){return e(a,n.state)})))},te.prototype.dispatch=function(e,t){var i=this,n=D(e,t),r=n.type,s=n.payload,o={type:r,payload:s},a=this._actions[r];if(a){try{this._actionSubscribers.slice().filter((function(e){return e.before})).forEach((function(e){return e.before(o,i.state)}))}catch(c){0}var l=a.length>1?Promise.all(a.map((function(e){return e(s)}))):a[0](s);return new Promise((function(e,t){l.then((function(t){try{i._actionSubscribers.filter((function(e){return e.after})).forEach((function(e){return e.after(o,i.state)}))}catch(c){0}e(t)}),(function(e){try{i._actionSubscribers.filter((function(e){return e.error})).forEach((function(t){return t.error(o,i.state,e)}))}catch(c){0}t(e)}))}))}},te.prototype.subscribe=function(e,t){return T(e,this._subscribers,t)},te.prototype.subscribeAction=function(e,t){var i="function"===typeof e?{before:e}:e;return T(i,this._actionSubscribers,t)},te.prototype.watch=function(e,t,i){var r=this;return(0,n.wB)((function(){return e(r.state,r.getters)}),t,Object.assign({},i))},te.prototype.replaceState=function(e){var t=this;this._withCommit((function(){t._state.data=e}))},te.prototype.registerModule=function(e,t,i){void 0===i&&(i={}),"string"===typeof e&&(e=[e]),this._modules.register(e,t),E(this,this.state,e,this._modules.get(e),i.preserveState),w(this,this.state)},te.prototype.unregisterModule=function(e){var t=this;"string"===typeof e&&(e=[e]),this._modules.unregister(e),this._withCommit((function(){var i=L(t.state,e.slice(0,-1));delete i[e[e.length-1]]})),S(this)},te.prototype.hasModule=function(e){return"string"===typeof e&&(e=[e]),this._modules.isRegistered(e)},te.prototype.hotUpdate=function(e){this._modules.update(e),S(this,!0)},te.prototype._withCommit=function(e){var t=this._committing;this._committing=!0,e(),this._committing=t},Object.defineProperties(te.prototype,ie);se((function(e,t){var i={};return ne(t).forEach((function(t){var n=t.key,r=t.val;i[n]=function(){var t=this.$store.state,i=this.$store.getters;if(e){var n=oe(this.$store,"mapState",e);if(!n)return;t=n.context.state,i=n.context.getters}return"function"===typeof r?r.call(this,t,i):t[r]},i[n].vuex=!0})),i})),se((function(e,t){var i={};return ne(t).forEach((function(t){var n=t.key,r=t.val;i[n]=function(){var t=[],i=arguments.length;while(i--)t[i]=arguments[i];var n=this.$store.commit;if(e){var s=oe(this.$store,"mapMutations",e);if(!s)return;n=s.context.commit}return"function"===typeof r?r.apply(this,[n].concat(t)):n.apply(this.$store,[r].concat(t))}})),i})),se((function(e,t){var i={};return ne(t).forEach((function(t){var n=t.key,r=t.val;r=e+r,i[n]=function(){if(!e||oe(this.$store,"mapGetters",e))return this.$store.getters[r]},i[n].vuex=!0})),i})),se((function(e,t){var i={};return ne(t).forEach((function(t){var n=t.key,r=t.val;i[n]=function(){var t=[],i=arguments.length;while(i--)t[i]=arguments[i];var n=this.$store.dispatch;if(e){var s=oe(this.$store,"mapActions",e);if(!s)return;n=s.context.dispatch}return"function"===typeof r?r.apply(this,[n].concat(t)):n.apply(this.$store,[r].concat(t))}})),i}));function ne(e){return re(e)?Array.isArray(e)?e.map((function(e){return{key:e,val:e}})):Object.keys(e).map((function(t){return{key:t,val:e[t]}})):[]}function re(e){return Array.isArray(e)||y(e)}function se(e){return function(t,i){return"string"!==typeof t?(i=t,t=""):"/"!==t.charAt(t.length-1)&&(t+="/"),e(t,i)}}function oe(e,t,i){var n=e._modulesNamespaceMap[i];return n}},9306:function(e,t,i){"use strict";var n=i(4901),r=i(6823),s=TypeError;e.exports=function(e){if(n(e))return e;throw new s(r(e)+" is not a function")}},3506:function(e,t,i){"use strict";var n=i(3925),r=String,s=TypeError;e.exports=function(e){if(n(e))return e;throw new s("Can't set "+r(e)+" as a prototype")}},7080:function(e,t,i){"use strict";var n=i(4402).has;e.exports=function(e){return n(e),e}},6469:function(e,t,i){"use strict";var n=i(8227),r=i(2360),s=i(4913).f,o=n("unscopables"),a=Array.prototype;void 0===a[o]&&s(a,o,{configurable:!0,value:r(null)}),e.exports=function(e){a[o][e]=!0}},679:function(e,t,i){"use strict";var n=i(1625),r=TypeError;e.exports=function(e,t){if(n(t,e))return e;throw new r("Incorrect invocation")}},8551:function(e,t,i){"use strict";var n=i(34),r=String,s=TypeError;e.exports=function(e){if(n(e))return e;throw new s(r(e)+" is not an object")}},7811:function(e){"use strict";e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7394:function(e,t,i){"use strict";var n=i(4576),r=i(6706),s=i(2195),o=n.ArrayBuffer,a=n.TypeError;e.exports=o&&r(o.prototype,"byteLength","get")||function(e){if("ArrayBuffer"!==s(e))throw new a("ArrayBuffer expected");return e.byteLength}},3238:function(e,t,i){"use strict";var n=i(4576),r=i(7811),s=i(7394),o=n.DataView;e.exports=function(e){if(!r||0!==s(e))return!1;try{return new o(e),!1}catch(t){return!0}}},5169:function(e,t,i){"use strict";var n=i(3238),r=TypeError;e.exports=function(e){if(n(e))throw new r("ArrayBuffer is detached");return e}},5636:function(e,t,i){"use strict";var n=i(4576),r=i(9504),s=i(6706),o=i(7696),a=i(5169),l=i(7394),c=i(4483),u=i(1548),d=n.structuredClone,h=n.ArrayBuffer,p=n.DataView,f=Math.min,v=h.prototype,g=p.prototype,m=r(v.slice),y=s(v,"resizable","get"),b=s(v,"maxByteLength","get"),k=r(g.getInt8),T=r(g.setInt8);e.exports=(u||c)&&function(e,t,i){var n,r=l(e),s=void 0===t?r:o(t),v=!y||!y(e);if(a(e),u&&(e=d(e,{transfer:[e]}),r===s&&(i||v)))return e;if(r>=s&&(!i||v))n=m(e,0,s);else{var g=i&&!v&&b?{maxByteLength:b(e)}:void 0;n=new h(s,g);for(var S=new p(e),w=new p(n),E=f(s,r),P=0;P<E;P++)T(w,P,k(S,P))}return u||c(e),n}},4644:function(e,t,i){"use strict";var n,r,s,o=i(7811),a=i(3724),l=i(4576),c=i(4901),u=i(34),d=i(9297),h=i(6955),p=i(6823),f=i(6699),v=i(6840),g=i(2106),m=i(1625),y=i(2787),b=i(2967),k=i(8227),T=i(3392),S=i(1181),w=S.enforce,E=S.get,P=l.Int8Array,C=P&&P.prototype,_=l.Uint8ClampedArray,A=_&&_.prototype,I=P&&y(P),R=C&&y(C),L=Object.prototype,D=l.TypeError,O=k("toStringTag"),M=T("TYPED_ARRAY_TAG"),x="TypedArrayConstructor",N=o&&!!b&&"Opera"!==h(l.opera),U=!1,F={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},j={BigInt64Array:8,BigUint64Array:8},B=function(e){if(!u(e))return!1;var t=h(e);return"DataView"===t||d(F,t)||d(j,t)},G=function(e){var t=y(e);if(u(t)){var i=E(t);return i&&d(i,x)?i[x]:G(t)}},$=function(e){if(!u(e))return!1;var t=h(e);return d(F,t)||d(j,t)},V=function(e){if($(e))return e;throw new D("Target is not a typed array")},W=function(e){if(c(e)&&(!b||m(I,e)))return e;throw new D(p(e)+" is not a typed array constructor")},H=function(e,t,i,n){if(a){if(i)for(var r in F){var s=l[r];if(s&&d(s.prototype,e))try{delete s.prototype[e]}catch(o){try{s.prototype[e]=t}catch(c){}}}R[e]&&!i||v(R,e,i?t:N&&C[e]||t,n)}},q=function(e,t,i){var n,r;if(a){if(b){if(i)for(n in F)if(r=l[n],r&&d(r,e))try{delete r[e]}catch(s){}if(I[e]&&!i)return;try{return v(I,e,i?t:N&&I[e]||t)}catch(s){}}for(n in F)r=l[n],!r||r[e]&&!i||v(r,e,t)}};for(n in F)r=l[n],s=r&&r.prototype,s?w(s)[x]=r:N=!1;for(n in j)r=l[n],s=r&&r.prototype,s&&(w(s)[x]=r);if((!N||!c(I)||I===Function.prototype)&&(I=function(){throw new D("Incorrect invocation")},N))for(n in F)l[n]&&b(l[n],I);if((!N||!R||R===L)&&(R=I.prototype,N))for(n in F)l[n]&&b(l[n].prototype,R);if(N&&y(A)!==R&&b(A,R),a&&!d(R,O))for(n in U=!0,g(R,O,{configurable:!0,get:function(){return u(this)?this[M]:void 0}}),F)l[n]&&f(l[n],M,n);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:N,TYPED_ARRAY_TAG:U&&M,aTypedArray:V,aTypedArrayConstructor:W,exportTypedArrayMethod:H,exportTypedArrayStaticMethod:q,getTypedArrayConstructor:G,isView:B,isTypedArray:$,TypedArray:I,TypedArrayPrototype:R}},5370:function(e,t,i){"use strict";var n=i(6198);e.exports=function(e,t,i){var r=0,s=arguments.length>2?i:n(t),o=new e(s);while(s>r)o[r]=t[r++];return o}},9617:function(e,t,i){"use strict";var n=i(5397),r=i(5610),s=i(6198),o=function(e){return function(t,i,o){var a=n(t),l=s(a);if(0===l)return!e&&-1;var c,u=r(o,l);if(e&&i!==i){while(l>u)if(c=a[u++],c!==c)return!0}else for(;l>u;u++)if((e||u in a)&&a[u]===i)return e||u||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},4527:function(e,t,i){"use strict";var n=i(3724),r=i(4376),s=TypeError,o=Object.getOwnPropertyDescriptor,a=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=a?function(e,t){if(r(e)&&!o(e,"length").writable)throw new s("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},7680:function(e,t,i){"use strict";var n=i(9504);e.exports=n([].slice)},7628:function(e,t,i){"use strict";var n=i(6198);e.exports=function(e,t){for(var i=n(e),r=new t(i),s=0;s<i;s++)r[s]=e[i-s-1];return r}},9928:function(e,t,i){"use strict";var n=i(6198),r=i(1291),s=RangeError;e.exports=function(e,t,i,o){var a=n(e),l=r(i),c=l<0?a+l:l;if(c>=a||c<0)throw new s("Incorrect index");for(var u=new t(a),d=0;d<a;d++)u[d]=d===c?o:e[d];return u}},6319:function(e,t,i){"use strict";var n=i(8551),r=i(9539);e.exports=function(e,t,i,s){try{return s?t(n(i)[0],i[1]):t(i)}catch(o){r(e,"throw",o)}}},2195:function(e,t,i){"use strict";var n=i(9504),r=n({}.toString),s=n("".slice);e.exports=function(e){return s(r(e),8,-1)}},6955:function(e,t,i){"use strict";var n=i(2140),r=i(4901),s=i(2195),o=i(8227),a=o("toStringTag"),l=Object,c="Arguments"===s(function(){return arguments}()),u=function(e,t){try{return e[t]}catch(i){}};e.exports=n?s:function(e){var t,i,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=u(t=l(e),a))?i:c?s(t):"Object"===(n=s(t))&&r(t.callee)?"Arguments":n}},7740:function(e,t,i){"use strict";var n=i(9297),r=i(5031),s=i(7347),o=i(4913);e.exports=function(e,t,i){for(var a=r(t),l=o.f,c=s.f,u=0;u<a.length;u++){var d=a[u];n(e,d)||i&&n(i,d)||l(e,d,c(t,d))}}},2211:function(e,t,i){"use strict";var n=i(9039);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},2529:function(e){"use strict";e.exports=function(e,t){return{value:e,done:t}}},6699:function(e,t,i){"use strict";var n=i(3724),r=i(4913),s=i(6980);e.exports=n?function(e,t,i){return r.f(e,t,s(1,i))}:function(e,t,i){return e[t]=i,e}},6980:function(e){"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},4659:function(e,t,i){"use strict";var n=i(3724),r=i(4913),s=i(6980);e.exports=function(e,t,i){n?r.f(e,t,s(0,i)):e[t]=i}},2106:function(e,t,i){"use strict";var n=i(283),r=i(4913);e.exports=function(e,t,i){return i.get&&n(i.get,t,{getter:!0}),i.set&&n(i.set,t,{setter:!0}),r.f(e,t,i)}},6840:function(e,t,i){"use strict";var n=i(4901),r=i(4913),s=i(283),o=i(9433);e.exports=function(e,t,i,a){a||(a={});var l=a.enumerable,c=void 0!==a.name?a.name:t;if(n(i)&&s(i,c,a),a.global)l?e[t]=i:o(t,i);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(u){}l?e[t]=i:r.f(e,t,{value:i,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},6279:function(e,t,i){"use strict";var n=i(6840);e.exports=function(e,t,i){for(var r in t)n(e,r,t[r],i);return e}},9433:function(e,t,i){"use strict";var n=i(4576),r=Object.defineProperty;e.exports=function(e,t){try{r(n,e,{value:t,configurable:!0,writable:!0})}catch(i){n[e]=t}return t}},3724:function(e,t,i){"use strict";var n=i(9039);e.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4483:function(e,t,i){"use strict";var n,r,s,o,a=i(4576),l=i(9429),c=i(1548),u=a.structuredClone,d=a.ArrayBuffer,h=a.MessageChannel,p=!1;if(c)p=function(e){u(e,{transfer:[e]})};else if(d)try{h||(n=l("worker_threads"),n&&(h=n.MessageChannel)),h&&(r=new h,s=new d(2),o=function(e){r.port1.postMessage(null,[e])},2===s.byteLength&&(o(s),0===s.byteLength&&(p=o)))}catch(f){}e.exports=p},4055:function(e,t,i){"use strict";var n=i(4576),r=i(34),s=n.document,o=r(s)&&r(s.createElement);e.exports=function(e){return o?s.createElement(e):{}}},6837:function(e){"use strict";var t=TypeError,i=9007199254740991;e.exports=function(e){if(e>i)throw t("Maximum allowed index exceeded");return e}},5002:function(e){"use strict";e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},8727:function(e){"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},9544:function(e,t,i){"use strict";var n=i(2839);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},6193:function(e,t,i){"use strict";var n=i(4215);e.exports="NODE"===n},2839:function(e,t,i){"use strict";var n=i(4576),r=n.navigator,s=r&&r.userAgent;e.exports=s?String(s):""},9519:function(e,t,i){"use strict";var n,r,s=i(4576),o=i(2839),a=s.process,l=s.Deno,c=a&&a.versions||l&&l.version,u=c&&c.v8;u&&(n=u.split("."),r=n[0]>0&&n[0]<4?1:+(n[0]+n[1])),!r&&o&&(n=o.match(/Edge\/(\d+)/),(!n||n[1]>=74)&&(n=o.match(/Chrome\/(\d+)/),n&&(r=+n[1]))),e.exports=r},4215:function(e,t,i){"use strict";var n=i(4576),r=i(2839),s=i(2195),o=function(e){return r.slice(0,e.length)===e};e.exports=function(){return o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":n.Bun&&"string"==typeof Bun.version?"BUN":n.Deno&&"object"==typeof Deno.version?"DENO":"process"===s(n.process)?"NODE":n.window&&n.document?"BROWSER":"REST"}()},8574:function(e,t,i){"use strict";var n=i(9504),r=Error,s=n("".replace),o=function(e){return String(new r(e).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,l=a.test(o);e.exports=function(e,t){if(l&&"string"==typeof e&&!r.prepareStackTrace)while(t--)e=s(e,a,"");return e}},6518:function(e,t,i){"use strict";var n=i(4576),r=i(7347).f,s=i(6699),o=i(6840),a=i(9433),l=i(7740),c=i(2796);e.exports=function(e,t){var i,u,d,h,p,f,v=e.target,g=e.global,m=e.stat;if(u=g?n:m?n[v]||a(v,{}):n[v]&&n[v].prototype,u)for(d in t){if(p=t[d],e.dontCallGetSet?(f=r(u,d),h=f&&f.value):h=u[d],i=c(g?d:v+(m?".":"#")+d,e.forced),!i&&void 0!==h){if(typeof p==typeof h)continue;l(p,h)}(e.sham||h&&h.sham)&&s(p,"sham",!0),o(u,d,p,e)}}},9039:function(e){"use strict";e.exports=function(e){try{return!!e()}catch(t){return!0}}},8745:function(e,t,i){"use strict";var n=i(616),r=Function.prototype,s=r.apply,o=r.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?o.bind(s):function(){return o.apply(s,arguments)})},6080:function(e,t,i){"use strict";var n=i(7476),r=i(9306),s=i(616),o=n(n.bind);e.exports=function(e,t){return r(e),void 0===t?e:s?o(e,t):function(){return e.apply(t,arguments)}}},616:function(e,t,i){"use strict";var n=i(9039);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},9565:function(e,t,i){"use strict";var n=i(616),r=Function.prototype.call;e.exports=n?r.bind(r):function(){return r.apply(r,arguments)}},350:function(e,t,i){"use strict";var n=i(3724),r=i(9297),s=Function.prototype,o=n&&Object.getOwnPropertyDescriptor,a=r(s,"name"),l=a&&"something"===function(){}.name,c=a&&(!n||n&&o(s,"name").configurable);e.exports={EXISTS:a,PROPER:l,CONFIGURABLE:c}},6706:function(e,t,i){"use strict";var n=i(9504),r=i(9306);e.exports=function(e,t,i){try{return n(r(Object.getOwnPropertyDescriptor(e,t)[i]))}catch(s){}}},7476:function(e,t,i){"use strict";var n=i(2195),r=i(9504);e.exports=function(e){if("Function"===n(e))return r(e)}},9504:function(e,t,i){"use strict";var n=i(616),r=Function.prototype,s=r.call,o=n&&r.bind.bind(s,s);e.exports=n?o:function(e){return function(){return s.apply(e,arguments)}}},9429:function(e,t,i){"use strict";var n=i(4576),r=i(6193);e.exports=function(e){if(r){try{return n.process.getBuiltinModule(e)}catch(t){}try{return Function('return require("'+e+'")')()}catch(t){}}}},4124:function(e,t,i){"use strict";var n=i(4576);e.exports=function(e,t){var i=n[e],r=i&&i.prototype;return r&&r[t]}},7751:function(e,t,i){"use strict";var n=i(4576),r=i(4901),s=function(e){return r(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?s(n[e]):n[e]&&n[e][t]}},1767:function(e){"use strict";e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},851:function(e,t,i){"use strict";var n=i(6955),r=i(5966),s=i(4117),o=i(6269),a=i(8227),l=a("iterator");e.exports=function(e){if(!s(e))return r(e,l)||r(e,"@@iterator")||o[n(e)]}},81:function(e,t,i){"use strict";var n=i(9565),r=i(9306),s=i(8551),o=i(6823),a=i(851),l=TypeError;e.exports=function(e,t){var i=arguments.length<2?a(e):t;if(r(i))return s(n(i,e));throw new l(o(e)+" is not iterable")}},5966:function(e,t,i){"use strict";var n=i(9306),r=i(4117);e.exports=function(e,t){var i=e[t];return r(i)?void 0:n(i)}},3789:function(e,t,i){"use strict";var n=i(9306),r=i(8551),s=i(9565),o=i(1291),a=i(1767),l="Invalid size",c=RangeError,u=TypeError,d=Math.max,h=function(e,t){this.set=e,this.size=d(t,0),this.has=n(e.has),this.keys=n(e.keys)};h.prototype={getIterator:function(){return a(r(s(this.keys,this.set)))},includes:function(e){return s(this.has,this.set,e)}},e.exports=function(e){r(e);var t=+e.size;if(t!==t)throw new u(l);var i=o(t);if(i<0)throw new c(l);return new h(e,i)}},4576:function(e,t,i){"use strict";var n=function(e){return e&&e.Math===Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof i.g&&i.g)||n("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9297:function(e,t,i){"use strict";var n=i(9504),r=i(8981),s=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return s(r(e),t)}},421:function(e){"use strict";e.exports={}},397:function(e,t,i){"use strict";var n=i(7751);e.exports=n("document","documentElement")},5917:function(e,t,i){"use strict";var n=i(3724),r=i(9039),s=i(4055);e.exports=!n&&!r((function(){return 7!==Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},7055:function(e,t,i){"use strict";var n=i(9504),r=i(9039),s=i(2195),o=Object,a=n("".split);e.exports=r((function(){return!o("z").propertyIsEnumerable(0)}))?function(e){return"String"===s(e)?a(e,""):o(e)}:o},3167:function(e,t,i){"use strict";var n=i(4901),r=i(34),s=i(2967);e.exports=function(e,t,i){var o,a;return s&&n(o=t.constructor)&&o!==i&&r(a=o.prototype)&&a!==i.prototype&&s(e,a),e}},3706:function(e,t,i){"use strict";var n=i(9504),r=i(4901),s=i(7629),o=n(Function.toString);r(s.inspectSource)||(s.inspectSource=function(e){return o(e)}),e.exports=s.inspectSource},1181:function(e,t,i){"use strict";var n,r,s,o=i(8622),a=i(4576),l=i(34),c=i(6699),u=i(9297),d=i(7629),h=i(6119),p=i(421),f="Object already initialized",v=a.TypeError,g=a.WeakMap,m=function(e){return s(e)?r(e):n(e,{})},y=function(e){return function(t){var i;if(!l(t)||(i=r(t)).type!==e)throw new v("Incompatible receiver, "+e+" required");return i}};if(o||d.state){var b=d.state||(d.state=new g);b.get=b.get,b.has=b.has,b.set=b.set,n=function(e,t){if(b.has(e))throw new v(f);return t.facade=e,b.set(e,t),t},r=function(e){return b.get(e)||{}},s=function(e){return b.has(e)}}else{var k=h("state");p[k]=!0,n=function(e,t){if(u(e,k))throw new v(f);return t.facade=e,c(e,k,t),t},r=function(e){return u(e,k)?e[k]:{}},s=function(e){return u(e,k)}}e.exports={set:n,get:r,has:s,enforce:m,getterFor:y}},4209:function(e,t,i){"use strict";var n=i(8227),r=i(6269),s=n("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[s]===e)}},4376:function(e,t,i){"use strict";var n=i(2195);e.exports=Array.isArray||function(e){return"Array"===n(e)}},1108:function(e,t,i){"use strict";var n=i(6955);e.exports=function(e){var t=n(e);return"BigInt64Array"===t||"BigUint64Array"===t}},4901:function(e){"use strict";var t="object"==typeof document&&document.all;e.exports="undefined"==typeof t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},2796:function(e,t,i){"use strict";var n=i(9039),r=i(4901),s=/#|\.prototype\./,o=function(e,t){var i=l[a(e)];return i===u||i!==c&&(r(t)?n(t):!!t)},a=o.normalize=function(e){return String(e).replace(s,".").toLowerCase()},l=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";e.exports=o},4117:function(e){"use strict";e.exports=function(e){return null===e||void 0===e}},34:function(e,t,i){"use strict";var n=i(4901);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},3925:function(e,t,i){"use strict";var n=i(34);e.exports=function(e){return n(e)||null===e}},6395:function(e){"use strict";e.exports=!1},757:function(e,t,i){"use strict";var n=i(7751),r=i(4901),s=i(1625),o=i(7040),a=Object;e.exports=o?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return r(t)&&s(t.prototype,a(e))}},507:function(e,t,i){"use strict";var n=i(9565);e.exports=function(e,t,i){var r,s,o=i?e:e.iterator,a=e.next;while(!(r=n(a,o)).done)if(s=t(r.value),void 0!==s)return s}},2652:function(e,t,i){"use strict";var n=i(6080),r=i(9565),s=i(8551),o=i(6823),a=i(4209),l=i(6198),c=i(1625),u=i(81),d=i(851),h=i(9539),p=TypeError,f=function(e,t){this.stopped=e,this.result=t},v=f.prototype;e.exports=function(e,t,i){var g,m,y,b,k,T,S,w=i&&i.that,E=!(!i||!i.AS_ENTRIES),P=!(!i||!i.IS_RECORD),C=!(!i||!i.IS_ITERATOR),_=!(!i||!i.INTERRUPTED),A=n(t,w),I=function(e){return g&&h(g,"normal",e),new f(!0,e)},R=function(e){return E?(s(e),_?A(e[0],e[1],I):A(e[0],e[1])):_?A(e,I):A(e)};if(P)g=e.iterator;else if(C)g=e;else{if(m=d(e),!m)throw new p(o(e)+" is not iterable");if(a(m)){for(y=0,b=l(e);b>y;y++)if(k=R(e[y]),k&&c(v,k))return k;return new f(!1)}g=u(e,m)}T=P?e.next:g.next;while(!(S=r(T,g)).done){try{k=R(S.value)}catch(L){h(g,"throw",L)}if("object"==typeof k&&k&&c(v,k))return k}return new f(!1)}},9539:function(e,t,i){"use strict";var n=i(9565),r=i(8551),s=i(5966);e.exports=function(e,t,i){var o,a;r(e);try{if(o=s(e,"return"),!o){if("throw"===t)throw i;return i}o=n(o,e)}catch(l){a=!0,o=l}if("throw"===t)throw i;if(a)throw o;return r(o),i}},9462:function(e,t,i){"use strict";var n=i(9565),r=i(2360),s=i(6699),o=i(6279),a=i(8227),l=i(1181),c=i(5966),u=i(7657).IteratorPrototype,d=i(2529),h=i(9539),p=a("toStringTag"),f="IteratorHelper",v="WrapForValidIterator",g=l.set,m=function(e){var t=l.getterFor(e?v:f);return o(r(u),{next:function(){var i=t(this);if(e)return i.nextHandler();if(i.done)return d(void 0,!0);try{var n=i.nextHandler();return i.returnHandlerResult?n:d(n,i.done)}catch(r){throw i.done=!0,r}},return:function(){var i=t(this),r=i.iterator;if(i.done=!0,e){var s=c(r,"return");return s?n(s,r):d(void 0,!0)}if(i.inner)try{h(i.inner.iterator,"normal")}catch(o){return h(r,"throw",o)}return r&&h(r,"normal"),d(void 0,!0)}})},y=m(!0),b=m(!1);s(b,p,"Iterator Helper"),e.exports=function(e,t,i){var n=function(n,r){r?(r.iterator=n.iterator,r.next=n.next):r=n,r.type=t?v:f,r.returnHandlerResult=!!i,r.nextHandler=e,r.counter=0,r.done=!1,g(this,r)};return n.prototype=t?y:b,n}},713:function(e,t,i){"use strict";var n=i(9565),r=i(9306),s=i(8551),o=i(1767),a=i(9462),l=i(6319),c=a((function(){var e=this.iterator,t=s(n(this.next,e)),i=this.done=!!t.done;if(!i)return l(e,this.mapper,[t.value,this.counter++],!0)}));e.exports=function(e){return s(this),r(e),new c(o(this),{mapper:e})}},7657:function(e,t,i){"use strict";var n,r,s,o=i(9039),a=i(4901),l=i(34),c=i(2360),u=i(2787),d=i(6840),h=i(8227),p=i(6395),f=h("iterator"),v=!1;[].keys&&(s=[].keys(),"next"in s?(r=u(u(s)),r!==Object.prototype&&(n=r)):v=!0);var g=!l(n)||o((function(){var e={};return n[f].call(e)!==e}));g?n={}:p&&(n=c(n)),a(n[f])||d(n,f,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:v}},6269:function(e){"use strict";e.exports={}},6198:function(e,t,i){"use strict";var n=i(8014);e.exports=function(e){return n(e.length)}},283:function(e,t,i){"use strict";var n=i(9504),r=i(9039),s=i(4901),o=i(9297),a=i(3724),l=i(350).CONFIGURABLE,c=i(3706),u=i(1181),d=u.enforce,h=u.get,p=String,f=Object.defineProperty,v=n("".slice),g=n("".replace),m=n([].join),y=a&&!r((function(){return 8!==f((function(){}),"length",{value:8}).length})),b=String(String).split("String"),k=e.exports=function(e,t,i){"Symbol("===v(p(t),0,7)&&(t="["+g(p(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),i&&i.getter&&(t="get "+t),i&&i.setter&&(t="set "+t),(!o(e,"name")||l&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),y&&i&&o(i,"arity")&&e.length!==i.arity&&f(e,"length",{value:i.arity});try{i&&o(i,"constructor")&&i.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(r){}var n=d(e);return o(n,"source")||(n.source=m(b,"string"==typeof t?t:"")),e};Function.prototype.toString=k((function(){return s(this)&&h(this).source||c(this)}),"toString")},741:function(e){"use strict";var t=Math.ceil,i=Math.floor;e.exports=Math.trunc||function(e){var n=+e;return(n>0?i:t)(n)}},2603:function(e,t,i){"use strict";var n=i(655);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:n(e)}},2360:function(e,t,i){"use strict";var n,r=i(8551),s=i(6801),o=i(8727),a=i(421),l=i(397),c=i(4055),u=i(6119),d=">",h="<",p="prototype",f="script",v=u("IE_PROTO"),g=function(){},m=function(e){return h+f+d+e+h+"/"+f+d},y=function(e){e.write(m("")),e.close();var t=e.parentWindow.Object;return e=null,t},b=function(){var e,t=c("iframe"),i="java"+f+":";return t.style.display="none",l.appendChild(t),t.src=String(i),e=t.contentWindow.document,e.open(),e.write(m("document.F=Object")),e.close(),e.F},k=function(){try{n=new ActiveXObject("htmlfile")}catch(t){}k="undefined"!=typeof document?document.domain&&n?y(n):b():y(n);var e=o.length;while(e--)delete k[p][o[e]];return k()};a[v]=!0,e.exports=Object.create||function(e,t){var i;return null!==e?(g[p]=r(e),i=new g,g[p]=null,i[v]=e):i=k(),void 0===t?i:s.f(i,t)}},6801:function(e,t,i){"use strict";var n=i(3724),r=i(8686),s=i(4913),o=i(8551),a=i(5397),l=i(1072);t.f=n&&!r?Object.defineProperties:function(e,t){o(e);var i,n=a(t),r=l(t),c=r.length,u=0;while(c>u)s.f(e,i=r[u++],n[i]);return e}},4913:function(e,t,i){"use strict";var n=i(3724),r=i(5917),s=i(8686),o=i(8551),a=i(6969),l=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,d="enumerable",h="configurable",p="writable";t.f=n?s?function(e,t,i){if(o(e),t=a(t),o(i),"function"===typeof e&&"prototype"===t&&"value"in i&&p in i&&!i[p]){var n=u(e,t);n&&n[p]&&(e[t]=i.value,i={configurable:h in i?i[h]:n[h],enumerable:d in i?i[d]:n[d],writable:!1})}return c(e,t,i)}:c:function(e,t,i){if(o(e),t=a(t),o(i),r)try{return c(e,t,i)}catch(n){}if("get"in i||"set"in i)throw new l("Accessors not supported");return"value"in i&&(e[t]=i.value),e}},7347:function(e,t,i){"use strict";var n=i(3724),r=i(9565),s=i(8773),o=i(6980),a=i(5397),l=i(6969),c=i(9297),u=i(5917),d=Object.getOwnPropertyDescriptor;t.f=n?d:function(e,t){if(e=a(e),t=l(t),u)try{return d(e,t)}catch(i){}if(c(e,t))return o(!r(s.f,e,t),e[t])}},8480:function(e,t,i){"use strict";var n=i(1828),r=i(8727),s=r.concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,s)}},3717:function(e,t){"use strict";t.f=Object.getOwnPropertySymbols},2787:function(e,t,i){"use strict";var n=i(9297),r=i(4901),s=i(8981),o=i(6119),a=i(2211),l=o("IE_PROTO"),c=Object,u=c.prototype;e.exports=a?c.getPrototypeOf:function(e){var t=s(e);if(n(t,l))return t[l];var i=t.constructor;return r(i)&&t instanceof i?i.prototype:t instanceof c?u:null}},1625:function(e,t,i){"use strict";var n=i(9504);e.exports=n({}.isPrototypeOf)},1828:function(e,t,i){"use strict";var n=i(9504),r=i(9297),s=i(5397),o=i(9617).indexOf,a=i(421),l=n([].push);e.exports=function(e,t){var i,n=s(e),c=0,u=[];for(i in n)!r(a,i)&&r(n,i)&&l(u,i);while(t.length>c)r(n,i=t[c++])&&(~o(u,i)||l(u,i));return u}},1072:function(e,t,i){"use strict";var n=i(1828),r=i(8727);e.exports=Object.keys||function(e){return n(e,r)}},8773:function(e,t){"use strict";var i={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,r=n&&!i.call({1:2},1);t.f=r?function(e){var t=n(this,e);return!!t&&t.enumerable}:i},2967:function(e,t,i){"use strict";var n=i(6706),r=i(34),s=i(7750),o=i(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{e=n(Object.prototype,"__proto__","set"),e(i,[]),t=i instanceof Array}catch(a){}return function(i,n){return s(i),o(n),r(i)?(t?e(i,n):i.__proto__=n,i):i}}():void 0)},4270:function(e,t,i){"use strict";var n=i(9565),r=i(4901),s=i(34),o=TypeError;e.exports=function(e,t){var i,a;if("string"===t&&r(i=e.toString)&&!s(a=n(i,e)))return a;if(r(i=e.valueOf)&&!s(a=n(i,e)))return a;if("string"!==t&&r(i=e.toString)&&!s(a=n(i,e)))return a;throw new o("Can't convert object to primitive value")}},5031:function(e,t,i){"use strict";var n=i(7751),r=i(9504),s=i(8480),o=i(3717),a=i(8551),l=r([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=s.f(a(e)),i=o.f;return i?l(t,i(e)):t}},7979:function(e,t,i){"use strict";var n=i(8551);e.exports=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},7750:function(e,t,i){"use strict";var n=i(4117),r=TypeError;e.exports=function(e){if(n(e))throw new r("Can't call method on "+e);return e}},9472:function(e,t,i){"use strict";var n=i(4576),r=i(8745),s=i(4901),o=i(4215),a=i(2839),l=i(7680),c=i(2812),u=n.Function,d=/MSIE .\./.test(a)||"BUN"===o&&function(){var e=n.Bun.version.split(".");return e.length<3||"0"===e[0]&&(e[1]<3||"3"===e[1]&&"0"===e[2])}();e.exports=function(e,t){var i=t?2:1;return d?function(n,o){var a=c(arguments.length,1)>i,d=s(n)?n:u(n),h=a?l(arguments,i):[],p=a?function(){r(d,this,h)}:d;return t?e(p,o):e(p)}:e}},9286:function(e,t,i){"use strict";var n=i(4402),r=i(8469),s=n.Set,o=n.add;e.exports=function(e){var t=new s;return r(e,(function(e){o(t,e)})),t}},3440:function(e,t,i){"use strict";var n=i(7080),r=i(4402),s=i(9286),o=i(5170),a=i(3789),l=i(8469),c=i(507),u=r.has,d=r.remove;e.exports=function(e){var t=n(this),i=a(e),r=s(t);return o(t)<=i.size?l(t,(function(e){i.includes(e)&&d(r,e)})):c(i.getIterator(),(function(e){u(t,e)&&d(r,e)})),r}},4402:function(e,t,i){"use strict";var n=i(9504),r=Set.prototype;e.exports={Set:Set,add:n(r.add),has:n(r.has),remove:n(r["delete"]),proto:r}},8750:function(e,t,i){"use strict";var n=i(7080),r=i(4402),s=i(5170),o=i(3789),a=i(8469),l=i(507),c=r.Set,u=r.add,d=r.has;e.exports=function(e){var t=n(this),i=o(e),r=new c;return s(t)>i.size?l(i.getIterator(),(function(e){d(t,e)&&u(r,e)})):a(t,(function(e){i.includes(e)&&u(r,e)})),r}},4449:function(e,t,i){"use strict";var n=i(7080),r=i(4402).has,s=i(5170),o=i(3789),a=i(8469),l=i(507),c=i(9539);e.exports=function(e){var t=n(this),i=o(e);if(s(t)<=i.size)return!1!==a(t,(function(e){if(i.includes(e))return!1}),!0);var u=i.getIterator();return!1!==l(u,(function(e){if(r(t,e))return c(u,"normal",!1)}))}},3838:function(e,t,i){"use strict";var n=i(7080),r=i(5170),s=i(8469),o=i(3789);e.exports=function(e){var t=n(this),i=o(e);return!(r(t)>i.size)&&!1!==s(t,(function(e){if(!i.includes(e))return!1}),!0)}},8527:function(e,t,i){"use strict";var n=i(7080),r=i(4402).has,s=i(5170),o=i(3789),a=i(507),l=i(9539);e.exports=function(e){var t=n(this),i=o(e);if(s(t)<i.size)return!1;var c=i.getIterator();return!1!==a(c,(function(e){if(!r(t,e))return l(c,"normal",!1)}))}},8469:function(e,t,i){"use strict";var n=i(9504),r=i(507),s=i(4402),o=s.Set,a=s.proto,l=n(a.forEach),c=n(a.keys),u=c(new o).next;e.exports=function(e,t,i){return i?r({iterator:c(e),next:u},t):l(e,t)}},4916:function(e,t,i){"use strict";var n=i(7751),r=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},s=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var i=n("Set");try{(new i)[e](r(0));try{return(new i)[e](r(-1)),!1}catch(a){if(!t)return!0;try{return(new i)[e](s(-1/0)),!1}catch(l){var o=new i;return o.add(1),o.add(2),t(o[e](s(1/0)))}}}catch(l){return!1}}},5170:function(e,t,i){"use strict";var n=i(6706),r=i(4402);e.exports=n(r.proto,"size","get")||function(e){return e.size}},3650:function(e,t,i){"use strict";var n=i(7080),r=i(4402),s=i(9286),o=i(3789),a=i(507),l=r.add,c=r.has,u=r.remove;e.exports=function(e){var t=n(this),i=o(e).getIterator(),r=s(t);return a(i,(function(e){c(t,e)?u(r,e):l(r,e)})),r}},4204:function(e,t,i){"use strict";var n=i(7080),r=i(4402).add,s=i(9286),o=i(3789),a=i(507);e.exports=function(e){var t=n(this),i=o(e).getIterator(),l=s(t);return a(i,(function(e){r(l,e)})),l}},6119:function(e,t,i){"use strict";var n=i(5745),r=i(3392),s=n("keys");e.exports=function(e){return s[e]||(s[e]=r(e))}},7629:function(e,t,i){"use strict";var n=i(6395),r=i(4576),s=i(9433),o="__core-js_shared__",a=e.exports=r[o]||s(o,{});(a.versions||(a.versions=[])).push({version:"3.40.0",mode:n?"pure":"global",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.40.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5745:function(e,t,i){"use strict";var n=i(7629);e.exports=function(e,t){return n[e]||(n[e]=t||{})}},1548:function(e,t,i){"use strict";var n=i(4576),r=i(9039),s=i(9519),o=i(4215),a=n.structuredClone;e.exports=!!a&&!r((function(){if("DENO"===o&&s>92||"NODE"===o&&s>94||"BROWSER"===o&&s>97)return!1;var e=new ArrayBuffer(8),t=a(e,{transfer:[e]});return 0!==e.byteLength||8!==t.byteLength}))},4495:function(e,t,i){"use strict";var n=i(9519),r=i(9039),s=i(4576),o=s.String;e.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},9225:function(e,t,i){"use strict";var n,r,s,o,a=i(4576),l=i(8745),c=i(6080),u=i(4901),d=i(9297),h=i(9039),p=i(397),f=i(7680),v=i(4055),g=i(2812),m=i(9544),y=i(6193),b=a.setImmediate,k=a.clearImmediate,T=a.process,S=a.Dispatch,w=a.Function,E=a.MessageChannel,P=a.String,C=0,_={},A="onreadystatechange";h((function(){n=a.location}));var I=function(e){if(d(_,e)){var t=_[e];delete _[e],t()}},R=function(e){return function(){I(e)}},L=function(e){I(e.data)},D=function(e){a.postMessage(P(e),n.protocol+"//"+n.host)};b&&k||(b=function(e){g(arguments.length,1);var t=u(e)?e:w(e),i=f(arguments,1);return _[++C]=function(){l(t,void 0,i)},r(C),C},k=function(e){delete _[e]},y?r=function(e){T.nextTick(R(e))}:S&&S.now?r=function(e){S.now(R(e))}:E&&!m?(s=new E,o=s.port2,s.port1.onmessage=L,r=c(o.postMessage,o)):a.addEventListener&&u(a.postMessage)&&!a.importScripts&&n&&"file:"!==n.protocol&&!h(D)?(r=D,a.addEventListener("message",L,!1)):r=A in v("script")?function(e){p.appendChild(v("script"))[A]=function(){p.removeChild(this),I(e)}}:function(e){setTimeout(R(e),0)}),e.exports={set:b,clear:k}},5610:function(e,t,i){"use strict";var n=i(1291),r=Math.max,s=Math.min;e.exports=function(e,t){var i=n(e);return i<0?r(i+t,0):s(i,t)}},5854:function(e,t,i){"use strict";var n=i(2777),r=TypeError;e.exports=function(e){var t=n(e,"number");if("number"==typeof t)throw new r("Can't convert number to bigint");return BigInt(t)}},7696:function(e,t,i){"use strict";var n=i(1291),r=i(8014),s=RangeError;e.exports=function(e){if(void 0===e)return 0;var t=n(e),i=r(t);if(t!==i)throw new s("Wrong length or index");return i}},5397:function(e,t,i){"use strict";var n=i(7055),r=i(7750);e.exports=function(e){return n(r(e))}},1291:function(e,t,i){"use strict";var n=i(741);e.exports=function(e){var t=+e;return t!==t||0===t?0:n(t)}},8014:function(e,t,i){"use strict";var n=i(1291),r=Math.min;e.exports=function(e){var t=n(e);return t>0?r(t,9007199254740991):0}},8981:function(e,t,i){"use strict";var n=i(7750),r=Object;e.exports=function(e){return r(n(e))}},2777:function(e,t,i){"use strict";var n=i(9565),r=i(34),s=i(757),o=i(5966),a=i(4270),l=i(8227),c=TypeError,u=l("toPrimitive");e.exports=function(e,t){if(!r(e)||s(e))return e;var i,l=o(e,u);if(l){if(void 0===t&&(t="default"),i=n(l,e,t),!r(i)||s(i))return i;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},6969:function(e,t,i){"use strict";var n=i(2777),r=i(757);e.exports=function(e){var t=n(e,"string");return r(t)?t:t+""}},2140:function(e,t,i){"use strict";var n=i(8227),r=n("toStringTag"),s={};s[r]="z",e.exports="[object z]"===String(s)},655:function(e,t,i){"use strict";var n=i(6955),r=String;e.exports=function(e){if("Symbol"===n(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}},6823:function(e){"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(i){return"Object"}}},3392:function(e,t,i){"use strict";var n=i(9504),r=0,s=Math.random(),o=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++r+s,36)}},7040:function(e,t,i){"use strict";var n=i(4495);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8686:function(e,t,i){"use strict";var n=i(3724),r=i(9039);e.exports=n&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},2812:function(e){"use strict";var t=TypeError;e.exports=function(e,i){if(e<i)throw new t("Not enough arguments");return e}},8622:function(e,t,i){"use strict";var n=i(4576),r=i(4901),s=n.WeakMap;e.exports=r(s)&&/native code/.test(String(s))},8227:function(e,t,i){"use strict";var n=i(4576),r=i(5745),s=i(9297),o=i(3392),a=i(4495),l=i(7040),c=n.Symbol,u=r("wks"),d=l?c["for"]||c:c&&c.withoutSetter||o;e.exports=function(e){return s(u,e)||(u[e]=a&&s(c,e)?c[e]:d("Symbol."+e)),u[e]}},6573:function(e,t,i){"use strict";var n=i(3724),r=i(2106),s=i(3238),o=ArrayBuffer.prototype;n&&!("detached"in o)&&r(o,"detached",{configurable:!0,get:function(){return s(this)}})},7936:function(e,t,i){"use strict";var n=i(6518),r=i(5636);r&&n({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return r(this,arguments.length?arguments[0]:void 0,!1)}})},8100:function(e,t,i){"use strict";var n=i(6518),r=i(5636);r&&n({target:"ArrayBuffer",proto:!0},{transfer:function(){return r(this,arguments.length?arguments[0]:void 0,!0)}})},4114:function(e,t,i){"use strict";var n=i(6518),r=i(8981),s=i(6198),o=i(4527),a=i(6837),l=i(9039),c=l((function(){return 4294967297!==[].push.call({length:4294967296},1)})),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},d=c||!u();n({target:"Array",proto:!0,arity:1,forced:d},{push:function(e){var t=r(this),i=s(t),n=arguments.length;a(i+n);for(var l=0;l<n;l++)t[i]=arguments[l],i++;return o(t,i),i}})},9678:function(e,t,i){"use strict";var n=i(6518),r=i(7628),s=i(5397),o=i(6469),a=Array;n({target:"Array",proto:!0},{toReversed:function(){return r(s(this),a)}}),o("toReversed")},7145:function(e,t,i){"use strict";var n=i(6518),r=i(9504),s=i(9306),o=i(5397),a=i(5370),l=i(4124),c=i(6469),u=Array,d=r(l("Array","sort"));n({target:"Array",proto:!0},{toSorted:function(e){void 0!==e&&s(e);var t=o(this),i=a(u,t);return d(i,e)}}),c("toSorted")},1658:function(e,t,i){"use strict";var n=i(6518),r=i(6469),s=i(6837),o=i(6198),a=i(5610),l=i(5397),c=i(1291),u=Array,d=Math.max,h=Math.min;n({target:"Array",proto:!0},{toSpliced:function(e,t){var i,n,r,p,f=l(this),v=o(f),g=a(e,v),m=arguments.length,y=0;for(0===m?i=n=0:1===m?(i=0,n=v-g):(i=m-2,n=h(d(c(t),0),v-g)),r=s(v+i-n),p=u(r);y<g;y++)p[y]=f[y];for(;y<g+i;y++)p[y]=arguments[y-g+2];for(;y<r;y++)p[y]=f[y+n-i];return p}}),r("toSpliced")},8111:function(e,t,i){"use strict";var n=i(6518),r=i(4576),s=i(679),o=i(8551),a=i(4901),l=i(2787),c=i(2106),u=i(4659),d=i(9039),h=i(9297),p=i(8227),f=i(7657).IteratorPrototype,v=i(3724),g=i(6395),m="constructor",y="Iterator",b=p("toStringTag"),k=TypeError,T=r[y],S=g||!a(T)||T.prototype!==f||!d((function(){T({})})),w=function(){if(s(this,f),l(this)===f)throw new k("Abstract class Iterator not directly constructable")},E=function(e,t){v?c(f,e,{configurable:!0,get:function(){return t},set:function(t){if(o(this),this===f)throw new k("You can't redefine this property");h(this,e)?this[e]=t:u(this,e,t)}}):f[e]=t};h(f,b)||E(b,y),!S&&h(f,m)&&f[m]!==Object||E(m,w),w.prototype=f,n({global:!0,constructor:!0,forced:S},{Iterator:w})},1148:function(e,t,i){"use strict";var n=i(6518),r=i(2652),s=i(9306),o=i(8551),a=i(1767);n({target:"Iterator",proto:!0,real:!0},{every:function(e){o(this),s(e);var t=a(this),i=0;return!r(t,(function(t,n){if(!e(t,i++))return n()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},2489:function(e,t,i){"use strict";var n=i(6518),r=i(9565),s=i(9306),o=i(8551),a=i(1767),l=i(9462),c=i(6319),u=i(6395),d=l((function(){var e,t,i,n=this.iterator,s=this.predicate,a=this.next;while(1){if(e=o(r(a,n)),t=this.done=!!e.done,t)return;if(i=e.value,c(n,s,[i,this.counter++],!0))return i}}));n({target:"Iterator",proto:!0,real:!0,forced:u},{filter:function(e){return o(this),s(e),new d(a(this),{predicate:e})}})},116:function(e,t,i){"use strict";var n=i(6518),r=i(2652),s=i(9306),o=i(8551),a=i(1767);n({target:"Iterator",proto:!0,real:!0},{find:function(e){o(this),s(e);var t=a(this),i=0;return r(t,(function(t,n){if(e(t,i++))return n(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},7588:function(e,t,i){"use strict";var n=i(6518),r=i(2652),s=i(9306),o=i(8551),a=i(1767);n({target:"Iterator",proto:!0,real:!0},{forEach:function(e){o(this),s(e);var t=a(this),i=0;r(t,(function(t){e(t,i++)}),{IS_RECORD:!0})}})},1701:function(e,t,i){"use strict";var n=i(6518),r=i(713),s=i(6395);n({target:"Iterator",proto:!0,real:!0,forced:s},{map:r})},8237:function(e,t,i){"use strict";var n=i(6518),r=i(2652),s=i(9306),o=i(8551),a=i(1767),l=TypeError;n({target:"Iterator",proto:!0,real:!0},{reduce:function(e){o(this),s(e);var t=a(this),i=arguments.length<2,n=i?void 0:arguments[1],c=0;if(r(t,(function(t){i?(i=!1,n=t):n=e(n,t,c),c++}),{IS_RECORD:!0}),i)throw new l("Reduce of empty iterator with no initial value");return n}})},3579:function(e,t,i){"use strict";var n=i(6518),r=i(2652),s=i(9306),o=i(8551),a=i(1767);n({target:"Iterator",proto:!0,real:!0},{some:function(e){o(this),s(e);var t=a(this),i=0;return r(t,(function(t,n){if(e(t,i++))return n()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},9479:function(e,t,i){"use strict";var n=i(4576),r=i(3724),s=i(2106),o=i(7979),a=i(9039),l=n.RegExp,c=l.prototype,u=r&&a((function(){var e=!0;try{l(".","d")}catch(u){e=!1}var t={},i="",n=e?"dgimsy":"gimsy",r=function(e,n){Object.defineProperty(t,e,{get:function(){return i+=n,!0}})},s={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(s.hasIndices="d"),s)r(o,s[o]);var a=Object.getOwnPropertyDescriptor(c,"flags").get.call(t);return a!==n||i!==n}));u&&s(c,"flags",{configurable:!0,get:o})},7642:function(e,t,i){"use strict";var n=i(6518),r=i(3440),s=i(4916),o=!s("difference",(function(e){return 0===e.size}));n({target:"Set",proto:!0,real:!0,forced:o},{difference:r})},8004:function(e,t,i){"use strict";var n=i(6518),r=i(9039),s=i(8750),o=i(4916),a=!o("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||r((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));n({target:"Set",proto:!0,real:!0,forced:a},{intersection:s})},3853:function(e,t,i){"use strict";var n=i(6518),r=i(4449),s=i(4916),o=!s("isDisjointFrom",(function(e){return!e}));n({target:"Set",proto:!0,real:!0,forced:o},{isDisjointFrom:r})},5876:function(e,t,i){"use strict";var n=i(6518),r=i(3838),s=i(4916),o=!s("isSubsetOf",(function(e){return e}));n({target:"Set",proto:!0,real:!0,forced:o},{isSubsetOf:r})},2475:function(e,t,i){"use strict";var n=i(6518),r=i(8527),s=i(4916),o=!s("isSupersetOf",(function(e){return!e}));n({target:"Set",proto:!0,real:!0,forced:o},{isSupersetOf:r})},5024:function(e,t,i){"use strict";var n=i(6518),r=i(3650),s=i(4916);n({target:"Set",proto:!0,real:!0,forced:!s("symmetricDifference")},{symmetricDifference:r})},1698:function(e,t,i){"use strict";var n=i(6518),r=i(4204),s=i(4916);n({target:"Set",proto:!0,real:!0,forced:!s("union")},{union:r})},7467:function(e,t,i){"use strict";var n=i(7628),r=i(4644),s=r.aTypedArray,o=r.exportTypedArrayMethod,a=r.getTypedArrayConstructor;o("toReversed",(function(){return n(s(this),a(this))}))},4732:function(e,t,i){"use strict";var n=i(4644),r=i(9504),s=i(9306),o=i(5370),a=n.aTypedArray,l=n.getTypedArrayConstructor,c=n.exportTypedArrayMethod,u=r(n.TypedArrayPrototype.sort);c("toSorted",(function(e){void 0!==e&&s(e);var t=a(this),i=o(l(t),t);return u(i,e)}))},9577:function(e,t,i){"use strict";var n=i(9928),r=i(4644),s=i(1108),o=i(1291),a=i(5854),l=r.aTypedArray,c=r.getTypedArrayConstructor,u=r.exportTypedArrayMethod,d=!!function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}();u("with",{with:function(e,t){var i=l(this),r=o(e),u=s(i)?a(t):+t;return n(i,c(i),r,u)}}["with"],!d)},8992:function(e,t,i){"use strict";i(8111)},3215:function(e,t,i){"use strict";i(1148)},4520:function(e,t,i){"use strict";i(2489)},2577:function(e,t,i){"use strict";i(116)},3949:function(e,t,i){"use strict";i(7588)},1454:function(e,t,i){"use strict";i(1701)},8872:function(e,t,i){"use strict";i(8237)},7550:function(e,t,i){"use strict";i(3579)},6368:function(e,t,i){"use strict";var n=i(6518),r=i(4576),s=i(9225).clear;n({global:!0,bind:!0,enumerable:!0,forced:r.clearImmediate!==s},{clearImmediate:s})},4979:function(e,t,i){"use strict";var n=i(6518),r=i(4576),s=i(7751),o=i(6980),a=i(4913).f,l=i(9297),c=i(679),u=i(3167),d=i(2603),h=i(5002),p=i(8574),f=i(3724),v=i(6395),g="DOMException",m=s("Error"),y=s(g),b=function(){c(this,k);var e=arguments.length,t=d(e<1?void 0:arguments[0]),i=d(e<2?void 0:arguments[1],"Error"),n=new y(t,i),r=new m(t);return r.name=g,a(n,"stack",o(1,p(r.stack,1))),u(n,this,b),n},k=b.prototype=y.prototype,T="stack"in new m(g),S="stack"in new y(1,2),w=y&&f&&Object.getOwnPropertyDescriptor(r,g),E=!!w&&!(w.writable&&w.configurable),P=T&&!E&&!S;n({global:!0,constructor:!0,forced:v||P},{DOMException:P?b:y});var C=s(g),_=C.prototype;if(_.constructor!==C)for(var A in v||a(_,"constructor",o(1,C)),h)if(l(h,A)){var I=h[A],R=I.s;l(C,R)||a(C,R,o(6,I.c))}},9848:function(e,t,i){"use strict";i(6368),i(9309)},9309:function(e,t,i){"use strict";var n=i(6518),r=i(4576),s=i(9225).set,o=i(9472),a=r.setImmediate?o(s,!1):s;n({global:!0,bind:!0,enumerable:!0,forced:r.setImmediate!==a},{setImmediate:a})},4603:function(e,t,i){"use strict";var n=i(6840),r=i(9504),s=i(655),o=i(2812),a=URLSearchParams,l=a.prototype,c=r(l.append),u=r(l["delete"]),d=r(l.forEach),h=r([].push),p=new a("a=1&a=2&b=3");p["delete"]("a",1),p["delete"]("b",void 0),p+""!=="a=2"&&n(l,"delete",(function(e){var t=arguments.length,i=t<2?void 0:arguments[1];if(t&&void 0===i)return u(this,e);var n=[];d(this,(function(e,t){h(n,{key:t,value:e})})),o(t,1);var r,a=s(e),l=s(i),p=0,f=0,v=!1,g=n.length;while(p<g)r=n[p++],v||r.key===a?(v=!0,u(this,r.key)):f++;while(f<g)r=n[f++],r.key===a&&r.value===l||c(this,r.key,r.value)}),{enumerable:!0,unsafe:!0})},7566:function(e,t,i){"use strict";var n=i(6840),r=i(9504),s=i(655),o=i(2812),a=URLSearchParams,l=a.prototype,c=r(l.getAll),u=r(l.has),d=new a("a=1");!d.has("a",2)&&d.has("a",void 0)||n(l,"has",(function(e){var t=arguments.length,i=t<2?void 0:arguments[1];if(t&&void 0===i)return u(this,e);var n=c(this,e);o(t,1);var r=s(i),a=0;while(a<n.length)if(n[a++]===r)return!0;return!1}),{enumerable:!0,unsafe:!0})},8721:function(e,t,i){"use strict";var n=i(3724),r=i(9504),s=i(2106),o=URLSearchParams.prototype,a=r(o.forEach);n&&!("size"in o)&&s(o,"size",{get:function(){var e=0;return a(this,(function(){e++})),e},configurable:!0,enumerable:!0})},1387:function(e,t,i){"use strict";i.d(t,{LA:function(){return le},aE:function(){return rt}});i(4114),i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698),i(8992),i(3215),i(4520),i(2577),i(3949),i(1454),i(8872),i(7550);var n=i(6768),r=i(144);
/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */
const s="undefined"!==typeof document;function o(e){return"object"===typeof e||"displayName"in e||"props"in e||"__vccOpts"in e}function a(e){return e.__esModule||"Module"===e[Symbol.toStringTag]||e.default&&o(e.default)}const l=Object.assign;function c(e,t){const i={};for(const n in t){const r=t[n];i[n]=d(r)?r.map(e):e(r)}return i}const u=()=>{},d=Array.isArray;const h=/#/g,p=/&/g,f=/\//g,v=/=/g,g=/\?/g,m=/\+/g,y=/%5B/g,b=/%5D/g,k=/%5E/g,T=/%60/g,S=/%7B/g,w=/%7C/g,E=/%7D/g,P=/%20/g;function C(e){return encodeURI(""+e).replace(w,"|").replace(y,"[").replace(b,"]")}function _(e){return C(e).replace(S,"{").replace(E,"}").replace(k,"^")}function A(e){return C(e).replace(m,"%2B").replace(P,"+").replace(h,"%23").replace(p,"%26").replace(T,"`").replace(S,"{").replace(E,"}").replace(k,"^")}function I(e){return A(e).replace(v,"%3D")}function R(e){return C(e).replace(h,"%23").replace(g,"%3F")}function L(e){return null==e?"":R(e).replace(f,"%2F")}function D(e){try{return decodeURIComponent(""+e)}catch(t){}return""+e}const O=/\/$/,M=e=>e.replace(O,"");function x(e,t,i="/"){let n,r={},s="",o="";const a=t.indexOf("#");let l=t.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(n=t.slice(0,l),s=t.slice(l+1,a>-1?a:t.length),r=e(s)),a>-1&&(n=n||t.slice(0,a),o=t.slice(a,t.length)),n=V(null!=n?n:t,i),{fullPath:n+(s&&"?")+s+o,path:n,query:r,hash:D(o)}}function N(e,t){const i=t.query?e(t.query):"";return t.path+(i&&"?")+i+(t.hash||"")}function U(e,t){return t&&e.toLowerCase().startsWith(t.toLowerCase())?e.slice(t.length)||"/":e}function F(e,t,i){const n=t.matched.length-1,r=i.matched.length-1;return n>-1&&n===r&&j(t.matched[n],i.matched[r])&&B(t.params,i.params)&&e(t.query)===e(i.query)&&t.hash===i.hash}function j(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function B(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!G(e[i],t[i]))return!1;return!0}function G(e,t){return d(e)?$(e,t):d(t)?$(t,e):e===t}function $(e,t){return d(t)?e.length===t.length&&e.every(((e,i)=>e===t[i])):1===e.length&&e[0]===t}function V(e,t){if(e.startsWith("/"))return e;if(!e)return t;const i=t.split("/"),n=e.split("/"),r=n[n.length-1];".."!==r&&"."!==r||n.push("");let s,o,a=i.length-1;for(s=0;s<n.length;s++)if(o=n[s],"."!==o){if(".."!==o)break;a>1&&a--}return i.slice(0,a).join("/")+"/"+n.slice(s).join("/")}const W={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var H,q;(function(e){e["pop"]="pop",e["push"]="push"})(H||(H={})),function(e){e["back"]="back",e["forward"]="forward",e["unknown"]=""}(q||(q={}));function z(e){if(!e)if(s){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return"/"!==e[0]&&"#"!==e[0]&&(e="/"+e),M(e)}const K=/^[^#]+#/;function J(e,t){return e.replace(K,"#")+t}function Q(e,t){const i=document.documentElement.getBoundingClientRect(),n=e.getBoundingClientRect();return{behavior:t.behavior,left:n.left-i.left-(t.left||0),top:n.top-i.top-(t.top||0)}}const Y=()=>({left:window.scrollX,top:window.scrollY});function Z(e){let t;if("el"in e){const i=e.el,n="string"===typeof i&&i.startsWith("#");0;const r="string"===typeof i?n?document.getElementById(i.slice(1)):document.querySelector(i):i;if(!r)return;t=Q(r,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(null!=t.left?t.left:window.scrollX,null!=t.top?t.top:window.scrollY)}function X(e,t){const i=history.state?history.state.position-t:-1;return i+e}const ee=new Map;function te(e,t){ee.set(e,t)}function ie(e){const t=ee.get(e);return ee.delete(e),t}let ne=()=>location.protocol+"//"+location.host;function re(e,t){const{pathname:i,search:n,hash:r}=t,s=e.indexOf("#");if(s>-1){let t=r.includes(e.slice(s))?e.slice(s).length:1,i=r.slice(t);return"/"!==i[0]&&(i="/"+i),U(i,"")}const o=U(i,e);return o+n+r}function se(e,t,i,n){let r=[],s=[],o=null;const a=({state:s})=>{const a=re(e,location),l=i.value,c=t.value;let u=0;if(s){if(i.value=a,t.value=s,o&&o===l)return void(o=null);u=c?s.position-c.position:0}else n(a);r.forEach((e=>{e(i.value,l,{delta:u,type:H.pop,direction:u?u>0?q.forward:q.back:q.unknown})}))};function c(){o=i.value}function u(e){r.push(e);const t=()=>{const t=r.indexOf(e);t>-1&&r.splice(t,1)};return s.push(t),t}function d(){const{history:e}=window;e.state&&e.replaceState(l({},e.state,{scroll:Y()}),"")}function h(){for(const e of s)e();s=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:c,listen:u,destroy:h}}function oe(e,t,i,n=!1,r=!1){return{back:e,current:t,forward:i,replaced:n,position:window.history.length,scroll:r?Y():null}}function ae(e){const{history:t,location:i}=window,n={value:re(e,i)},r={value:t.state};function s(n,s,o){const a=e.indexOf("#"),l=a>-1?(i.host&&document.querySelector("base")?e:e.slice(a))+n:ne()+e+n;try{t[o?"replaceState":"pushState"](s,"",l),r.value=s}catch(c){console.error(c),i[o?"replace":"assign"](l)}}function o(e,i){const o=l({},t.state,oe(r.value.back,e,r.value.forward,!0),i,{position:r.value.position});s(e,o,!0),n.value=e}function a(e,i){const o=l({},r.value,t.state,{forward:e,scroll:Y()});s(o.current,o,!0);const a=l({},oe(n.value,e,null),{position:o.position+1},i);s(e,a,!1),n.value=e}return r.value||s(n.value,{back:null,current:n.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0),{location:n,state:r,push:a,replace:o}}function le(e){e=z(e);const t=ae(e),i=se(e,t.state,t.location,t.replace);function n(e,t=!0){t||i.pauseListeners(),history.go(e)}const r=l({location:"",base:e,go:n,createHref:J.bind(null,e)},t,i);return Object.defineProperty(r,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(r,"state",{enumerable:!0,get:()=>t.state.value}),r}function ce(e){return"string"===typeof e||e&&"object"===typeof e}function ue(e){return"string"===typeof e||"symbol"===typeof e}const de=Symbol("");var he;(function(e){e[e["aborted"]=4]="aborted",e[e["cancelled"]=8]="cancelled",e[e["duplicated"]=16]="duplicated"})(he||(he={}));function pe(e,t){return l(new Error,{type:e,[de]:!0},t)}function fe(e,t){return e instanceof Error&&de in e&&(null==t||!!(e.type&t))}const ve="[^/]+?",ge={sensitive:!1,strict:!1,start:!0,end:!0},me=/[.+*?^${}()[\]/\\]/g;function ye(e,t){const i=l({},ge,t),n=[];let r=i.start?"^":"";const s=[];for(const l of e){const e=l.length?[]:[90];i.strict&&!l.length&&(r+="/");for(let t=0;t<l.length;t++){const n=l[t];let o=40+(i.sensitive?.25:0);if(0===n.type)t||(r+="/"),r+=n.value.replace(me,"\\$&"),o+=40;else if(1===n.type){const{value:e,repeatable:i,optional:a,regexp:c}=n;s.push({name:e,repeatable:i,optional:a});const d=c||ve;if(d!==ve){o+=10;try{new RegExp(`(${d})`)}catch(u){throw new Error(`Invalid custom RegExp for param "${e}" (${d}): `+u.message)}}let h=i?`((?:${d})(?:/(?:${d}))*)`:`(${d})`;t||(h=a&&l.length<2?`(?:/${h})`:"/"+h),a&&(h+="?"),r+=h,o+=20,a&&(o+=-8),i&&(o+=-20),".*"===d&&(o+=-50)}e.push(o)}n.push(e)}if(i.strict&&i.end){const e=n.length-1;n[e][n[e].length-1]+=.7000000000000001}i.strict||(r+="/?"),i.end?r+="$":i.strict&&!r.endsWith("/")&&(r+="(?:/|$)");const o=new RegExp(r,i.sensitive?"":"i");function a(e){const t=e.match(o),i={};if(!t)return null;for(let n=1;n<t.length;n++){const e=t[n]||"",r=s[n-1];i[r.name]=e&&r.repeatable?e.split("/"):e}return i}function c(t){let i="",n=!1;for(const r of e){n&&i.endsWith("/")||(i+="/"),n=!1;for(const e of r)if(0===e.type)i+=e.value;else if(1===e.type){const{value:s,repeatable:o,optional:a}=e,l=s in t?t[s]:"";if(d(l)&&!o)throw new Error(`Provided param "${s}" is an array but it is not repeatable (* or + modifiers)`);const c=d(l)?l.join("/"):l;if(!c){if(!a)throw new Error(`Missing required param "${s}"`);r.length<2&&(i.endsWith("/")?i=i.slice(0,-1):n=!0)}i+=c}}return i||"/"}return{re:o,score:n,keys:s,parse:a,stringify:c}}function be(e,t){let i=0;while(i<e.length&&i<t.length){const n=t[i]-e[i];if(n)return n;i++}return e.length<t.length?1===e.length&&80===e[0]?-1:1:e.length>t.length?1===t.length&&80===t[0]?1:-1:0}function ke(e,t){let i=0;const n=e.score,r=t.score;while(i<n.length&&i<r.length){const e=be(n[i],r[i]);if(e)return e;i++}if(1===Math.abs(r.length-n.length)){if(Te(n))return 1;if(Te(r))return-1}return r.length-n.length}function Te(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const Se={type:0,value:""},we=/[a-zA-Z0-9_]/;function Ee(e){if(!e)return[[]];if("/"===e)return[[Se]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(e){throw new Error(`ERR (${i})/"${c}": ${e}`)}let i=0,n=i;const r=[];let s;function o(){s&&r.push(s),s=[]}let a,l=0,c="",u="";function d(){c&&(0===i?s.push({type:0,value:c}):1===i||2===i||3===i?(s.length>1&&("*"===a||"+"===a)&&t(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),s.push({type:1,value:c,regexp:u,repeatable:"*"===a||"+"===a,optional:"*"===a||"?"===a})):t("Invalid state to consume buffer"),c="")}function h(){c+=a}while(l<e.length)if(a=e[l++],"\\"!==a||2===i)switch(i){case 0:"/"===a?(c&&d(),o()):":"===a?(d(),i=1):h();break;case 4:h(),i=n;break;case 1:"("===a?i=2:we.test(a)?h():(d(),i=0,"*"!==a&&"?"!==a&&"+"!==a&&l--);break;case 2:")"===a?"\\"==u[u.length-1]?u=u.slice(0,-1)+a:i=3:u+=a;break;case 3:d(),i=0,"*"!==a&&"?"!==a&&"+"!==a&&l--,u="";break;default:t("Unknown state");break}else n=i,i=4;return 2===i&&t(`Unfinished custom RegExp for param "${c}"`),d(),o(),r}function Pe(e,t,i){const n=ye(Ee(e.path),i);const r=l(n,{record:e,parent:t,children:[],alias:[]});return t&&!r.record.aliasOf===!t.record.aliasOf&&t.children.push(r),r}function Ce(e,t){const i=[],n=new Map;function r(e){return n.get(e)}function s(e,i,n){const r=!n,a=Ae(e);a.aliasOf=n&&n.record;const d=De(t,e),h=[a];if("alias"in e){const t="string"===typeof e.alias?[e.alias]:e.alias;for(const e of t)h.push(Ae(l({},a,{components:n?n.record.components:a.components,path:e,aliasOf:n?n.record:a})))}let p,f;for(const t of h){const{path:l}=t;if(i&&"/"!==l[0]){const e=i.record.path,n="/"===e[e.length-1]?"":"/";t.path=i.record.path+(l&&n+l)}if(p=Pe(t,i,d),n?n.alias.push(p):(f=f||p,f!==p&&f.alias.push(p),r&&e.name&&!Re(p)&&o(e.name)),xe(p)&&c(p),a.children){const e=a.children;for(let t=0;t<e.length;t++)s(e[t],p,n&&n.children[t])}n=n||p}return f?()=>{o(f)}:u}function o(e){if(ue(e)){const t=n.get(e);t&&(n.delete(e),i.splice(i.indexOf(t),1),t.children.forEach(o),t.alias.forEach(o))}else{const t=i.indexOf(e);t>-1&&(i.splice(t,1),e.record.name&&n.delete(e.record.name),e.children.forEach(o),e.alias.forEach(o))}}function a(){return i}function c(e){const t=Oe(e,i);i.splice(t,0,e),e.record.name&&!Re(e)&&n.set(e.record.name,e)}function d(e,t){let r,s,o,a={};if("name"in e&&e.name){if(r=n.get(e.name),!r)throw pe(1,{location:e});0,o=r.record.name,a=l(_e(t.params,r.keys.filter((e=>!e.optional)).concat(r.parent?r.parent.keys.filter((e=>e.optional)):[]).map((e=>e.name))),e.params&&_e(e.params,r.keys.map((e=>e.name)))),s=r.stringify(a)}else if(null!=e.path)s=e.path,r=i.find((e=>e.re.test(s))),r&&(a=r.parse(s),o=r.record.name);else{if(r=t.name?n.get(t.name):i.find((e=>e.re.test(t.path))),!r)throw pe(1,{location:e,currentLocation:t});o=r.record.name,a=l({},t.params,e.params),s=r.stringify(a)}const c=[];let u=r;while(u)c.unshift(u.record),u=u.parent;return{name:o,path:s,params:a,matched:c,meta:Le(c)}}function h(){i.length=0,n.clear()}return t=De({strict:!1,end:!0,sensitive:!1},t),e.forEach((e=>s(e))),{addRoute:s,resolve:d,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:r}}function _e(e,t){const i={};for(const n of t)n in e&&(i[n]=e[n]);return i}function Ae(e){const t={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:Ie(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function Ie(e){const t={},i=e.props||!1;if("component"in e)t.default=i;else for(const n in e.components)t[n]="object"===typeof i?i[n]:i;return t}function Re(e){while(e){if(e.record.aliasOf)return!0;e=e.parent}return!1}function Le(e){return e.reduce(((e,t)=>l(e,t.meta)),{})}function De(e,t){const i={};for(const n in e)i[n]=n in t?t[n]:e[n];return i}function Oe(e,t){let i=0,n=t.length;while(i!==n){const r=i+n>>1,s=ke(e,t[r]);s<0?n=r:i=r+1}const r=Me(e);return r&&(n=t.lastIndexOf(r,n-1)),n}function Me(e){let t=e;while(t=t.parent)if(xe(t)&&0===ke(e,t))return t}function xe({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function Ne(e){const t={};if(""===e||"?"===e)return t;const i="?"===e[0],n=(i?e.slice(1):e).split("&");for(let r=0;r<n.length;++r){const e=n[r].replace(m," "),i=e.indexOf("="),s=D(i<0?e:e.slice(0,i)),o=i<0?null:D(e.slice(i+1));if(s in t){let e=t[s];d(e)||(e=t[s]=[e]),e.push(o)}else t[s]=o}return t}function Ue(e){let t="";for(let i in e){const n=e[i];if(i=I(i),null==n){void 0!==n&&(t+=(t.length?"&":"")+i);continue}const r=d(n)?n.map((e=>e&&A(e))):[n&&A(n)];r.forEach((e=>{void 0!==e&&(t+=(t.length?"&":"")+i,null!=e&&(t+="="+e))}))}return t}function Fe(e){const t={};for(const i in e){const n=e[i];void 0!==n&&(t[i]=d(n)?n.map((e=>null==e?null:""+e)):null==n?n:""+n)}return t}const je=Symbol(""),Be=Symbol(""),Ge=Symbol(""),$e=Symbol(""),Ve=Symbol("");function We(){let e=[];function t(t){return e.push(t),()=>{const i=e.indexOf(t);i>-1&&e.splice(i,1)}}function i(){e=[]}return{add:t,list:()=>e.slice(),reset:i}}function He(e,t,i,n,r,s=e=>e()){const o=n&&(n.enterCallbacks[r]=n.enterCallbacks[r]||[]);return()=>new Promise(((a,l)=>{const c=e=>{!1===e?l(pe(4,{from:i,to:t})):e instanceof Error?l(e):ce(e)?l(pe(2,{from:t,to:e})):(o&&n.enterCallbacks[r]===o&&"function"===typeof e&&o.push(e),a())},u=s((()=>e.call(n&&n.instances[r],t,i,c)));let d=Promise.resolve(u);e.length<3&&(d=d.then(c)),d.catch((e=>l(e)))}))}function qe(e,t,i,n,r=e=>e()){const s=[];for(const l of e){0;for(const e in l.components){let c=l.components[e];if("beforeRouteEnter"===t||l.instances[e])if(o(c)){const o=c.__vccOpts||c,a=o[t];a&&s.push(He(a,i,n,l,e,r))}else{let o=c();0,s.push((()=>o.then((s=>{if(!s)throw new Error(`Couldn't resolve component "${e}" at "${l.path}"`);const o=a(s)?s.default:s;l.mods[e]=s,l.components[e]=o;const c=o.__vccOpts||o,u=c[t];return u&&He(u,i,n,l,e,r)()}))))}}}return s}function ze(e){const t=(0,n.WQ)(Ge),i=(0,n.WQ)($e);const s=(0,n.EW)((()=>{const i=(0,r.R1)(e.to);return t.resolve(i)})),o=(0,n.EW)((()=>{const{matched:e}=s.value,{length:t}=e,n=e[t-1],r=i.matched;if(!n||!r.length)return-1;const o=r.findIndex(j.bind(null,n));if(o>-1)return o;const a=Xe(e[t-2]);return t>1&&Xe(n)===a&&r[r.length-1].path!==a?r.findIndex(j.bind(null,e[t-2])):o})),a=(0,n.EW)((()=>o.value>-1&&Ze(i.params,s.value.params))),l=(0,n.EW)((()=>o.value>-1&&o.value===i.matched.length-1&&B(i.params,s.value.params)));function c(i={}){if(Ye(i)){const i=t[(0,r.R1)(e.replace)?"replace":"push"]((0,r.R1)(e.to)).catch(u);return e.viewTransition&&"undefined"!==typeof document&&"startViewTransition"in document&&document.startViewTransition((()=>i)),i}return Promise.resolve()}return{route:s,href:(0,n.EW)((()=>s.value.href)),isActive:a,isExactActive:l,navigate:c}}function Ke(e){return 1===e.length?e[0]:e}const Je=(0,n.pM)({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:ze,setup(e,{slots:t}){const i=(0,r.Kh)(ze(e)),{options:s}=(0,n.WQ)(Ge),o=(0,n.EW)((()=>({[et(e.activeClass,s.linkActiveClass,"router-link-active")]:i.isActive,[et(e.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:i.isExactActive})));return()=>{const r=t.default&&Ke(t.default(i));return e.custom?r:(0,n.h)("a",{"aria-current":i.isExactActive?e.ariaCurrentValue:null,href:i.href,onClick:i.navigate,class:o.value},r)}}}),Qe=Je;function Ye(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&(void 0===e.button||0===e.button)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function Ze(e,t){for(const i in t){const n=t[i],r=e[i];if("string"===typeof n){if(n!==r)return!1}else if(!d(r)||r.length!==n.length||n.some(((e,t)=>e!==r[t])))return!1}return!0}function Xe(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const et=(e,t,i)=>null!=e?e:null!=t?t:i,tt=(0,n.pM)({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:i}){const s=(0,n.WQ)(Ve),o=(0,n.EW)((()=>e.route||s.value)),a=(0,n.WQ)(Be,0),c=(0,n.EW)((()=>{let e=(0,r.R1)(a);const{matched:t}=o.value;let i;while((i=t[e])&&!i.components)e++;return e})),u=(0,n.EW)((()=>o.value.matched[c.value]));(0,n.Gt)(Be,(0,n.EW)((()=>c.value+1))),(0,n.Gt)(je,u),(0,n.Gt)(Ve,o);const d=(0,r.KR)();return(0,n.wB)((()=>[d.value,u.value,e.name]),(([e,t,i],[n,r,s])=>{t&&(t.instances[i]=e,r&&r!==t&&e&&e===n&&(t.leaveGuards.size||(t.leaveGuards=r.leaveGuards),t.updateGuards.size||(t.updateGuards=r.updateGuards))),!e||!t||r&&j(t,r)&&n||(t.enterCallbacks[i]||[]).forEach((t=>t(e)))}),{flush:"post"}),()=>{const r=o.value,s=e.name,a=u.value,c=a&&a.components[s];if(!c)return it(i.default,{Component:c,route:r});const h=a.props[s],p=h?!0===h?r.params:"function"===typeof h?h(r):h:null,f=e=>{e.component.isUnmounted&&(a.instances[s]=null)},v=(0,n.h)(c,l({},p,t,{onVnodeUnmounted:f,ref:d}));return it(i.default,{Component:v,route:r})||v}}});function it(e,t){if(!e)return null;const i=e(t);return 1===i.length?i[0]:i}const nt=tt;function rt(e){const t=Ce(e.routes,e),i=e.parseQuery||Ne,o=e.stringifyQuery||Ue,a=e.history;const h=We(),p=We(),f=We(),v=(0,r.IJ)(W);let g=W;s&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const m=c.bind(null,(e=>""+e)),y=c.bind(null,L),b=c.bind(null,D);function k(e,i){let n,r;return ue(e)?(n=t.getRecordMatcher(e),r=i):r=e,t.addRoute(r,n)}function T(e){const i=t.getRecordMatcher(e);i&&t.removeRoute(i)}function S(){return t.getRoutes().map((e=>e.record))}function w(e){return!!t.getRecordMatcher(e)}function E(e,n){if(n=l({},n||v.value),"string"===typeof e){const r=x(i,e,n.path),s=t.resolve({path:r.path},n),o=a.createHref(r.fullPath);return l(r,s,{params:b(s.params),hash:D(r.hash),redirectedFrom:void 0,href:o})}let r;if(null!=e.path)r=l({},e,{path:x(i,e.path,n.path).path});else{const t=l({},e.params);for(const e in t)null==t[e]&&delete t[e];r=l({},e,{params:y(t)}),n.params=y(n.params)}const s=t.resolve(r,n),c=e.hash||"";s.params=m(b(s.params));const u=N(o,l({},e,{hash:_(c),path:s.path})),d=a.createHref(u);return l({fullPath:u,hash:c,query:o===Ue?Fe(e.query):e.query||{}},s,{redirectedFrom:void 0,href:d})}function P(e){return"string"===typeof e?x(i,e,v.value.path):l({},e)}function C(e,t){if(g!==e)return pe(8,{from:t,to:e})}function A(e){return O(e)}function I(e){return A(l(P(e),{replace:!0}))}function R(e){const t=e.matched[e.matched.length-1];if(t&&t.redirect){const{redirect:i}=t;let n="function"===typeof i?i(e):i;return"string"===typeof n&&(n=n.includes("?")||n.includes("#")?n=P(n):{path:n},n.params={}),l({query:e.query,hash:e.hash,params:null!=n.path?{}:e.params},n)}}function O(e,t){const i=g=E(e),n=v.value,r=e.state,s=e.force,a=!0===e.replace,c=R(i);if(c)return O(l(P(c),{state:"object"===typeof c?l({},r,c.state):r,force:s,replace:a}),t||i);const u=i;let d;return u.redirectedFrom=t,!s&&F(o,n,i)&&(d=pe(16,{to:u,from:n}),ne(n,n,!0,!1)),(d?Promise.resolve(d):j(u,n)).catch((e=>fe(e)?fe(e,2)?e:ee(e):J(e,u,n))).then((e=>{if(e){if(fe(e,2))return O(l({replace:a},P(e.to),{state:"object"===typeof e.to?l({},r,e.to.state):r,force:s}),t||u)}else e=G(u,n,!0,a,r);return B(u,n,e),e}))}function M(e,t){const i=C(e,t);return i?Promise.reject(i):Promise.resolve()}function U(e){const t=oe.values().next().value;return t&&"function"===typeof t.runWithContext?t.runWithContext(e):e()}function j(e,t){let i;const[n,r,s]=st(e,t);i=qe(n.reverse(),"beforeRouteLeave",e,t);for(const a of n)a.leaveGuards.forEach((n=>{i.push(He(n,e,t))}));const o=M.bind(null,e,t);return i.push(o),le(i).then((()=>{i=[];for(const n of h.list())i.push(He(n,e,t));return i.push(o),le(i)})).then((()=>{i=qe(r,"beforeRouteUpdate",e,t);for(const n of r)n.updateGuards.forEach((n=>{i.push(He(n,e,t))}));return i.push(o),le(i)})).then((()=>{i=[];for(const n of s)if(n.beforeEnter)if(d(n.beforeEnter))for(const r of n.beforeEnter)i.push(He(r,e,t));else i.push(He(n.beforeEnter,e,t));return i.push(o),le(i)})).then((()=>(e.matched.forEach((e=>e.enterCallbacks={})),i=qe(s,"beforeRouteEnter",e,t,U),i.push(o),le(i)))).then((()=>{i=[];for(const n of p.list())i.push(He(n,e,t));return i.push(o),le(i)})).catch((e=>fe(e,8)?e:Promise.reject(e)))}function B(e,t,i){f.list().forEach((n=>U((()=>n(e,t,i)))))}function G(e,t,i,n,r){const o=C(e,t);if(o)return o;const c=t===W,u=s?history.state:{};i&&(n||c?a.replace(e.fullPath,l({scroll:c&&u&&u.scroll},r)):a.push(e.fullPath,r)),v.value=e,ne(e,t,i,c),ee()}let $;function V(){$||($=a.listen(((e,t,i)=>{if(!ae.listening)return;const n=E(e),r=R(n);if(r)return void O(l(r,{replace:!0,force:!0}),n).catch(u);g=n;const o=v.value;s&&te(X(o.fullPath,i.delta),Y()),j(n,o).catch((e=>fe(e,12)?e:fe(e,2)?(O(l(P(e.to),{force:!0}),n).then((e=>{fe(e,20)&&!i.delta&&i.type===H.pop&&a.go(-1,!1)})).catch(u),Promise.reject()):(i.delta&&a.go(-i.delta,!1),J(e,n,o)))).then((e=>{e=e||G(n,o,!1),e&&(i.delta&&!fe(e,8)?a.go(-i.delta,!1):i.type===H.pop&&fe(e,20)&&a.go(-1,!1)),B(n,o,e)})).catch(u)})))}let q,z=We(),K=We();function J(e,t,i){ee(e);const n=K.list();return n.length?n.forEach((n=>n(e,t,i))):console.error(e),Promise.reject(e)}function Q(){return q&&v.value!==W?Promise.resolve():new Promise(((e,t)=>{z.add([e,t])}))}function ee(e){return q||(q=!e,V(),z.list().forEach((([t,i])=>e?i(e):t())),z.reset()),e}function ne(t,i,r,o){const{scrollBehavior:a}=e;if(!s||!a)return Promise.resolve();const l=!r&&ie(X(t.fullPath,0))||(o||!r)&&history.state&&history.state.scroll||null;return(0,n.dY)().then((()=>a(t,i,l))).then((e=>e&&Z(e))).catch((e=>J(e,t,i)))}const re=e=>a.go(e);let se;const oe=new Set,ae={currentRoute:v,listening:!0,addRoute:k,removeRoute:T,clearRoutes:t.clearRoutes,hasRoute:w,getRoutes:S,resolve:E,options:e,push:A,replace:I,go:re,back:()=>re(-1),forward:()=>re(1),beforeEach:h.add,beforeResolve:p.add,afterEach:f.add,onError:K.add,isReady:Q,install(e){const t=this;e.component("RouterLink",Qe),e.component("RouterView",nt),e.config.globalProperties.$router=t,Object.defineProperty(e.config.globalProperties,"$route",{enumerable:!0,get:()=>(0,r.R1)(v)}),s&&!se&&v.value===W&&(se=!0,A(a.location).catch((e=>{0})));const i={};for(const r in W)Object.defineProperty(i,r,{get:()=>v.value[r],enumerable:!0});e.provide(Ge,t),e.provide($e,(0,r.Gc)(i)),e.provide(Ve,v);const n=e.unmount;oe.add(e),e.unmount=function(){oe.delete(e),oe.size<1&&(g=W,$&&$(),$=null,v.value=W,se=!1,q=!1),n()}}};function le(e){return e.reduce(((e,t)=>e.then((()=>U(t)))),Promise.resolve())}return ae}function st(e,t){const i=[],n=[],r=[],s=Math.max(t.matched.length,e.matched.length);for(let o=0;o<s;o++){const s=t.matched[o];s&&(e.matched.find((e=>j(e,s)))?n.push(s):i.push(s));const a=e.matched[o];a&&(t.matched.find((e=>j(e,a)))||r.push(a))}return[i,n,r]}}}]);
//# sourceMappingURL=chunk-vendors.d6cec260.js.map